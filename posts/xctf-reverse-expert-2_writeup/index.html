<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>XCTF REVERSE Expert (2) Writeup | Jasmine❀Hiker</title><meta name=keywords content="ctf,writeup,reverse"><meta name=description content="XCTF-REVERSE-高手区-2 writeup 感觉攻防世界的逆向题目还是蛮有意思的，刷着玩玩，就当作闯关游戏一样！
0x0 EasyRE 使用DIE查看一下程序信息：
无壳32位程序，直接静态分析走起！
int __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v3; // kr00_4 int v4; // edx char *v5; // esi char v6; // al unsigned int i; // edx int v8; // eax char Arglist[16]; // [esp+2h] [ebp-24h] BYREF __int64 v11; // [esp+12h] [ebp-14h] BYREF int v12; // [esp+1Ah] [ebp-Ch] __int16 v13; // [esp+1Eh] [ebp-8h] sub_401020(Format, Arglist[0]); v12 = 0; v13 = 0; *(_OWORD *)Arglist = 0i64; v11 = 0i64; sub_401050(&#34;%s&#34;, (char)Arglist); v3 = strlen(Arglist); if ( v3 >= 0x10 && v3 == 24 ) { v4 = 0; v5 = (char *)&amp;v11 + 7; do { v6 = *v5--; byte_40336C[v4++] = v6; } while ( v4 < 24 ); for ( i = 0; i < 0x18; ++i ) byte_40336C[i] = (byte_40336C[i] + 1) ^ 6; v8 = strcmp(byte_40336C, aXircjR2twsv3pt); if ( v8 ) v8 = v8 < 0 ?"><meta name=author content="Me"><link rel=canonical href=/posts/xctf-reverse-expert-2_writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=apple-touch-icon href=apple-touch-icon.png><link rel=mask-icon href=safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="XCTF REVERSE Expert (2) Writeup"><meta property="og:description" content="XCTF-REVERSE-高手区-2 writeup 感觉攻防世界的逆向题目还是蛮有意思的，刷着玩玩，就当作闯关游戏一样！
0x0 EasyRE 使用DIE查看一下程序信息：
无壳32位程序，直接静态分析走起！
int __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v3; // kr00_4 int v4; // edx char *v5; // esi char v6; // al unsigned int i; // edx int v8; // eax char Arglist[16]; // [esp+2h] [ebp-24h] BYREF __int64 v11; // [esp+12h] [ebp-14h] BYREF int v12; // [esp+1Ah] [ebp-Ch] __int16 v13; // [esp+1Eh] [ebp-8h] sub_401020(Format, Arglist[0]); v12 = 0; v13 = 0; *(_OWORD *)Arglist = 0i64; v11 = 0i64; sub_401050(&#34;%s&#34;, (char)Arglist); v3 = strlen(Arglist); if ( v3 >= 0x10 && v3 == 24 ) { v4 = 0; v5 = (char *)&amp;v11 + 7; do { v6 = *v5--; byte_40336C[v4++] = v6; } while ( v4 < 24 ); for ( i = 0; i < 0x18; ++i ) byte_40336C[i] = (byte_40336C[i] + 1) ^ 6; v8 = strcmp(byte_40336C, aXircjR2twsv3pt); if ( v8 ) v8 = v8 < 0 ?"><meta property="og:type" content="article"><meta property="og:url" content="/posts/xctf-reverse-expert-2_writeup/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-28T19:33:59+08:00"><meta property="article:modified_time" content="2022-01-28T19:33:59+08:00"><meta property="og:site_name" content="Jasmine❀Hiker"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="XCTF REVERSE Expert (2) Writeup"><meta name=twitter:description content="XCTF-REVERSE-高手区-2 writeup 感觉攻防世界的逆向题目还是蛮有意思的，刷着玩玩，就当作闯关游戏一样！
0x0 EasyRE 使用DIE查看一下程序信息：
无壳32位程序，直接静态分析走起！
int __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v3; // kr00_4 int v4; // edx char *v5; // esi char v6; // al unsigned int i; // edx int v8; // eax char Arglist[16]; // [esp+2h] [ebp-24h] BYREF __int64 v11; // [esp+12h] [ebp-14h] BYREF int v12; // [esp+1Ah] [ebp-Ch] __int16 v13; // [esp+1Eh] [ebp-8h] sub_401020(Format, Arglist[0]); v12 = 0; v13 = 0; *(_OWORD *)Arglist = 0i64; v11 = 0i64; sub_401050(&#34;%s&#34;, (char)Arglist); v3 = strlen(Arglist); if ( v3 >= 0x10 && v3 == 24 ) { v4 = 0; v5 = (char *)&amp;v11 + 7; do { v6 = *v5--; byte_40336C[v4++] = v6; } while ( v4 < 24 ); for ( i = 0; i < 0x18; ++i ) byte_40336C[i] = (byte_40336C[i] + 1) ^ 6; v8 = strcmp(byte_40336C, aXircjR2twsv3pt); if ( v8 ) v8 = v8 < 0 ?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"XCTF REVERSE Expert (2) Writeup","item":"/posts/xctf-reverse-expert-2_writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"XCTF REVERSE Expert (2) Writeup","name":"XCTF REVERSE Expert (2) Writeup","description":"XCTF-REVERSE-高手区-2 writeup 感觉攻防世界的逆向题目还是蛮有意思的，刷着玩玩，就当作闯关游戏一样！\n0x0 EasyRE 使用DIE查看一下程序信息：\n无壳32位程序，直接静态分析走起！\nint __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v3; // kr00_4 int v4; // edx char *v5; // esi char v6; // al unsigned int i; // edx int v8; // eax char Arglist[16]; // [esp+2h] [ebp-24h] BYREF __int64 v11; // [esp+12h] [ebp-14h] BYREF int v12; // [esp+1Ah] [ebp-Ch] __int16 v13; // [esp+1Eh] [ebp-8h] sub_401020(Format, Arglist[0]); v12 = 0; v13 = 0; *(_OWORD *)Arglist = 0i64; v11 = 0i64; sub_401050(\u0026#34;%s\u0026#34;, (char)Arglist); v3 = strlen(Arglist); if ( v3 \u0026gt;= 0x10 \u0026amp;\u0026amp; v3 == 24 ) { v4 = 0; v5 = (char *)\u0026amp;v11 + 7; do { v6 = *v5--; byte_40336C[v4++] = v6; } while ( v4 \u0026lt; 24 ); for ( i = 0; i \u0026lt; 0x18; ++i ) byte_40336C[i] = (byte_40336C[i] + 1) ^ 6; v8 = strcmp(byte_40336C, aXircjR2twsv3pt); if ( v8 ) v8 = v8 \u0026lt; 0 ?","keywords":["ctf","writeup","reverse"],"articleBody":"XCTF-REVERSE-高手区-2 writeup 感觉攻防世界的逆向题目还是蛮有意思的，刷着玩玩，就当作闯关游戏一样！\n0x0 EasyRE 使用DIE查看一下程序信息：\n无壳32位程序，直接静态分析走起！\nint __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v3; // kr00_4 int v4; // edx char *v5; // esi char v6; // al unsigned int i; // edx int v8; // eax char Arglist[16]; // [esp+2h] [ebp-24h] BYREF __int64 v11; // [esp+12h] [ebp-14h] BYREF int v12; // [esp+1Ah] [ebp-Ch] __int16 v13; // [esp+1Eh] [ebp-8h] sub_401020(Format, Arglist[0]); v12 = 0; v13 = 0; *(_OWORD *)Arglist = 0i64; v11 = 0i64; sub_401050(\"%s\", (char)Arglist); v3 = strlen(Arglist); if ( v3 \u003e= 0x10 \u0026\u0026 v3 == 24 ) { v4 = 0; v5 = (char *)\u0026v11 + 7; do { v6 = *v5--; byte_40336C[v4++] = v6; } while ( v4 \u003c 24 ); for ( i = 0; i \u003c 0x18; ++i ) byte_40336C[i] = (byte_40336C[i] + 1) ^ 6; v8 = strcmp(byte_40336C, aXircjR2twsv3pt); if ( v8 ) v8 = v8 \u003c 0 ? -1 : 1; if ( !v8 ) { sub_401020(\"right\\n\", Arglist[0]); system(\"pause\"); } } return 0; } 看代码，应该是比较简单的。但是需要对代码进行相对比较仔细的审计，来确保代码审计的成功\n首先程序先对数组进行了倒序处理\nv4 = 0; v5 = (char *)\u0026v11 + 7; do { v6 = *v5--; byte_40336C[v4++] = v6; } while ( v4 \u003c 24 ); 然后是对数据进行处理\nfor ( i = 0; i \u003c 0x18; ++i ) byte_40336C[i] = (byte_40336C[i] + 1) ^ 6; 而我们的目标是得到原始匹配的输入数据来获取到flag\n编写一个小程序来获得flag\n#include #include int main() { int data[]{ 0x78, 0x49, 0x72, 0x43, 0x6A, 0x7E, 0x3C, 0x72, 0x7C, 0x32, 0x74, 0x57, 0x73, 0x76, 0x33, 0x50, 0x74, 0x49, 0x7F, 0x7A, 0x6E, 0x64, 0x6B, 0x61 }; for(int i{ 0 };i\u003c24;i++) { data[i] = (data[i]^6)-1; } for(int j{23};j\u003e=0;j--) { putchar(data[j]); } return 0; } 编译并运行程序得到：\nflag{xNqU4otPq3ys9wkDsN} 0x1 Shuffle 丢到DIE探测一波：\n没有壳，32位的Ubuntu编译的程序，直接静态分析\nint __cdecl main(int argc, const char **argv, const char **envp) { time_t v3; // ebx __pid_t v4; // eax int i; // [esp+14h] [ebp-44h] unsigned int v7; // [esp+18h] [ebp-40h] unsigned int v8; // [esp+1Ch] [ebp-3Ch] char v9; // [esp+20h] [ebp-38h] char s[40]; // [esp+24h] [ebp-34h] BYREF unsigned int v11; // [esp+4Ch] [ebp-Ch] v11 = __readgsdword(0x14u); strcpy(s, \"SECCON{Welcome to the SECCON 2014 CTF!}\"); v3 = time(0); v4 = getpid(); srand(v3 + v4); for ( i = 0; i \u003c= 99; ++i ) { v7 = rand() % 0x28u; v8 = rand() % 0x28u; v9 = s[v7]; s[v7] = s[v8]; s[v8] = v9; } puts(s); return 0; } 由于题目描述：\n找到字符串在随机化之前 故flag为：\nSECCON{Welcome to the SECCON 2014 CTF!} 0x2 re-for-50-plz-50 使用DIE查看程序信息：\n没有壳32位程序，直接静态分析：\nint __cdecl __noreturn main(int argc, const char **argv, const char **envp) { int i; // [sp+18h] [+18h] for ( i = 0; i \u003c 31; ++i ) { if ( meow[i] != (char)(argv[1][i] ^ 0x37) ) { print(\"NOOOOOOOOOOOOOOOOOO\\n\"); exit_funct(); } } puts(\"C0ngr4ssulations!! U did it.\", argv, envp); exit_funct(); } 代码非常简单，就是对程序静态字符串进行按位异或操作，编写一个程序来求解：\n#include int main() { int meow[]{ 0x63, 0x62, 0x74, 0x63, 0x71, 0x4C, 0x55, 0x42, 0x43, 0x68, 0x45, 0x52, 0x56, 0x5B, 0x5B, 0x4E, 0x68, 0x40, 0x5F, 0x58, 0x5E, 0x44, 0x5D, 0x58, 0x5F, 0x59, 0x50, 0x56, 0x5B, 0x43, 0x4A }; int f{0x37}; for(int i{0};i\u003c31;i++) { putchar(meow[i]^f); } return 0; } 编译并运行得到：\nTUCTF{but_really_whoisjohngalt} 0x3 dmd-50 使用DIE来进行探测：\n64位ELF程序，静态分析一探究竟：\n看样子应该是C++编写的程序，可以发现汇编代码有个md5的函数，应该是使用了md5加密\n后面的汇编语句进行了一系列的比较操作：\n0x00400f36 cmp al, 0x37 ; 55 0x00400f38 jne 0x40129b 0x00400f3e mov rax, qword [var_58h] 0x00400f42 add rax, 1 0x00400f46 movzx eax, byte [rax] 0x00400f49 cmp al, 0x38 ; 56 0x00400f4b jne 0x40129b 0x00400f51 mov rax, qword [var_58h] 0x00400f55 add rax, 2 0x00400f59 movzx eax, byte [rax] 0x00400f5c cmp al, 0x30 ; 48 0x00400f5e jne 0x40129b 0x00400f64 mov rax, qword [var_58h] 0x00400f68 add rax, 3 0x00400f6c movzx eax, byte [rax] 0x00400f6f cmp al, 0x34 ; 52 0x00400f71 jne 0x40129b 0x00400f77 mov rax, qword [var_58h] 0x00400f7b add rax, 4 0x00400f7f movzx eax, byte [rax] 0x00400f82 cmp al, 0x33 ; 51 0x00400f84 jne 0x40129b 0x00400f8a mov rax, qword [var_58h] 0x00400f8e add rax, 5 0x00400f92 movzx eax, byte [rax] 0x00400f95 cmp al, 0x38 ; 56 0x00400f97 jne 0x40129b 0x00400f9d mov rax, qword [var_58h] 0x00400fa1 add rax, 6 0x00400fa5 movzx eax, byte [rax] 0x00400fa8 cmp al, 0x64 ; 100 0x00400faa jne 0x40129b 0x00400fb0 mov rax, qword [var_58h] 0x00400fb4 add rax, 7 0x00400fb8 movzx eax, byte [rax] 0x00400fbb cmp al, 0x35 ; 53 0x00400fbd jne 0x40129b 0x00400fc3 mov rax, qword [var_58h] 0x00400fc7 add rax, 8 0x00400fcb movzx eax, byte [rax] 0x00400fce cmp al, 0x62 ; 98 0x00400fd0 jne 0x40129b 0x00400fd6 mov rax, qword [var_58h] 0x00400fda add rax, 9 0x00400fde movzx eax, byte [rax] 0x00400fe1 cmp al, 0x36 ; 54 0x00400fe3 jne 0x40129b 0x00400fe9 mov rax, qword [var_58h] 0x00400fed add rax, 0xa 0x00400ff1 movzx eax, byte [rax] 0x00400ff4 cmp al, 0x65 ; 101 0x00400ff6 jne 0x40129b 0x00400ffc mov rax, qword [var_58h] 0x00401000 add rax, 0xb ; 11 0x00401004 movzx eax, byte [rax] 0x00401007 cmp al, 0x32 ; 50 0x00401009 jne 0x40129b 0x0040100f mov rax, qword [var_58h] 0x00401013 add rax, 0xc ; 12 0x00401017 movzx eax, byte [rax] 0x0040101a cmp al, 0x39 ; 57 0x0040101c jne 0x40129b 0x00401022 mov rax, qword [var_58h] 0x00401026 add rax, 0xd ; 13 0x0040102a movzx eax, byte [rax] 0x0040102d cmp al, 0x64 ; 100 0x0040102f jne 0x40129b 0x00401035 mov rax, qword [var_58h] 0x00401039 add rax, 0xe ; 14 0x0040103d movzx eax, byte [rax] 0x00401040 cmp al, 0x62 ; 98 0x00401042 jne 0x40129b 0x00401048 mov rax, qword [var_58h] 0x0040104c add rax, 0xf ; 15 0x00401050 movzx eax, byte [rax] 0x00401053 cmp al, 0x30 ; 48 0x00401055 jne 0x40129b 0x0040105b mov rax, qword [var_58h] 0x0040105f add rax, 0x10 ; 16 0x00401063 movzx eax, byte [rax] 0x00401066 cmp al, 0x38 ; 56 0x00401068 jne 0x40129b 0x0040106e mov rax, qword [var_58h] 0x00401072 add rax, 0x11 ; 17 0x00401076 movzx eax, byte [rax] 0x00401079 cmp al, 0x39 ; 57 0x0040107b jne 0x40129b 0x00401081 mov rax, qword [var_58h] 0x00401085 add rax, 0x12 ; 18 0x00401089 movzx eax, byte [rax] 0x0040108c cmp al, 0x38 ; 56 0x0040108e jne 0x40129b 0x00401094 mov rax, qword [var_58h] 0x00401098 add rax, 0x13 ; 19 0x0040109c movzx eax, byte [rax] 0x0040109f cmp al, 0x62 ; 98 0x004010a1 jne 0x40129b 0x004010a7 mov rax, qword [var_58h] 0x004010ab add rax, 0x14 ; 20 0x004010af movzx eax, byte [rax] 0x004010b2 cmp al, 0x63 ; 99 0x004010b4 jne 0x40129b 0x004010ba mov rax, qword [var_58h] 0x004010be add rax, 0x15 ; 21 0x004010c2 movzx eax, byte [rax] 0x004010c5 cmp al, 0x34 ; 52 0x004010c7 jne 0x40129b 0x004010cd mov rax, qword [var_58h] 0x004010d1 add rax, 0x16 ; 22 0x004010d5 movzx eax, byte [rax] 0x004010d8 cmp al, 0x66 ; 102 0x004010da jne 0x40129b 0x004010e0 mov rax, qword [var_58h] 0x004010e4 add rax, 0x17 ; 23 0x004010e8 movzx eax, byte [rax] 0x004010eb cmp al, 0x30 ; 48 0x004010ed jne 0x40129b 0x004010f3 mov rax, qword [var_58h] 0x004010f7 add rax, 0x18 ; 24 0x004010fb movzx eax, byte [rax] 0x004010fe cmp al, 0x32 ; 50 0x00401100 jne 0x40129b 0x00401106 mov rax, qword [var_58h] 0x0040110a add rax, 0x19 ; 25 0x0040110e movzx eax, byte [rax] 0x00401111 cmp al, 0x32 ; 50 0x00401113 jne 0x40129b 0x00401119 mov rax, qword [var_58h] 0x0040111d add rax, 0x1a ; 26 0x00401121 movzx eax, byte [rax] 0x00401124 cmp al, 0x35 ; 53 0x00401126 jne 0x40129b 0x0040112c mov rax, qword [var_58h] 0x00401130 add rax, 0x1b ; 27 0x00401134 movzx eax, byte [rax] 0x00401137 cmp al, 0x39 ; 57 0x00401139 jne 0x40129b 0x0040113f mov rax, qword [var_58h] 0x00401143 add rax, 0x1c ; 28 0x00401147 movzx eax, byte [rax] 0x0040114a cmp al, 0x33 ; 51 0x0040114c jne 0x40129b 0x00401152 mov rax, qword [var_58h] 0x00401156 add rax, 0x1d ; 29 0x0040115a movzx eax, byte [rax] 0x0040115d cmp al, 0x35 ; 53 0x0040115f jne 0x40129b 0x00401165 mov rax, qword [var_58h] 0x00401169 add rax, 0x1e ; 30 0x0040116d movzx eax, byte [rax] 0x00401170 cmp al, 0x63 ; 99 0x00401172 jne 0x40129b 0x00401178 mov rax, qword [var_58h] 0x0040117c add rax, 0x1f ; 31 0x00401180 movzx eax, byte [rax] 0x00401183 cmp al, 0x30 ; 48 0x00401185 jne 0x40129b 根据汇编语句可以得到md5的字符应该是：\n780438d5b6e29db0898bc4f0225935c0 试试使用一些md5破解的工具进行破解：\nb781cbb29054db12f88f08c6e161c199 这个应该就是flag了，题目思路也就很简单。可能感到困难的是C++的反汇编。\n本题flag：\nb781cbb29054db12f88f08c6e161c199 0x4 parallel-comparator-200 题目直接给到了C的源代码\n#include #include #include #define FLAG_LEN 20 void * checking(void *arg) { char *result = malloc(sizeof(char)); char *argument = (char *)arg; *result = (argument[0]+argument[1]) ^ argument[2]; return result; } int highly_optimized_parallel_comparsion(char *user_string) { int initialization_number; int i; char generated_string[FLAG_LEN + 1]; generated_string[FLAG_LEN] = '\\0'; while ((initialization_number = random()) \u003e= 64); int first_letter; first_letter = (initialization_number % 26) + 97; pthread_t thread[FLAG_LEN]; char differences[FLAG_LEN] = {0, 9, -9, -1, 13, -13, -4, -11, -9, -1, -7, 6, -13, 13, 3, 9, -13, -11, 6, -7}; char *arguments[20]; for (i = 0; i \u003c FLAG_LEN; i++) { arguments[i] = (char *)malloc(3*sizeof(char)); arguments[i][0] = first_letter; arguments[i][1] = differences[i]; arguments[i][2] = user_string[i]; pthread_create((pthread_t*)(thread+i), NULL, checking, arguments[i]); } void *result; int just_a_string[FLAG_LEN] = {115, 116, 114, 97, 110, 103, 101, 95, 115, 116, 114, 105, 110, 103, 95, 105, 116, 95, 105, 115}; for (i = 0; i \u003c FLAG_LEN; i++) { pthread_join(*(thread+i), \u0026result); generated_string[i] = *(char *)result + just_a_string[i]; free(result); free(arguments[i]); } int is_ok = 1; for (i = 0; i \u003c FLAG_LEN; i++) { if (generated_string[i] != just_a_string[i]) return 0; } return 1; } int main() { char *user_string = (char *)calloc(FLAG_LEN+1, sizeof(char)); fgets(user_string, FLAG_LEN+1, stdin); int is_ok = highly_optimized_parallel_comparsion(user_string); if (is_ok) printf(\"You win!\\n\"); else printf(\"Wrong!\\n\"); return 0; } 应该是一个代码审计的题目，对C语言源码进行审计\n找到关键函数代码：\npthread_t thread[FLAG_LEN]; char differences[FLAG_LEN] = {0, 9, -9, -1, 13, -13, -4, -11, -9, -1, -7, 6, -13, 13, 3, 9, -13, -11, 6, -7}; char *arguments[20]; for (i = 0; i \u003c FLAG_LEN; i++) { arguments[i] = (char *)malloc(3*sizeof(char)); arguments[i][0] = first_letter; arguments[i][1] = differences[i]; arguments[i][2] = user_string[i]; pthread_create((pthread_t*)(thread+i), NULL, checking, arguments[i]); } 关键应该是pthread_create函数和checking函数\nvoid * checking(void *arg) { char *result = malloc(sizeof(char)); char *argument = (char *)arg; *result = (argument[0]+argument[1]) ^ argument[2]; return result; } 通过对函数pthread_create的查阅并根据checking的返回值可以得到：\nresult == 0 ，也就是可以得到一个等式关系来进行求解：\n(argument[0]+argument[1]) == argument[2]; 故现在只需要得到argument[0]的数值就可以进行求解了：\nint first_letter; first_letter = (initialization_number % 26) + 97; 现在可以知道argument[0]的取值范围在 0 ~ 25根据这个范围进行爆破。\n根据上述分析，写一个python脚本求解：\ndifferences = [0, 9, -9, -1, 13, -13, -4, -11, -9, -1, -7, 6, -13, 13, 3, 9, -13, -11, 6, -7] for i in range(97,97+26): flag =\"\" for k in differences: flag += chr(k+i) print(flag) 运行代码在输出结果中可以找到：\n故本题的flag:\nlucky_hacker_you_are 0x5 secret-galaxy-300 使用DIE来对程序进行探测：\n没有壳，静态分析看下代码：\nint __cdecl main(int argc, const char **argv, const char **envp) { __main(); fill_starbase(\u0026starbase); print_starbase(\u0026starbase); return 0; } 分别跟进两个函数来查看\nfill_starbase：\nvoid __cdecl fill_starbase(int a1) { int i; // [esp+8h] [ebp-10h] int v2; // [esp+Ch] [ebp-Ch] v2 = 0; for ( i = 0; i \u003c= 4; ++i ) { *(_DWORD *)(a1 + 24 * i) = galaxy_name[i]; *(_DWORD *)(24 * i + a1 + 4) = rand(); *(_DWORD *)(24 * i + a1 + 8) = 0; *(_DWORD *)(24 * i + a1 + 12) = 0; *(_DWORD *)(24 * i + a1 + 16) = 24 * (i + 1) + a1; *(_DWORD *)(a1 + 24 * i + 20) = v2; v2 = 24 * i + a1; } print_starbase：\nint __cdecl print_starbase(int a1) { int result; // eax const char *v2; // edx int i; // [esp+1Ch] [ebp-Ch] puts(\"--------------GALAXY DATABASE-------------\"); printf(\"%10s | %s | %s\\n\", \"Galaxy name\", \"Existence of life\", \"Distance from Earth\"); result = puts(\"-------------------------------------------\"); for ( i = 0; i \u003c= 4; ++i ) { if ( *(_DWORD *)(24 * i + a1 + 8) == 1 ) v2 = \"INHABITED\"; else v2 = \"IS NOT INHABITED\"; result = printf(\"%11s | %17s | %d\\n\", *(const char **)(24 * i + a1), v2, *(_DWORD *)(24 * i + a1 + 4)); } return result; } 实在是看不出什么线索，查看一下字符串输出\n发现有个字符串没有进行输出，有点可疑，跟进去一探究竟\n果然有些端倪，继续追踪\n再接再励，真相就在眼前\n这个字符串的地址是0x4013E0，拿到了地址就可以做很多事情了，可以使用Ollydbg跟踪到这个地址来进行动态分析，如果没有问题的话，flag应该就在动态调试的内存中。先来尝试一下调试调试：\n步入到断点0x4013E0，不断进行F8单步运行，运行到函数结尾位置，查看一下内存：\n发现可疑字符，这段字符应该就是可能的flag\n这道题目的flag是\naliens_are_around_us ","wordCount":"1852","inLanguage":"en","datePublished":"2022-01-28T19:33:59+08:00","dateModified":"2022-01-28T19:33:59+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/xctf-reverse-expert-2_writeup/"},"publisher":{"@type":"Organization","name":"Jasmine❀Hiker","logo":{"@type":"ImageObject","url":"favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/categories/ title=Categories><span>Categories</span></a></li><li><a href=/tags/ title=Tags><span>Tags</span></a></li><li><a href=/posts/ title=Posts><span>Posts</span></a></li><li><a href=/about/ title=About><span>About</span></a></li><li><a href=/link/ title=Link><span>Link</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/posts/>Posts</a></div><h1 class=post-title>XCTF REVERSE Expert (2) Writeup</h1><div class=post-meta><span title='2022-01-28 19:33:59 +0800 CST'>January 28, 2022</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1852 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#xctf-reverse-%e9%ab%98%e6%89%8b%e5%8c%ba-2-writeup aria-label="XCTF-REVERSE-高手区-2 writeup">XCTF-REVERSE-高手区-2 writeup</a><ul><li><a href=#0x0-easyre aria-label="0x0 EasyRE">0x0 EasyRE</a></li><li><a href=#0x1-shuffle aria-label="0x1 Shuffle">0x1 Shuffle</a></li><li><a href=#0x2-re-for-50-plz-50 aria-label="0x2 re-for-50-plz-50">0x2 re-for-50-plz-50</a></li><li><a href=#0x3-dmd-50 aria-label="0x3 dmd-50">0x3 dmd-50</a></li><li><a href=#0x4-parallel-comparator-200 aria-label="0x4 parallel-comparator-200">0x4 parallel-comparator-200</a></li><li><a href=#0x5-secret-galaxy-300 aria-label="0x5 secret-galaxy-300">0x5 secret-galaxy-300</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=xctf-reverse-高手区-2-writeup>XCTF-REVERSE-高手区-2 writeup<a hidden class=anchor aria-hidden=true href=#xctf-reverse-高手区-2-writeup>#</a></h1><p>感觉攻防世界的逆向题目还是蛮有意思的，刷着玩玩，就当作闯关游戏一样！</p><h2 id=0x0-easyre>0x0 EasyRE<a hidden class=anchor aria-hidden=true href=#0x0-easyre>#</a></h2><p>使用DIE查看一下程序信息：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211101090530961.png alt=image-20211101090530961></p><p>无壳32位程序，直接静态分析走起！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// kr00_4
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=o>*</span><span class=n>v5</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// al
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>Arglist</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span> <span class=c1>// [esp+2h] [ebp-24h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [esp+12h] [ebp-14h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v12</span><span class=p>;</span> <span class=c1>// [esp+1Ah] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int16</span> <span class=n>v13</span><span class=p>;</span> <span class=c1>// [esp+1Eh] [ebp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401020</span><span class=p>(</span><span class=n>Format</span><span class=p>,</span> <span class=n>Arglist</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=n>v12</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v13</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=p>(</span><span class=n>_OWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>Arglist</span> <span class=o>=</span> <span class=mi>0</span><span class=n>i64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v11</span> <span class=o>=</span> <span class=mi>0</span><span class=n>i64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401050</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>Arglist</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Arglist</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v3</span> <span class=o>&gt;=</span> <span class=mh>0x10</span> <span class=o>&amp;&amp;</span> <span class=n>v3</span> <span class=o>==</span> <span class=mi>24</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v4</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v5</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v11</span> <span class=o>+</span> <span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v6</span> <span class=o>=</span> <span class=o>*</span><span class=n>v5</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>byte_40336C</span><span class=p>[</span><span class=n>v4</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>&lt;</span> <span class=mi>24</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x18</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>byte_40336C</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>byte_40336C</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=mi>6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v8</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>byte_40336C</span><span class=p>,</span> <span class=n>aXircjR2twsv3pt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v8</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span> <span class=o>=</span> <span class=n>v8</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>v8</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_401020</span><span class=p>(</span><span class=s>&#34;right</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>Arglist</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>      <span class=nf>system</span><span class=p>(</span><span class=s>&#34;pause&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>看代码，应该是比较简单的。但是需要对代码进行相对比较仔细的审计，来确保代码审计的成功</p><p>首先程序先对数组进行了倒序处理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>v4</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>v5</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v11</span> <span class=o>+</span> <span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=o>*</span><span class=n>v5</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>byte_40336C</span><span class=p>[</span><span class=n>v4</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>&lt;</span> <span class=mi>24</span> <span class=p>);</span>
</span></span></code></pre></div><p>然后是对数据进行处理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x18</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>byte_40336C</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>byte_40336C</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=mi>6</span><span class=p>;</span>
</span></span></code></pre></div><p>而我们的目标是得到原始匹配的输入数据来获取到flag</p><p>编写一个小程序来获得flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>data</span><span class=p>[]{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mh>0x61</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>{</span> <span class=mi>0</span> <span class=p>};</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>24</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=mi>6</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=p>{</span><span class=mi>23</span><span class=p>};</span><span class=n>j</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>--</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>putchar</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译并运行程序得到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{xNqU4otPq3ys9wkDsN} 
</span></span></code></pre></div><h2 id=0x1-shuffle>0x1 Shuffle<a hidden class=anchor aria-hidden=true href=#0x1-shuffle>#</a></h2><p>丢到DIE探测一波：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211101161009642.png alt=image-20211101161009642></p><p>没有壳，32位的Ubuntu编译的程序，直接静态分析</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>time_t</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// ebx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>__pid_t</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+14h] [ebp-44h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [esp+18h] [ebp-40h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [esp+1Ch] [ebp-3Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// [esp+20h] [ebp-38h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>40</span><span class=p>];</span> <span class=c1>// [esp+24h] [ebp-34h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [esp+4Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v11</span> <span class=o>=</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>strcpy</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s>&#34;SECCON{Welcome to the SECCON 2014 CTF!}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>time</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=nf>getpid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>srand</span><span class=p>(</span><span class=n>v3</span> <span class=o>+</span> <span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>99</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mh>0x28u</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v8</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mh>0x28u</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v9</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>v7</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=n>v7</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>v8</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=n>v8</span><span class=p>]</span> <span class=o>=</span> <span class=n>v9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>由于题目描述：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>找到字符串在随机化之前
</span></span></code></pre></div><p>故flag为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>SECCON{Welcome to the SECCON 2014 CTF!}
</span></span></code></pre></div><h2 id=0x2-re-for-50-plz-50>0x2 re-for-50-plz-50<a hidden class=anchor aria-hidden=true href=#0x2-re-for-50-plz-50>#</a></h2><p>使用DIE查看程序信息：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102081907475.png alt=image-20211102081907475></p><p>没有壳32位程序，直接静态分析：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=n>__noreturn</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [sp+18h] [+18h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>31</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>meow</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=p>(</span><span class=kt>char</span><span class=p>)(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x37</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>print</span><span class=p>(</span><span class=s>&#34;NOOOOOOOOOOOOOOOOOO</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit_funct</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;C0ngr4ssulations!! U did it.&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>envp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit_funct</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>代码非常简单，就是对程序静态字符串进行按位异或操作，编写一个程序来求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>meow</span><span class=p>[]{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x4A</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>{</span><span class=mh>0x37</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>31</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>putchar</span><span class=p>(</span><span class=n>meow</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译并运行得到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>TUCTF{but_really_whoisjohngalt}
</span></span></code></pre></div><h2 id=0x3-dmd-50>0x3 dmd-50<a hidden class=anchor aria-hidden=true href=#0x3-dmd-50>#</a></h2><p>使用DIE来进行探测：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102130922964.png alt=image-20211102130922964></p><p>64位ELF程序，静态分析一探究竟：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102135037235.png alt=image-20211102135037235></p><p>看样子应该是C++编写的程序，可以发现汇编代码有个<code>md5</code>的函数，应该是使用了md5加密</p><p>后面的汇编语句进行了一系列的比较操作：</p><pre tabindex=0><code class=language-x86asm data-lang=x86asm>0x00400f36      cmp     al, 0x37   ; 55
0x00400f38      jne     0x40129b
0x00400f3e      mov     rax, qword [var_58h]
0x00400f42      add     rax, 1
0x00400f46      movzx   eax, byte [rax]
0x00400f49      cmp     al, 0x38   ; 56
0x00400f4b      jne     0x40129b
0x00400f51      mov     rax, qword [var_58h]
0x00400f55      add     rax, 2
0x00400f59      movzx   eax, byte [rax]
0x00400f5c      cmp     al, 0x30   ; 48
0x00400f5e      jne     0x40129b
0x00400f64      mov     rax, qword [var_58h]
0x00400f68      add     rax, 3
0x00400f6c      movzx   eax, byte [rax]
0x00400f6f      cmp     al, 0x34   ; 52
0x00400f71      jne     0x40129b
0x00400f77      mov     rax, qword [var_58h]
0x00400f7b      add     rax, 4
0x00400f7f      movzx   eax, byte [rax]
0x00400f82      cmp     al, 0x33   ; 51
0x00400f84      jne     0x40129b
0x00400f8a      mov     rax, qword [var_58h]
0x00400f8e      add     rax, 5
0x00400f92      movzx   eax, byte [rax]
0x00400f95      cmp     al, 0x38   ; 56
0x00400f97      jne     0x40129b
0x00400f9d      mov     rax, qword [var_58h]
0x00400fa1      add     rax, 6
0x00400fa5      movzx   eax, byte [rax]
0x00400fa8      cmp     al, 0x64   ; 100
0x00400faa      jne     0x40129b
0x00400fb0      mov     rax, qword [var_58h]
0x00400fb4      add     rax, 7
0x00400fb8      movzx   eax, byte [rax]
0x00400fbb      cmp     al, 0x35   ; 53
0x00400fbd      jne     0x40129b
0x00400fc3      mov     rax, qword [var_58h]
0x00400fc7      add     rax, 8
0x00400fcb      movzx   eax, byte [rax]
0x00400fce      cmp     al, 0x62   ; 98
0x00400fd0      jne     0x40129b
0x00400fd6      mov     rax, qword [var_58h]
0x00400fda      add     rax, 9
0x00400fde      movzx   eax, byte [rax]
0x00400fe1      cmp     al, 0x36   ; 54
0x00400fe3      jne     0x40129b
0x00400fe9      mov     rax, qword [var_58h]
0x00400fed      add     rax, 0xa
0x00400ff1      movzx   eax, byte [rax]
0x00400ff4      cmp     al, 0x65   ; 101
0x00400ff6      jne     0x40129b
0x00400ffc      mov     rax, qword [var_58h]
0x00401000      add     rax, 0xb   ; 11
0x00401004      movzx   eax, byte [rax]
0x00401007      cmp     al, 0x32   ; 50
0x00401009      jne     0x40129b
0x0040100f      mov     rax, qword [var_58h]
0x00401013      add     rax, 0xc   ; 12
0x00401017      movzx   eax, byte [rax]
0x0040101a      cmp     al, 0x39   ; 57
0x0040101c      jne     0x40129b
0x00401022      mov     rax, qword [var_58h]
0x00401026      add     rax, 0xd   ; 13
0x0040102a      movzx   eax, byte [rax]
0x0040102d      cmp     al, 0x64   ; 100
0x0040102f      jne     0x40129b
0x00401035      mov     rax, qword [var_58h]
0x00401039      add     rax, 0xe   ; 14
0x0040103d      movzx   eax, byte [rax]
0x00401040      cmp     al, 0x62   ; 98
0x00401042      jne     0x40129b
0x00401048      mov     rax, qword [var_58h]
0x0040104c      add     rax, 0xf   ; 15
0x00401050      movzx   eax, byte [rax]
0x00401053      cmp     al, 0x30   ; 48
0x00401055      jne     0x40129b
0x0040105b      mov     rax, qword [var_58h]
0x0040105f      add     rax, 0x10  ; 16
0x00401063      movzx   eax, byte [rax]
0x00401066      cmp     al, 0x38   ; 56
0x00401068      jne     0x40129b
0x0040106e      mov     rax, qword [var_58h]
0x00401072      add     rax, 0x11  ; 17
0x00401076      movzx   eax, byte [rax]
0x00401079      cmp     al, 0x39   ; 57
0x0040107b      jne     0x40129b
0x00401081      mov     rax, qword [var_58h]
0x00401085      add     rax, 0x12  ; 18
0x00401089      movzx   eax, byte [rax]
0x0040108c      cmp     al, 0x38   ; 56
0x0040108e      jne     0x40129b
0x00401094      mov     rax, qword [var_58h]
0x00401098      add     rax, 0x13  ; 19
0x0040109c      movzx   eax, byte [rax]
0x0040109f      cmp     al, 0x62   ; 98
0x004010a1      jne     0x40129b
0x004010a7      mov     rax, qword [var_58h]
0x004010ab      add     rax, 0x14  ; 20
0x004010af      movzx   eax, byte [rax]
0x004010b2      cmp     al, 0x63   ; 99
0x004010b4      jne     0x40129b
0x004010ba      mov     rax, qword [var_58h]
0x004010be      add     rax, 0x15  ; 21
0x004010c2      movzx   eax, byte [rax]
0x004010c5      cmp     al, 0x34   ; 52
0x004010c7      jne     0x40129b
0x004010cd      mov     rax, qword [var_58h]
0x004010d1      add     rax, 0x16  ; 22
0x004010d5      movzx   eax, byte [rax]
0x004010d8      cmp     al, 0x66   ; 102
0x004010da      jne     0x40129b
0x004010e0      mov     rax, qword [var_58h]
0x004010e4      add     rax, 0x17  ; 23
0x004010e8      movzx   eax, byte [rax]
0x004010eb      cmp     al, 0x30   ; 48
0x004010ed      jne     0x40129b
0x004010f3      mov     rax, qword [var_58h]
0x004010f7      add     rax, 0x18  ; 24
0x004010fb      movzx   eax, byte [rax]
0x004010fe      cmp     al, 0x32   ; 50
0x00401100      jne     0x40129b
0x00401106      mov     rax, qword [var_58h]
0x0040110a      add     rax, 0x19  ; 25
0x0040110e      movzx   eax, byte [rax]
0x00401111      cmp     al, 0x32   ; 50
0x00401113      jne     0x40129b
0x00401119      mov     rax, qword [var_58h]
0x0040111d      add     rax, 0x1a  ; 26
0x00401121      movzx   eax, byte [rax]
0x00401124      cmp     al, 0x35   ; 53
0x00401126      jne     0x40129b
0x0040112c      mov     rax, qword [var_58h]
0x00401130      add     rax, 0x1b  ; 27
0x00401134      movzx   eax, byte [rax]
0x00401137      cmp     al, 0x39   ; 57
0x00401139      jne     0x40129b
0x0040113f      mov     rax, qword [var_58h]
0x00401143      add     rax, 0x1c  ; 28
0x00401147      movzx   eax, byte [rax]
0x0040114a      cmp     al, 0x33   ; 51
0x0040114c      jne     0x40129b
0x00401152      mov     rax, qword [var_58h]
0x00401156      add     rax, 0x1d  ; 29
0x0040115a      movzx   eax, byte [rax]
0x0040115d      cmp     al, 0x35   ; 53
0x0040115f      jne     0x40129b
0x00401165      mov     rax, qword [var_58h]
0x00401169      add     rax, 0x1e  ; 30
0x0040116d      movzx   eax, byte [rax]
0x00401170      cmp     al, 0x63   ; 99
0x00401172      jne     0x40129b
0x00401178      mov     rax, qword [var_58h]
0x0040117c      add     rax, 0x1f  ; 31
0x00401180      movzx   eax, byte [rax]
0x00401183      cmp     al, 0x30   ; 48
0x00401185      jne     0x40129b
</code></pre><p>根据汇编语句可以得到md5的字符应该是：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>780438d5b6e29db0898bc4f0225935c0
</span></span></code></pre></div><p>试试使用一些md5破解的工具进行破解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>b781cbb29054db12f88f08c6e161c199
</span></span></code></pre></div><p>这个应该就是flag了，题目思路也就很简单。可能感到困难的是C++的反汇编。</p><p>本题flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>b781cbb29054db12f88f08c6e161c199
</span></span></code></pre></div><h2 id=0x4-parallel-comparator-200>0x4 parallel-comparator-200<a hidden class=anchor aria-hidden=true href=#0x4-parallel-comparator-200>#</a></h2><p>题目直接给到了C的源代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;pthread.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define FLAG_LEN 20
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span> <span class=nf>checking</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>result</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>argument</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>arg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>argument</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>argument</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=n>argument</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>highly_optimized_parallel_comparsion</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>user_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>initialization_number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>generated_string</span><span class=p>[</span><span class=n>FLAG_LEN</span> <span class=o>+</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>generated_string</span><span class=p>[</span><span class=n>FLAG_LEN</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>initialization_number</span> <span class=o>=</span> <span class=nf>random</span><span class=p>())</span> <span class=o>&gt;=</span> <span class=mi>64</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>first_letter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>first_letter</span> <span class=o>=</span> <span class=p>(</span><span class=n>initialization_number</span> <span class=o>%</span> <span class=mi>26</span><span class=p>)</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>pthread_t</span> <span class=kr>thread</span><span class=p>[</span><span class=n>FLAG_LEN</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>differences</span><span class=p>[</span><span class=n>FLAG_LEN</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>4</span><span class=p>,</span> <span class=o>-</span><span class=mi>11</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>7</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>11</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=o>-</span><span class=mi>7</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>arguments</span><span class=p>[</span><span class=mi>20</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>FLAG_LEN</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=mi>3</span><span class=o>*</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>first_letter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>differences</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_string</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>pthread_create</span><span class=p>((</span><span class=kt>pthread_t</span><span class=o>*</span><span class=p>)(</span><span class=kr>thread</span><span class=o>+</span><span class=n>i</span><span class=p>),</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>checking</span><span class=p>,</span> <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=o>*</span><span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>just_a_string</span><span class=p>[</span><span class=n>FLAG_LEN</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>115</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>97</span><span class=p>,</span> <span class=mi>110</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>101</span><span class=p>,</span> <span class=mi>95</span><span class=p>,</span> <span class=mi>115</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>110</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>95</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>95</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>115</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>FLAG_LEN</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>pthread_join</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kr>thread</span><span class=o>+</span><span class=n>i</span><span class=p>),</span> <span class=o>&amp;</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>generated_string</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>result</span> <span class=o>+</span> <span class=n>just_a_string</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nf>free</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>free</span><span class=p>(</span><span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>is_ok</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>FLAG_LEN</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>generated_string</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>just_a_string</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>user_string</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>calloc</span><span class=p>(</span><span class=n>FLAG_LEN</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>fgets</span><span class=p>(</span><span class=n>user_string</span><span class=p>,</span> <span class=n>FLAG_LEN</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=n>stdin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>is_ok</span> <span class=o>=</span> <span class=nf>highly_optimized_parallel_comparsion</span><span class=p>(</span><span class=n>user_string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>is_ok</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You win!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Wrong!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>应该是一个代码审计的题目，对C语言源码进行审计</p><p>找到关键函数代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>pthread_t</span> <span class=kr>thread</span><span class=p>[</span><span class=n>FLAG_LEN</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>differences</span><span class=p>[</span><span class=n>FLAG_LEN</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>4</span><span class=p>,</span> <span class=o>-</span><span class=mi>11</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>7</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>11</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=o>-</span><span class=mi>7</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>arguments</span><span class=p>[</span><span class=mi>20</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>FLAG_LEN</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=mi>3</span><span class=o>*</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>first_letter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>differences</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_string</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>pthread_create</span><span class=p>((</span><span class=kt>pthread_t</span><span class=o>*</span><span class=p>)(</span><span class=kr>thread</span><span class=o>+</span><span class=n>i</span><span class=p>),</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>checking</span><span class=p>,</span> <span class=n>arguments</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>关键应该是<code>pthread_create</code>函数和<code>checking</code>函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span> <span class=nf>checking</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>result</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>argument</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>arg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>argument</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>argument</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=n>argument</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>通过对函数<code>pthread_create</code>的查阅并根据<code>checking</code>的返回值可以得到：</p><p><code>result == 0</code> ，也就是可以得到一个等式关系来进行求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>(</span><span class=n>argument</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>argument</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>==</span> <span class=n>argument</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span></code></pre></div><p>故现在只需要得到<code>argument[0]</code>的数值就可以进行求解了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>first_letter</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>first_letter</span> <span class=o>=</span> <span class=p>(</span><span class=n>initialization_number</span> <span class=o>%</span> <span class=mi>26</span><span class=p>)</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span></code></pre></div><p>现在可以知道<code>argument[0]</code>的取值范围在 0 ~ 25根据这个范围进行爆破。</p><p>根据上述分析，写一个python脚本求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>differences</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>4</span><span class=p>,</span> <span class=o>-</span><span class=mi>11</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>7</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=o>-</span><span class=mi>13</span><span class=p>,</span> <span class=o>-</span><span class=mi>11</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=o>-</span><span class=mi>7</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>97</span><span class=p>,</span><span class=mi>97</span><span class=o>+</span><span class=mi>26</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>differences</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>k</span><span class=o>+</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行代码在输出结果中可以找到：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102180423890.png alt=image-20211102180423890></p><p>故本题的flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>lucky_hacker_you_are
</span></span></code></pre></div><h2 id=0x5-secret-galaxy-300>0x5 secret-galaxy-300<a hidden class=anchor aria-hidden=true href=#0x5-secret-galaxy-300>#</a></h2><p>使用DIE来对程序进行探测：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102184409728.png alt=image-20211102184409728></p><p>没有壳，静态分析看下代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>__main</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>fill_starbase</span><span class=p>(</span><span class=o>&amp;</span><span class=n>starbase</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>print_starbase</span><span class=p>(</span><span class=o>&amp;</span><span class=n>starbase</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>分别跟进两个函数来查看</p><p>fill_starbase：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=kr>__cdecl</span> <span class=nf>fill_starbase</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+8h] [ebp-10h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>4</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>24</span> <span class=o>*</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=n>galaxy_name</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span><span class=p>)</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>8</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>12</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>16</span><span class=p>)</span> <span class=o>=</span> <span class=mi>24</span> <span class=o>*</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>20</span><span class=p>)</span> <span class=o>=</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>print_starbase：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>print_starbase</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>v2</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+1Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;--------------GALAXY DATABASE-------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%10s | %s | %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=s>&#34;Galaxy name&#34;</span><span class=p>,</span> <span class=s>&#34;Existence of life&#34;</span><span class=p>,</span> <span class=s>&#34;Distance from Earth&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;-------------------------------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>4</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>8</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>v2</span> <span class=o>=</span> <span class=s>&#34;INHABITED&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=n>v2</span> <span class=o>=</span> <span class=s>&#34;IS NOT INHABITED&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%11s | %17s | %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span><span class=p>),</span> <span class=n>v2</span><span class=p>,</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>实在是看不出什么线索，查看一下字符串输出</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102191117327.png alt=image-20211102191117327></p><p>发现有个字符串没有进行输出，有点可疑，跟进去一探究竟</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102191250757.png alt=image-20211102191250757></p><p>果然有些端倪，继续追踪</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102191341004.png alt=image-20211102191341004></p><p>再接再励，真相就在眼前</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102191448118.png alt=image-20211102191448118></p><p>这个字符串的地址是0x4013E0，拿到了地址就可以做很多事情了，可以使用Ollydbg跟踪到这个地址来进行动态分析，如果没有问题的话，flag应该就在动态调试的内存中。先来尝试一下调试调试：</p><p>步入到断点0x4013E0，不断进行F8单步运行，运行到函数结尾位置，查看一下内存：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-2_writeup/image-20211102192916295.png alt=image-20211102192916295></p><p>发现可疑字符，这段字符应该就是可能的flag</p><p>这道题目的flag是</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>aliens_are_around_us
</span></span></code></pre></div><hr></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/ctf/>ctf</a></li><li><a href=/tags/writeup/>writeup</a></li><li><a href=/tags/reverse/>Reverse</a></li></ul><nav class=paginav><a class=prev href=/posts/xctf-reverse-expert-3_writeup/><span class=title>« Prev</span><br><span>XCTF REVERSE Expert (3) Writeup</span></a>
<a class=next href=/posts/xctf-reverse-expert-1_writeup/><span class=title>Next »</span><br><span>XCTF REVERSE Expert (1) Writeup</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href>Jasmine❀Hiker</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script><script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>