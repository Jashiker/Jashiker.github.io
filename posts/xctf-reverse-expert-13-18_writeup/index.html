<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>XCTF REVERSE Expert [13~18]_Writeup | OPdbgBytes</title>
<meta name="keywords" content="ctf, writeup">
<meta name="description" content="XCTF-REVERSE-高手区-[13-18] writeup 继续玩一玩逆向的题目，感觉还是蛮有意思的。
0x0 srm-50 使用DIE进行探测：
32位PE程序，无壳。可以尝试运行一下：
应该是一个邮箱破解的程序，终于有点稍微有意思的题目了
首先进行静态分析看代码：
根据WIN32的编程基础，关键函数应该是在DialogFunc中，登录的细节应该是在DialogFunc中。
跟进DialogFunc函数，来寻找更多的细节
INT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { HMODULE v5; // eax  HICON v6; // eax  HMODULE v7; // eax  HWND v8; // eax  HCURSOR v9; // [esp-4h] [ebp-34Ch]  CHAR String[256]; // [esp&#43;8h] [ebp-340h] BYREF  CHAR v11[256]; // [esp&#43;108h] [ebp-240h] BYREF  CHAR Text[256]; // [esp&#43;208h] [ebp-140h] BYREF  char Source[60]; // [esp&#43;308h] [ebp-40h] BYREF  if ( a2 == 16 ) { EndDialog(hDlg, 0); return 0; } if ( a2 == 272 ) { v5 = GetModuleHandleW(0); v6 = LoadIconW(v5, (LPCWSTR)0x67); SetClassLongA(hDlg, -14, (LONG)v6); v7 = GetModuleHandleW(0); v9 = LoadCursorW(v7, (LPCWSTR)0x66); v8 = GetDlgItem(hDlg, 1); SetClassLongA(v8, -12, (LONG)v9); return 1; } if ( a2 !">
<meta name="author" content="Me">
<link rel="canonical" href="https://OolongCode.github.io/posts/xctf-reverse-expert-13-18_writeup/">

<link crossorigin="anonymous" href="/assets/css/stylesheet.0b739a2e2c5e5656e4bcd5f0b2268d063addaf81d89ec3987d6af8f04decdc97.css" integrity="sha256-C3OaLixeVlbkvNXwsiaNBjrdr4HYnsOYfWr48E3s3Jc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://OolongCode.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://OolongCode.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://OolongCode.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://OolongCode.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://OolongCode.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="XCTF REVERSE Expert [13~18]_Writeup" />
<meta property="og:description" content="XCTF-REVERSE-高手区-[13-18] writeup 继续玩一玩逆向的题目，感觉还是蛮有意思的。
0x0 srm-50 使用DIE进行探测：
32位PE程序，无壳。可以尝试运行一下：
应该是一个邮箱破解的程序，终于有点稍微有意思的题目了
首先进行静态分析看代码：
根据WIN32的编程基础，关键函数应该是在DialogFunc中，登录的细节应该是在DialogFunc中。
跟进DialogFunc函数，来寻找更多的细节
INT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { HMODULE v5; // eax  HICON v6; // eax  HMODULE v7; // eax  HWND v8; // eax  HCURSOR v9; // [esp-4h] [ebp-34Ch]  CHAR String[256]; // [esp&#43;8h] [ebp-340h] BYREF  CHAR v11[256]; // [esp&#43;108h] [ebp-240h] BYREF  CHAR Text[256]; // [esp&#43;208h] [ebp-140h] BYREF  char Source[60]; // [esp&#43;308h] [ebp-40h] BYREF  if ( a2 == 16 ) { EndDialog(hDlg, 0); return 0; } if ( a2 == 272 ) { v5 = GetModuleHandleW(0); v6 = LoadIconW(v5, (LPCWSTR)0x67); SetClassLongA(hDlg, -14, (LONG)v6); v7 = GetModuleHandleW(0); v9 = LoadCursorW(v7, (LPCWSTR)0x66); v8 = GetDlgItem(hDlg, 1); SetClassLongA(v8, -12, (LONG)v9); return 1; } if ( a2 !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://OolongCode.github.io/posts/xctf-reverse-expert-13-18_writeup/" /><meta property="og:image" content="https://OolongCode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-28T19:34:08&#43;08:00" />
<meta property="article:modified_time" content="2022-01-28T19:34:08&#43;08:00" /><meta property="og:site_name" content="ExampleSite" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://OolongCode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="XCTF REVERSE Expert [13~18]_Writeup"/>
<meta name="twitter:description" content="XCTF-REVERSE-高手区-[13-18] writeup 继续玩一玩逆向的题目，感觉还是蛮有意思的。
0x0 srm-50 使用DIE进行探测：
32位PE程序，无壳。可以尝试运行一下：
应该是一个邮箱破解的程序，终于有点稍微有意思的题目了
首先进行静态分析看代码：
根据WIN32的编程基础，关键函数应该是在DialogFunc中，登录的细节应该是在DialogFunc中。
跟进DialogFunc函数，来寻找更多的细节
INT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { HMODULE v5; // eax  HICON v6; // eax  HMODULE v7; // eax  HWND v8; // eax  HCURSOR v9; // [esp-4h] [ebp-34Ch]  CHAR String[256]; // [esp&#43;8h] [ebp-340h] BYREF  CHAR v11[256]; // [esp&#43;108h] [ebp-240h] BYREF  CHAR Text[256]; // [esp&#43;208h] [ebp-140h] BYREF  char Source[60]; // [esp&#43;308h] [ebp-40h] BYREF  if ( a2 == 16 ) { EndDialog(hDlg, 0); return 0; } if ( a2 == 272 ) { v5 = GetModuleHandleW(0); v6 = LoadIconW(v5, (LPCWSTR)0x67); SetClassLongA(hDlg, -14, (LONG)v6); v7 = GetModuleHandleW(0); v9 = LoadCursorW(v7, (LPCWSTR)0x66); v8 = GetDlgItem(hDlg, 1); SetClassLongA(v8, -12, (LONG)v9); return 1; } if ( a2 !"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://OolongCode.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "XCTF REVERSE Expert [13~18]_Writeup",
      "item": "https://OolongCode.github.io/posts/xctf-reverse-expert-13-18_writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "XCTF REVERSE Expert [13~18]_Writeup",
  "name": "XCTF REVERSE Expert [13~18]_Writeup",
  "description": "XCTF-REVERSE-高手区-[13-18] writeup 继续玩一玩逆向的题目，感觉还是蛮有意思的。\n0x0 srm-50 使用DIE进行探测：\n32位PE程序，无壳。可以尝试运行一下：\n应该是一个邮箱破解的程序，终于有点稍微有意思的题目了\n首先进行静态分析看代码：\n根据WIN32的编程基础，关键函数应该是在DialogFunc中，登录的细节应该是在DialogFunc中。\n跟进DialogFunc函数，来寻找更多的细节\nINT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { HMODULE v5; // eax  HICON v6; // eax  HMODULE v7; // eax  HWND v8; // eax  HCURSOR v9; // [esp-4h] [ebp-34Ch]  CHAR String[256]; // [esp+8h] [ebp-340h] BYREF  CHAR v11[256]; // [esp+108h] [ebp-240h] BYREF  CHAR Text[256]; // [esp+208h] [ebp-140h] BYREF  char Source[60]; // [esp+308h] [ebp-40h] BYREF  if ( a2 == 16 ) { EndDialog(hDlg, 0); return 0; } if ( a2 == 272 ) { v5 = GetModuleHandleW(0); v6 = LoadIconW(v5, (LPCWSTR)0x67); SetClassLongA(hDlg, -14, (LONG)v6); v7 = GetModuleHandleW(0); v9 = LoadCursorW(v7, (LPCWSTR)0x66); v8 = GetDlgItem(hDlg, 1); SetClassLongA(v8, -12, (LONG)v9); return 1; } if ( a2 !",
  "keywords": [
    "ctf", "writeup"
  ],
  "articleBody": "XCTF-REVERSE-高手区-[13-18] writeup 继续玩一玩逆向的题目，感觉还是蛮有意思的。\n0x0 srm-50 使用DIE进行探测：\n32位PE程序，无壳。可以尝试运行一下：\n应该是一个邮箱破解的程序，终于有点稍微有意思的题目了\n首先进行静态分析看代码：\n根据WIN32的编程基础，关键函数应该是在DialogFunc中，登录的细节应该是在DialogFunc中。\n跟进DialogFunc函数，来寻找更多的细节\nINT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { HMODULE v5; // eax  HICON v6; // eax  HMODULE v7; // eax  HWND v8; // eax  HCURSOR v9; // [esp-4h] [ebp-34Ch]  CHAR String[256]; // [esp+8h] [ebp-340h] BYREF  CHAR v11[256]; // [esp+108h] [ebp-240h] BYREF  CHAR Text[256]; // [esp+208h] [ebp-140h] BYREF  char Source[60]; // [esp+308h] [ebp-40h] BYREF  if ( a2 == 16 ) { EndDialog(hDlg, 0); return 0; } if ( a2 == 272 ) { v5 = GetModuleHandleW(0); v6 = LoadIconW(v5, (LPCWSTR)0x67); SetClassLongA(hDlg, -14, (LONG)v6); v7 = GetModuleHandleW(0); v9 = LoadCursorW(v7, (LPCWSTR)0x66); v8 = GetDlgItem(hDlg, 1); SetClassLongA(v8, -12, (LONG)v9); return 1; } if ( a2 != 273 || (unsigned __int16)a3 != 1 ) return 0; memset(String, (unsigned __int16)a3 - 1, sizeof(String)); memset(v11, 0, sizeof(v11)); memset(Text, 0, sizeof(Text)); GetDlgItemTextA(hDlg, 1001, String, 256); GetDlgItemTextA(hDlg, 1002, v11, 256); if ( strstr(String, \"@\") \u0026\u0026 strstr(String, \".\") \u0026\u0026 strstr(String, \".\")[1] \u0026\u0026 strstr(String, \"@\")[1] != 46 ) { strcpy(\u0026Source[36], \"Registration failure.\"); strcpy(Source, \"Registration Success!\\nYour flag is:\"); if ( strlen(v11) == 16 \u0026\u0026 v11[0] == 67 \u0026\u0026 v11[15] == 88 \u0026\u0026 v11[1] == 90 \u0026\u0026 v11[14] == 65 \u0026\u0026 v11[2] == 57 \u0026\u0026 v11[13] == 98 \u0026\u0026 v11[3] == 100 \u0026\u0026 v11[12] == 55 \u0026\u0026 v11[4] == 109 \u0026\u0026 v11[11] == 71 \u0026\u0026 v11[5] == 113 \u0026\u0026 v11[10] == 57 \u0026\u0026 v11[6] == 52 \u0026\u0026 v11[9] == 103 \u0026\u0026 v11[7] == 99 \u0026\u0026 v11[8] == 56 ) { strcpy_s(Text, 0x100u, Source); strcat_s(Text, 0x100u, v11); } else { strcpy_s(Text, 0x100u, \u0026Source[36]); } } else { strcpy_s(Text, 0x100u, \"Your E-mail address in not valid.\"); } MessageBoxA(hDlg, Text, \"Registeration\", 0x40u); return 1; } flag直接展示的非常清晰了：\nif ( strstr(String, \"@\") \u0026\u0026 strstr(String, \".\") \u0026\u0026 strstr(String, \".\")[1] \u0026\u0026 strstr(String, \"@\")[1] != 46 ) { strcpy(\u0026Source[36], \"Registration failure.\"); strcpy(Source, \"Registration Success!\\nYour flag is:\"); if ( strlen(v11) == 16 \u0026\u0026 v11[0] == 67 \u0026\u0026 v11[15] == 88 \u0026\u0026 v11[1] == 90 \u0026\u0026 v11[14] == 65 \u0026\u0026 v11[2] == 57 \u0026\u0026 v11[13] == 98 \u0026\u0026 v11[3] == 100 \u0026\u0026 v11[12] == 55 \u0026\u0026 v11[4] == 109 \u0026\u0026 v11[11] == 71 \u0026\u0026 v11[5] == 113 \u0026\u0026 v11[10] == 57 \u0026\u0026 v11[6] == 52 \u0026\u0026 v11[9] == 103 \u0026\u0026 v11[7] == 99 \u0026\u0026 v11[8] == 56 ) { strcpy_s(Text, 0x100u, Source); strcat_s(Text, 0x100u, v11); } else { strcpy_s(Text, 0x100u, \u0026Source[36]); } } 对v11数组进行运算就可以得到，非常简单，可以非常容易地得到：\nCZ9dmq4c8g9G7bAX 故本题的flag：\nCZ9dmq4c8g9G7bAX 0x1 simple-check-100 先使用DIE姐姐进行探测一下，呐呐~\nPE32程序，没有加壳。直接静态分析看一波：\nint __cdecl main(int argc, const char **argv, const char **envp) { void *v3; // esp  void *v4; // esp  char v6; // [esp+8h] [ebp-40h] BYREF  char v7; // [esp+1Bh] [ebp-2Dh] BYREF  char *v8; // [esp+1Ch] [ebp-2Ch]  int v9; // [esp+20h] [ebp-28h]  char v10; // [esp+25h] [ebp-23h]  char v11; // [esp+26h] [ebp-22h]  char v12; // [esp+27h] [ebp-21h]  char v13; // [esp+28h] [ebp-20h]  char v14; // [esp+29h] [ebp-1Fh]  char v15; // [esp+2Ah] [ebp-1Eh]  char v16; // [esp+2Bh] [ebp-1Dh]  char v17; // [esp+2Ch] [ebp-1Ch]  char v18; // [esp+2Dh] [ebp-1Bh]  char v19; // [esp+2Eh] [ebp-1Ah]  char v20; // [esp+2Fh] [ebp-19h]  char v21; // [esp+30h] [ebp-18h]  char v22; // [esp+31h] [ebp-17h]  char v23; // [esp+32h] [ebp-16h]  char v24; // [esp+33h] [ebp-15h]  char v25; // [esp+34h] [ebp-14h]  char v26; // [esp+35h] [ebp-13h]  char v27; // [esp+36h] [ebp-12h]  char v28; // [esp+37h] [ebp-11h]  char v29; // [esp+38h] [ebp-10h]  char v30; // [esp+39h] [ebp-Fh]  char v31; // [esp+3Ah] [ebp-Eh]  char v32; // [esp+3Bh] [ebp-Dh]  char v33; // [esp+3Ch] [ebp-Ch]  char v34; // [esp+3Dh] [ebp-Bh]  char v35; // [esp+3Eh] [ebp-Ah]  char v36; // [esp+3Fh] [ebp-9h]  int *v37; // [esp+40h] [ebp-8h]  v37 = \u0026argc; __main(); v7 = 84; v36 = -56; v35 = 126; v34 = -29; v33 = 100; v32 = -57; v31 = 22; v30 = -102; v29 = -51; v28 = 17; v27 = 101; v26 = 50; v25 = 45; v24 = -29; v23 = -45; v22 = 67; v21 = -110; v20 = -87; v19 = -99; v18 = -46; v17 = -26; v16 = 109; v15 = 44; v14 = -45; v13 = -74; v12 = -67; v11 = -2; v10 = 106; v9 = 19; v3 = alloca(32); v4 = alloca(32); v8 = \u0026v6; printf(\"Key: \"); scanf(\"%s\", v8); if ( check_key((int)v8) ) interesting_function((int)\u0026v7); else puts(\"Wrong\"); return 0; } 关键函数是check_key函数，只要对check_key函数进行绕过应该就可以拿到flag\n使用Ollydbg进行动态调试：\n发现Ollydbg总是会输出乱码。不能够正确地将flag输出出来，可能是由于WINDOW编码的问题，也可能是由于题目的WINDOWS程序没有写好。需要再进行对Linux程序进行分析，但是考虑到Linux程序的代码应该是和Windows的代码结构大致一致\n把程序拖到Kali Linux中，使用GDB进行调试：\n成功调试出了flag：\nflag_is_you_know_cracking!!! 0x2 Mysterious 先使用DIE探测一下：\n32位PE程序，无壳\n尝试运行一下这个程序：\n密码破解的程序，先进行静态分析确定位置：\n经典的WIN32程序，继续跟进\n跟进DialogFunc函数，这个函数主要就是WIN32的窗口创建函数，代码逻辑应该就在WIN32中。\n继续跟进，胜利就在前方！\n找到主要的逻辑函数，在下面寻找逻辑判断语句\n这个loc_401183应该是关键函数，这个函数的地址是0x401183，使用Ollydbg进行同时调试来绕过这个判断条件直接出flag\n使用Ollydbg，使用快捷键CTRL+G快速跳转到0x401183的地址，同时也要根据代码静态分析的逻辑来进行判断，发现需要进行输入的代码段是122，这个可以作为Key进行输入：\n在Ollydbg中修改汇编，修改跳转条件，然后输入122\n就可以拿到flag了\nflag为：\nflag{123_Buff3r_0v3rf|0w}  本题还有一种更简单的解法，就是直接静态分析来读取密码直接输入来拿到flag\n本菜鸡只是希望可以学习到更多的技能点，于是使用另一种思路进行求解。\n0x3 re1-100 先进行一下探测：\n64位的ELF文件，直接静态分析：\n代码中有反调试函数，这道题目使用动态调试会有些麻烦，应该是使用静态调试进行求解\n查看静态调试代码\nint __cdecl __noreturn main(int argc, const char **argv, const char **envp) { __pid_t v3; // eax  size_t v4; // rax  ssize_t v5; // rbx  bool v6; // al  bool bCheckPtrace; // [rsp+13h] [rbp-1BDh]  ssize_t numRead; // [rsp+18h] [rbp-1B8h]  ssize_t numReada; // [rsp+18h] [rbp-1B8h]  char bufWrite[200]; // [rsp+20h] [rbp-1B0h] BYREF  char bufParentRead[200]; // [rsp+F0h] [rbp-E0h] BYREF  unsigned __int64 v12; // [rsp+1B8h] [rbp-18h]  v12 = __readfsqword(0x28u); bCheckPtrace = detectDebugging(); if ( pipe(pParentWrite) == -1 ) exit(1); if ( pipe(pParentRead) == -1 ) exit(1); v3 = fork(); if ( v3 != -1 ) { if ( v3 ) { close(pParentWrite[0]); close(pParentRead[1]); while ( 1 ) { printf(\"Input key : \"); memset(bufWrite, 0, sizeof(bufWrite)); gets(bufWrite); v4 = strlen(bufWrite); v5 = write(pParentWrite[1], bufWrite, v4); if ( v5 != strlen(bufWrite) ) printf(\"parent - partial/failed write\"); do { memset(bufParentRead, 0, sizeof(bufParentRead)); numReada = read(pParentRead[0], bufParentRead, 0xC8uLL); v6 = bCheckPtrace || checkDebuggerProcessRunning(); if ( !v6 \u0026\u0026 checkStringIsNumber(bufParentRead) \u0026\u0026 atoi(bufParentRead) ) { puts(\"True\"); if ( close(pParentWrite[1]) == -1 ) exit(1); exit(0); } puts(\"Wrong !!!\\n\"); } while ( numReada == -1 ); } } close(pParentWrite[1]); close(pParentRead[0]); while ( 1 ) { memset(bufParentRead, 0, sizeof(bufParentRead)); numRead = read(pParentWrite[0], bufParentRead, 0xC8uLL); if ( numRead == -1 ) break; if ( numRead ) { if ( !childCheckDebugResult() \u0026\u0026 bufParentRead[0] == 123 \u0026\u0026 strlen(bufParentRead) == '*' \u0026\u0026 !strncmp(\u0026bufParentRead[1], \"53fc275d81\", 0xAuLL) \u0026\u0026 bufParentRead[strlen(bufParentRead) - 1] == 125 \u0026\u0026 !strncmp(\u0026bufParentRead[31], \"4938ae4efd\", 0xAuLL) \u0026\u0026 confuseKey(bufParentRead, 42) \u0026\u0026 !strncmp(bufParentRead, \"{daf29f59034938ae4efd53fc275d81053ed5be8c}\", 0x2AuLL) ) { responseTrue(); } else { responseFalse(); } } } exit(1); } exit(1); } 发现存在有一个可疑的字符串：\n{daf29f59034938ae4efd53fc275d81053ed5be8c} 这个字符串可能是flag，但是感觉似乎有些不太对劲\n往上观察，发现存在有一个进行变换的函数confusekey\n进入这个函数：\nbool __cdecl confuseKey(char *szKey, int iKeyLength) { char szPart1[15]; // [rsp+10h] [rbp-50h] BYREF  char szPart2[15]; // [rsp+20h] [rbp-40h] BYREF  char szPart3[15]; // [rsp+30h] [rbp-30h] BYREF  char szPart4[15]; // [rsp+40h] [rbp-20h] BYREF  unsigned __int64 v7; // [rsp+58h] [rbp-8h]  v7 = __readfsqword(0x28u); *(_QWORD *)szPart1 = 0LL; *(_DWORD *)\u0026szPart1[8] = 0; *(_WORD *)\u0026szPart1[12] = 0; szPart1[14] = 0; *(_QWORD *)szPart2 = 0LL; *(_DWORD *)\u0026szPart2[8] = 0; *(_WORD *)\u0026szPart2[12] = 0; szPart2[14] = 0; *(_QWORD *)szPart3 = 0LL; *(_DWORD *)\u0026szPart3[8] = 0; *(_WORD *)\u0026szPart3[12] = 0; szPart3[14] = 0; *(_QWORD *)szPart4 = 0LL; *(_DWORD *)\u0026szPart4[8] = 0; *(_WORD *)\u0026szPart4[12] = 0; szPart4[14] = 0; if ( iKeyLength != 42 ) return 0; if ( !szKey ) return 0; if ( strlen(szKey) != 42 ) return 0; if ( *szKey != 123 ) return 0; strncpy(szPart1, szKey + 1, 0xAuLL); strncpy(szPart2, szKey + 11, 0xAuLL); strncpy(szPart3, szKey + 21, 0xAuLL); strncpy(szPart4, szKey + 31, 0xAuLL); memset(szKey, 0, 0x2AuLL); *szKey = 123; strcat(szKey, szPart3); strcat(szKey, szPart4); strcat(szKey, szPart1); strcat(szKey, szPart2); szKey[41] = 125; return 1; } 发现字符串发生了位置的变化，将位置变化还原应该就是flag\n看代码可以直接对字符进行变换处理：\n53fc275d81053ed5be8cdaf29f59034938ae4efd 本题的flag为：\n53fc275d81053ed5be8cdaf29f59034938ae4efd 0x4 crazy 探测探测，看看是什么样的程序：\n64位的ELF程序，无壳。直接上静态分析看一看：\nint __cdecl main(int argc, const char **argv, const char **envp) { __int64 v3; // rax  __int64 v4; // rax  __int64 v5; // rax  __int64 v6; // rax  __int64 v7; // rax  __int64 v8; // rax  __int64 v9; // rax  __int64 v10; // rax  __int64 v11; // rax  __int64 v12; // rax  __int64 v13; // rax  __int64 v14; // rax  __int64 v15; // rax  __int64 v16; // rax  char v18[32]; // [rsp+10h] [rbp-130h] BYREF  char v19[32]; // [rsp+30h] [rbp-110h] BYREF  char v20[32]; // [rsp+50h] [rbp-F0h] BYREF  char v21[32]; // [rsp+70h] [rbp-D0h] BYREF  char v22[32]; // [rsp+90h] [rbp-B0h] BYREF  char v23[120]; // [rsp+B0h] [rbp-90h] BYREF  unsigned __int64 v24; // [rsp+128h] [rbp-18h]  v24 = __readfsqword(0x28u); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::basic_string(v18, argv, envp); std::operatorchar(\u0026std::cin, v18); v3 = std::operatorstd::char_traitschar(\u0026std::cout, \"-------------------------------------------\"); std::ostream::operator(v3, \u0026std::endlchar,std::char_traitschar); v4 = std::operatorstd::char_traitschar(\u0026std::cout, \"Quote from people's champ\"); std::ostream::operator(v4, \u0026std::endlchar,std::char_traitschar); v5 = std::operatorstd::char_traitschar(\u0026std::cout, \"-------------------------------------------\"); std::ostream::operator(v5, \u0026std::endlchar,std::char_traitschar); v6 = std::operatorstd::char_traitschar( \u0026std::cout, \"*My goal was never to be the loudest or the craziest. It was to be the most entertaining.\"); std::ostream::operator(v6, \u0026std::endlchar,std::char_traitschar); v7 = std::operatorstd::char_traitschar(\u0026std::cout, \"*Wrestling was like stand-up comedy for me.\"); std::ostream::operator(v7, \u0026std::endlchar,std::char_traitschar); v8 = std::operatorstd::char_traitschar( \u0026std::cout, \"*I like to use the hard times in the past to motivate me today.\"); std::ostream::operator(v8, \u0026std::endlchar,std::char_traitschar); v9 = std::operatorstd::char_traitschar(\u0026std::cout, \"-------------------------------------------\"); std::ostream::operator(v9, \u0026std::endlchar,std::char_traitschar); HighTemplar::HighTemplar((DarkTemplar *)v23, (__int64)v18); v10 = std::operatorstd::char_traitschar(\u0026std::cout, \"Checking....\"); std::ostream::operator(v10, \u0026std::endlchar,std::char_traitschar); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::basic_string(v19, v18); func1(v20, v19); func2(v21, v20); func3(v21, 0LL); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::~basic_string(v21); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::~basic_string(v20); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::~basic_string(v19); HighTemplar::calculate((HighTemplar *)v23); if ( !(unsigned int)HighTemplar::getSerial((HighTemplar *)v23) ) { v11 = std::operatorstd::char_traitschar(\u0026std::cout, \"/////////////////////////////////\"); std::ostream::operator(v11, \u0026std::endlchar,std::char_traitschar); v12 = std::operatorstd::char_traitschar(\u0026std::cout, \"Do not be angry. Happy Hacking :)\"); std::ostream::operator(v12, \u0026std::endlchar,std::char_traitschar); v13 = std::operatorstd::char_traitschar(\u0026std::cout, \"/////////////////////////////////\"); std::ostream::operator(v13, \u0026std::endlchar,std::char_traitschar); HighTemplar::getFlag[abi:cxx11](v22, v23); v14 = std::operatorstd::char_traitschar(\u0026std::cout, \"flag{\"); v15 = std::operatorchar(v14, v22); v16 = std::operatorstd::char_traitschar(v15, \"}\"); std::ostream::operator(v16, \u0026std::endlchar,std::char_traitschar); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::~basic_string(v22); } HighTemplar::~HighTemplar((HighTemplar *)v23); std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::~basic_string(v18); return 0; } 这道题目的难点应该是C++反汇编反编译代码的阅读，需要寻找关键函数：\nHighTemplar::HighTemplar((DarkTemplar *)v23, (__int64)v18); // 数据：\"327a6c4304ad5938eaf0efb6cc3e53dc\" HighTemplar::calculate((HighTemplar *)v23); // 加密 HighTemplar::getSerial((HighTemplar *)v23); // 验证 现在通过审计获得了三个关键函数，现在就可以逐一分析了\n先看看加密：\nbool __fastcall HighTemplar::calculate(HighTemplar *this) { __int64 v1; // rax  _BYTE *v2; // rbx  bool result; // al  _BYTE *v4; // rbx  int i; // [rsp+18h] [rbp-18h]  int j; // [rsp+1Ch] [rbp-14h]  if ( std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::length((char *)this + 16) != 32 ) { v1 = std::operatorstd::char_traitschar(\u0026std::cout, \"Too short or too long\"); std::ostream::operator(v1, \u0026std::endlchar,std::char_traitschar); exit(-1); } for ( i = 0; i  (unsigned __int64)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::length((char *)this + 16); ++i ) { v2 = (_BYTE *)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::operator[]( (char *)this + 16, i); *v2 = (*(_BYTE *)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::operator[]( (char *)this + 16, i) ^ 0x50) + 23; } for ( j = 0; ; ++j ) { result = j  (unsigned __int64)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::length((char *)this + 16); if ( !result ) break; v4 = (_BYTE *)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::operator[]( (char *)this + 16, j); *v4 = (*(_BYTE *)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::operator[]( (char *)this + 16, j) ^ 0x13) + 11; } return result; } 对加密代码简要分析就是：\nc = (((m ^ 0x50) + 23) ^ 0x13) + 11 然后查看一下验证函数\n__int64 __fastcall HighTemplar::getSerial(HighTemplar *this) { char v1; // bl  __int64 v2; // rax  __int64 v3; // rax  __int64 v4; // rax  __int64 v5; // rax  unsigned int i; // [rsp+1Ch] [rbp-14h]  for ( i = 0; (int)i  (unsigned __int64)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::length((char *)this + 16); ++i ) { v1 = *(_BYTE *)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::operator[]( (char *)this + 80, (int)i); if ( v1 != *(_BYTE *)std::__cxx11::basic_stringchar,std::char_traitschar,std::allocatorchar::operator[]( (char *)this + 16, (int)i) ) { v4 = std::operatorstd::char_traitschar(\u0026std::cout, \"You did not pass \"); v5 = std::ostream::operator(v4, i); std::ostream::operator(v5, \u0026std::endlchar,std::char_traitschar); *((_DWORD *)this + 3) = 1; return *((unsigned int *)this + 3); } v2 = std::operatorstd::char_traitschar(\u0026std::cout, \"Pass \"); v3 = std::ostream::operator(v2, i); std::ostream::operator(v3, \u0026std::endlchar,std::char_traitschar); } return *((unsigned int *)this + 3); } 也是对于字符327a6c4304ad5938eaf0efb6cc3e53dc的验证\n于是这道题目就非常简单了，直接对于异或操作进行逆向求解，写个python即可求解：\ndata='327a6c4304ad5938eaf0efb6cc3e53dc' flag='' for i in range(len(data)): n=ord(data[i]) flag+=chr((((n-11)^0x13)-23)^0x50) print('flag{'+flag+'}') 运行就能得到flag\nflag{tMx~qdstOs~crvtwb~aOba}qddtbrtcd} 0x5 Windows Reverse1 探测程序：\n程序是32位PE程序，使用了UPX的压缩壳，需要进行程序脱壳\n使用 upx -d命令进行脱壳\n脱壳后再次检查：\n脱壳之后然后进行静态分析：\nint __cdecl main(int argc, const char **argv, const char **envp) { char v4; // [esp+4h] [ebp-804h] BYREF  char v5[1023]; // [esp+5h] [ebp-803h] BYREF  char v6; // [esp+404h] [ebp-404h] BYREF  char v7[1023]; // [esp+405h] [ebp-403h] BYREF  v6 = 0; memset(v7, 0, sizeof(v7)); v4 = 0; memset(v5, 0, sizeof(v5)); printf(\"please input code:\"); scanf(\"%s\", \u0026v6); sub_401000(\u0026v6); if ( !strcmp(\u0026v4, \"DDCTF{reverseME}\") ) printf(\"You've got it!!%s\\n\", \u0026v4); else printf(\"Try again later.\\n\"); return 0; } 进行静态分析发现，存在一个关键函数在进行处理，即sub_401000函数在进行处理\n跟进这个函数\nunsigned int __cdecl sub_401000(const char *a1) { _BYTE *v1; // ecx  unsigned int v2; // edi  unsigned int result; // eax  int v4; // ebx  v2 = 0; result = strlen(a1); if ( result ) { v4 = a1 - v1; do { *v1 = byte_402FF8[(char)v1[v4]]; ++v2; ++v1; result = strlen(a1); } while ( v2  result ); } return result; } 发现这个函数的具体实现算法相对而言是比较难以理解，当然也是本垃圾太菜了，对这个算法的逻辑搞不太清楚。\n看看这个代码的汇编语句：\n对汇编代码的阅读，就可以理解关键语句\n*v1 = byte_402FF8[(char)v1[v4]]; 这个代码就可以转换为\n*v1 = byte_402FF8[(char)(v1+v4)]; 同时，由于：\nv4 = a1 - v1; 因此：\n*v1 = byte_402FF8[(char)a1]; 这样子就很好分析了，就是将a1进行遍历，将数据存储在v1里面。下面就是寻找byte_402FF8\n由于本题是在进行很多地址的运算，数组也大概率被存储在更高位的地址，依着逻辑去寻找可以找到byte_402FF8\n应该就是下面那一坨字符，进行提取就可以了。\n现在逻辑已经大致梳理清楚了，可以写个程序进行求解了：\n#include #include int main() { char data[]{ 126, 125, 124, 123, 122, 121, 120, 119, 118, 117, 116, 115, 114, 113, 112, 111, 110, 109, 108, 107, 106, 105, 104, 103, 102, 101, 100, 99, 98, 97, 96, 95, 94, 93, 92, 91, 90, 89, 88, 87, 86, 85, 84, 83, 82, 81, 80, 79, 78, 77, 76, 75, 74, 73, 72, 71, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49, 48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 0 }; char c[]{\"DDCTF{reverseME}\"}; std::cout  \"flag{\"; for(size_t i{ 0 };i  strlen(c);i++) { for(size_t j{ 0 };j  strlen(data); j++) { if(c[i] == data[j]) putchar(32+j); } } std::cout  \"}\"  std::endl; return 0; } 编译并运行，就能拿到flag啦：\nflag{ZZ[JX#,9(9,+9QY!} 这道题目坑好多，而且考察的点是相对比较偏的。\n",
  "wordCount" : "2031",
  "inLanguage": "en",
  "datePublished": "2022-01-28T19:34:08+08:00",
  "dateModified": "2022-01-28T19:34:08+08:00",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://OolongCode.github.io/posts/xctf-reverse-expert-13-18_writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "OPdbgBytes",
    "logo": {
      "@type": "ImageObject",
      "url": "https://OolongCode.github.io/favicon.ico"
    }
  }
}
</script>

<link href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css" rel="stylesheet">
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>

<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/armasm.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/mipsasm.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/wasm.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/x86asm.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://OolongCode.github.io" accesskey="h" title="OPdbgBytes (Alt + H)">OPdbgBytes</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://OolongCode.github.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://OolongCode.github.io/posts" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://OolongCode.github.io/link" title="Link">
                    <span>Link</span>
                </a>
            </li>
            <li>
                <a href="https://OolongCode.github.io/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://OolongCode.github.io">Home</a>&nbsp;»&nbsp;<a href="https://OolongCode.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      XCTF REVERSE Expert [13~18]_Writeup
    </h1>
    <div class="post-meta"><span title='2022-01-28 19:34:08 +0800 CST'>January 28, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;2031 words&nbsp;·&nbsp;Me

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x0-srm-50">0x0 srm-50</a></li>
    <li><a href="#0x1-simple-check-100">0x1 simple-check-100</a></li>
    <li><a href="#0x2-mysterious">0x2 Mysterious</a></li>
    <li><a href="#0x3-re1-100">0x3 re1-100</a></li>
    <li><a href="#0x4-crazy">0x4 crazy</a></li>
    <li><a href="#0x5-windows-reverse1">0x5 Windows Reverse1</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="xctf-reverse-高手区-13-18-writeup">XCTF-REVERSE-高手区-[13-18] writeup<a hidden class="anchor" aria-hidden="true" href="#xctf-reverse-高手区-13-18-writeup">#</a></h1>
<p>继续玩一玩逆向的题目，感觉还是蛮有意思的。</p>
<h2 id="0x0-srm-50">0x0 srm-50<a hidden class="anchor" aria-hidden="true" href="#0x0-srm-50">#</a></h2>
<p>使用DIE进行探测：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103093725322.png" alt="image-20211103093725322"  />
</p>
<p>32位PE程序，无壳。可以尝试运行一下：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103093811981.png" alt="image-20211103093811981"  />
</p>
<p>应该是一个邮箱破解的程序，终于有点稍微有意思的题目了</p>
<p>首先进行静态分析看代码：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103094139950.png" alt="image-20211103094139950"  />
</p>
<p>根据WIN32的编程基础，关键函数应该是在<code>DialogFunc</code>中，登录的细节应该是在<code>DialogFunc</code>中。</p>
<p>跟进<code>DialogFunc</code>函数，来寻找更多的细节</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">INT_PTR</span> <span class="kr">__stdcall</span> <span class="nf">DialogFunc</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hDlg</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">a2</span><span class="p">,</span> <span class="n">WPARAM</span> <span class="n">a3</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">a4</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">HMODULE</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">HICON</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">HMODULE</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">HWND</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">HCURSOR</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [esp-4h] [ebp-34Ch]
</span><span class="c1"></span>  <span class="n">CHAR</span> <span class="n">String</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="c1">// [esp+8h] [ebp-340h] BYREF
</span><span class="c1"></span>  <span class="n">CHAR</span> <span class="n">v11</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="c1">// [esp+108h] [ebp-240h] BYREF
</span><span class="c1"></span>  <span class="n">CHAR</span> <span class="n">Text</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="c1">// [esp+208h] [ebp-140h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">Source</span><span class="p">[</span><span class="mi">60</span><span class="p">];</span> <span class="c1">// [esp+308h] [ebp-40h] BYREF
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">==</span> <span class="mi">16</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">EndDialog</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">==</span> <span class="mi">272</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v5</span> <span class="o">=</span> <span class="n">GetModuleHandleW</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="n">LoadIconW</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="mh">0x67</span><span class="p">);</span>
    <span class="n">SetClassLongA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span> <span class="p">(</span><span class="n">LONG</span><span class="p">)</span><span class="n">v6</span><span class="p">);</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="n">GetModuleHandleW</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">v9</span> <span class="o">=</span> <span class="n">LoadCursorW</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="mh">0x66</span><span class="p">);</span>
    <span class="n">v8</span> <span class="o">=</span> <span class="n">GetDlgItem</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">SetClassLongA</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="p">(</span><span class="n">LONG</span><span class="p">)</span><span class="n">v9</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">!=</span> <span class="mi">273</span> <span class="o">||</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span><span class="p">)</span><span class="n">a3</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span><span class="p">)</span><span class="n">a3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">String</span><span class="p">));</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">v11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v11</span><span class="p">));</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Text</span><span class="p">));</span>
  <span class="n">GetDlgItemTextA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
  <span class="n">GetDlgItemTextA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="n">v11</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;@&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;@&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">46</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Source</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="s">&#34;Registration failure.&#34;</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="s">&#34;Registration Success!</span><span class="se">\n</span><span class="s">Your flag is:&#34;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">v11</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">67</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="mi">88</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">90</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="mi">65</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">57</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">==</span> <span class="mi">98</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">100</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">55</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">109</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="mi">71</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">113</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="mi">57</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">52</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="mi">103</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mi">99</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="mi">56</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">strcpy_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="n">Source</span><span class="p">);</span>
      <span class="n">strcat_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="n">v11</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">strcpy_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Source</span><span class="p">[</span><span class="mi">36</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="s">&#34;Your E-mail address in not valid.&#34;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">MessageBoxA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="s">&#34;Registeration&#34;</span><span class="p">,</span> <span class="mh">0x40u</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>flag直接展示的非常清晰了：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">if</span> <span class="p">(</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;@&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">strstr</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34;@&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">46</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Source</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="s">&#34;Registration failure.&#34;</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="s">&#34;Registration Success!</span><span class="se">\n</span><span class="s">Your flag is:&#34;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">v11</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">67</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="mi">88</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">90</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="mi">65</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">57</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">==</span> <span class="mi">98</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">100</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">55</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">109</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="mi">71</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">113</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="mi">57</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">52</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="mi">103</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mi">99</span>
      <span class="o">&amp;&amp;</span> <span class="n">v11</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="mi">56</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">strcpy_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="n">Source</span><span class="p">);</span>
      <span class="n">strcat_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="n">v11</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">strcpy_s</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="mh">0x100u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Source</span><span class="p">[</span><span class="mi">36</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div><p>对<code>v11</code>数组进行运算就可以得到，非常简单，可以非常容易地得到：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">CZ9dmq4c8g9G7bAX
</code></pre></div><p>故本题的flag：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">CZ9dmq4c8g9G7bAX
</code></pre></div><h2 id="0x1-simple-check-100">0x1 simple-check-100<a hidden class="anchor" aria-hidden="true" href="#0x1-simple-check-100">#</a></h2>
<p>先使用DIE姐姐进行探测一下，呐呐~</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103095757150.png" alt="image-20211103095757150"  />
</p>
<p>PE32程序，没有加壳。直接静态分析看一波：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// esp
</span><span class="c1"></span>  <span class="kt">void</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// esp
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+8h] [ebp-40h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [esp+1Bh] [ebp-2Dh] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="o">*</span><span class="n">v8</span><span class="p">;</span> <span class="c1">// [esp+1Ch] [ebp-2Ch]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [esp+20h] [ebp-28h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [esp+25h] [ebp-23h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// [esp+26h] [ebp-22h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// [esp+27h] [ebp-21h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v13</span><span class="p">;</span> <span class="c1">// [esp+28h] [ebp-20h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v14</span><span class="p">;</span> <span class="c1">// [esp+29h] [ebp-1Fh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v15</span><span class="p">;</span> <span class="c1">// [esp+2Ah] [ebp-1Eh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v16</span><span class="p">;</span> <span class="c1">// [esp+2Bh] [ebp-1Dh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v17</span><span class="p">;</span> <span class="c1">// [esp+2Ch] [ebp-1Ch]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v18</span><span class="p">;</span> <span class="c1">// [esp+2Dh] [ebp-1Bh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v19</span><span class="p">;</span> <span class="c1">// [esp+2Eh] [ebp-1Ah]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v20</span><span class="p">;</span> <span class="c1">// [esp+2Fh] [ebp-19h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v21</span><span class="p">;</span> <span class="c1">// [esp+30h] [ebp-18h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v22</span><span class="p">;</span> <span class="c1">// [esp+31h] [ebp-17h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v23</span><span class="p">;</span> <span class="c1">// [esp+32h] [ebp-16h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v24</span><span class="p">;</span> <span class="c1">// [esp+33h] [ebp-15h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v25</span><span class="p">;</span> <span class="c1">// [esp+34h] [ebp-14h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v26</span><span class="p">;</span> <span class="c1">// [esp+35h] [ebp-13h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v27</span><span class="p">;</span> <span class="c1">// [esp+36h] [ebp-12h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v28</span><span class="p">;</span> <span class="c1">// [esp+37h] [ebp-11h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v29</span><span class="p">;</span> <span class="c1">// [esp+38h] [ebp-10h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v30</span><span class="p">;</span> <span class="c1">// [esp+39h] [ebp-Fh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v31</span><span class="p">;</span> <span class="c1">// [esp+3Ah] [ebp-Eh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v32</span><span class="p">;</span> <span class="c1">// [esp+3Bh] [ebp-Dh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v33</span><span class="p">;</span> <span class="c1">// [esp+3Ch] [ebp-Ch]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v34</span><span class="p">;</span> <span class="c1">// [esp+3Dh] [ebp-Bh]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v35</span><span class="p">;</span> <span class="c1">// [esp+3Eh] [ebp-Ah]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v36</span><span class="p">;</span> <span class="c1">// [esp+3Fh] [ebp-9h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="o">*</span><span class="n">v37</span><span class="p">;</span> <span class="c1">// [esp+40h] [ebp-8h]
</span><span class="c1"></span>
  <span class="n">v37</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">argc</span><span class="p">;</span>
  <span class="n">__main</span><span class="p">();</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="mi">84</span><span class="p">;</span>
  <span class="n">v36</span> <span class="o">=</span> <span class="o">-</span><span class="mi">56</span><span class="p">;</span>
  <span class="n">v35</span> <span class="o">=</span> <span class="mi">126</span><span class="p">;</span>
  <span class="n">v34</span> <span class="o">=</span> <span class="o">-</span><span class="mi">29</span><span class="p">;</span>
  <span class="n">v33</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="n">v32</span> <span class="o">=</span> <span class="o">-</span><span class="mi">57</span><span class="p">;</span>
  <span class="n">v31</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
  <span class="n">v30</span> <span class="o">=</span> <span class="o">-</span><span class="mi">102</span><span class="p">;</span>
  <span class="n">v29</span> <span class="o">=</span> <span class="o">-</span><span class="mi">51</span><span class="p">;</span>
  <span class="n">v28</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
  <span class="n">v27</span> <span class="o">=</span> <span class="mi">101</span><span class="p">;</span>
  <span class="n">v26</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
  <span class="n">v25</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span>
  <span class="n">v24</span> <span class="o">=</span> <span class="o">-</span><span class="mi">29</span><span class="p">;</span>
  <span class="n">v23</span> <span class="o">=</span> <span class="o">-</span><span class="mi">45</span><span class="p">;</span>
  <span class="n">v22</span> <span class="o">=</span> <span class="mi">67</span><span class="p">;</span>
  <span class="n">v21</span> <span class="o">=</span> <span class="o">-</span><span class="mi">110</span><span class="p">;</span>
  <span class="n">v20</span> <span class="o">=</span> <span class="o">-</span><span class="mi">87</span><span class="p">;</span>
  <span class="n">v19</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span><span class="p">;</span>
  <span class="n">v18</span> <span class="o">=</span> <span class="o">-</span><span class="mi">46</span><span class="p">;</span>
  <span class="n">v17</span> <span class="o">=</span> <span class="o">-</span><span class="mi">26</span><span class="p">;</span>
  <span class="n">v16</span> <span class="o">=</span> <span class="mi">109</span><span class="p">;</span>
  <span class="n">v15</span> <span class="o">=</span> <span class="mi">44</span><span class="p">;</span>
  <span class="n">v14</span> <span class="o">=</span> <span class="o">-</span><span class="mi">45</span><span class="p">;</span>
  <span class="n">v13</span> <span class="o">=</span> <span class="o">-</span><span class="mi">74</span><span class="p">;</span>
  <span class="n">v12</span> <span class="o">=</span> <span class="o">-</span><span class="mi">67</span><span class="p">;</span>
  <span class="n">v11</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
  <span class="n">v10</span> <span class="o">=</span> <span class="mi">106</span><span class="p">;</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">alloca</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">alloca</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v6</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Key: &#34;</span><span class="p">);</span>
  <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">v8</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">check_key</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">v8</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">interesting_function</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v7</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Wrong&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>关键函数是<code>check_key</code>函数，只要对<code>check_key</code>函数进行绕过应该就可以拿到flag</p>
<p>使用Ollydbg进行动态调试：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103155250920.png" alt="image-20211103155250920"  />
</p>
<p>发现Ollydbg总是会输出乱码。不能够正确地将flag输出出来，可能是由于WINDOW编码的问题，也可能是由于题目的WINDOWS程序没有写好。需要再进行对Linux程序进行分析，但是考虑到Linux程序的代码应该是和Windows的代码结构大致一致</p>
<p>把程序拖到Kali Linux中，使用GDB进行调试：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103160210709.png" alt="image-20211103160210709"  />
</p>
<p>成功调试出了flag：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag_is_you_know_cracking!!!
</code></pre></div><h2 id="0x2-mysterious">0x2 Mysterious<a hidden class="anchor" aria-hidden="true" href="#0x2-mysterious">#</a></h2>
<p>先使用DIE探测一下：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103163229333.png" alt="image-20211103163229333"  />
</p>
<p>32位PE程序，无壳</p>
<p>尝试运行一下这个程序：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103163501910.png" alt="image-20211103163501910"  />
</p>
<p>密码破解的程序，先进行静态分析确定位置：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103163903336.png" alt="image-20211103163903336"  />
</p>
<p>经典的WIN32程序，继续跟进</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103164106092.png" alt="image-20211103164106092"  />
</p>
<p>跟进<code>DialogFunc</code>函数，这个函数主要就是WIN32的窗口创建函数，代码逻辑应该就在WIN32中。</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103164207779.png" alt="image-20211103164207779"  />
</p>
<p>继续跟进，胜利就在前方！</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103164237890.png" alt="image-20211103164237890"  />
</p>
<p>找到主要的逻辑函数，在下面寻找逻辑判断语句</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103164423968.png" alt="image-20211103164423968"  />
</p>
<p>这个<code>loc_401183</code>应该是关键函数，这个函数的地址是<code>0x401183</code>，使用Ollydbg进行同时调试来绕过这个判断条件直接出flag</p>
<p>使用Ollydbg，使用快捷键<code>CTRL+G</code>快速跳转到<code>0x401183</code>的地址，同时也要根据代码静态分析的逻辑来进行判断，发现需要进行输入的代码段是122，这个可以作为Key进行输入：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103165814525.png" alt="image-20211103165814525"  />
</p>
<p>在Ollydbg中修改汇编，修改跳转条件，然后输入122</p>
<p>就可以拿到flag了</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103171857297.png" alt="image-20211103171857297"  />
</p>
<p>flag为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{123_Buff3r_0v3rf|0w}
</code></pre></div><hr>
<p>本题还有一种更简单的解法，就是直接静态分析来读取密码直接输入来拿到flag</p>
<p>本菜鸡只是希望可以学习到更多的技能点，于是使用另一种思路进行求解。</p>
<h2 id="0x3-re1-100">0x3 re1-100<a hidden class="anchor" aria-hidden="true" href="#0x3-re1-100">#</a></h2>
<p>先进行一下探测：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103172548605.png" alt="image-20211103172548605"  />
</p>
<p>64位的ELF文件，直接静态分析：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103172742437.png" alt="image-20211103172742437"  />
</p>
<p>代码中有反调试函数，这道题目使用动态调试会有些麻烦，应该是使用静态调试进行求解</p>
<p>查看静态调试代码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">__noreturn</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">__pid_t</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">size_t</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="n">ssize_t</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// rbx
</span><span class="c1"></span>  <span class="kt">bool</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// al
</span><span class="c1"></span>  <span class="kt">bool</span> <span class="n">bCheckPtrace</span><span class="p">;</span> <span class="c1">// [rsp+13h] [rbp-1BDh]
</span><span class="c1"></span>  <span class="n">ssize_t</span> <span class="n">numRead</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-1B8h]
</span><span class="c1"></span>  <span class="n">ssize_t</span> <span class="n">numReada</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-1B8h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">bufWrite</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-1B0h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">bufParentRead</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// [rsp+F0h] [rbp-E0h] BYREF
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// [rsp+1B8h] [rbp-18h]
</span><span class="c1"></span>
  <span class="n">v12</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">bCheckPtrace</span> <span class="o">=</span> <span class="n">detectDebugging</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">pipe</span><span class="p">(</span><span class="n">pParentWrite</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">pipe</span><span class="p">(</span><span class="n">pParentRead</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">close</span><span class="p">(</span><span class="n">pParentWrite</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="n">close</span><span class="p">(</span><span class="n">pParentRead</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
      <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Input key : &#34;</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">bufWrite</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bufWrite</span><span class="p">));</span>
        <span class="n">gets</span><span class="p">(</span><span class="n">bufWrite</span><span class="p">);</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">bufWrite</span><span class="p">);</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">pParentWrite</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bufWrite</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">!=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">bufWrite</span><span class="p">)</span> <span class="p">)</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">&#34;parent - partial/failed write&#34;</span><span class="p">);</span>
        <span class="k">do</span>
        <span class="p">{</span>
          <span class="n">memset</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">));</span>
          <span class="n">numReada</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">pParentRead</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bufParentRead</span><span class="p">,</span> <span class="mh">0xC8uLL</span><span class="p">);</span>
          <span class="n">v6</span> <span class="o">=</span> <span class="n">bCheckPtrace</span> <span class="o">||</span> <span class="n">checkDebuggerProcessRunning</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v6</span> <span class="o">&amp;&amp;</span> <span class="n">checkStringIsNumber</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">atoi</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">)</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">&#34;True&#34;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">close</span><span class="p">(</span><span class="n">pParentWrite</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
              <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Wrong !!!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span> <span class="n">numReada</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">close</span><span class="p">(</span><span class="n">pParentWrite</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">pParentRead</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">memset</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">));</span>
      <span class="n">numRead</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">pParentWrite</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bufParentRead</span><span class="p">,</span> <span class="mh">0xC8uLL</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">numRead</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">numRead</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">childCheckDebugResult</span><span class="p">()</span>
          <span class="o">&amp;&amp;</span> <span class="n">bufParentRead</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">123</span>
          <span class="o">&amp;&amp;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span>
          <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bufParentRead</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#34;53fc275d81&#34;</span><span class="p">,</span> <span class="mh">0xAuLL</span><span class="p">)</span>
          <span class="o">&amp;&amp;</span> <span class="n">bufParentRead</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">125</span>
          <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bufParentRead</span><span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="s">&#34;4938ae4efd&#34;</span><span class="p">,</span> <span class="mh">0xAuLL</span><span class="p">)</span>
          <span class="o">&amp;&amp;</span> <span class="n">confuseKey</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
          <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">bufParentRead</span><span class="p">,</span> <span class="s">&#34;{daf29f59034938ae4efd53fc275d81053ed5be8c}&#34;</span><span class="p">,</span> <span class="mh">0x2AuLL</span><span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="n">responseTrue</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="n">responseFalse</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>发现存在有一个可疑的字符串：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">{daf29f59034938ae4efd53fc275d81053ed5be8c}
</code></pre></div><p>这个字符串可能是flag，但是感觉似乎有些不太对劲</p>
<p>往上观察，发现存在有一个进行变换的函数<code>confusekey</code></p>
<p>进入这个函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">bool</span> <span class="kr">__cdecl</span> <span class="nf">confuseKey</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">szKey</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iKeyLength</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">szPart1</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-50h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">szPart2</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-40h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">szPart3</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span> <span class="c1">// [rsp+30h] [rbp-30h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">szPart4</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span> <span class="c1">// [rsp+40h] [rbp-20h] BYREF
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+58h] [rbp-8h]
</span><span class="c1"></span>
  <span class="n">v7</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">szPart1</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart1</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart1</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">szPart1</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">szPart2</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart2</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart2</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">szPart2</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">szPart3</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart3</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart3</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">szPart3</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">szPart4</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart4</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">szPart4</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">szPart4</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">iKeyLength</span> <span class="o">!=</span> <span class="mi">42</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">szKey</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szKey</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">42</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">szKey</span> <span class="o">!=</span> <span class="mi">123</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">strncpy</span><span class="p">(</span><span class="n">szPart1</span><span class="p">,</span> <span class="n">szKey</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0xAuLL</span><span class="p">);</span>
  <span class="n">strncpy</span><span class="p">(</span><span class="n">szPart2</span><span class="p">,</span> <span class="n">szKey</span> <span class="o">+</span> <span class="mi">11</span><span class="p">,</span> <span class="mh">0xAuLL</span><span class="p">);</span>
  <span class="n">strncpy</span><span class="p">(</span><span class="n">szPart3</span><span class="p">,</span> <span class="n">szKey</span> <span class="o">+</span> <span class="mi">21</span><span class="p">,</span> <span class="mh">0xAuLL</span><span class="p">);</span>
  <span class="n">strncpy</span><span class="p">(</span><span class="n">szPart4</span><span class="p">,</span> <span class="n">szKey</span> <span class="o">+</span> <span class="mi">31</span><span class="p">,</span> <span class="mh">0xAuLL</span><span class="p">);</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">szKey</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x2AuLL</span><span class="p">);</span>
  <span class="o">*</span><span class="n">szKey</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">szKey</span><span class="p">,</span> <span class="n">szPart3</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">szKey</span><span class="p">,</span> <span class="n">szPart4</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">szKey</span><span class="p">,</span> <span class="n">szPart1</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">szKey</span><span class="p">,</span> <span class="n">szPart2</span><span class="p">);</span>
  <span class="n">szKey</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span> <span class="o">=</span> <span class="mi">125</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>发现字符串发生了位置的变化，将位置变化还原应该就是flag</p>
<p>看代码可以直接对字符进行变换处理：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">53fc275d81053ed5be8cdaf29f59034938ae4efd
</code></pre></div><p>本题的flag为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">53fc275d81053ed5be8cdaf29f59034938ae4efd
</code></pre></div><h2 id="0x4-crazy">0x4 crazy<a hidden class="anchor" aria-hidden="true" href="#0x4-crazy">#</a></h2>
<p>探测探测，看看是什么样的程序：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103185717266.png" alt="image-20211103185717266"  />
</p>
<p>64位的ELF程序，无壳。直接上静态分析看一看：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v13</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v14</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v15</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v16</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v18</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-130h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v19</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">// [rsp+30h] [rbp-110h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v20</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">// [rsp+50h] [rbp-F0h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v21</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">// [rsp+70h] [rbp-D0h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v22</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span> <span class="c1">// [rsp+90h] [rbp-B0h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v23</span><span class="p">[</span><span class="mi">120</span><span class="p">];</span> <span class="c1">// [rsp+B0h] [rbp-90h] BYREF
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v24</span><span class="p">;</span> <span class="c1">// [rsp+128h] [rbp-18h]
</span><span class="c1"></span>
  <span class="n">v24</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&gt;&gt;&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span> <span class="n">v18</span><span class="p">);</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;-------------------------------------------&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;Quote from people&#39;s champ&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;-------------------------------------------&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span>
         <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span>
         <span class="s">&#34;*My goal was never to be the loudest or the craziest. It was to be the most entertaining.&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;*Wrestling was like stand-up comedy for me.&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span>
         <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span>
         <span class="s">&#34;*I like to use the hard times in the past to motivate me today.&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;-------------------------------------------&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v9</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">HighTemplar</span><span class="o">::</span><span class="n">HighTemplar</span><span class="p">((</span><span class="n">DarkTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v18</span><span class="p">);</span>
  <span class="n">v10</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;Checking....&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v19</span><span class="p">,</span> <span class="n">v18</span><span class="p">);</span>
  <span class="n">func1</span><span class="p">(</span><span class="n">v20</span><span class="p">,</span> <span class="n">v19</span><span class="p">);</span>
  <span class="n">func2</span><span class="p">(</span><span class="n">v21</span><span class="p">,</span> <span class="n">v20</span><span class="p">);</span>
  <span class="n">func3</span><span class="p">(</span><span class="n">v21</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::~</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v21</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::~</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v20</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::~</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v19</span><span class="p">);</span>
  <span class="n">HighTemplar</span><span class="o">::</span><span class="n">calculate</span><span class="p">((</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">HighTemplar</span><span class="o">::</span><span class="n">getSerial</span><span class="p">((</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v11</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;/////////////////////////////////&#34;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v11</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
    <span class="n">v12</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;Do not be angry. Happy Hacking :)&#34;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
    <span class="n">v13</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;/////////////////////////////////&#34;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v13</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
    <span class="n">HighTemplar</span><span class="o">::</span><span class="n">getFlag</span><span class="p">[</span><span class="nl">abi</span><span class="p">:</span><span class="n">cxx11</span><span class="p">](</span><span class="n">v22</span><span class="p">,</span> <span class="n">v23</span><span class="p">);</span>
    <span class="n">v14</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;flag{&#34;</span><span class="p">);</span>
    <span class="n">v15</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v14</span><span class="p">,</span> <span class="n">v22</span><span class="p">);</span>
    <span class="n">v16</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span> <span class="s">&#34;}&#34;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v16</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::~</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v22</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">HighTemplar</span><span class="o">::~</span><span class="n">HighTemplar</span><span class="p">((</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::~</span><span class="n">basic_string</span><span class="p">(</span><span class="n">v18</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>这道题目的难点应该是C++反汇编反编译代码的阅读，需要寻找关键函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="n">HighTemplar</span><span class="o">::</span><span class="n">HighTemplar</span><span class="p">((</span><span class="n">DarkTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v18</span><span class="p">);</span> <span class="c1">// 数据：&#34;327a6c4304ad5938eaf0efb6cc3e53dc&#34;
</span><span class="c1"></span><span class="n">HighTemplar</span><span class="o">::</span><span class="n">calculate</span><span class="p">((</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">);</span> <span class="c1">// 加密
</span><span class="c1"></span><span class="n">HighTemplar</span><span class="o">::</span><span class="n">getSerial</span><span class="p">((</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="p">)</span><span class="n">v23</span><span class="p">);</span> <span class="c1">// 验证
</span></code></pre></div><p>现在通过审计获得了三个关键函数，现在就可以逐一分析了</p>
<p>先看看加密：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">bool</span> <span class="kr">__fastcall</span> <span class="n">HighTemplar</span><span class="o">::</span><span class="n">calculate</span><span class="p">(</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="k">this</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span> <span class="c1">// rbx
</span><span class="c1"></span>  <span class="kt">bool</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// al
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// rbx
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-18h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-14h]
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">length</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">32</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;Too short or too long&#34;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">length</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
        <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="k">operator</span><span class="p">[](</span>
                    <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span>
                    <span class="n">i</span><span class="p">);</span>
    <span class="o">*</span><span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="k">operator</span><span class="p">[](</span>
                       <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span>
                       <span class="n">i</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0x50</span><span class="p">)</span>
        <span class="o">+</span> <span class="mi">23</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">length</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">result</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="k">operator</span><span class="p">[](</span>
                    <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span>
                    <span class="n">j</span><span class="p">);</span>
    <span class="o">*</span><span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="k">operator</span><span class="p">[](</span>
                       <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span>
                       <span class="n">j</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0x13</span><span class="p">)</span>
        <span class="o">+</span> <span class="mi">11</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>对加密代码简要分析就是：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">c</span> <span class="o">=</span> <span class="p">(((</span><span class="n">m</span> <span class="o">^</span> <span class="mh">0x50</span><span class="p">)</span> <span class="o">+</span> <span class="mi">23</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">11</span>
</code></pre></div><p>然后查看一下验证函数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="n">HighTemplar</span><span class="o">::</span><span class="n">getSerial</span><span class="p">(</span><span class="n">HighTemplar</span> <span class="o">*</span><span class="k">this</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// bl
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// rax
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-14h]
</span><span class="c1"></span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">length</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
        <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="k">operator</span><span class="p">[](</span>
                     <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">80</span><span class="p">,</span>
                     <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="k">operator</span><span class="p">[](</span>
                           <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span>
                           <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">i</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;You did not pass &#34;</span><span class="p">);</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
      <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
      <span class="o">*</span><span class="p">((</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;Pass &#34;</span><span class="p">);</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>也是对于字符<code>327a6c4304ad5938eaf0efb6cc3e53dc</code>的验证</p>
<p>于是这道题目就非常简单了，直接对于异或操作进行逆向求解，写个python即可求解：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">data</span><span class="o">=</span><span class="s1">&#39;327a6c4304ad5938eaf0efb6cc3e53dc&#39;</span>
<span class="n">flag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">flag</span><span class="o">+=</span><span class="nb">chr</span><span class="p">((((</span><span class="n">n</span><span class="o">-</span><span class="mi">11</span><span class="p">)</span><span class="o">^</span><span class="mh">0x13</span><span class="p">)</span><span class="o">-</span><span class="mi">23</span><span class="p">)</span><span class="o">^</span><span class="mh">0x50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flag{&#39;</span><span class="o">+</span><span class="n">flag</span><span class="o">+</span><span class="s1">&#39;}&#39;</span><span class="p">)</span>
</code></pre></div><p>运行就能得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{tMx~qdstOs~crvtwb~aOba}qddtbrtcd}
</code></pre></div><h2 id="0x5-windows-reverse1">0x5 Windows Reverse1<a hidden class="anchor" aria-hidden="true" href="#0x5-windows-reverse1">#</a></h2>
<p>探测程序：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103200343354.png" alt="image-20211103200343354"  />
</p>
<p>程序是32位PE程序，使用了UPX的压缩壳，需要进行程序脱壳</p>
<p>使用 <code>upx -d</code>命令进行脱壳</p>
<p>脱壳后再次检查：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211103202849197.png" alt="image-20211103202849197"  />
</p>
<p>脱壳之后然后进行静态分析：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-804h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">1023</span><span class="p">];</span> <span class="c1">// [esp+5h] [ebp-803h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+404h] [ebp-404h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">1023</span><span class="p">];</span> <span class="c1">// [esp+405h] [ebp-403h] BYREF
</span><span class="c1"></span>
  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v7</span><span class="p">));</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v5</span><span class="p">));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;please input code:&#34;</span><span class="p">);</span>
  <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v6</span><span class="p">);</span>
  <span class="n">sub_401000</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v6</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v4</span><span class="p">,</span> <span class="s">&#34;DDCTF{reverseME}&#34;</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;You&#39;ve got it!!%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Try again later.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>进行静态分析发现，存在一个关键函数在进行处理，即<code>sub_401000</code>函数在进行处理</p>
<p>跟进这个函数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">sub_401000</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v1</span><span class="p">;</span> <span class="c1">// ecx
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// edi
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// ebx
</span><span class="c1"></span>
  <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">result</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">-</span> <span class="n">v1</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="n">byte_402FF8</span><span class="p">[(</span><span class="kt">char</span><span class="p">)</span><span class="n">v1</span><span class="p">[</span><span class="n">v4</span><span class="p">]];</span>
      <span class="o">++</span><span class="n">v2</span><span class="p">;</span>
      <span class="o">++</span><span class="n">v1</span><span class="p">;</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="n">result</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>发现这个函数的具体实现算法相对而言是比较难以理解，当然也是本垃圾太菜了，对这个算法的逻辑搞不太清楚。</p>
<p>看看这个代码的汇编语句：</p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211104075853810.png" alt="image-20211104075853810"  />
</p>
<p>对汇编代码的阅读，就可以理解关键语句</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="n">byte_402FF8</span><span class="p">[(</span><span class="kt">char</span><span class="p">)</span><span class="n">v1</span><span class="p">[</span><span class="n">v4</span><span class="p">]];</span>
</code></pre></div><p>这个代码就可以转换为</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="n">byte_402FF8</span><span class="p">[(</span><span class="kt">char</span><span class="p">)(</span><span class="n">v1</span><span class="o">+</span><span class="n">v4</span><span class="p">)];</span>
</code></pre></div><p>同时，由于：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">v4</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">-</span> <span class="n">v1</span><span class="p">;</span>
</code></pre></div><p>因此：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="n">byte_402FF8</span><span class="p">[(</span><span class="kt">char</span><span class="p">)</span><span class="n">a1</span><span class="p">];</span>
</code></pre></div><p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211104084802229.png" alt="image-20211104084802229"  />
</p>
<p>这样子就很好分析了，就是将<code>a1</code>进行遍历，将数据存储在v1里面。下面就是寻找<code>byte_402FF8</code></p>
<p>由于本题是在进行很多地址的运算，数组也大概率被存储在更高位的地址，依着逻辑去寻找可以找到<code>byte_402FF8</code></p>
<p><img loading="lazy" src="/images/XCTF-REVERSE-expert-[13-18]_writeup/image-20211104085233187.png" alt="image-20211104085233187"  />
</p>
<p>应该就是下面那一坨字符，进行提取就可以了。</p>
<p>现在逻辑已经大致梳理清楚了，可以写个程序进行求解了：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">data</span><span class="p">[]{</span>
    <span class="mi">126</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> 
    <span class="mi">116</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> 
    <span class="mi">106</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="mi">99</span><span class="p">,</span>  <span class="mi">98</span><span class="p">,</span>  <span class="mi">97</span><span class="p">,</span> 
     <span class="mi">96</span><span class="p">,</span>  <span class="mi">95</span><span class="p">,</span>  <span class="mi">94</span><span class="p">,</span>  <span class="mi">93</span><span class="p">,</span>  <span class="mi">92</span><span class="p">,</span>  <span class="mi">91</span><span class="p">,</span>  <span class="mi">90</span><span class="p">,</span>  <span class="mi">89</span><span class="p">,</span>  <span class="mi">88</span><span class="p">,</span>  <span class="mi">87</span><span class="p">,</span> 
     <span class="mi">86</span><span class="p">,</span>  <span class="mi">85</span><span class="p">,</span>  <span class="mi">84</span><span class="p">,</span>  <span class="mi">83</span><span class="p">,</span>  <span class="mi">82</span><span class="p">,</span>  <span class="mi">81</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span>  <span class="mi">79</span><span class="p">,</span>  <span class="mi">78</span><span class="p">,</span>  <span class="mi">77</span><span class="p">,</span> 
     <span class="mi">76</span><span class="p">,</span>  <span class="mi">75</span><span class="p">,</span>  <span class="mi">74</span><span class="p">,</span>  <span class="mi">73</span><span class="p">,</span>  <span class="mi">72</span><span class="p">,</span>  <span class="mi">71</span><span class="p">,</span>  <span class="mi">70</span><span class="p">,</span>  <span class="mi">69</span><span class="p">,</span>  <span class="mi">68</span><span class="p">,</span>  <span class="mi">67</span><span class="p">,</span> 
     <span class="mi">66</span><span class="p">,</span>  <span class="mi">65</span><span class="p">,</span>  <span class="mi">64</span><span class="p">,</span>  <span class="mi">63</span><span class="p">,</span>  <span class="mi">62</span><span class="p">,</span>  <span class="mi">61</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>  <span class="mi">59</span><span class="p">,</span>  <span class="mi">58</span><span class="p">,</span>  <span class="mi">57</span><span class="p">,</span> 
     <span class="mi">56</span><span class="p">,</span>  <span class="mi">55</span><span class="p">,</span>  <span class="mi">54</span><span class="p">,</span>  <span class="mi">53</span><span class="p">,</span>  <span class="mi">52</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>  <span class="mi">50</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span>  <span class="mi">48</span><span class="p">,</span>  <span class="mi">47</span><span class="p">,</span> 
     <span class="mi">46</span><span class="p">,</span>  <span class="mi">45</span><span class="p">,</span>  <span class="mi">44</span><span class="p">,</span>  <span class="mi">43</span><span class="p">,</span>  <span class="mi">42</span><span class="p">,</span>  <span class="mi">41</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span>  <span class="mi">39</span><span class="p">,</span>  <span class="mi">38</span><span class="p">,</span>  <span class="mi">37</span><span class="p">,</span> 
     <span class="mi">36</span><span class="p">,</span>  <span class="mi">35</span><span class="p">,</span>  <span class="mi">34</span><span class="p">,</span>  <span class="mi">33</span><span class="p">,</span>  <span class="mi">32</span><span class="p">,</span>   <span class="mi">0</span>
  <span class="p">};</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">[]{</span><span class="s">&#34;DDCTF{reverseME}&#34;</span><span class="p">};</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;flag{&#34;</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">size_t</span> <span class="n">i</span><span class="p">{</span> <span class="mi">0</span> <span class="p">};</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">size_t</span> <span class="n">j</span><span class="p">{</span> <span class="mi">0</span> <span class="p">};</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
              <span class="n">putchar</span><span class="p">(</span><span class="mi">32</span><span class="o">+</span><span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;}&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>编译并运行，就能拿到flag啦：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{ZZ[JX#,9(9,+9QY!}
</code></pre></div><p>这道题目坑好多，而且考察的点是相对比较偏的。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://OolongCode.github.io/tags/ctf/">ctf</a></li>
      <li><a href="https://OolongCode.github.io/tags/writeup/">writeup</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://OolongCode.github.io/posts/%E4%B8%80%E8%8A%B1%E4%B8%80%E4%B8%96%E7%95%8C%E4%B8%80%E7%A0%81%E4%B8%80%E5%8D%83%E7%A7%8B/">
    <span class="title">« Prev</span>
    <br>
    <span>一花一世界，一码一千秋</span>
  </a>
  <a class="next" href="https://OolongCode.github.io/posts/xctf-reverse-expert-7-12_writeup/">
    <span class="title">Next »</span>
    <br>
    <span>XCTF REVERSE Expert [7~12]_Writeup</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share XCTF REVERSE Expert [13~18]_Writeup on twitter"
        href="https://twitter.com/intent/tweet/?text=XCTF%20REVERSE%20Expert%20%5b13~18%5d_Writeup&amp;url=https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f&amp;hashtags=ctf%2cwriteup">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share XCTF REVERSE Expert [13~18]_Writeup on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f&amp;title=XCTF%20REVERSE%20Expert%20%5b13~18%5d_Writeup&amp;summary=XCTF%20REVERSE%20Expert%20%5b13~18%5d_Writeup&amp;source=https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share XCTF REVERSE Expert [13~18]_Writeup on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f&title=XCTF%20REVERSE%20Expert%20%5b13~18%5d_Writeup">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share XCTF REVERSE Expert [13~18]_Writeup on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share XCTF REVERSE Expert [13~18]_Writeup on whatsapp"
        href="https://api.whatsapp.com/send?text=XCTF%20REVERSE%20Expert%20%5b13~18%5d_Writeup%20-%20https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share XCTF REVERSE Expert [13~18]_Writeup on telegram"
        href="https://telegram.me/share/url?text=XCTF%20REVERSE%20Expert%20%5b13~18%5d_Writeup&amp;url=https%3a%2f%2fOolongCode.github.io%2fposts%2fxctf-reverse-expert-13-18_writeup%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://OolongCode.github.io">OPdbgBytes</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
