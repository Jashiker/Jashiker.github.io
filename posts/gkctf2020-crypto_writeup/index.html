<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>GKCTF2020 CRYPTO_writeup | Jasmine❀Hiker</title><meta name=keywords content="ctf,writeup"><meta name=description content="GKCTF2020的密码学题目相对而言比较简单，古典密码学题目偏多。而且密码学题目也只有四道题目
0x0 小学生的密码学 打开题目描述，查看题目描述内容：
e(x)=11x+6(mod26) 密文：welcylk （flag为base64形式） 看样子是仿射密码，直接逆就好了，写个python脚本解决吧：
import gmpy2 import string import base64 m = gmpy2.invert(11,26) table = string.ascii_lowercase # print table cipher = &#34;welcylk&#34; plainer = &#34;&#34; for i in cipher: x = table.index(i) j = (x-6)*m %26 # print j plainer += table[j] flag = &#34;flag{&#34;+base64.b64encode(plainer) +&#34;}&#34; print flag 运行脚本，得到flag：
flag{c29yY2VyeQ==} 0x1 汉字的秘密 题目描述：
你能看出汉字的奥秘吗？ 答案形式：flag{小写字母} 和汉字相关的密码，又是考察古典密码，估计是当铺密码
下载附件，发现附件是一个doc文件，查看附件内容：
王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫 看样子是当铺密码，没错了，写个脚本处理一下吧："><meta name=author content="Me"><link rel=canonical href=jashiker-jajaja.top/posts/gkctf2020-crypto_writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/jashiker-jajaja.top/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/jashiker-jajaja.top/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=jashiker-jajaja.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=apple-touch-icon href=jashiker-jajaja.top/apple-touch-icon.png><link rel=mask-icon href=jashiker-jajaja.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="GKCTF2020 CRYPTO_writeup"><meta property="og:description" content="GKCTF2020的密码学题目相对而言比较简单，古典密码学题目偏多。而且密码学题目也只有四道题目
0x0 小学生的密码学 打开题目描述，查看题目描述内容：
e(x)=11x+6(mod26) 密文：welcylk （flag为base64形式） 看样子是仿射密码，直接逆就好了，写个python脚本解决吧：
import gmpy2 import string import base64 m = gmpy2.invert(11,26) table = string.ascii_lowercase # print table cipher = &#34;welcylk&#34; plainer = &#34;&#34; for i in cipher: x = table.index(i) j = (x-6)*m %26 # print j plainer += table[j] flag = &#34;flag{&#34;+base64.b64encode(plainer) +&#34;}&#34; print flag 运行脚本，得到flag：
flag{c29yY2VyeQ==} 0x1 汉字的秘密 题目描述：
你能看出汉字的奥秘吗？ 答案形式：flag{小写字母} 和汉字相关的密码，又是考察古典密码，估计是当铺密码
下载附件，发现附件是一个doc文件，查看附件内容：
王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫 看样子是当铺密码，没错了，写个脚本处理一下吧："><meta property="og:type" content="article"><meta property="og:url" content="jashiker-jajaja.top/posts/gkctf2020-crypto_writeup/"><meta property="og:image" content="jashiker-jajaja.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-26T16:53:12+08:00"><meta property="article:modified_time" content="2021-06-26T16:53:12+08:00"><meta property="og:site_name" content="Jasmine❀Hiker"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="jashiker-jajaja.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="GKCTF2020 CRYPTO_writeup"><meta name=twitter:description content="GKCTF2020的密码学题目相对而言比较简单，古典密码学题目偏多。而且密码学题目也只有四道题目
0x0 小学生的密码学 打开题目描述，查看题目描述内容：
e(x)=11x+6(mod26) 密文：welcylk （flag为base64形式） 看样子是仿射密码，直接逆就好了，写个python脚本解决吧：
import gmpy2 import string import base64 m = gmpy2.invert(11,26) table = string.ascii_lowercase # print table cipher = &#34;welcylk&#34; plainer = &#34;&#34; for i in cipher: x = table.index(i) j = (x-6)*m %26 # print j plainer += table[j] flag = &#34;flag{&#34;+base64.b64encode(plainer) +&#34;}&#34; print flag 运行脚本，得到flag：
flag{c29yY2VyeQ==} 0x1 汉字的秘密 题目描述：
你能看出汉字的奥秘吗？ 答案形式：flag{小写字母} 和汉字相关的密码，又是考察古典密码，估计是当铺密码
下载附件，发现附件是一个doc文件，查看附件内容：
王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫 看样子是当铺密码，没错了，写个脚本处理一下吧："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"jashiker-jajaja.top/posts/"},{"@type":"ListItem","position":3,"name":"GKCTF2020 CRYPTO_writeup","item":"jashiker-jajaja.top/posts/gkctf2020-crypto_writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"GKCTF2020 CRYPTO_writeup","name":"GKCTF2020 CRYPTO_writeup","description":"GKCTF2020的密码学题目相对而言比较简单，古典密码学题目偏多。而且密码学题目也只有四道题目\n0x0 小学生的密码学 打开题目描述，查看题目描述内容：\ne(x)=11x+6(mod26) 密文：welcylk （flag为base64形式） 看样子是仿射密码，直接逆就好了，写个python脚本解决吧：\nimport gmpy2 import string import base64 m = gmpy2.invert(11,26) table = string.ascii_lowercase # print table cipher = \u0026#34;welcylk\u0026#34; plainer = \u0026#34;\u0026#34; for i in cipher: x = table.index(i) j = (x-6)*m %26 # print j plainer += table[j] flag = \u0026#34;flag{\u0026#34;+base64.b64encode(plainer) +\u0026#34;}\u0026#34; print flag 运行脚本，得到flag：\nflag{c29yY2VyeQ==} 0x1 汉字的秘密 题目描述：\n你能看出汉字的奥秘吗？ 答案形式：flag{小写字母} 和汉字相关的密码，又是考察古典密码，估计是当铺密码\n下载附件，发现附件是一个doc文件，查看附件内容：\n王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫 看样子是当铺密码，没错了，写个脚本处理一下吧：","keywords":["ctf","writeup"],"articleBody":"GKCTF2020的密码学题目相对而言比较简单，古典密码学题目偏多。而且密码学题目也只有四道题目\n0x0 小学生的密码学 打开题目描述，查看题目描述内容：\ne(x)=11x+6(mod26) 密文：welcylk （flag为base64形式） 看样子是仿射密码，直接逆就好了，写个python脚本解决吧：\nimport gmpy2 import string import base64 m = gmpy2.invert(11,26) table = string.ascii_lowercase # print table cipher = \"welcylk\" plainer = \"\" for i in cipher: x = table.index(i) j = (x-6)*m %26 # print j plainer += table[j] flag = \"flag{\"+base64.b64encode(plainer) +\"}\" print flag 运行脚本，得到flag：\nflag{c29yY2VyeQ==} 0x1 汉字的秘密 题目描述：\n你能看出汉字的奥秘吗？ 答案形式：flag{小写字母} 和汉字相关的密码，又是考察古典密码，估计是当铺密码\n下载附件，发现附件是一个doc文件，查看附件内容：\n王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫 看样子是当铺密码，没错了，写个脚本处理一下吧：\ndh = '田口由中人工大土士王夫井羊壮' ds = '00123455567899' c = '王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫' s = '' for i in c: if i in dh: s += ds[dh.index(i)] else: s += ' ' #print(s) c_list = s.split(\" \") m = '' for i in range(0,len(c_list)): m += chr(int(c_list[i])+i+1) flag = m.lower() print(flag) 运行脚本，得到flag：\nflag{you_are_good} 那什么是当铺密码呢？\n当铺密码是一种很有意思的密码，专门用来加密数字的，不需要密钥，明文信息包含在加密后的密文中。\n它通过一个汉字中隐藏的信息：笔画数，来将汉字和数字关联起来，将汉字定义为明文，将数字定义为密文，加密是将数字映射到对应笔画的汉字，解密是将汉字按照笔画映射回数字。\n有很多汉字的笔画数是相同的，所以可能会有多个明文（汉字）对应同一个密文（数字），当然这个主要是看汉字笔画映射表的选择，如果映射表只准备了9个汉字，每种笔画有一个汉字对应则是一对一的，否则是一对多的。一对一的话有个缺点就是如果要加密的明文中有重复数字，比如33，转换为“飞马”比“三三”更难总结出规律，而这种没有秘钥的加密方式重要的就是隐藏自己的规律，所以一对多会更难被破译。[1]\n当铺密码就是根据汉字的特点来设计的一种古典密码，还是挺有意思的，虽然不是很实用。\n0x2 babycrypto 下载附件，查看附件内容：\n# n:0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L # e:65537 # enc:1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361 # p\u003e\u003e128\u003c\u003c128:0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L RSA题目，考察的应该是p的高位泄露，应该是针对p的高位泄露进行设计的攻击算法来进行求解的。经查询发现，coppersmith算法应该是就是解决p高位泄露问题的解密算法，但是这个算法需要使用的开源数学工具sagemath。这里采用sagemath程序解决：\nn = 0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L p_fake = 0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L pbits = 1024 kbits = 128 pbar = p_fake \u0026 (2^pbits-2^kbits) print(\"upper %d bits (of %d bits) is given\" % (pbits-kbits, pbits)) PR.\u003cx\u003e = PolynomialRing(Zmod(n)) f = x + pbar x0 = f.small_roots(X=2^kbits, beta=0.4)[0] print(hex(int(x0 + pbar))) 使用sagemath运行可以得到p的数值：\n0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3 然后再使用一常规的RSA脚本进行求解：\nimport libnum n = 0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L e = 65537 c = 1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361 p = 0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3 q = n // p phi = (p-1)*(q-1) d = libnum.invmod(e,phi) m = pow(c,d,n) flag = libnum.n2s(m) print flag 运行脚本，得到flag：\nflag{3d0914a1-1e97-4822-a745-c7e20c5179b9} 0x3 Backdoor 查看题目描述：\np=k*M+(65537**a %M) 根据题目描述可以联想到ROCA漏洞，可以从论文中清晰地看到：\n正好符合这个题目的hint，这个题目的考察要点应该就是ROCA的CVE漏洞。这个CVE的利用再GitHub上面有现成的轮子，进行稍微修改一下就可以使用，这里给出解题的sagemath exp：[2]\nparam = { 512: { \"n\": 39, \"a_max\": 62, \"k_max\": 37, \"M\": 0x924cba6ae99dfa084537facc54948df0c23da044d8cabe0edd75bc6, \"M_prime\": 0x1b3e6c9433a7735fa5fc479ffe4027e13bea, \"m\": 5, \"t\": 6, \"c_a\": 0x80000 }, 1024: { \"n\": 71, \"a_max\": 134, \"k_max\": 37, \"M\": 0x7923ba25d1263232812ac930e9683ac0b02180c32bae1d77aa950c4a18a4e660db8cc90384a394940593408f192de1a05e1b61673ac499416088382, \"M_prime\": 0x24683144f41188c2b1d6a217f81f12888e4e6513c43f3f60e72af8bd9728807483425d1e, \"m\": 4, \"t\": 5, \"c_a\": 0x40000000 }, 2048: { \"n\": 126, \"a_max\": 434, \"k_max\": 53, \"M\": 0x7cda79f57f60a9b65478052f383ad7dadb714b4f4ac069997c7ff23d34d075fca08fdf20f95fbc5f0a981d65c3a3ee7ff74d769da52e948d6b0270dd736ef61fa99a54f80fb22091b055885dc22b9f17562778dfb2aeac87f51de339f71731d207c0af3244d35129feba028a48402247f4ba1d2b6d0755baff6, \"M_prime\": 0x16928dc3e47b44daf289a60e80e1fc6bd7648d7ef60d1890f3e0a9455efe0abdb7a748131413cebd2e36a76a355c1b664be462e115ac330f9c13344f8f3d1034a02c23396e6, \"m\": 7, \"t\": 8, \"c_a\": 0x400000000 } } # https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/coppersmith.sage def coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX): \"\"\" Coppersmith revisited by Howgrave-Graham finds a solution if: * b|N, b \u003e= N^beta , 0 \u003c beta \u003c= 1 * |x| \u003c XX \"\"\" # # init # dd = pol.degree() nn = dd * mm + tt # # checks # if not 0 \u003c beta \u003c= 1 : raise ValueError(\"beta should belongs in (0, 1]\") if not pol.is_monic(): raise ArithmeticError(\"Polynomial must be monic.\") # # Coppersmith revisited algo for univariate # # change ring of pol and x polZ = pol.change_ring(ZZ) x = polZ.parent().gen() # compute polynomials gg = [] for ii in range(mm): for jj in range(dd): gg.append((x * XX)**jj * N**(mm - ii) * polZ(x * XX)**ii) for ii in range(tt): gg.append((x * XX)**ii * polZ(x * XX)**mm) # construct lattice B BB = Matrix(ZZ, nn) for ii in range(nn): for jj in range(ii+1): BB[ii, jj] = gg[ii][jj] # LLL BB = BB.LLL(early_red=True, use_siegel=True) # transform shortest vector in polynomial new_pol = 0 for ii in range(nn): new_pol += x**ii * BB[0, ii] / XX**ii # factor polynomial potential_roots = new_pol.roots() return [i[0] for i in potential_roots] # Top level of the attack, feeds the queue for the workers def roca(N): # Key is not always of perfect size, infer from size keylength = int(log(N, 2)) if keylength \u003c 1000 : keylength = 512 elif keylength \u003c 2000 : keylength = 1024 elif keylength \u003c 4000 : keylength = 2048 else: keylength = 4096 # bruteforce M_prime = param[keylength]['M_prime'] c_prime = discrete_log(N, Mod(65537, M_prime)) ord_prime = Zmod(M_prime)(65537).multiplicative_order() top = (c_prime + ord_prime)/2 beta = 0.5 mm = param[keylength]['m'] tt = param[keylength]['t'] XX = int((2*pow(N, beta)) / M_prime) # Bruteforce until p, q are found a_prime = floor(c_prime/2) while a_prime \u003c top: # Construct polynomial m_inv = int(inverse_mod(M_prime, N)) k_tmp = int(pow(65537, a_prime, M_prime)) known_part_pol = int(k_tmp * m_inv) F = PolynomialRing(Zmod(N), implementation='NTL', names=('x',)) (x,) = F._first_ngens(1) pol = x + known_part_pol # Get roots of polynomial using coppersmith roots = coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX) # Check if roots are p, q for root in roots: factor1 = k_tmp + abs(root) * M_prime if mod(N, factor1) == 0: factor2 = N // factor1 return int(factor1), int(factor2) a_prime += 1 from Crypto.Util.number import * from Crypto.PublicKey import RSA import base64 with open('./pub.pem', 'r') as f: key = RSA.import_key(f.read()) e = key.e n = key.n print(n) with open('flag.enc', 'r') as f: c = base64.b64decode(f.read()) N = n print (\"[+] Factoring %i\" % N) factor1, factor2 = roca(N) q = factor1 p = factor2 print (\"[+] Found factors of N:\") print (\"[+] p =\" , factor1) print (\"[+] q =\" , factor2) assert(p * q == n) d = inverse(e, (q - 1) * (p - 1)) c = bytes_to_long(bytes.fromhex(str(c)[2:-1])) print(long_to_bytes(pow(c, d, n))) 使用sagemath运行得到flag：\nflag{760958c9-cca9-458b-9cbe-ea07aa1668e4} 参考： 当铺密码-博客园 GKCTF2020 Crypto Writeup- Chrisyy’s blog ","wordCount":"787","inLanguage":"en","datePublished":"2021-06-26T16:53:12+08:00","dateModified":"2021-06-26T16:53:12+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"jashiker-jajaja.top/posts/gkctf2020-crypto_writeup/"},"publisher":{"@type":"Organization","name":"Jasmine❀Hiker","logo":{"@type":"ImageObject","url":"jashiker-jajaja.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=jashiker-jajaja.top accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=jashiker-jajaja.top/jashiker-jajaja.top/categories/ title=Categories><span>Categories</span></a></li><li><a href=jashiker-jajaja.top/jashiker-jajaja.top/tags/ title=Tags><span>Tags</span></a></li><li><a href=jashiker-jajaja.top/jashiker-jajaja.top/posts/ title=Posts><span>Posts</span></a></li><li><a href=jashiker-jajaja.top/jashiker-jajaja.top/about/ title=About><span>About</span></a></li><li><a href=jashiker-jajaja.top/jashiker-jajaja.top/link/ title=Link><span>Link</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=jashiker-jajaja.top>Home</a>&nbsp;»&nbsp;<a href=jashiker-jajaja.top/posts/>Posts</a></div><h1 class=post-title>GKCTF2020 CRYPTO_writeup</h1><div class=post-meta><span title='2021-06-26 16:53:12 +0800 CST'>June 26, 2021</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;787 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0x0-%e5%b0%8f%e5%ad%a6%e7%94%9f%e7%9a%84%e5%af%86%e7%a0%81%e5%ad%a6 aria-label="0x0 小学生的密码学">0x0 小学生的密码学</a></li><li><a href=#0x1-%e6%b1%89%e5%ad%97%e7%9a%84%e7%a7%98%e5%af%86 aria-label="0x1 汉字的秘密">0x1 汉字的秘密</a></li><li><a href=#0x2-babycrypto aria-label="0x2 babycrypto">0x2 babycrypto</a></li><li><a href=#0x3-backdoor aria-label="0x3 Backdoor">0x3 Backdoor</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考：>参考：</a></li></ul></div></details></div><div class=post-content><p>GKCTF2020的密码学题目相对而言比较简单，古典密码学题目偏多。而且密码学题目也只有四道题目</p><p><img loading=lazy src=/images/GKCTF2020-Crypto_writeup/WechatIMG1350.jpeg alt=img></p><h2 id=0x0-小学生的密码学>0x0 小学生的密码学<a hidden class=anchor aria-hidden=true href=#0x0-小学生的密码学>#</a></h2><p>打开题目描述，查看题目描述内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>e(x)=11x+6(mod26)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>密文：welcylk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>（flag为base64形式）
</span></span></code></pre></div><p>看样子是仿射密码，直接逆就好了，写个python脚本解决吧：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span><span class=mi>26</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span>
</span></span><span class=line><span class=cl><span class=c1># print table</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=s2>&#34;welcylk&#34;</span>
</span></span><span class=line><span class=cl><span class=n>plainer</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>cipher</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>table</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=mi>6</span><span class=p>)</span><span class=o>*</span><span class=n>m</span> <span class=o>%</span><span class=mi>26</span>
</span></span><span class=line><span class=cl><span class=c1>#    print j</span>
</span></span><span class=line><span class=cl>    <span class=n>plainer</span> <span class=o>+=</span> <span class=n>table</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;flag{&#34;</span><span class=o>+</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>plainer</span><span class=p>)</span> <span class=o>+</span><span class=s2>&#34;}&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=n>flag</span>
</span></span></code></pre></div><p>运行脚本，得到flag：</p><pre tabindex=0><code>flag{c29yY2VyeQ==}
</code></pre><h2 id=0x1-汉字的秘密>0x1 汉字的秘密<a hidden class=anchor aria-hidden=true href=#0x1-汉字的秘密>#</a></h2><p>题目描述：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>你能看出汉字的奥秘吗？ 答案形式：flag{小写字母}
</span></span></code></pre></div><p>和汉字相关的密码，又是考察古典密码，估计是当铺密码</p><p>下载附件，发现附件是一个doc文件，查看附件内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由
</span></span><span class=line><span class=cl>土夫 井中 士夫 王工 王人 土由 由口夫
</span></span></code></pre></div><p>看样子是当铺密码，没错了，写个脚本处理一下吧：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>dh</span> <span class=o>=</span> <span class=s1>&#39;田口由中人工大土士王夫井羊壮&#39;</span>
</span></span><span class=line><span class=cl><span class=n>ds</span> <span class=o>=</span> <span class=s1>&#39;00123455567899&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=s1>&#39;王壮 夫工 王中 王夫 由由井 井人 夫中 夫夫 井王 土土 夫由 土夫 井中 士夫 王工 王人 土由 由口夫&#39;</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>c</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>dh</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>+=</span> <span class=n>ds</span><span class=p>[</span><span class=n>dh</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>i</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>+=</span> <span class=s1>&#39; &#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#print(s)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c_list</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>c_list</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>c_list</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>+</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本，得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{you_are_good}
</span></span></code></pre></div><hr><p>那什么是当铺密码呢？</p><p>当铺密码是一种很有意思的密码，专门用来加密数字的，不需要密钥，明文信息包含在加密后的密文中。</p><p>它通过一个汉字中隐藏的信息：笔画数，来将汉字和数字关联起来，将汉字定义为明文，将数字定义为密文，加密是将数字映射到对应笔画的汉字，解密是将汉字按照笔画映射回数字。</p><p>有很多汉字的笔画数是相同的，所以可能会有多个明文（汉字）对应同一个密文（数字），当然这个主要是看汉字笔画映射表的选择，如果映射表只准备了9个汉字，每种笔画有一个汉字对应则是一对一的，否则是一对多的。一对一的话有个缺点就是如果要加密的明文中有重复数字，比如33，转换为“飞马”比“三三”更难总结出规律，而这种没有秘钥的加密方式重要的就是隐藏自己的规律，所以一对多会更难被破译。[1]</p><p>当铺密码就是根据汉字的特点来设计的一种古典密码，还是挺有意思的，虽然不是很实用。</p><h2 id=0x2-babycrypto>0x2 babycrypto<a hidden class=anchor aria-hidden=true href=#0x2-babycrypto>#</a></h2><p>下载附件，查看附件内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># n:0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L
</span></span><span class=line><span class=cl># e:65537
</span></span><span class=line><span class=cl># enc:1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361
</span></span><span class=line><span class=cl># p&gt;&gt;128&lt;&lt;128:0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L
</span></span></code></pre></div><p>RSA题目，考察的应该是p的高位泄露，应该是针对p的高位泄露进行设计的攻击算法来进行求解的。经查询发现，coppersmith算法应该是就是解决p高位泄露问题的解密算法，但是这个算法需要使用的开源数学工具sagemath。这里采用sagemath程序解决：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mh>0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005</span><span class=n>L</span>
</span></span><span class=line><span class=cl><span class=n>p_fake</span> <span class=o>=</span> <span class=mh>0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000</span><span class=n>L</span>
</span></span><span class=line><span class=cl><span class=n>pbits</span> <span class=o>=</span> <span class=mi>1024</span>
</span></span><span class=line><span class=cl><span class=n>kbits</span> <span class=o>=</span> <span class=mi>128</span>
</span></span><span class=line><span class=cl><span class=n>pbar</span> <span class=o>=</span> <span class=n>p_fake</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>2</span><span class=o>^</span><span class=n>pbits</span><span class=o>-</span><span class=mi>2</span><span class=o>^</span><span class=n>kbits</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;upper </span><span class=si>%d</span><span class=s2> bits (of </span><span class=si>%d</span><span class=s2> bits) is given&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>pbits</span><span class=o>-</span><span class=n>kbits</span><span class=p>,</span> <span class=n>pbits</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>PR</span><span class=o>.&lt;</span><span class=n>x</span><span class=o>&gt;</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>pbar</span>
</span></span><span class=line><span class=cl><span class=n>x0</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>small_roots</span><span class=p>(</span><span class=n>X</span><span class=o>=</span><span class=mi>2</span><span class=o>^</span><span class=n>kbits</span><span class=p>,</span> <span class=n>beta</span><span class=o>=</span><span class=mf>0.4</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>x0</span> <span class=o>+</span> <span class=n>pbar</span><span class=p>)))</span>
</span></span></code></pre></div><p>使用sagemath运行可以得到p的数值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3
</span></span></code></pre></div><p>然后再使用一常规的RSA脚本进行求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>libnum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mh>0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005</span><span class=n>L</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=mi>1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mh>0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>libnum</span><span class=o>.</span><span class=n>invmod</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>libnum</span><span class=o>.</span><span class=n>n2s</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=n>flag</span>
</span></span></code></pre></div><p>运行脚本，得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{3d0914a1-1e97-4822-a745-c7e20c5179b9}
</span></span></code></pre></div><h2 id=0x3-backdoor>0x3 Backdoor<a hidden class=anchor aria-hidden=true href=#0x3-backdoor>#</a></h2><p>查看题目描述：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>p=k*M+(65537**a %M)
</span></span></code></pre></div><p>根据题目描述可以联想到ROCA漏洞，可以从论文中清晰地看到：</p><p><a href=/images/GKCTF2020-Crypto_writeup/image-12.png><img loading=lazy src=/images/GKCTF2020-Crypto_writeup/image-12.png alt=img></a></p><p>正好符合这个题目的hint，这个题目的考察要点应该就是<a href=https://crocs.fi.muni.cz/public/papers/rsa_ccs17>ROCA的CVE漏洞</a>。这个CVE的利用再GitHub上面有现成的轮子，进行稍微修改一下就可以使用，这里给出解题的sagemath exp：[2]</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>param</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=mi>512</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;n&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a_max&#34;</span><span class=p>:</span> <span class=mi>62</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;k_max&#34;</span><span class=p>:</span> <span class=mi>37</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;M&#34;</span><span class=p>:</span> <span class=mh>0x924cba6ae99dfa084537facc54948df0c23da044d8cabe0edd75bc6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;M_prime&#34;</span><span class=p>:</span> <span class=mh>0x1b3e6c9433a7735fa5fc479ffe4027e13bea</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;m&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;c_a&#34;</span><span class=p>:</span> <span class=mh>0x80000</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=mi>1024</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;n&#34;</span><span class=p>:</span> <span class=mi>71</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a_max&#34;</span><span class=p>:</span> <span class=mi>134</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;k_max&#34;</span><span class=p>:</span> <span class=mi>37</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;M&#34;</span><span class=p>:</span> <span class=mh>0x7923ba25d1263232812ac930e9683ac0b02180c32bae1d77aa950c4a18a4e660db8cc90384a394940593408f192de1a05e1b61673ac499416088382</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;M_prime&#34;</span><span class=p>:</span> <span class=mh>0x24683144f41188c2b1d6a217f81f12888e4e6513c43f3f60e72af8bd9728807483425d1e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;m&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;c_a&#34;</span><span class=p>:</span> <span class=mh>0x40000000</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=mi>2048</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;n&#34;</span><span class=p>:</span> <span class=mi>126</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a_max&#34;</span><span class=p>:</span> <span class=mi>434</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;k_max&#34;</span><span class=p>:</span> <span class=mi>53</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;M&#34;</span><span class=p>:</span> <span class=mh>0x7cda79f57f60a9b65478052f383ad7dadb714b4f4ac069997c7ff23d34d075fca08fdf20f95fbc5f0a981d65c3a3ee7ff74d769da52e948d6b0270dd736ef61fa99a54f80fb22091b055885dc22b9f17562778dfb2aeac87f51de339f71731d207c0af3244d35129feba028a48402247f4ba1d2b6d0755baff6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;M_prime&#34;</span><span class=p>:</span> <span class=mh>0x16928dc3e47b44daf289a60e80e1fc6bd7648d7ef60d1890f3e0a9455efe0abdb7a748131413cebd2e36a76a355c1b664be462e115ac330f9c13344f8f3d1034a02c23396e6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;m&#34;</span><span class=p>:</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;c_a&#34;</span><span class=p>:</span> <span class=mh>0x400000000</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/coppersmith.sage</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>coppersmith_howgrave_univariate</span><span class=p>(</span><span class=n>pol</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>beta</span><span class=p>,</span> <span class=n>mm</span><span class=p>,</span> <span class=n>tt</span><span class=p>,</span> <span class=n>XX</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Coppersmith revisited by Howgrave-Graham
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    finds a solution if:
</span></span></span><span class=line><span class=cl><span class=s2>    * b|N, b &gt;= N^beta , 0 &lt; beta &lt;= 1
</span></span></span><span class=line><span class=cl><span class=s2>    * |x| &lt; XX
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=c1># init</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=n>dd</span> <span class=o>=</span> <span class=n>pol</span><span class=o>.</span><span class=n>degree</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>nn</span> <span class=o>=</span> <span class=n>dd</span> <span class=o>*</span> <span class=n>mm</span> <span class=o>+</span> <span class=n>tt</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=c1># checks</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>beta</span> <span class=o>&lt;=</span> <span class=mi>1</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;beta should belongs in (0, 1]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>pol</span><span class=o>.</span><span class=n>is_monic</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ArithmeticError</span><span class=p>(</span><span class=s2>&#34;Polynomial must be monic.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=c1># Coppersmith revisited algo for univariate</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># change ring of pol and x</span>
</span></span><span class=line><span class=cl>    <span class=n>polZ</span> <span class=o>=</span> <span class=n>pol</span><span class=o>.</span><span class=n>change_ring</span><span class=p>(</span><span class=n>ZZ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>polZ</span><span class=o>.</span><span class=n>parent</span><span class=p>()</span><span class=o>.</span><span class=n>gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># compute polynomials</span>
</span></span><span class=line><span class=cl>    <span class=n>gg</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ii</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>mm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>jj</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>gg</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span> <span class=o>*</span> <span class=n>XX</span><span class=p>)</span><span class=o>**</span><span class=n>jj</span> <span class=o>*</span> <span class=n>N</span><span class=o>**</span><span class=p>(</span><span class=n>mm</span> <span class=o>-</span> <span class=n>ii</span><span class=p>)</span> <span class=o>*</span> <span class=n>polZ</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>XX</span><span class=p>)</span><span class=o>**</span><span class=n>ii</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ii</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>tt</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>gg</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span> <span class=o>*</span> <span class=n>XX</span><span class=p>)</span><span class=o>**</span><span class=n>ii</span> <span class=o>*</span> <span class=n>polZ</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>XX</span><span class=p>)</span><span class=o>**</span><span class=n>mm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># construct lattice B</span>
</span></span><span class=line><span class=cl>    <span class=n>BB</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>ZZ</span><span class=p>,</span> <span class=n>nn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ii</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>jj</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ii</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>BB</span><span class=p>[</span><span class=n>ii</span><span class=p>,</span> <span class=n>jj</span><span class=p>]</span> <span class=o>=</span> <span class=n>gg</span><span class=p>[</span><span class=n>ii</span><span class=p>][</span><span class=n>jj</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># LLL</span>
</span></span><span class=line><span class=cl>    <span class=n>BB</span> <span class=o>=</span> <span class=n>BB</span><span class=o>.</span><span class=n>LLL</span><span class=p>(</span><span class=n>early_red</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_siegel</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># transform shortest vector in polynomial    </span>
</span></span><span class=line><span class=cl>    <span class=n>new_pol</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ii</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>new_pol</span> <span class=o>+=</span> <span class=n>x</span><span class=o>**</span><span class=n>ii</span> <span class=o>*</span> <span class=n>BB</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>ii</span><span class=p>]</span> <span class=o>/</span> <span class=n>XX</span><span class=o>**</span><span class=n>ii</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># factor polynomial</span>
</span></span><span class=line><span class=cl>    <span class=n>potential_roots</span> <span class=o>=</span> <span class=n>new_pol</span><span class=o>.</span><span class=n>roots</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>i</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>potential_roots</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Top level of the attack, feeds the queue for the workers</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>roca</span><span class=p>(</span><span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1># Key is not always of perfect size, infer from size</span>
</span></span><span class=line><span class=cl>  <span class=n>keylength</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>log</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=n>keylength</span> <span class=o>&lt;</span> <span class=mi>1000</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keylength</span> <span class=o>=</span> <span class=mi>512</span>
</span></span><span class=line><span class=cl>  <span class=k>elif</span>  <span class=n>keylength</span> <span class=o>&lt;</span> <span class=mi>2000</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keylength</span> <span class=o>=</span> <span class=mi>1024</span> 
</span></span><span class=line><span class=cl>  <span class=k>elif</span> <span class=n>keylength</span> <span class=o>&lt;</span> <span class=mi>4000</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keylength</span> <span class=o>=</span> <span class=mi>2048</span> 
</span></span><span class=line><span class=cl>  <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>keylength</span> <span class=o>=</span> <span class=mi>4096</span> 
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1># bruteforce</span>
</span></span><span class=line><span class=cl>  <span class=n>M_prime</span> <span class=o>=</span> <span class=n>param</span><span class=p>[</span><span class=n>keylength</span><span class=p>][</span><span class=s1>&#39;M_prime&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>c_prime</span> <span class=o>=</span> <span class=n>discrete_log</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=n>Mod</span><span class=p>(</span><span class=mi>65537</span><span class=p>,</span> <span class=n>M_prime</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>ord_prime</span> <span class=o>=</span> <span class=n>Zmod</span><span class=p>(</span><span class=n>M_prime</span><span class=p>)(</span><span class=mi>65537</span><span class=p>)</span><span class=o>.</span><span class=n>multiplicative_order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>top</span> <span class=o>=</span> <span class=p>(</span><span class=n>c_prime</span> <span class=o>+</span> <span class=n>ord_prime</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=n>beta</span> <span class=o>=</span> <span class=mf>0.5</span> 
</span></span><span class=line><span class=cl>  <span class=n>mm</span> <span class=o>=</span> <span class=n>param</span><span class=p>[</span><span class=n>keylength</span><span class=p>][</span><span class=s1>&#39;m&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>tt</span> <span class=o>=</span> <span class=n>param</span><span class=p>[</span><span class=n>keylength</span><span class=p>][</span><span class=s1>&#39;t&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>XX</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=mi>2</span><span class=o>*</span><span class=nb>pow</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=n>beta</span><span class=p>))</span> <span class=o>/</span> <span class=n>M_prime</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Bruteforce until p, q are found</span>
</span></span><span class=line><span class=cl>  <span class=n>a_prime</span> <span class=o>=</span> <span class=n>floor</span><span class=p>(</span><span class=n>c_prime</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=n>a_prime</span> <span class=o>&lt;</span> <span class=n>top</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1># Construct polynomial</span>
</span></span><span class=line><span class=cl>      <span class=n>m_inv</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>inverse_mod</span><span class=p>(</span><span class=n>M_prime</span><span class=p>,</span> <span class=n>N</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=n>k_tmp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=mi>65537</span><span class=p>,</span> <span class=n>a_prime</span><span class=p>,</span> <span class=n>M_prime</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=n>known_part_pol</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>k_tmp</span> <span class=o>*</span> <span class=n>m_inv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>F</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>N</span><span class=p>),</span> <span class=n>implementation</span><span class=o>=</span><span class=s1>&#39;NTL&#39;</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;x&#39;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=n>x</span><span class=p>,)</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>_first_ngens</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>pol</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>known_part_pol</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1># Get roots of polynomial using coppersmith</span>
</span></span><span class=line><span class=cl>      <span class=n>roots</span> <span class=o>=</span> <span class=n>coppersmith_howgrave_univariate</span><span class=p>(</span><span class=n>pol</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>beta</span><span class=p>,</span> <span class=n>mm</span><span class=p>,</span> <span class=n>tt</span><span class=p>,</span> <span class=n>XX</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>      <span class=c1># Check if roots are p, q</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=n>root</span> <span class=ow>in</span> <span class=n>roots</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>factor1</span> <span class=o>=</span> <span class=n>k_tmp</span> <span class=o>+</span> <span class=nb>abs</span><span class=p>(</span><span class=n>root</span><span class=p>)</span> <span class=o>*</span> <span class=n>M_prime</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mod</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=n>factor1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>factor2</span> <span class=o>=</span> <span class=n>N</span> <span class=o>//</span> <span class=n>factor1</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>factor1</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>factor2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>a_prime</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./pub.pem&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>import_key</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=n>e</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;flag.enc&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=n>n</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;[+] Factoring </span><span class=si>%i</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>factor1</span><span class=p>,</span> <span class=n>factor2</span> <span class=o>=</span> <span class=n>roca</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>factor1</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>factor2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;[+] Found factors of N:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;[+] p =&#34;</span> <span class=p>,</span> <span class=n>factor1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;[+] q =&#34;</span> <span class=p>,</span> <span class=n>factor2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>assert</span><span class=p>(</span><span class=n>p</span> <span class=o>*</span> <span class=n>q</span> <span class=o>==</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>c</span><span class=p>)[</span><span class=mi>2</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)))</span>
</span></span></code></pre></div><p>使用sagemath运行得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{760958c9-cca9-458b-9cbe-ea07aa1668e4}
</span></span></code></pre></div><h2 id=参考>参考：<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ol><li><a href="https://www.cnblogs.com/cc11001100/p/9357263.html#:~:text=%E5%BD%93%E9%93%BA%E5%AF%86%E7%A0%81%E6%98%AF%E4%B8%80%E7%A7%8D%E5%BE%88,%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84%E5%AF%86%E6%96%87%E4%B8%AD%E3%80%82">当铺密码-博客园</a></li><li><a href=https://blog.chrisyy.top/2020/05/24/gkctf/>GKCTF2020 Crypto Writeup- Chrisyy&rsquo;s blog</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=jashiker-jajaja.top/tags/ctf/>ctf</a></li><li><a href=jashiker-jajaja.top/tags/writeup/>writeup</a></li></ul><nav class=paginav><a class=prev href=jashiker-jajaja.top/posts/bjdctf-2nd-crypto_writeup/><span class=title>« Prev</span><br><span>BJDCTF 2nd CRYPTO_writeup</span></a>
<a class=next href=jashiker-jajaja.top/posts/buuctf-crypto-3_writeup/><span class=title>Next »</span><br><span>BUUCTF CRYPTO (3) writeup</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=jashiker-jajaja.top>Jasmine❀Hiker</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script><script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>