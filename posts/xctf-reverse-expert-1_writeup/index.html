<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>XCTF REVERSE Expert (1) Writeup | Jasmine❀Hiker</title><meta name=keywords content="ctf,writeup,reverse"><meta name=description content="XCTF-REVERSE-高手区-1 writeup 有段时间没有刷题了，刷刷题找找手感
0x0 answer_to_everything 使用DIE查看程序信息
程序没有壳，而且是64位。然后看看文件长什么样，静态分析的时刻来临：
发现关键函数，跟进这个函数
__int64 __fastcall not_the_flag(int a1) { if ( a1 == 42 ) puts(&#34;Cipher from Bill \nSubmit without any tags\n#kdudpeh&#34;); else puts(&#34;YOUSUCK&#34;); return 0LL; } 根据题目要求，应该是要对一个字段进行sha1加密，仔细观察逆向程序，发现应该是对kdudpeh进行sha1加密
使用python进行sha1加密得：
80ee2a3fe31da904c596d993f7f1de4827c1450a 故本题flag为
flag{80ee2a3fe31da904c596d993f7f1de4827c1450a} 0x1 elrond32 使用DIE查询一下文件信息
32位的exec文件，使用IDA pro打开
定位到main函数的位置
int __cdecl main(int a1, char **a2) { if ( a1 > 1 && sub_8048414(a2[1], 0) ) { puts(&#34;Access granted&#34;); sub_8048538(a2[1]); } else { puts(&#34;Access denied&#34;); } return 0; } 关键函数应该是在sub_8048538(a2[1])函数里面"><meta name=author content="Me"><link rel=canonical href=https://oolongcode.github.io/posts/xctf-reverse-expert-1_writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://oolongcode.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://oolongcode.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://oolongcode.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://oolongcode.github.io/apple-touch-icon.png><link rel=mask-icon href=https://oolongcode.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="XCTF REVERSE Expert (1) Writeup"><meta property="og:description" content="XCTF-REVERSE-高手区-1 writeup 有段时间没有刷题了，刷刷题找找手感
0x0 answer_to_everything 使用DIE查看程序信息
程序没有壳，而且是64位。然后看看文件长什么样，静态分析的时刻来临：
发现关键函数，跟进这个函数
__int64 __fastcall not_the_flag(int a1) { if ( a1 == 42 ) puts(&#34;Cipher from Bill \nSubmit without any tags\n#kdudpeh&#34;); else puts(&#34;YOUSUCK&#34;); return 0LL; } 根据题目要求，应该是要对一个字段进行sha1加密，仔细观察逆向程序，发现应该是对kdudpeh进行sha1加密
使用python进行sha1加密得：
80ee2a3fe31da904c596d993f7f1de4827c1450a 故本题flag为
flag{80ee2a3fe31da904c596d993f7f1de4827c1450a} 0x1 elrond32 使用DIE查询一下文件信息
32位的exec文件，使用IDA pro打开
定位到main函数的位置
int __cdecl main(int a1, char **a2) { if ( a1 > 1 && sub_8048414(a2[1], 0) ) { puts(&#34;Access granted&#34;); sub_8048538(a2[1]); } else { puts(&#34;Access denied&#34;); } return 0; } 关键函数应该是在sub_8048538(a2[1])函数里面"><meta property="og:type" content="article"><meta property="og:url" content="https://oolongcode.github.io/posts/xctf-reverse-expert-1_writeup/"><meta property="og:image" content="https://oolongcode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-28T19:33:49+08:00"><meta property="article:modified_time" content="2022-01-28T19:33:49+08:00"><meta property="og:site_name" content="Jasmine❀Hiker"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://oolongcode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="XCTF REVERSE Expert (1) Writeup"><meta name=twitter:description content="XCTF-REVERSE-高手区-1 writeup 有段时间没有刷题了，刷刷题找找手感
0x0 answer_to_everything 使用DIE查看程序信息
程序没有壳，而且是64位。然后看看文件长什么样，静态分析的时刻来临：
发现关键函数，跟进这个函数
__int64 __fastcall not_the_flag(int a1) { if ( a1 == 42 ) puts(&#34;Cipher from Bill \nSubmit without any tags\n#kdudpeh&#34;); else puts(&#34;YOUSUCK&#34;); return 0LL; } 根据题目要求，应该是要对一个字段进行sha1加密，仔细观察逆向程序，发现应该是对kdudpeh进行sha1加密
使用python进行sha1加密得：
80ee2a3fe31da904c596d993f7f1de4827c1450a 故本题flag为
flag{80ee2a3fe31da904c596d993f7f1de4827c1450a} 0x1 elrond32 使用DIE查询一下文件信息
32位的exec文件，使用IDA pro打开
定位到main函数的位置
int __cdecl main(int a1, char **a2) { if ( a1 > 1 && sub_8048414(a2[1], 0) ) { puts(&#34;Access granted&#34;); sub_8048538(a2[1]); } else { puts(&#34;Access denied&#34;); } return 0; } 关键函数应该是在sub_8048538(a2[1])函数里面"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://oolongcode.github.io/posts/"},{"@type":"ListItem","position":3,"name":"XCTF REVERSE Expert (1) Writeup","item":"https://oolongcode.github.io/posts/xctf-reverse-expert-1_writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"XCTF REVERSE Expert (1) Writeup","name":"XCTF REVERSE Expert (1) Writeup","description":"XCTF-REVERSE-高手区-1 writeup 有段时间没有刷题了，刷刷题找找手感\n0x0 answer_to_everything 使用DIE查看程序信息\n程序没有壳，而且是64位。然后看看文件长什么样，静态分析的时刻来临：\n发现关键函数，跟进这个函数\n__int64 __fastcall not_the_flag(int a1) { if ( a1 == 42 ) puts(\u0026#34;Cipher from Bill \\nSubmit without any tags\\n#kdudpeh\u0026#34;); else puts(\u0026#34;YOUSUCK\u0026#34;); return 0LL; } 根据题目要求，应该是要对一个字段进行sha1加密，仔细观察逆向程序，发现应该是对kdudpeh进行sha1加密\n使用python进行sha1加密得：\n80ee2a3fe31da904c596d993f7f1de4827c1450a 故本题flag为\nflag{80ee2a3fe31da904c596d993f7f1de4827c1450a} 0x1 elrond32 使用DIE查询一下文件信息\n32位的exec文件，使用IDA pro打开\n定位到main函数的位置\nint __cdecl main(int a1, char **a2) { if ( a1 \u0026gt; 1 \u0026amp;\u0026amp; sub_8048414(a2[1], 0) ) { puts(\u0026#34;Access granted\u0026#34;); sub_8048538(a2[1]); } else { puts(\u0026#34;Access denied\u0026#34;); } return 0; } 关键函数应该是在sub_8048538(a2[1])函数里面","keywords":["ctf","writeup","reverse"],"articleBody":"XCTF-REVERSE-高手区-1 writeup 有段时间没有刷题了，刷刷题找找手感\n0x0 answer_to_everything 使用DIE查看程序信息\n程序没有壳，而且是64位。然后看看文件长什么样，静态分析的时刻来临：\n发现关键函数，跟进这个函数\n__int64 __fastcall not_the_flag(int a1) { if ( a1 == 42 ) puts(\"Cipher from Bill \\nSubmit without any tags\\n#kdudpeh\"); else puts(\"YOUSUCK\"); return 0LL; } 根据题目要求，应该是要对一个字段进行sha1加密，仔细观察逆向程序，发现应该是对kdudpeh进行sha1加密\n使用python进行sha1加密得：\n80ee2a3fe31da904c596d993f7f1de4827c1450a 故本题flag为\nflag{80ee2a3fe31da904c596d993f7f1de4827c1450a} 0x1 elrond32 使用DIE查询一下文件信息\n32位的exec文件，使用IDA pro打开\n定位到main函数的位置\nint __cdecl main(int a1, char **a2) { if ( a1 \u003e 1 \u0026\u0026 sub_8048414(a2[1], 0) ) { puts(\"Access granted\"); sub_8048538(a2[1]); } else { puts(\"Access denied\"); } return 0; } 关键函数应该是在sub_8048538(a2[1])函数里面\n跟进到sub_8048538(a2[1])函数\nint __cdecl sub_8048538(int a1) { int v2[33]; // [esp+18h] [ebp-A0h] BYREF int i; // [esp+9Ch] [ebp-1Ch] qmemcpy(v2, \u0026unk_8048760, sizeof(v2)); for ( i = 0; i \u003c= 32; ++i ) putchar(v2[i] ^ *(char *)(a1 + i % 8)); return putchar(10); } 发现和参数a2有关联，需要寻找a2的相关线索\n发现if判断那个位置的函数有对a2数据进行处理，跟进那个函数：\nint __cdecl sub_8048414(_BYTE *a1, int a2) { int result; // eax switch ( a2 ) { case 0: if ( *a1 == 105 ) goto LABEL_19; result = 0; break; case 1: if ( *a1 == 101 ) goto LABEL_19; result = 0; break; case 3: if ( *a1 == 110 ) goto LABEL_19; result = 0; break; case 4: if ( *a1 == 100 ) goto LABEL_19; result = 0; break; case 5: if ( *a1 == 97 ) goto LABEL_19; result = 0; break; case 6: if ( *a1 == 103 ) goto LABEL_19; result = 0; break; case 7: if ( *a1 == 115 ) goto LABEL_19; result = 0; break; case 9: if ( *a1 == 114 ) LABEL_19: result = sub_8048414(a1 + 1, 7 * (a2 + 1) % 11); else result = 0; break; default: result = 1; break; } return result; } 对于a2进行递归变化，结合对于a2处理的函数，可以编写个小程序来生成flag\n#include int main() { int v2[] { 0x0F, 0x1F, 0x04, 0x09, 0x1C, 0x12, 0x42, 0x09, 0x0C, 0x44, 0x0D, 0x07, 0x09, 0x06, 0x2D, 0x37, 0x59, 0x1E, 0x00, 0x59, 0x0F, 0x08, 0x1C, 0x23, 0x36, 0x07, 0x55, 0x02, 0x0C, 0x08, 0x41, 0x0A, 0x14 }; int key[] { 105,115,101,110,103,97,114,100 }; for(int i = 0;i\u003c33;i++) { putchar(v2[i]^key[i%8]); } return 0; } 编译并运行，就能得到flag\nflag{s0me7hing_S0me7hinG_t0lki3n} 0x2 666 使用DIE查询一下程序信息：\n64位程序，使用GCC进行编译的无壳程序\n使用IDA x64 pro 对程序进行静态分析：\nint __cdecl main(int argc, const char **argv, const char **envp) { char s[240]; // [rsp+0h] [rbp-1E0h] BYREF char v5[240]; // [rsp+F0h] [rbp-F0h] BYREF memset(s, 0, 30uLL); printf(\"Please Input Key: \"); __isoc99_scanf(\"%s\", v5); encode(v5, (__int64)s); if ( strlen(v5) == key ) { if ( !strcmp(s, enflag) ) puts(\"You are Right\"); else puts(\"flag{This_1s_f4cker_flag}\"); } return 0; } 关键函数应该是在encode里面，这个程序的基本逻辑就是将输入进行encode函数处理，然后与指定的字符串进行比对来进行验证。\n而输入的字符串就是flag数据。\n因此，这道题目也就可以非常简单进行处理，也就是对encode函数进行逆向处理就可\n首先，还是查看一下encode的内部实现情况：\nint __fastcall encode(const char *a1, __int64 a2) { char v3[104]; // [rsp+10h] [rbp-70h] int v4; // [rsp+78h] [rbp-8h] int i; // [rsp+7Ch] [rbp-4h] i = 0; v4 = 0; if ( strlen(a1) != key ) return puts(\"Your Length is Wrong\"); for ( i = 0; i \u003c key; i += 3 ) { v3[i + 64] = key ^ (a1[i] + 6); v3[i + 33] = (a1[i + 1] - 6) ^ key; v3[i + 2] = a1[i + 2] ^ 6 ^ key; *(_BYTE *)(a2 + i) = v3[i + 64]; *(_BYTE *)(a2 + i + 1LL) = v3[i + 33]; *(_BYTE *)(a2 + i + 2LL) = v3[i + 2]; } return a2; } 进行跟踪发现key = 18\n可以得知我们输入的内容长度为18\n根据编码函数编写一个解密器进行程序破解\n#include int main() { int enflag[] = { 0x69, 0x7A, 0x77, 0x68, 0x72, 0x6F, 0x7A, 0x22, 0x22, 0x77, 0x22, 0x76, 0x2E, 0x4B, 0x22, 0x2E, 0x4E, 0x69, 0x00 }; int key = 0x12; int i = 0; for(i;i\u003ckey;i+=3) { putchar((key^enflag[i])-6); putchar((enflag[i+1]^key)+6); putchar((enflag[i+2]^key^6)); } return 0; } 编译并运行程序就能拿到flag：\nunctf{b66_6b6_66b} 0x3 IgniteMe 首先是使用DIE进行程序信息的查看：\n32位的PE程序，PE程序可以使用的工具就有很多了，首先还是静态分析：\nint __cdecl main(int argc, const char **argv, const char **envp) { int result; // eax size_t i; // [esp+4Ch] [ebp-8Ch] char v5[8]; // [esp+50h] [ebp-88h] BYREF char Str[128]; // [esp+58h] [ebp-80h] BYREF sub_402B30(\u0026unk_446360, \"Give me your flag:\"); sub_4013F0(sub_403670); sub_401440(Str, 127); if ( strlen(Str) \u003c 0x1E \u0026\u0026 strlen(Str) \u003e 4 ) { strcpy(v5, \"EIS{\"); for ( i = 0; i \u003c strlen(v5); ++i ) { if ( Str[i] != v5[i] ) goto LABEL_7; } if ( Str[28] != 125 ) { LABEL_7: sub_402B30(\u0026unk_446360, \"Sorry, keep trying! \"); sub_4013F0(sub_403670); return 0; } if ( (unsigned __int8)sub_4011C0(Str) ) sub_402B30(\u0026unk_446360, \"Congratulations! \"); else sub_402B30(\u0026unk_446360, \"Sorry, keep trying! \"); sub_4013F0(sub_403670); result = 0; } else { sub_402B30(\u0026unk_446360, \"Sorry, keep trying!\"); sub_4013F0(sub_403670); result = 0; } return result; } 找到关键加密的位置进行分析\n即对函数sub_4011c0(str)进行分析\nbool __cdecl sub_4011C0(char *Str) { size_t v2; // eax int v3; // [esp+50h] [ebp-B0h] char Str2[32]; // [esp+54h] [ebp-ACh] BYREF int v5; // [esp+74h] [ebp-8Ch] int v6; // [esp+78h] [ebp-88h] size_t i; // [esp+7Ch] [ebp-84h] char v8[128]; // [esp+80h] [ebp-80h] BYREF if ( strlen(Str) \u003c= 4 ) return 0; i = 4; v6 = 0; while ( i \u003c strlen(Str) - 1 ) v8[v6++] = Str[i++]; v8[v6] = 0; v5 = 0; v3 = 0; memset(Str2, 0, sizeof(Str2)); for ( i = 0; ; ++i ) { v2 = strlen(v8); if ( i \u003e= v2 ) break; if ( v8[i] \u003e= 97 \u0026\u0026 v8[i] \u003c= 122 ) { v8[i] -= 32; v3 = 1; } if ( !v3 \u0026\u0026 v8[i] \u003e= 65 \u0026\u0026 v8[i] \u003c= 90 ) v8[i] += 32; Str2[i] = byte_4420B0[i] ^ sub_4013C0(v8[i]); v3 = 0; } return strcmp(\"GONDPHyGjPEKruv{{pj]X@rF\", Str2) == 0; } 直接就是一个加密算法，直接进行手撸一个解密算法即可：\n#include #include int main() { char flag[128]{ 0 }; char s[]{ 0x0D, 0x13, 0x17, 0x11, 0x02, 0x01, 0x20, 0x1D, 0x0C, 0x02, 0x19, 0x2F, 0x17, 0x2B, 0x24, 0x1F, 0x1E, 0x16, 0x09, 0x0F, 0x15, 0x27, 0x13, 0x26, 0x0A, 0x2F, 0x1E, 0x1A, 0x2D, 0x0C, 0x22, 0x04 }; char Str[]{ \"GONDPHyGjPEKruv{{pj]X@rF\" }; for(int i{ 0 };i\u003cstrlen(Str);i++) { flag[i] = ((Str[i]^s[i])-72)^0x55; if(flag[i] \u003e= 'a' \u0026\u0026 flag[i] \u003c= 'z') { flag[i] -= 32; } else if(flag[i] \u003e= 'A' \u0026\u0026 flag[i] \u003c= 'Z') { flag[i] += 32; } } std::cout \u003c\u003c \"EIS{\" \u003c\u003c flag \u003c\u003c \"}\" \u003c\u003c std::endl; return 0; } 编译并运行，就可以得到flag\nEIS{wadx_tdgk_aihc_ihkn_pjlm} 0x4 debug 使用DIE进行正常的程序信息查询：\n.Net编译的程序，看样子不太友好。面对从未见到过的程序，该怎么做呢？这种情况下，就要使用强大的搜索引擎来寻找答案，经过搜索引擎的帮助，我这边找到了一个工具可以进行.Net程序的逆向——dnSpy\n使用dnSpy来进行.Net程序的开心逆向吧！\ndnSpy程序载入页面，dnSpy是一个非常好用的.Net程序和C#程序逆向工具，而且dnSpy的操作方式与Visual Studio非常相似，可以根据Visual Studio的操作模式进行debug。\n首先，需要寻找到关键函数和关键代码位置\n经过一番寻找，发现在02000003的位置有存在关键代码，根据关键代码跟进关键函数发现：\nflag就存在在这里，使用断点断在入口函数这里来进行调试，得到：\n得到flag：\nflag{967DDDFBCD32C1F53527C221D9E40A0B} 0x5 Guess-the-Number 题目直接给了一个jar程序文件，应该是一个java逆向题目，java逆向和Android逆向类似，故可以使用相似的工具进行反编译：\npackage defpackage; import java.math.BigInteger; /* renamed from: guess reason: default package */ public class guess { static String XOR(String _str_one, String _str_two) { return new BigInteger(_str_one, 16).xor(new BigInteger(_str_two, 16)).toString(16); } public static void main(String[] args) { if (args.length \u003e 0) { try { if (309137378 == Integer.parseInt(args[0])) { int my_num = 349763335 + 345736730; System.out.println(\"your flag is: \" + XOR(\"4b64ca12ace755516c178f72d05d7061\", \"ecd44646cfe5994ebeb35bf922e25dba\")); return; } System.err.println(\"wrong guess!\"); System.exit(1); } catch (NumberFormatException e) { System.err.println(\"please enter an integer \\nexample: java -jar guess 12\"); System.exit(1); } } else { System.err.println(\"wrong guess!\"); int num = 1000000 + 1; System.exit(1); } } } 可以直接拖到idea进行参数调试来得到flag:cat:（偷懒小技巧）\n成功得到flag：\na7b08c546302cc1fd2a4d48bf2bf2ddb ","wordCount":"1049","inLanguage":"en","datePublished":"2022-01-28T19:33:49+08:00","dateModified":"2022-01-28T19:33:49+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://oolongcode.github.io/posts/xctf-reverse-expert-1_writeup/"},"publisher":{"@type":"Organization","name":"Jasmine❀Hiker","logo":{"@type":"ImageObject","url":"https://oolongcode.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://oolongcode.github.io accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://oolongcode.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://oolongcode.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://oolongcode.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://oolongcode.github.io/about/ title=About><span>About</span></a></li><li><a href=https://oolongcode.github.io/link/ title=Link><span>Link</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://oolongcode.github.io>Home</a>&nbsp;»&nbsp;<a href=https://oolongcode.github.io/posts/>Posts</a></div><h1 class=post-title>XCTF REVERSE Expert (1) Writeup</h1><div class=post-meta><span title='2022-01-28 19:33:49 +0800 CST'>January 28, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1049 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#xctf-reverse-%e9%ab%98%e6%89%8b%e5%8c%ba-1-writeup aria-label="XCTF-REVERSE-高手区-1 writeup">XCTF-REVERSE-高手区-1 writeup</a><ul><li><a href=#0x0-answer_to_everything aria-label="0x0 answer_to_everything">0x0 answer_to_everything</a></li><li><a href=#0x1-elrond32 aria-label="0x1 elrond32">0x1 elrond32</a></li><li><a href=#0x2-666 aria-label="0x2 666">0x2 666</a></li><li><a href=#0x3-igniteme aria-label="0x3 IgniteMe">0x3 IgniteMe</a></li><li><a href=#0x4-debug aria-label="0x4 debug">0x4 debug</a></li><li><a href=#0x5-guess-the-number aria-label="0x5 Guess-the-Number">0x5 Guess-the-Number</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=xctf-reverse-高手区-1-writeup>XCTF-REVERSE-高手区-1 writeup<a hidden class=anchor aria-hidden=true href=#xctf-reverse-高手区-1-writeup>#</a></h1><p>有段时间没有刷题了，刷刷题找找手感</p><h2 id=0x0-answer_to_everything>0x0 answer_to_everything<a hidden class=anchor aria-hidden=true href=#0x0-answer_to_everything>#</a></h2><p>使用DIE查看程序信息</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211031104627471.png alt=image-20211031104627471></p><p>程序没有壳，而且是64位。然后看看文件长什么样，静态分析的时刻来临：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211031104740182.png alt=image-20211031104740182></p><p>发现关键函数，跟进这个函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>not_the_flag</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a1</span> <span class=o>==</span> <span class=mi>42</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Cipher from Bill </span><span class=se>\n</span><span class=s>Submit without any tags</span><span class=se>\n</span><span class=s>#kdudpeh&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;YOUSUCK&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>根据题目要求，应该是要对一个字段进行sha1加密，仔细观察逆向程序，发现应该是对<code>kdudpeh</code>进行sha1加密</p><p>使用python进行sha1加密得：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>80ee2a3fe31da904c596d993f7f1de4827c1450a
</span></span></code></pre></div><p>故本题flag为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{80ee2a3fe31da904c596d993f7f1de4827c1450a}
</span></span></code></pre></div><h2 id=0x1-elrond32>0x1 elrond32<a hidden class=anchor aria-hidden=true href=#0x1-elrond32>#</a></h2><p>使用DIE查询一下文件信息</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211031105318823.png alt=image-20211031105318823></p><p>32位的exec文件，使用IDA pro打开</p><p>定位到main函数的位置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a1</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=nf>sub_8048414</span><span class=p>(</span><span class=n>a2</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>0</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Access granted&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_8048538</span><span class=p>(</span><span class=n>a2</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Access denied&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>关键函数应该是在<code>sub_8048538(a2[1])</code>函数里面</p><p>跟进到<code>sub_8048538(a2[1])</code>函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_8048538</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v2</span><span class=p>[</span><span class=mi>33</span><span class=p>];</span> <span class=c1>// [esp+18h] [ebp-A0h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+9Ch] [ebp-1Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v2</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_8048760</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>32</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>putchar</span><span class=p>(</span><span class=n>v2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=o>*</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>8</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>putchar</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>发现和参数a2有关联，需要寻找<code>a2</code>的相关线索</p><p>发现<code>if</code>判断那个位置的函数有对<code>a2</code>数据进行处理，跟进那个函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_8048414</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span> <span class=n>a2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>105</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>101</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>110</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>4</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>100</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>5</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>97</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>6</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>103</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>7</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>115</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>9</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>114</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nl>LABEL_19</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=nf>sub_8048414</span><span class=p>(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>7</span> <span class=o>*</span> <span class=p>(</span><span class=n>a2</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>11</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>对于<code>a2</code>进行递归变化，结合对于<code>a2</code>处理的函数，可以编写个小程序来生成flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v2</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x1F</span><span class=p>,</span>  <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span>  <span class=mh>0x42</span><span class=p>,</span>  <span class=mh>0x09</span><span class=p>,</span>  <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span>  <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span>  <span class=mh>0x59</span><span class=p>,</span>  <span class=mh>0x1E</span><span class=p>,</span>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span>  <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span>  <span class=mh>0x55</span><span class=p>,</span>  <span class=mh>0x02</span><span class=p>,</span>  <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span>  <span class=mh>0x14</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>key</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mi>105</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>110</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>97</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>100</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>33</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>putchar</span><span class=p>(</span><span class=n>v2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>key</span><span class=p>[</span><span class=n>i</span><span class=o>%</span><span class=mi>8</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译并运行，就能得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{s0me7hing_S0me7hinG_t0lki3n}
</span></span></code></pre></div><h2 id=0x2-666>0x2 666<a hidden class=anchor aria-hidden=true href=#0x2-666>#</a></h2><p>使用DIE查询一下程序信息：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211031153424353.png alt=image-20211031153424353></p><p>64位程序，使用GCC进行编译的无壳程序</p><p>使用IDA x64 pro 对程序进行静态分析：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>240</span><span class=p>];</span> <span class=c1>// [rsp+0h] [rbp-1E0h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>[</span><span class=mi>240</span><span class=p>];</span> <span class=c1>// [rsp+F0h] [rbp-F0h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>30uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please Input Key: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>encode</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>v5</span><span class=p>)</span> <span class=o>==</span> <span class=n>key</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>enflag</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;You are Right&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;flag{This_1s_f4cker_flag}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>关键函数应该是在encode里面，这个程序的基本逻辑就是将输入进行<code>encode</code>函数处理，然后与指定的字符串进行比对来进行验证。</p><p>而输入的字符串就是flag数据。</p><p>因此，这道题目也就可以非常简单进行处理，也就是对<code>encode</code>函数进行逆向处理就可</p><p>首先，还是查看一下<code>encode</code>的内部实现情况：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=nf>encode</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>a1</span><span class=p>,</span> <span class=kr>__int64</span> <span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v3</span><span class=p>[</span><span class=mi>104</span><span class=p>];</span> <span class=c1>// [rsp+10h] [rbp-70h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+78h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+7Ch] [rbp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>a1</span><span class=p>)</span> <span class=o>!=</span> <span class=n>key</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Your Length is Wrong&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>key</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>64</span><span class=p>]</span> <span class=o>=</span> <span class=n>key</span> <span class=o>^</span> <span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>33</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>6</span><span class=p>)</span> <span class=o>^</span> <span class=n>key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>a1</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=mi>6</span> <span class=o>^</span> <span class=n>key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)(</span><span class=n>a2</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=n>v3</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)(</span><span class=n>a2</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1LL</span><span class=p>)</span> <span class=o>=</span> <span class=n>v3</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>33</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)(</span><span class=n>a2</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>2LL</span><span class=p>)</span> <span class=o>=</span> <span class=n>v3</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>进行跟踪发现<code>key = 18</code></p><p>可以得知我们输入的内容长度为18</p><p>根据编码函数编写一个解密器进行程序破解</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>enflag</span><span class=p>[]</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x00</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>key</span> <span class=o>=</span> <span class=mh>0x12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>key</span><span class=p>;</span><span class=n>i</span><span class=o>+=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>putchar</span><span class=p>((</span><span class=n>key</span><span class=o>^</span><span class=n>enflag</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>-</span><span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>putchar</span><span class=p>((</span><span class=n>enflag</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>^</span><span class=n>key</span><span class=p>)</span><span class=o>+</span><span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>putchar</span><span class=p>((</span><span class=n>enflag</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=p>]</span><span class=o>^</span><span class=n>key</span><span class=o>^</span><span class=mi>6</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译并运行程序就能拿到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>unctf{b66_6b6_66b}
</span></span></code></pre></div><h2 id=0x3-igniteme>0x3 IgniteMe<a hidden class=anchor aria-hidden=true href=#0x3-igniteme>#</a></h2><p>首先是使用DIE进行程序信息的查看：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211031161028282.png alt=image-20211031161028282></p><p>32位的PE程序，PE程序可以使用的工具就有很多了，首先还是静态分析：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>size_t</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+4Ch] [ebp-8Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span> <span class=c1>// [esp+50h] [ebp-88h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>Str</span><span class=p>[</span><span class=mi>128</span><span class=p>];</span> <span class=c1>// [esp+58h] [ebp-80h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_402B30</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_446360</span><span class=p>,</span> <span class=s>&#34;Give me your flag:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_4013F0</span><span class=p>(</span><span class=n>sub_403670</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401440</span><span class=p>(</span><span class=n>Str</span><span class=p>,</span> <span class=mi>127</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mh>0x1E</span> <span class=o>&amp;&amp;</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>4</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>strcpy</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=s>&#34;EIS{&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>v5</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>Str</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>v5</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>Str</span><span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>125</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nl>LABEL_7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_402B30</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_446360</span><span class=p>,</span> <span class=s>&#34;Sorry, keep trying! &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_4013F0</span><span class=p>(</span><span class=n>sub_403670</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=nf>sub_4011C0</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_402B30</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_446360</span><span class=p>,</span> <span class=s>&#34;Congratulations! &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_402B30</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_446360</span><span class=p>,</span> <span class=s>&#34;Sorry, keep trying! &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_4013F0</span><span class=p>(</span><span class=n>sub_403670</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_402B30</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_446360</span><span class=p>,</span> <span class=s>&#34;Sorry, keep trying!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_4013F0</span><span class=p>(</span><span class=n>sub_403670</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>找到关键加密的位置进行分析</p><p>即对函数<code>sub_4011c0(str)</code>进行分析</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>bool</span> <span class=kr>__cdecl</span> <span class=nf>sub_4011C0</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>Str</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>size_t</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [esp+50h] [ebp-B0h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>Str2</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span> <span class=c1>// [esp+54h] [ebp-ACh] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [esp+74h] [ebp-8Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [esp+78h] [ebp-88h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>size_t</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+7Ch] [ebp-84h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v8</span><span class=p>[</span><span class=mi>128</span><span class=p>];</span> <span class=c1>// [esp+80h] [ebp-80h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>4</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>i</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>v8</span><span class=p>[</span><span class=n>v6</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>Str</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span><span class=p>[</span><span class=n>v6</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>Str2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Str2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>v8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>v2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>97</span> <span class=o>&amp;&amp;</span> <span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>122</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v3</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>v3</span> <span class=o>&amp;&amp;</span> <span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>65</span> <span class=o>&amp;&amp;</span> <span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>90</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Str2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>byte_4420B0</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=nf>sub_4013C0</span><span class=p>(</span><span class=n>v8</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>strcmp</span><span class=p>(</span><span class=s>&#34;GONDPHyGjPEKruv{{pj]X@rF&#34;</span><span class=p>,</span> <span class=n>Str2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>直接就是一个加密算法，直接进行手撸一个解密算法即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>flag</span><span class=p>[</span><span class=mi>128</span><span class=p>]{</span> <span class=mi>0</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s</span><span class=p>[]{</span>
</span></span><span class=line><span class=cl>  <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x04</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>Str</span><span class=p>[]{</span> <span class=s>&#34;GONDPHyGjPEKruv{{pj]X@rF&#34;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>{</span> <span class=mi>0</span> <span class=p>};</span><span class=n>i</span><span class=o>&lt;</span><span class=n>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>);</span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>((</span><span class=n>Str</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>-</span><span class=mi>72</span><span class=p>)</span><span class=o>^</span><span class=mh>0x55</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;a&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=sc>&#39;z&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;A&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=sc>&#39;Z&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;EIS{&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>flag</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;}&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译并运行，就可以得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>EIS{wadx_tdgk_aihc_ihkn_pjlm}
</span></span></code></pre></div><h2 id=0x4-debug>0x4 debug<a hidden class=anchor aria-hidden=true href=#0x4-debug>#</a></h2><p>使用DIE进行正常的程序信息查询：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211101080738116.png alt=image-20211101080738116></p><p>.Net编译的程序，看样子不太友好。面对从未见到过的程序，该怎么做呢？这种情况下，就要使用强大的搜索引擎来寻找答案，经过搜索引擎的帮助，我这边找到了一个工具可以进行.Net程序的逆向——dnSpy</p><p>使用dnSpy来进行.Net程序的开心逆向吧！</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211101082430169.png alt=image-20211101082430169></p><p>dnSpy程序载入页面，dnSpy是一个非常好用的.Net程序和C#程序逆向工具，而且dnSpy的操作方式与Visual Studio非常相似，可以根据Visual Studio的操作模式进行debug。</p><p>首先，需要寻找到关键函数和关键代码位置</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211101082804148.png alt=image-20211101082804148></p><p>经过一番寻找，发现在02000003的位置有存在关键代码，根据关键代码跟进关键函数发现：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211101083006881.png alt=image-20211101083006881></p><p>flag就存在在这里，使用断点断在入口函数这里来进行调试，得到：</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211101083207311.png alt=image-20211101083207311></p><p>得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{967DDDFBCD32C1F53527C221D9E40A0B}
</span></span></code></pre></div><h2 id=0x5-guess-the-number>0x5 Guess-the-Number<a hidden class=anchor aria-hidden=true href=#0x5-guess-the-number>#</a></h2><p>题目直接给了一个jar程序文件，应该是一个java逆向题目，java逆向和Android逆向类似，故可以使用相似的工具进行反编译：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>defpackage</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.math.BigInteger</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* renamed from: guess  reason: default package */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>guess</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>String</span> <span class=nf>XOR</span><span class=o>(</span><span class=n>String</span> <span class=n>_str_one</span><span class=o>,</span> <span class=n>String</span> <span class=n>_str_two</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>BigInteger</span><span class=o>(</span><span class=n>_str_one</span><span class=o>,</span> <span class=mi>16</span><span class=o>).</span><span class=na>xor</span><span class=o>(</span><span class=k>new</span> <span class=n>BigInteger</span><span class=o>(</span><span class=n>_str_two</span><span class=o>,</span> <span class=mi>16</span><span class=o>)).</span><span class=na>toString</span><span class=o>(</span><span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=mi>309137378</span> <span class=o>==</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=kt>int</span> <span class=n>my_num</span> <span class=o>=</span> <span class=mi>349763335</span> <span class=o>+</span> <span class=mi>345736730</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;your flag is: &#34;</span> <span class=o>+</span> <span class=n>XOR</span><span class=o>(</span><span class=s>&#34;4b64ca12ace755516c178f72d05d7061&#34;</span><span class=o>,</span> <span class=s>&#34;ecd44646cfe5994ebeb35bf922e25dba&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;wrong guess!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;please enter an integer \nexample: java -jar guess 12&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;wrong guess!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>num</span> <span class=o>=</span> <span class=mi>1000000</span> <span class=o>+</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>可以直接拖到idea进行参数调试来得到flag:cat:（偷懒小技巧）</p><p><img loading=lazy src=/images/XCTF-REVERSE-expert-1_writeup/image-20211101084458531.png alt=image-20211101084458531></p><p>成功得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>a7b08c546302cc1fd2a4d48bf2bf2ddb
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://oolongcode.github.io/tags/ctf/>ctf</a></li><li><a href=https://oolongcode.github.io/tags/writeup/>writeup</a></li><li><a href=https://oolongcode.github.io/tags/reverse/>Reverse</a></li></ul><nav class=paginav><a class=prev href=https://oolongcode.github.io/posts/xctf-reverse-expert-2_writeup/><span class=title>« Prev</span><br><span>XCTF REVERSE Expert (2) Writeup</span></a>
<a class=next href=https://oolongcode.github.io/posts/buuctf-reverse-3_writeup/><span class=title>Next »</span><br><span>BUUCTF REVERSE [17~24]_Writeup</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://oolongcode.github.io>Jasmine❀Hiker</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script><script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>