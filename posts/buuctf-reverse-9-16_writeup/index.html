<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>BUUCTF REVERSE [9~16]_Writeup | OPdbgBytes</title>
<meta name="keywords" content="ctf, writeup">
<meta name="description" content="BUUCTF-REVERSE-[9-16] writeup 8道逆向工程的小题目，re真是越来越有意思了
0x0 不一样的flag 简单看看题目描述
是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。
首先还是先查询一下程序信息
没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧
#include &lt;stdint.h&gt; int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = &amp;a; ebx = &#34;*11110100001010000101111#&#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi&#43;&#43;; es:edi&#43;&#43;; } while (ecx !">
<meta name="author" content="Me">
<link rel="canonical" href="https://www.codetea.top/posts/buuctf-reverse-9-16_writeup/">

<link crossorigin="anonymous" href="/assets/css/stylesheet.0b739a2e2c5e5656e4bcd5f0b2268d063addaf81d89ec3987d6af8f04decdc97.css" integrity="sha256-C3OaLixeVlbkvNXwsiaNBjrdr4HYnsOYfWr48E3s3Jc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://www.codetea.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codetea.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codetea.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.codetea.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.codetea.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="BUUCTF REVERSE [9~16]_Writeup" />
<meta property="og:description" content="BUUCTF-REVERSE-[9-16] writeup 8道逆向工程的小题目，re真是越来越有意思了
0x0 不一样的flag 简单看看题目描述
是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。
首先还是先查询一下程序信息
没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧
#include &lt;stdint.h&gt; int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = &amp;a; ebx = &#34;*11110100001010000101111#&#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi&#43;&#43;; es:edi&#43;&#43;; } while (ecx !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.codetea.top/posts/buuctf-reverse-9-16_writeup/" /><meta property="og:image" content="https://www.codetea.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-28T19:18:38&#43;08:00" />
<meta property="article:modified_time" content="2022-01-28T19:18:38&#43;08:00" /><meta property="og:site_name" content="ExampleSite" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.codetea.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="BUUCTF REVERSE [9~16]_Writeup"/>
<meta name="twitter:description" content="BUUCTF-REVERSE-[9-16] writeup 8道逆向工程的小题目，re真是越来越有意思了
0x0 不一样的flag 简单看看题目描述
是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。
首先还是先查询一下程序信息
没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧
#include &lt;stdint.h&gt; int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = &amp;a; ebx = &#34;*11110100001010000101111#&#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi&#43;&#43;; es:edi&#43;&#43;; } while (ecx !"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://www.codetea.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "BUUCTF REVERSE [9~16]_Writeup",
      "item": "https://www.codetea.top/posts/buuctf-reverse-9-16_writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "BUUCTF REVERSE [9~16]_Writeup",
  "name": "BUUCTF REVERSE [9~16]_Writeup",
  "description": "BUUCTF-REVERSE-[9-16] writeup 8道逆向工程的小题目，re真是越来越有意思了\n0x0 不一样的flag 简单看看题目描述\n是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。\n首先还是先查询一下程序信息\n没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧\n#include \u0026lt;stdint.h\u0026gt; int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = \u0026amp;a; ebx = \u0026#34;*11110100001010000101111#\u0026#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx !",
  "keywords": [
    "ctf", "writeup"
  ],
  "articleBody": "BUUCTF-REVERSE-[9-16] writeup 8道逆向工程的小题目，re真是越来越有意思了\n0x0 不一样的flag 简单看看题目描述\n是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。\n首先还是先查询一下程序信息\n没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧\n#include  int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = \u0026a; ebx = \"*11110100001010000101111#\"; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx != 0); goto label_1; label_0: label_1: _puts (\"you can choose one action to execute\"); _puts (\"1 up\"); _puts (\"2 down\"); _puts (\"3 left\"); _printf (\"4 right\\n:\"); eax = \u0026choice; _scanf (0x403066, eax); eax = choice; if (eax != 2) { if (eax  2) { if (eax != 1) { } else { if (eax != 3) { if (eax == 4) { goto label_2; } eax = location; eax--; location = eax; } else { } else { eax = location; eax++; location = eax; goto label_3; } } eax = var_34h; eax--; var_34h = eax; goto label_3; label_2: eax = var_34h; eax++; var_34h = eax; goto label_3; } _exit (1); } label_3: i = 0; while (i  1) { eax = i; eax = *((esp + eax*4 + 0x30)); if (eax = 0) { eax = i; eax = *((esp + eax*4 + 0x30)); if (eax  4) { goto label_4; } } _exit (1); label_4: i++; } edx = location; ecx = var_34h; eax = edx; eax  2; eax += edx; edx = \u0026var_40h; eax += edx; eax += ecx; eax -= 0x29; al = *(eax); if (al == 0x31) { _exit (1); } edx = location; ecx = var_34h; eax = edx; eax  2; eax += edx; esi = \u0026var_40h; eax += esi; eax += ecx; eax -= 0x29; al = *(eax); if (al != 0x23) { goto label_0; } _puts (\"\\nok, the order you enter is the flag!\"); _exit (0); } 根据反编译的代码，可以发现这道题目是一个走迷宫的题目，总体而言，还是挺有意思的，找到迷宫数据然后走出迷宫。\n根据迷宫的特性，需要寻找一下一些关键性的信息，来完成迷宫的\n首先是迷宫的信息，可以从反编译的关键代码找到迷宫信息\nebx = \"*11110100001010000101111#\"; 将数据整合一下便得到如下内容：\n*1111 01000 01010 00010 1111# 对于这个数据可以非常清晰看出迷宫的形式，*是起点，#是终点，1不能通行，0可以通行。\n然后是寻找操作指令，自然也可以从反编译代码中找到\n_puts (\"you can choose one action to execute\"); _puts (\"1 up\"); _puts (\"2 down\"); _puts (\"3 left\"); _printf (\"4 right\\n:\"); 根据迷宫和操作数，就可以得到flag\nflag{222441144222} 0x1 SimpleRev 首先查一下程序信息，看看程序具体是个什么\n是一个Linux程序，使用x64 IDA pro进行打开\n找到main函数位置，查看反编译代码\nint __cdecl __noreturn main(int argc, const char **argv, const char **envp) { int v3; // eax  char v4; // [rsp+Fh] [rbp-1h]  while ( 1 ) { while ( 1 ) { printf(\"Welcome to CTF game!\\nPlease input d/D to start or input q/Q to quit this program: \"); v4 = getchar(); if ( v4 != 100 \u0026\u0026 v4 != 68 ) break; Decry(\"Welcome to CTF game!\\nPlease input d/D to start or input q/Q to quit this program: \", argv); } if ( v4 == 113 || v4 == 81 ) Exit(\"Welcome to CTF game!\\nPlease input d/D to start or input q/Q to quit this program: \", argv); puts(\"Input fault format!\"); v3 = getchar(); putchar(v3); } } 对反编译的代码进行简单的审计，发现Decry函数是关键函数，可以看看这个函数的具体实现细节\nunsigned __int64 Decry() { char v1; // [rsp+Fh] [rbp-51h]  int v2; // [rsp+10h] [rbp-50h]  int v3; // [rsp+14h] [rbp-4Ch]  int i; // [rsp+18h] [rbp-48h]  int v5; // [rsp+1Ch] [rbp-44h]  char src[8]; // [rsp+20h] [rbp-40h] BYREF  __int64 v7; // [rsp+28h] [rbp-38h]  int v8; // [rsp+30h] [rbp-30h]  __int64 v9[2]; // [rsp+40h] [rbp-20h] BYREF  int v10; // [rsp+50h] [rbp-10h]  unsigned __int64 v11; // [rsp+58h] [rbp-8h]  v11 = __readfsqword(0x28u); *(_QWORD *)src = 0x534C43444ELL; v7 = 0LL; v8 = 0; v9[0] = 0x776F646168LL; v9[1] = 0LL; v10 = 0; text = (char *)join(key3, v9); strcpy(key, key1); strcat(key, src); v2 = 0; v3 = 0; getchar(); v5 = strlen(key); for ( i = 0; i  v5; ++i ) { if ( key[v3 % v5]  64 \u0026\u0026 key[v3 % v5]  90 ) key[i] = key[v3 % v5] + 32; ++v3; } printf(\"Please input your flag:\"); while ( 1 ) { v1 = getchar(); if ( v1 == 10 ) break; if ( v1 == 32 ) { ++v2; } else { if ( v1  96 || v1  122 ) { if ( v1  64 \u0026\u0026 v1  90 ) { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } } else { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } if ( !(v3 % v5) ) putchar(32); ++v2; } } if ( !strcmp(text, str2) ) puts(\"Congratulation!\\n\"); else puts(\"Try again!\\n\"); return __readfsqword(0x28u) ^ v11; } 根据函数的核心代码可以知道，最开始的数据是\n Intel CPU/AMD CPU 计算机内部的数据存储的方式是以小端序存储的方式，因此部分数据是以颠倒方式进行存储的\n text = 'killshadow' key = 'ADSFKNDCLS' 现在有原始数据就可以进一步对算法进行分析\nwhile ( 1 ) { v1 = getchar(); if ( v1 == 10 ) break; if ( v1 == 32 ) { ++v2; } else { if ( v1  96 || v1  122 ) { if ( v1  64 \u0026\u0026 v1  90 ) { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } } else { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } if ( !(v3 % v5) ) putchar(32); ++v2; } } if ( !strcmp(text, str2) ) puts(\"Congratulation!\\n\"); else puts(\"Try again!\\n\"); 对代码观察可以发现，最终的逻辑判断是text的数据和str2的数据相等\n根据对于程序的逻辑判断，编写逆向算法\n#include #include  using namespace std; int main() { int i, j, n = 0, v2 = 0, v3 = 0;; char v1; string text = \"killshadow\"; string key = \"ADSFKNDCLS\"; char flag[11] = { 0 }; char str2[104] = { 0 };\tint v5 = key.length(); for(int i=0; iv5; ++i) { if ( key[v3 % v5]  64 \u0026\u0026 key[v3 % v5]  90 ) key[i] = key[v3 % v5] + 32; ++v3; } for (j = 0; j  10; ++j) { for (v2 = 0; v2  10; ++v2) { v1 = text[v2] - 97 + 26 * j - 97 + key[v3++ % v5] + 39; if ((v1 = 65 \u0026\u0026 v1  90) || (v1 = 97 \u0026\u0026 v1  122)) { flag[v2] = v1; if (++n == 10) { cout  flag  endl; system(\"PAUSE\"); return 0; } } } } system(\"PAUSE\"); return 0; } 运行得到flag\nKLDQCUDFZO 0x2 Java逆向解密 Java逆向的题目，本质上和安卓逆向有着异曲同工之处，可以使用安卓逆向工具进行打开，这里使用Jadx打开\npackage defpackage; import java.util.ArrayList; import java.util.Scanner; /* renamed from: Reverse reason: default package */ public class Reverse { public static void main(String[] args) { Scanner s = new Scanner(System.in); System.out.println(\"Please input the flag ：\"); String str = s.next(); System.out.println(\"Your input is ：\"); System.out.println(str); Encrypt(str.toCharArray()); } public static void Encrypt(char[] arr) { int[] KEY; ArrayListInteger Resultlist = new ArrayList(); for (char c : arr) { Resultlist.add(Integer.valueOf((c + '@') ^ 32)); } ArrayListInteger KEYList = new ArrayList(); for (int i : new int[]{180, 136, 137, 147, 191, 137, 147, 191, 148, 136, 133, 191, 134, 140, 129, 135, 191, 65}) { KEYList.add(Integer.valueOf(i)); } System.out.println(\"Result:\"); if (Resultlist.equals(KEYList)) { System.out.println(\"Congratulations！\"); } else { System.err.println(\"Error！\"); } } } 应该就是最基本的代码审计\n关键代码其实就在Encrypt函数里面\npublic static void Encrypt(char[] arr) { int[] KEY; ArrayListInteger Resultlist = new ArrayList(); for (char c : arr) { Resultlist.add(Integer.valueOf((c + '@') ^ 32)); } ArrayListInteger KEYList = new ArrayList(); for (int i : new int[]{180, 136, 137, 147, 191, 137, 147, 191, 148, 136, 133, 191, 134, 140, 129, 135, 191, 65}) { KEYList.add(Integer.valueOf(i)); } System.out.println(\"Result:\"); if (Resultlist.equals(KEYList)) { System.out.println(\"Congratulations！\"); } else { System.err.println(\"Error！\"); } } 应该是一个注册码校验程序，写一个java程序逆过去应该就可以得到flag\npackage re; import java.util.ArrayList; public class JavaRe { public static void main(String[] args) { ArrayListInteger KEYList = new ArrayList(); for (int i : new int[]{180, 136, 137, 147, 191, 137, 147, 191, 148, 136, 133, 191, 134, 140, 129, 135, 191, 65}) { KEYList.add(Integer.valueOf(i)); } ArrayListCharacter Resultlist = new ArrayList(); for (int c : KEYList) { Resultlist.add(((char)((c^ 32)-'@'))); } String flag = new String(); for(char c:Resultlist) { flag += c; } System.out.println(flag); } } 运行Java程序就可以得到flag\nThis_is_the_flag_! 0x3 刮开有奖 看下题目：\n这是一个赌博程序，快去赚钱吧！！！！！！！！！！！！！！！！！！！！！！！！！！！(在编辑框中的输入值，即为flag，提交即可) 注意：得到的 flag 请包上 flag{} 提交 先查一下壳：\n没壳，32位的程序，使用IDA pro打开\nint __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd) { DialogBoxParamA(hInstance, (LPCSTR)0x67, 0, DialogFunc, 0); return 0; } 看样子是调用了一个WIN32的API函数，关键的代码应该是在DialogFunc函数代码中\nINT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { const char *v4; // esi  const char *v5; // edi  int v7[2]; // [esp+8h] [ebp-20030h] BYREF  int v8; // [esp+10h] [ebp-20028h]  int v9; // [esp+14h] [ebp-20024h]  int v10; // [esp+18h] [ebp-20020h]  int v11; // [esp+1Ch] [ebp-2001Ch]  int v12; // [esp+20h] [ebp-20018h]  int v13; // [esp+24h] [ebp-20014h]  int v14; // [esp+28h] [ebp-20010h]  int v15; // [esp+2Ch] [ebp-2000Ch]  int v16; // [esp+30h] [ebp-20008h]  CHAR String[65536]; // [esp+34h] [ebp-20004h] BYREF  char v18[65536]; // [esp+10034h] [ebp-10004h] BYREF  if ( a2 == 272 ) return 1; if ( a2 != 273 ) return 0; if ( (_WORD)a3 == 1001 ) { memset(String, 0, 0xFFFFu); GetDlgItemTextA(hDlg, 1000, String, 0xFFFF); if ( strlen(String) == 8 ) { v7[0] = 90; v7[1] = 74; v8 = 83; v9 = 69; v10 = 67; v11 = 97; v12 = 78; v13 = 72; v14 = 51; v15 = 110; v16 = 103; sub_4010F0(v7, 0, 10); memset(v18, 0, 0xFFFFu); v18[0] = String[5]; v18[2] = String[7]; v18[1] = String[6]; v4 = (const char *)sub_401000(v18, strlen(v18)); memset(v18, 0, 0xFFFFu); v18[1] = String[3]; v18[0] = String[2]; v18[2] = String[4]; v5 = (const char *)sub_401000(v18, strlen(v18)); if ( String[0] == v7[0] + 34 \u0026\u0026 String[1] == v10 \u0026\u0026 4 * String[2] - 141 == 3 * v8 \u0026\u0026 String[3] / 4 == 2 * (v13 / 9) \u0026\u0026 !strcmp(v4, \"ak1w\") \u0026\u0026 !strcmp(v5, \"V1Ax\") ) { MessageBoxA(hDlg, \"U g3t 1T!\", \"@_@\", 0); } } return 0; } if ( (_WORD)a3 != 1 \u0026\u0026 (_WORD)a3 != 2 ) return 0; EndDialog(hDlg, (unsigned __int16)a3); return 1; } 也是调用了几个WIN32的API，对代码进行分析\n可以知道：\nGetDlgItemTextA 函数是获取输入的字符串\n这段代码对字符串进行了处理，主要是有两个处理函数sub_4010F0 和 sub_401000\n这个函数应该是处理这个程序字符串的关键函数\n先来看看sub_4010F0函数：\nint __cdecl sub_4010F0(int a1, int a2, int a3) { int result; // eax  int i; // esi  int v5; // ecx  int v6; // edx  result = a3; for ( i = a2; i  a3; a2 = i ) { v5 = 4 * i; v6 = *(_DWORD *)(4 * i + a1); if ( a2  result \u0026\u0026 i  result ) { do { if ( v6  *(_DWORD *)(a1 + 4 * result) ) { if ( i = result ) break; ++i; *(_DWORD *)(v5 + a1) = *(_DWORD *)(a1 + 4 * result); if ( i = result ) break; while ( *(_DWORD *)(a1 + 4 * i)  v6 ) { if ( ++i = result ) goto LABEL_13; } if ( i = result ) break; v5 = 4 * i; *(_DWORD *)(a1 + 4 * result) = *(_DWORD *)(4 * i + a1); } --result; } while ( i  result ); } LABEL_13: *(_DWORD *)(a1 + 4 * result) = v6; sub_4010F0(a1, a2, i - 1); result = a3; ++i; } return result; } 代码的功能暂时不太清楚，毕竟对C语言的审计功底还是不是很到位，根据代码进行转换为相应的Cpp代码运行一下：\n#include #include #include  using namespace std; int __cdecl sub_4010F0(char *a1, int a2, int a3) { int result; // eax  int i; // esi  int v5; // ecx  int v6; // edx  result = a3; for (i = a2; i  a3; a2 = i) { v5 = i; v6 = a1[i]; if (a2  result \u0026\u0026 i  result) { do { if (v6 a1[result]) { if (i = result) break; ++i; a1[v5] = a1[result]; if (i = result) break; while (a1[i]  v6) { if (++i = result) goto LABEL_13; } if (i = result) break; v5 = i; a1[result] = a1[i]; } --result; } while (i  result); } LABEL_13: a1[result] = v6; sub_4010F0(a1, a2, i - 1); result = a3; ++i; } return result; } int main() { char v7[11]; v7[0] = 90; v7[1] = 74; v7[2] = 83; v7[3] = 69; v7[4] = 67; v7[5] = 97; v7[6] = 78; v7[7] = 72; v7[8] = 51; v7[9] = 110; v7[10] = 103; cout  v7  endl; sub_4010F0(v7, 0, 10); for(int i = 0;i 11;++i){ cout  (int)v7[i]  \"\\t\"; } cout  endl; system(\"PAUSE\"); return 0; } 运行代码，得到\nZJSECaNH3ng 51 67 69 72 74 78 83 90 97 103 110 看来应该是一个排序算法，按升序进行排序的\n下面分析另一个函数具体是个什么东西：\n_BYTE *__cdecl sub_401000(int a1, int a2) { int v2; // eax  int v3; // esi  size_t v4; // ebx  _BYTE *v5; // eax  _BYTE *v6; // edi  int v7; // eax  _BYTE *v8; // ebx  int v9; // edi  int v10; // edx  int v11; // edi  int v12; // eax  int i; // esi  _BYTE *result; // eax  _BYTE *v15; // [esp+Ch] [ebp-10h]  _BYTE *v16; // [esp+10h] [ebp-Ch]  int v17; // [esp+14h] [ebp-8h]  int v18; // [esp+18h] [ebp-4h]  v2 = a2 / 3; v3 = 0; if ( a2 % 3  0 ) ++v2; v4 = 4 * v2 + 1; v5 = malloc(v4); v6 = v5; v15 = v5; if ( !v5 ) exit(0); memset(v5, 0, v4); v7 = a2; v8 = v6; v16 = v6; if ( a2  0 ) { while ( 1 ) { v9 = 0; v10 = 0; v18 = 0; do { if ( v3 = v7 ) break; ++v10; v9 = *(unsigned __int8 *)(v3 + a1) | (v9  8); ++v3; } while ( v10  3 ); v11 = v9  (8 * (3 - v10)); v12 = 0; v17 = v3; for ( i = 18; i  -6; i -= 6 ) { if ( v10 = v12 ) { *((_BYTE *)\u0026v18 + v12) = (v11  i) \u0026 0x3F; v8 = v16; } else { *((_BYTE *)\u0026v18 + v12) = 64; } *v8++ = byte_407830[*((char *)\u0026v18 + v12++)]; v16 = v8; } v3 = v17; if ( v17 = a2 ) break; v7 = a2; } v6 = v15; } result = v6; *v8 = 0; return result; } 看代码，发现有3和8移位的特征初步推测是base64编码，看到有一个byte_407830的数组，跟进点开查看数据内容\n看到这数据应该就可以断定是base64编码了。\n现在知道了两个函数的功能作用，可以直接进行求解，直接定位到判断条件的位置：\nif ( String[0] == v7[0] + 34 \u0026\u0026 String[1] == v10 \u0026\u0026 4 * String[2] - 141 == 3 * v8 \u0026\u0026 String[3] / 4 == 2 * (v13 / 9) \u0026\u0026 !strcmp(v4, \"ak1w\") \u0026\u0026 !strcmp(v5, \"V1Ax\") ) { MessageBoxA(hDlg, \"U g3t 1T!\", \"@_@\", 0); } 进行简单的推断可以得出\nString[0] == 85; // 51+34 = 85 String[1] == 74; String[2] == 87; //(3 x 69 +141)/4 = 87 String[3] == 80;// 2 x (90 / 9) x4 == 80 下面进行base64解码来得到后面四个字符的数据\nb'jMp' b'WP1' 根据推断出来的信息可以求解得到flag\nUJWP1jMp  也可以使用Python脚本快速求解\nimport base64 data = [51, 67, 69, 72, 74, 78, 83, 90, 97, 103, 110] String = \"\" String += chr(data[0]+34) String += chr(data[4]) String += base64.b64decode(\"V1Ax\").decode() String += base64.b64decode(\"ak1w\").decode() flag = \"flag{\"+String+\"}\" print(flag) 运行脚本就可以得到flag\nflag{UJWP1jMp} 0x4 [GXYCTF2019]luck_guy 文件没有拓展名，感觉是一个ELF格式的文件\n先走一下逆向的流程，首先查下壳\n果然是一个ELF文件，64位的文件，用x64 IDA pro打开文件，查看主程序\nint __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v4; // [rsp+14h] [rbp-Ch] BYREF  unsigned __int64 v5; // [rsp+18h] [rbp-8h]  v5 = __readfsqword(0x28u); welcome(argc, argv, envp); puts(\"_________________\"); puts(\"try to patch me and find flag\"); v4 = 0; puts(\"please input a lucky number\"); __isoc99_scanf(\"%d\", \u0026v4); patch_me(v4); puts(\"OK,see you again\"); return 0; } 程序挺简单的，需要寻找一下核心代码\n看样子核心代码应该是在patch_me(v4)函数里面，进入函数内部\nint __fastcall patch_me(int a1) { int result; // eax  if ( a1 % 2 == 1 ) result = puts(\"just finished\"); else result = get_flag(); return result; } 继续跟进到get_flag()函数里面\nunsigned __int64 get_flag() { unsigned int v0; // eax  int i; // [rsp+4h] [rbp-3Ch]  int j; // [rsp+8h] [rbp-38h]  __int64 s; // [rsp+10h] [rbp-30h] BYREF  char v5; // [rsp+18h] [rbp-28h]  unsigned __int64 v6; // [rsp+38h] [rbp-8h]  v6 = __readfsqword(0x28u); v0 = time(0LL); srand(v0); for ( i = 0; i  4; ++i ) { switch ( rand() % 200 ) { case 1: puts(\"OK, it's flag:\"); memset(\u0026s, 0, 0x28uLL); strcat((char *)\u0026s, f1); strcat((char *)\u0026s, \u0026f2); printf(\"%s\", (const char *)\u0026s); break; case 2: printf(\"Solar not like you\"); break; case 3: printf(\"Solar want a girlfriend\"); break; case 4: s = 0x7F666F6067756369LL; v5 = 0; strcat(\u0026f2, (const char *)\u0026s); break; case 5: for ( j = 0; j  7; ++j ) { if ( j % 2 == 1 ) *(\u0026f2 + j) -= 2; else --*(\u0026f2 + j); } break; default: puts(\"emmm,you can't find flag 23333\"); break; } } return __readfsqword(0x28u) ^ v6; } 看来flag应该就在这个函数里面，本来觉得可以使用gdb调试出来，无奈自己太菜了，不知道到gdb怎么修改汇编代码进行跳转，只能进行静态分析调试\n进行分析发现，switch 条件的顺序应该是 4 – 5 —1的顺序依次输出flag\n写一个脚本将flag数据输出\nflag = 'GXY{do_not_' f2 = [0x7F, 0x66, 0x6F, 0x60, 0x67, 0x75, 0x63, 0x69][::-1] s = '' for i in range(8): if i % 2 == 1: s = chr(f2[i] - 2) else: s = chr(f2[i] - 1) flag += s print(flag) 运行脚本，得到flag\nGXY{do_not_hate_me} 0x5 findit 看下题目哈\n不知不觉，小明长大了，变成了一个程序员，虽然很苦逼，但是偶尔编写个小东西坑害公司新人还是蛮好玩的。新人小萌一天问小明wifi账号密码，一分钟后，小萌收到了一个文件。小萌想了好久都没得到密码，怎么办，女朋友要买东西，流量告罄，没wifi上不了网，不买就分手，是时候该展现月老的实力了兄弟们！代表月亮惩罚小明！得出答案。 注意：得到的 flag 请包上 flag{} 提交 感觉像是一道APK的题目，下载附件发现果然是一个APK的题目，使用APK逆向工具jadx进行逆向\npackage com.example.findit; import android.os.Bundle; import android.support.v7.app.ActionBarActivity; import android.view.MenuItem; import android.view.View; import android.widget.Button; import android.widget.EditText; import android.widget.TextView; public class MainActivity extends ActionBarActivity { /* access modifiers changed from: protected */ @Override // android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity  public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); final EditText edit = (EditText) findViewById(R.id.widget2); final TextView text = (TextView) findViewById(R.id.widget1); final char[] a = {'T', 'h', 'i', 's', 'I', 's', 'T', 'h', 'e', 'F', 'l', 'a', 'g', 'H', 'o', 'm', 'e'}; final char[] b = {'p', 'v', 'k', 'q', '{', 'm', '1', '6', '4', '6', '7', '5', '2', '6', '2', '0', '3', '3', 'l', '4', 'm', '4', '9', 'l', 'n', 'p', '7', 'p', '9', 'm', 'n', 'k', '2', '8', 'k', '7', '5', '}'}; ((Button) findViewById(R.id.widget3)).setOnClickListener(new View.OnClickListener() { /* class com.example.findit.MainActivity.AnonymousClass1 */ public void onClick(View v) { char[] x = new char[17]; char[] y = new char[38]; for (int i = 0; i  17; i++) { if ((a[i]  'I' \u0026\u0026 a[i] = 'A') || (a[i]  'i' \u0026\u0026 a[i] = 'a')) { x[i] = (char) (a[i] + 18); } else if ((a[i]  'A' || a[i]  'Z') \u0026\u0026 (a[i]  'a' || a[i]  'z')) { x[i] = a[i]; } else { x[i] = (char) (a[i] - '\\b'); } } if (String.valueOf(x).equals(edit.getText().toString())) { for (int i2 = 0; i2  38; i2++) { if ((b[i2]  'A' || b[i2]  'Z') \u0026\u0026 (b[i2]  'a' || b[i2]  'z')) { y[i2] = b[i2]; } else { y[i2] = (char) (b[i2] + 16); if ((y[i2]  'Z' \u0026\u0026 y[i2]  'a') || y[i2] = 'z') { y[i2] = (char) (y[i2] - 26); } } } text.setText(String.valueOf(y)); return; } text.setText(\"答案错了肿么办。。。不给你又不好意思。。。哎呀好纠结啊~~~\"); } }); } public boolean onOptionsItemSelected(MenuItem item) { if (item.getItemId() == R.id.action_settings) { return true; } return super.onOptionsItemSelected(item); } } 看样子好像是一个简单的加密程序，可以进行简单的分析\n发现主要的flag代码：\nfor (int i2 = 0; i2  38; i2++) { if ((b[i2]  'A' || b[i2]  'Z') \u0026\u0026 (b[i2]  'a' || b[i2]  'z')) { y[i2] = b[i2]; } else { y[i2] = (char) (b[i2] + 16); if ((y[i2]  'Z' \u0026\u0026 y[i2]  'a') || y[i2] = 'z') { y[i2] = (char) (y[i2] - 26); } } } text.setText(String.valueOf(y)); return; 这行代码稍加修改一下运行就可以直接俄得到flag了，写个Java的flag生成器，来生成flag吧！\npackage re; public class Findit { final static char[] b = {'p', 'v', 'k', 'q', '{', 'm', '1', '6', '4', '6', '7', '5', '2', '6', '2', '0', '3', '3', 'l', '4', 'm', '4', '9', 'l', 'n', 'p', '7', 'p', '9', 'm', 'n', 'k', '2', '8', 'k', '7', '5', '}'}; public static void main(String[] args) { char[] y = new char[38]; for (int i2 = 0; i2  38; i2++) { if ((b[i2]  'A' || b[i2]  'Z') \u0026\u0026 (b[i2]  'a' || b[i2]  'z')) { y[i2] = b[i2]; } else { y[i2] = (char) (b[i2] + 16); if ((y[i2]  'Z' \u0026\u0026 y[i2]  'a') || y[i2] = 'z') { y[i2] = (char) (y[i2] - 26); } } } System.out.println(String.valueOf(y)); }\t} 运行一下这个java程序就能生成flag啦！\nflag{c164675262033b4c49bdf7f9cda28a75} 0x6 简单的注册器 看下题目\n生活中难免会有需要使用一些付费的程序，但是没有绿色版怎么办？只能自己逆向看看注册程序的代码是什么逻辑了。 注意：得到的 flag 请包上 flag{} 提交 下载附件，发现是一个apk文件，使用apk逆向工具jadx查看apk的伪代码\npackage com.example.flag; import android.os.Bundle; import android.support.v4.app.Fragment; import android.support.v7.app.ActionBarActivity; import android.view.LayoutInflater; import android.view.Menu; import android.view.MenuItem; import android.view.View; import android.view.ViewGroup; import android.widget.Button; import android.widget.EditText; import android.widget.TextView; public class MainActivity extends ActionBarActivity { /* access modifiers changed from: protected */ @Override // android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity  public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); if (savedInstanceState == null) { getSupportFragmentManager().beginTransaction().add(R.id.container, new PlaceholderFragment()).commit(); } final TextView textview = (TextView) findViewById(R.id.textView1); final EditText editview = (EditText) findViewById(R.id.editText1); ((Button) findViewById(R.id.button1)).setOnClickListener(new View.OnClickListener() { /* class com.example.flag.MainActivity.AnonymousClass1 */ public void onClick(View v) { int flag = 1; String xx = editview.getText().toString(); if (!(xx.length() == 32 \u0026\u0026 xx.charAt(31) == 'a' \u0026\u0026 xx.charAt(1) == 'b' \u0026\u0026 (xx.charAt(0) + xx.charAt(2)) - 48 == 56)) { flag = 0; } if (flag == 1) { char[] x = \"dd2940c04462b4dd7c450528835cca15\".toCharArray(); x[2] = (char) ((x[2] + x[3]) - 50); x[4] = (char) ((x[2] + x[5]) - 48); x[30] = (char) ((x[31] + x[9]) - 48); x[14] = (char) ((x[27] + x[28]) - 97); for (int i = 0; i  16; i++) { char a = x[31 - i]; x[31 - i] = x[i]; x[i] = a; } textview.setText(\"flag{\" + String.valueOf(x) + \"}\"); return; } textview.setText(\"输入注册码错误\"); } }); } public boolean onCreateOptionsMenu(Menu menu) { getMenuInflater().inflate(R.menu.main, menu); return true; } public boolean onOptionsItemSelected(MenuItem item) { if (item.getItemId() == R.id.action_settings) { return true; } return super.onOptionsItemSelected(item); } public static class PlaceholderFragment extends Fragment { @Override // android.support.v4.app.Fragment  public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) { return inflater.inflate(R.layout.fragment_main, container, false); } } } 进行简单的代码审计，可以确定核心代码：\nif (flag == 1) { char[] x = \"dd2940c04462b4dd7c450528835cca15\".toCharArray(); x[2] = (char) ((x[2] + x[3]) - 50); x[4] = (char) ((x[2] + x[5]) - 48); x[30] = (char) ((x[31] + x[9]) - 48); x[14] = (char) ((x[27] + x[28]) - 97); for (int i = 0; i  16; i++) { char a = x[31 - i]; x[31 - i] = x[i]; x[i] = a; } textview.setText(\"flag{\" + String.valueOf(x) + \"}\"); return; } 写一个Java注册器，把flag注册出来\npackage re; public class Register { public static void main(String[] args) { char[] x = \"dd2940c04462b4dd7c450528835cca15\".toCharArray(); x[2] = (char) ((x[2] + x[3]) - 50); x[4] = (char) ((x[2] + x[5]) - 48); x[30] = (char) ((x[31] + x[9]) - 48); x[14] = (char) ((x[27] + x[28]) - 97); for (int i = 0; i  16; i++) { char a = x[31 - i]; x[31 - i] = x[i]; x[i] = a; } System.out.println(\"flag{\" + String.valueOf(x) + \"}\"); } } 运行注册器来注册一个flag\nflag{59acc538825054c7de4b26440c0999dd} 0x7 [BJDCTF2020]JustRE 下载下来是一个挺有意思的exe程序\n走下流程，首先是查询文件\n32位的PE程序，使用IDA pro反汇编通过检索BJD的字符串来定位到核心代码\nINT_PTR __stdcall DialogFunc(HWND hWnd, UINT a2, WPARAM a3, LPARAM a4) { CHAR String[100]; // [esp+0h] [ebp-64h] BYREF  if ( a2 != 272 ) { if ( a2 != 273 ) return 0; if ( (_WORD)a3 != 1 \u0026\u0026 (_WORD)a3 != 2 ) { sprintf(String, Format, ++dword_4099F0); if ( dword_4099F0 == 19999 ) { sprintf(String, \" BJD{%d%d2069a45792d233ac}\", 19999, 0); SetWindowTextA(hWnd, String); return 0; } SetWindowTextA(hWnd, String); return 0; } EndDialog(hWnd, (unsigned __int16)a3); } return 1; } 发现核心代码中隐藏着flag的信息，得到flag\nBJD{1999902069a45792d233ac} ",
  "wordCount" : "3644",
  "inLanguage": "en",
  "datePublished": "2022-01-28T19:18:38+08:00",
  "dateModified": "2022-01-28T19:18:38+08:00",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codetea.top/posts/buuctf-reverse-9-16_writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "OPdbgBytes",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.codetea.top/favicon.ico"
    }
  }
}
</script>

<link href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css" rel="stylesheet">
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>

<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/armasm.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/mipsasm.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/wasm.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/languages/x86asm.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.codetea.top/" accesskey="h" title="OPdbgBytes (Alt + H)">OPdbgBytes</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.codetea.top/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://www.codetea.top/posts" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://www.codetea.top/link" title="Link">
                    <span>Link</span>
                </a>
            </li>
            <li>
                <a href="https://www.codetea.top/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.codetea.top/">Home</a>&nbsp;»&nbsp;<a href="https://www.codetea.top/posts/">Posts</a></div>
    <h1 class="post-title">
      BUUCTF REVERSE [9~16]_Writeup
    </h1>
    <div class="post-meta"><span title='2022-01-28 19:18:38 +0800 CST'>January 28, 2022</span>&nbsp;·&nbsp;18 min&nbsp;·&nbsp;3644 words&nbsp;·&nbsp;Me

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x0-不一样的flag">0x0 不一样的flag</a></li>
    <li><a href="#0x1-simplerev">0x1 SimpleRev</a></li>
    <li><a href="#0x2-java逆向解密">0x2 Java逆向解密</a></li>
    <li><a href="#0x3-刮开有奖">0x3 刮开有奖</a></li>
    <li><a href="#0x4-gxyctf2019luck_guy">0x4 [GXYCTF2019]luck_guy</a></li>
    <li><a href="#0x5-findit">0x5 findit</a></li>
    <li><a href="#0x6-简单的注册器">0x6 简单的注册器</a></li>
    <li><a href="#0x7-bjdctf2020justre">0x7 [BJDCTF2020]JustRE</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="buuctf-reverse-9-16-writeup">BUUCTF-REVERSE-[9-16] writeup<a hidden class="anchor" aria-hidden="true" href="#buuctf-reverse-9-16-writeup">#</a></h1>
<p>8道逆向工程的小题目，re真是越来越有意思了</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210808095050806.png" alt="image-20210808095050806"  />
</p>
<h2 id="0x0-不一样的flag">0x0 不一样的flag<a hidden class="anchor" aria-hidden="true" href="#0x0-不一样的flag">#</a></h2>
<p>简单看看题目描述</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交
</code></pre></div><p>应该会是一道非常有趣的题目，非常有意思的题目。</p>
<p>首先还是先查询一下程序信息</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210808211004969.png" alt="image-20210808211004969"  />
</p>
<p>没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span><span class="cp"></span> 
<span class="kt">int32_t</span> <span class="nf">dbg_main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int32_t</span> <span class="n">var_4h</span><span class="p">;</span>
    <span class="kt">char</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="n">a</span><span class="p">;</span>
    <span class="kt">int</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">location</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_34h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">choice</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_40h</span><span class="p">;</span>
    <span class="cm">/* int main(); */</span>
    <span class="n">_main</span> <span class="p">(</span><span class="n">ebx</span><span class="p">,</span> <span class="n">esi</span><span class="p">,</span> <span class="n">edi</span><span class="p">);</span>
    <span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">var_34h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">edx</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
    <span class="n">ebx</span> <span class="o">=</span> <span class="s">&#34;*11110100001010000101111#&#34;</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
    <span class="n">edi</span> <span class="o">=</span> <span class="n">edx</span><span class="p">;</span>
    <span class="n">esi</span> <span class="o">=</span> <span class="n">ebx</span><span class="p">;</span>
    <span class="n">ecx</span> <span class="o">=</span> <span class="n">eax</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="nl">es</span><span class="p">:</span><span class="n">edi</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">esi</span><span class="p">);</span>
        <span class="n">ecx</span><span class="o">--</span><span class="p">;</span>
        <span class="n">esi</span><span class="o">++</span><span class="p">;</span>
        <span class="nl">es</span><span class="p">:</span><span class="n">edi</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ecx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">goto</span> <span class="n">label_1</span><span class="p">;</span>
<span class="nl">label_0</span><span class="p">:</span>
<span class="nl">label_1</span><span class="p">:</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;you can choose one action to execute&#34;</span><span class="p">);</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;1 up&#34;</span><span class="p">);</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;2 down&#34;</span><span class="p">);</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;3 left&#34;</span><span class="p">);</span>
    <span class="n">_printf</span> <span class="p">(</span><span class="s">&#34;4 right</span><span class="se">\n</span><span class="s">:&#34;</span><span class="p">);</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">choice</span><span class="p">;</span>
    <span class="n">_scanf</span> <span class="p">(</span><span class="mh">0x403066</span><span class="p">,</span> <span class="n">eax</span><span class="p">);</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="n">choice</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">goto</span> <span class="n">label_2</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="n">eax</span> <span class="o">=</span> <span class="n">location</span><span class="p">;</span>
                    <span class="n">eax</span><span class="o">--</span><span class="p">;</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">eax</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">eax</span> <span class="o">=</span> <span class="n">location</span><span class="p">;</span>
                    <span class="n">eax</span><span class="o">++</span><span class="p">;</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">eax</span><span class="p">;</span>
                    <span class="k">goto</span> <span class="n">label_3</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">eax</span> <span class="o">=</span> <span class="n">var_34h</span><span class="p">;</span>
            <span class="n">eax</span><span class="o">--</span><span class="p">;</span>
            <span class="n">var_34h</span> <span class="o">=</span> <span class="n">eax</span><span class="p">;</span>
            <span class="k">goto</span> <span class="n">label_3</span><span class="p">;</span>
<span class="nl">label_2</span><span class="p">:</span>
            <span class="n">eax</span> <span class="o">=</span> <span class="n">var_34h</span><span class="p">;</span>
            <span class="n">eax</span><span class="o">++</span><span class="p">;</span>
            <span class="n">var_34h</span> <span class="o">=</span> <span class="n">eax</span><span class="p">;</span>
            <span class="k">goto</span> <span class="n">label_3</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">_exit</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="nl">label_3</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">eax</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">eax</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">esp</span> <span class="o">+</span> <span class="n">eax</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">eax</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="n">eax</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">esp</span> <span class="o">+</span> <span class="n">eax</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">goto</span> <span class="n">label_4</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">_exit</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nl">label_4</span><span class="p">:</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">edx</span> <span class="o">=</span> <span class="n">location</span><span class="p">;</span>
    <span class="n">ecx</span> <span class="o">=</span> <span class="n">var_34h</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="n">edx</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">edx</span><span class="p">;</span>
    <span class="n">edx</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">var_40h</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">edx</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">ecx</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">-=</span> <span class="mh">0x29</span><span class="p">;</span>
    <span class="n">al</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">eax</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">al</span> <span class="o">==</span> <span class="mh">0x31</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_exit</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">edx</span> <span class="o">=</span> <span class="n">location</span><span class="p">;</span>
    <span class="n">ecx</span> <span class="o">=</span> <span class="n">var_34h</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">=</span> <span class="n">edx</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">edx</span><span class="p">;</span>
    <span class="n">esi</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">var_40h</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">esi</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">+=</span> <span class="n">ecx</span><span class="p">;</span>
    <span class="n">eax</span> <span class="o">-=</span> <span class="mh">0x29</span><span class="p">;</span>
    <span class="n">al</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">eax</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">al</span> <span class="o">!=</span> <span class="mh">0x23</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">label_0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">ok, the order you enter is the flag!&#34;</span><span class="p">);</span>
    <span class="n">_exit</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>根据反编译的代码，可以发现这道题目是一个走迷宫的题目，总体而言，还是挺有意思的，找到迷宫数据然后走出迷宫。</p>
<p>根据迷宫的特性，需要寻找一下一些关键性的信息，来完成迷宫的</p>
<p>首先是迷宫的信息，可以从反编译的关键代码找到迷宫信息</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"> <span class="n">ebx</span> <span class="o">=</span> <span class="s">&#34;*11110100001010000101111#&#34;</span><span class="p">;</span>
</code></pre></div><p>将数据整合一下便得到如下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">*1111
01000
01010
00010
1111#
</code></pre></div><p>对于这个数据可以非常清晰看出迷宫的形式，*是起点，#是终点，1不能通行，0可以通行。</p>
<p>然后是寻找操作指令，自然也可以从反编译代码中找到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;you can choose one action to execute&#34;</span><span class="p">);</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;1 up&#34;</span><span class="p">);</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;2 down&#34;</span><span class="p">);</span>
    <span class="n">_puts</span> <span class="p">(</span><span class="s">&#34;3 left&#34;</span><span class="p">);</span>
    <span class="n">_printf</span> <span class="p">(</span><span class="s">&#34;4 right</span><span class="se">\n</span><span class="s">:&#34;</span><span class="p">);</span>
</code></pre></div><p>根据迷宫和操作数，就可以得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{222441144222}
</code></pre></div><h2 id="0x1-simplerev">0x1 SimpleRev<a hidden class="anchor" aria-hidden="true" href="#0x1-simplerev">#</a></h2>
<p>首先查一下程序信息，看看程序具体是个什么</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210809170725758.png" alt="image-20210809170725758"  />
</p>
<p>是一个Linux程序，使用x64 IDA pro进行打开</p>
<p>找到main函数位置，查看反编译代码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">__noreturn</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+Fh] [rbp-1h]
</span><span class="c1"></span>
  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome to CTF game!</span><span class="se">\n</span><span class="s">Please input d/D to start or input q/Q to quit this program: &#34;</span><span class="p">);</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mi">100</span> <span class="o">&amp;&amp;</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mi">68</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="n">Decry</span><span class="p">(</span><span class="s">&#34;Welcome to CTF game!</span><span class="se">\n</span><span class="s">Please input d/D to start or input q/Q to quit this program: &#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mi">113</span> <span class="o">||</span> <span class="n">v4</span> <span class="o">==</span> <span class="mi">81</span> <span class="p">)</span>
      <span class="n">Exit</span><span class="p">(</span><span class="s">&#34;Welcome to CTF game!</span><span class="se">\n</span><span class="s">Please input d/D to start or input q/Q to quit this program: &#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Input fault format!&#34;</span><span class="p">);</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="n">putchar</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>对反编译的代码进行简单的审计，发现Decry函数是关键函数，可以看看这个函数的具体实现细节</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="nf">Decry</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+Fh] [rbp-51h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-50h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-4Ch]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-48h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-44h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">src</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-40h] BYREF
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-38h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-30h]
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v9</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// [rsp+40h] [rbp-20h] BYREF
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+50h] [rbp-10h]
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// [rsp+58h] [rbp-8h]
</span><span class="c1"></span>
  <span class="n">v11</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">src</span> <span class="o">=</span> <span class="mh">0x534C43444ELL</span><span class="p">;</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v9</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x776F646168LL</span><span class="p">;</span>
  <span class="n">v9</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">join</span><span class="p">(</span><span class="n">key3</span><span class="p">,</span> <span class="n">v9</span><span class="p">);</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key1</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">getchar</span><span class="p">();</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">64</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">90</span> <span class="p">)</span>
      <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span>
    <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Please input your flag:&#34;</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">32</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="o">++</span><span class="n">v2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">96</span> <span class="o">||</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">122</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">64</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">90</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="n">str2</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="mi">39</span> <span class="o">-</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">97</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">97</span><span class="p">;</span>
          <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="n">str2</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="mi">39</span> <span class="o">-</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">97</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">97</span><span class="p">;</span>
        <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">putchar</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
      <span class="o">++</span><span class="n">v2</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Congratulation!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Try again!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v11</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>根据函数的核心代码可以知道，最开始的数据是</p>
<blockquote>
<p>Intel CPU/AMD CPU 计算机内部的数据存储的方式是以小端序存储的方式，因此部分数据是以颠倒方式进行存储的</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">text = &#39;killshadow&#39;
key =  &#39;ADSFKNDCLS&#39;
</code></pre></div><p>现在有原始数据就可以进一步对算法进行分析</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">32</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="o">++</span><span class="n">v2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">96</span> <span class="o">||</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">122</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">64</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">90</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">str2</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="mi">39</span> <span class="o">-</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">97</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">97</span><span class="p">;</span>
                <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">str2</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="mi">39</span> <span class="o">-</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">97</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">97</span><span class="p">;</span>
            <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">putchar</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
        <span class="o">++</span><span class="n">v2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Congratulation!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="k">else</span>
    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Try again!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</code></pre></div><p>对代码观察可以发现，最终的逻辑判断是<code>text</code>的数据和<code>str2</code>的数据相等</p>
<p>根据对于程序的逻辑判断，编写逆向算法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;;</span>
	<span class="kt">char</span> <span class="n">v1</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">text</span> <span class="o">=</span> <span class="s">&#34;killshadow&#34;</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#34;ADSFKNDCLS&#34;</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="kt">char</span> <span class="n">str2</span><span class="p">[</span><span class="mi">104</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>	
	<span class="kt">int</span> <span class="n">v5</span> <span class="o">=</span> <span class="n">key</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">v5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">64</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">90</span> <span class="p">)</span>
      		<span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span>
    	<span class="o">++</span><span class="n">v3</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">v2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">97</span> <span class="o">+</span> <span class="mi">26</span> <span class="o">*</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">97</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="n">v3</span><span class="o">++</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">+</span> <span class="mi">39</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">v1</span> <span class="o">&gt;=</span> <span class="mi">65</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&gt;=</span> <span class="mi">97</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">122</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">flag</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">n</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">flag</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
                    <span class="n">system</span><span class="p">(</span><span class="s">&#34;PAUSE&#34;</span><span class="p">);</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
	<span class="n">system</span><span class="p">(</span><span class="s">&#34;PAUSE&#34;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>运行得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">KLDQCUDFZO
</code></pre></div><h2 id="0x2-java逆向解密">0x2 Java逆向解密<a hidden class="anchor" aria-hidden="true" href="#0x2-java逆向解密">#</a></h2>
<p>Java逆向的题目，本质上和安卓逆向有着异曲同工之处，可以使用安卓逆向工具进行打开，这里使用Jadx打开</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">defpackage</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="cm">/* renamed from: Reverse  reason: default package */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reverse</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Please input the flag ：&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Your input is ：&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="n">Encrypt</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">Encrypt</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">KEY</span><span class="o">;</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">Resultlist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">:</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Resultlist</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">((</span><span class="n">c</span> <span class="o">+</span> <span class="sc">&#39;@&#39;</span><span class="o">)</span> <span class="o">^</span> <span class="n">32</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">KEYList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">180</span><span class="o">,</span> <span class="n">136</span><span class="o">,</span> <span class="n">137</span><span class="o">,</span> <span class="n">147</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">137</span><span class="o">,</span> <span class="n">147</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">148</span><span class="o">,</span> <span class="n">136</span><span class="o">,</span> <span class="n">133</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">134</span><span class="o">,</span> <span class="n">140</span><span class="o">,</span> <span class="n">129</span><span class="o">,</span> <span class="n">135</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">65</span><span class="o">})</span> <span class="o">{</span>
            <span class="n">KEYList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Result:&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Resultlist</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">KEYList</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Congratulations！&#34;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Error！&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>应该就是最基本的代码审计</p>
<p>关键代码其实就在<code>Encrypt</code>函数里面</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">Encrypt</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">KEY</span><span class="o">;</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">Resultlist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">:</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Resultlist</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">((</span><span class="n">c</span> <span class="o">+</span> <span class="sc">&#39;@&#39;</span><span class="o">)</span> <span class="o">^</span> <span class="n">32</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">KEYList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">180</span><span class="o">,</span> <span class="n">136</span><span class="o">,</span> <span class="n">137</span><span class="o">,</span> <span class="n">147</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">137</span><span class="o">,</span> <span class="n">147</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">148</span><span class="o">,</span> <span class="n">136</span><span class="o">,</span> <span class="n">133</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">134</span><span class="o">,</span> <span class="n">140</span><span class="o">,</span> <span class="n">129</span><span class="o">,</span> <span class="n">135</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">65</span><span class="o">})</span> <span class="o">{</span>
            <span class="n">KEYList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Result:&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Resultlist</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">KEYList</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Congratulations！&#34;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Error！&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div><p>应该是一个注册码校验程序，写一个java程序逆过去应该就可以得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">re</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaRe</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">KEYList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">180</span><span class="o">,</span> <span class="n">136</span><span class="o">,</span> <span class="n">137</span><span class="o">,</span> <span class="n">147</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">137</span><span class="o">,</span> <span class="n">147</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">148</span><span class="o">,</span> <span class="n">136</span><span class="o">,</span> <span class="n">133</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">134</span><span class="o">,</span> <span class="n">140</span><span class="o">,</span> <span class="n">129</span><span class="o">,</span> <span class="n">135</span><span class="o">,</span> <span class="n">191</span><span class="o">,</span> <span class="n">65</span><span class="o">})</span> <span class="o">{</span>
            <span class="n">KEYList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">&gt;</span> <span class="n">Resultlist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">:</span> <span class="n">KEYList</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Resultlist</span><span class="o">.</span><span class="na">add</span><span class="o">(((</span><span class="kt">char</span><span class="o">)((</span><span class="n">c</span><span class="o">^</span> <span class="n">32</span><span class="o">)-</span><span class="sc">&#39;@&#39;</span><span class="o">)));</span>
        <span class="o">}</span>
        <span class="n">String</span> <span class="n">flag</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">:</span><span class="n">Resultlist</span><span class="o">)</span> <span class="o">{</span>
        	<span class="n">flag</span> <span class="o">+=</span> <span class="n">c</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">flag</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><p>运行Java程序就可以得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">This_is_the_flag_!
</code></pre></div><h2 id="0x3-刮开有奖">0x3 刮开有奖<a hidden class="anchor" aria-hidden="true" href="#0x3-刮开有奖">#</a></h2>
<p>看下题目：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">这是一个赌博程序，快去赚钱吧！！！！！！！！！！！！！！！！！！！！！！！！！！！(在编辑框中的输入值，即为flag，提交即可) 注意：得到的 flag 请包上 flag{} 提交
</code></pre></div><p>先查一下壳：</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210901182834092.png" alt="image-20210901182834092"  />
</p>
<p>没壳，32位的程序，使用IDA pro打开</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__stdcall</span> <span class="nf">WinMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span> <span class="n">LPSTR</span> <span class="n">lpCmdLine</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nShowCmd</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">DialogBoxParamA</span><span class="p">(</span><span class="n">hInstance</span><span class="p">,</span> <span class="p">(</span><span class="n">LPCSTR</span><span class="p">)</span><span class="mh">0x67</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DialogFunc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>看样子是调用了一个WIN32的API函数，关键的代码应该是在DialogFunc函数代码中</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">INT_PTR</span> <span class="kr">__stdcall</span> <span class="nf">DialogFunc</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hDlg</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">a2</span><span class="p">,</span> <span class="n">WPARAM</span> <span class="n">a3</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">a4</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// esi
</span><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">v5</span><span class="p">;</span> <span class="c1">// edi
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v7</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// [esp+8h] [ebp-20030h] BYREF
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [esp+10h] [ebp-20028h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [esp+14h] [ebp-20024h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [esp+18h] [ebp-20020h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// [esp+1Ch] [ebp-2001Ch]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// [esp+20h] [ebp-20018h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v13</span><span class="p">;</span> <span class="c1">// [esp+24h] [ebp-20014h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v14</span><span class="p">;</span> <span class="c1">// [esp+28h] [ebp-20010h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v15</span><span class="p">;</span> <span class="c1">// [esp+2Ch] [ebp-2000Ch]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v16</span><span class="p">;</span> <span class="c1">// [esp+30h] [ebp-20008h]
</span><span class="c1"></span>  <span class="n">CHAR</span> <span class="n">String</span><span class="p">[</span><span class="mi">65536</span><span class="p">];</span> <span class="c1">// [esp+34h] [ebp-20004h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v18</span><span class="p">[</span><span class="mi">65536</span><span class="p">];</span> <span class="c1">// [esp+10034h] [ebp-10004h] BYREF
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">==</span> <span class="mi">272</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">!=</span> <span class="mi">273</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">_WORD</span><span class="p">)</span><span class="n">a3</span> <span class="o">==</span> <span class="mi">1001</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFu</span><span class="p">);</span>
    <span class="n">GetDlgItemTextA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">;</span>
      <span class="n">v7</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">74</span><span class="p">;</span>
      <span class="n">v8</span> <span class="o">=</span> <span class="mi">83</span><span class="p">;</span>
      <span class="n">v9</span> <span class="o">=</span> <span class="mi">69</span><span class="p">;</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="mi">67</span><span class="p">;</span>
      <span class="n">v11</span> <span class="o">=</span> <span class="mi">97</span><span class="p">;</span>
      <span class="n">v12</span> <span class="o">=</span> <span class="mi">78</span><span class="p">;</span>
      <span class="n">v13</span> <span class="o">=</span> <span class="mi">72</span><span class="p">;</span>
      <span class="n">v14</span> <span class="o">=</span> <span class="mi">51</span><span class="p">;</span>
      <span class="n">v15</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span>
      <span class="n">v16</span> <span class="o">=</span> <span class="mi">103</span><span class="p">;</span>
      <span class="n">sub_4010F0</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
      <span class="n">memset</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFu</span><span class="p">);</span>
      <span class="n">v18</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
      <span class="n">v18</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
      <span class="n">v18</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">sub_401000</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">v18</span><span class="p">));</span>
      <span class="n">memset</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFu</span><span class="p">);</span>
      <span class="n">v18</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
      <span class="n">v18</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="n">v18</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">sub_401000</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">v18</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">String</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">34</span>
        <span class="o">&amp;&amp;</span> <span class="n">String</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">v10</span>
        <span class="o">&amp;&amp;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">String</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">141</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">v8</span>
        <span class="o">&amp;&amp;</span> <span class="n">String</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">v13</span> <span class="o">/</span> <span class="mi">9</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="s">&#34;ak1w&#34;</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="s">&#34;V1Ax&#34;</span><span class="p">)</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">MessageBoxA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="s">&#34;U g3t 1T!&#34;</span><span class="p">,</span> <span class="s">&#34;@_@&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">_WORD</span><span class="p">)</span><span class="n">a3</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">_WORD</span><span class="p">)</span><span class="n">a3</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EndDialog</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span><span class="p">)</span><span class="n">a3</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>也是调用了几个WIN32的API，对代码进行分析</p>
<p>可以知道：</p>
<p><code>GetDlgItemTextA</code> 函数是获取输入的字符串</p>
<p>这段代码对字符串进行了处理，主要是有两个处理函数<code>sub_4010F0</code> 和 <code>sub_401000</code></p>
<p>这个函数应该是处理这个程序字符串的关键函数</p>
<p>先来看看sub_4010F0函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">sub_4010F0</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// esi
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// ecx
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// edx
</span><span class="c1"></span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">a3</span><span class="p">;</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v5</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">a1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">&lt;</span> <span class="n">result</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">do</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v6</span> <span class="o">&gt;</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">result</span><span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="o">++</span><span class="n">i</span><span class="p">;</span>
          <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v5</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">result</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">while</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">v6</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">++</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span> <span class="p">)</span>
              <span class="k">goto</span> <span class="n">LABEL_13</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="n">v5</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">;</span>
          <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">result</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">a1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="o">--</span><span class="n">result</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="nl">LABEL_13</span><span class="p">:</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">result</span><span class="p">)</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
    <span class="n">sub_4010F0</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>
    <span class="o">++</span><span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>代码的功能暂时不太清楚，毕竟对C语言的审计功底还是不是很到位，根据代码进行转换为相应的Cpp代码运行一下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">sub_4010F0</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// esi
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// ecx
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// edx
</span><span class="c1"></span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">a3</span><span class="p">;</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">v6</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a2</span> <span class="o">&lt;</span> <span class="n">result</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">v6</span> <span class="o">&gt;</span><span class="n">a1</span><span class="p">[</span><span class="n">result</span><span class="p">])</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="o">++</span><span class="n">i</span><span class="p">;</span>
                    <span class="n">a1</span><span class="p">[</span><span class="n">v5</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">result</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">v6</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span><span class="p">)</span>
                            <span class="k">goto</span> <span class="n">LABEL_13</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">result</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="n">v5</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                    <span class="n">a1</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="o">--</span><span class="n">result</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="nl">LABEL_13</span><span class="p">:</span>
        <span class="n">a1</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
        <span class="n">sub_4010F0</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>
        <span class="o">++</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
	<span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">74</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">83</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">69</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">67</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">97</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">72</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">51</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">103</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v7</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">sub_4010F0</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
    	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
	<span class="n">system</span><span class="p">(</span><span class="s">&#34;PAUSE&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>运行代码，得到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ZJSECaNH3ng
<span class="m">51</span>      <span class="m">67</span>      <span class="m">69</span>      <span class="m">72</span>      <span class="m">74</span>      <span class="m">78</span>      <span class="m">83</span>      <span class="m">90</span>      <span class="m">97</span>      <span class="m">103</span>     <span class="m">110</span>
</code></pre></div><p>看来应该是一个排序算法，按升序进行排序的</p>
<p>下面分析另一个函数具体是个什么东西：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">_BYTE</span> <span class="o">*</span><span class="kr">__cdecl</span> <span class="nf">sub_401000</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// esi
</span><span class="c1"></span>  <span class="n">size_t</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// ebx
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v5</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// edi
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v8</span><span class="p">;</span> <span class="c1">// ebx
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// edi
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// edx
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// edi
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// esi
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v15</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-10h]
</span><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v16</span><span class="p">;</span> <span class="c1">// [esp+10h] [ebp-Ch]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v17</span><span class="p">;</span> <span class="c1">// [esp+14h] [ebp-8h]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v18</span><span class="p">;</span> <span class="c1">// [esp+18h] [ebp-4h]
</span><span class="c1"></span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="o">++</span><span class="n">v2</span><span class="p">;</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">v2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">v4</span><span class="p">);</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
  <span class="n">v15</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v5</span> <span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
  <span class="n">v16</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">do</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">&gt;=</span> <span class="n">v7</span> <span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
        <span class="n">v9</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v3</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">v9</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
        <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span> <span class="n">v10</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">);</span>
      <span class="n">v11</span> <span class="o">=</span> <span class="n">v9</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">v10</span><span class="p">));</span>
      <span class="n">v12</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v17</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span> <span class="n">i</span> <span class="o">-=</span> <span class="mi">6</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v10</span> <span class="o">&gt;=</span> <span class="n">v12</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v18</span> <span class="o">+</span> <span class="n">v12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">v11</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>
          <span class="n">v8</span> <span class="o">=</span> <span class="n">v16</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v18</span> <span class="o">+</span> <span class="n">v12</span><span class="p">)</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">*</span><span class="n">v8</span><span class="o">++</span> <span class="o">=</span> <span class="n">byte_407830</span><span class="p">[</span><span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v18</span> <span class="o">+</span> <span class="n">v12</span><span class="o">++</span><span class="p">)];</span>
        <span class="n">v16</span> <span class="o">=</span> <span class="n">v8</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="n">v17</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v17</span> <span class="o">&gt;=</span> <span class="n">a2</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="n">v7</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="n">v15</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
  <span class="o">*</span><span class="n">v8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>看代码，发现有3和8移位的特征初步推测是base64编码，看到有一个<code>byte_407830</code>的数组，跟进点开查看数据内容</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210901203207491.png" alt="image-20210901203207491"  />
</p>
<p>看到这数据应该就可以断定是base64编码了。</p>
<p>现在知道了两个函数的功能作用，可以直接进行求解，直接定位到判断条件的位置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">if</span> <span class="p">(</span> <span class="n">String</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">34</span>
        <span class="o">&amp;&amp;</span> <span class="n">String</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">v10</span>
        <span class="o">&amp;&amp;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">String</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">141</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">v8</span>
        <span class="o">&amp;&amp;</span> <span class="n">String</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">v13</span> <span class="o">/</span> <span class="mi">9</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="s">&#34;ak1w&#34;</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="s">&#34;V1Ax&#34;</span><span class="p">)</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">MessageBoxA</span><span class="p">(</span><span class="n">hDlg</span><span class="p">,</span> <span class="s">&#34;U g3t 1T!&#34;</span><span class="p">,</span> <span class="s">&#34;@_@&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
</code></pre></div><p>进行简单的推断可以得出</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">String</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">85</span><span class="p">;</span> <span class="c1">// 51+34 = 85
</span><span class="c1"></span><span class="n">String</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">74</span><span class="p">;</span>
<span class="n">String</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">87</span><span class="p">;</span> <span class="c1">//(3 x 69 +141)/4 = 87
</span><span class="c1"></span><span class="n">String</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">80</span><span class="p">;</span><span class="c1">// 2 x (90 / 9) x4 == 80
</span></code></pre></div><p>下面进行base64解码来得到后面四个字符的数据</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">b<span class="s1">&#39;jMp&#39;</span>
b<span class="s1">&#39;WP1&#39;</span>
</code></pre></div><p>根据推断出来的信息可以求解得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">UJWP1jMp
</code></pre></div><hr>
<p>也可以使用Python脚本快速求解</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">base64</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">110</span><span class="p">]</span>
<span class="n">String</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
<span class="n">String</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">34</span><span class="p">)</span>
<span class="n">String</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">String</span> <span class="o">+=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="s2">&#34;V1Ax&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="n">String</span> <span class="o">+=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="s2">&#34;ak1w&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;flag{&#34;</span><span class="o">+</span><span class="n">String</span><span class="o">+</span><span class="s2">&#34;}&#34;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</code></pre></div><p>运行脚本就可以得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{UJWP1jMp}
</code></pre></div><h2 id="0x4-gxyctf2019luck_guy">0x4 [GXYCTF2019]luck_guy<a hidden class="anchor" aria-hidden="true" href="#0x4-gxyctf2019luck_guy">#</a></h2>
<p>文件没有拓展名，感觉是一个ELF格式的文件</p>
<p>先走一下逆向的流程，首先查下壳</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210902074301328.png" alt="image-20210902074301328"  />
</p>
<p>果然是一个ELF文件，64位的文件，用x64 IDA pro打开文件，查看主程序</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-Ch] BYREF
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]
</span><span class="c1"></span>
  <span class="n">v5</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">welcome</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;_________________&#34;</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;try to patch me and find flag&#34;</span><span class="p">);</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;please input a lucky number&#34;</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">);</span>
  <span class="n">patch_me</span><span class="p">(</span><span class="n">v4</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;OK,see you again&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>程序挺简单的，需要寻找一下核心代码</p>
<p>看样子核心代码应该是在<code>patch_me(v4)</code>函数里面，进入函数内部</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">patch_me</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">puts</span><span class="p">(</span><span class="s">&#34;just finished&#34;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">get_flag</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>继续跟进到<code>get_flag()</code>函数里面</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="nf">get_flag</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-3Ch]
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-38h]
</span><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-30h] BYREF
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-28h]
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-8h]
</span><span class="c1"></span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">v0</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0LL</span><span class="p">);</span>
  <span class="n">srand</span><span class="p">(</span><span class="n">v0</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">200</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&#34;OK, it&#39;s flag:&#34;</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x28uLL</span><span class="p">);</span>
        <span class="n">strcat</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="n">f1</span><span class="p">);</span>
        <span class="n">strcat</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">f2</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Solar not like you&#34;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Solar want a girlfriend&#34;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mh">0x7F666F6067756369LL</span><span class="p">;</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">strcat</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f2</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
        <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f2</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="o">--*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f2</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&#34;emmm,you can&#39;t find flag 23333&#34;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v6</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>看来flag应该就在这个函数里面，本来觉得可以使用gdb调试出来，无奈自己太菜了，不知道到gdb怎么修改汇编代码进行跳转，只能进行静态分析调试</p>
<p>进行分析发现，<code>switch</code> 条件的顺序应该是 4 –&gt; 5 —&gt;1的顺序依次输出flag</p>
<p>写一个脚本将flag数据输出</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;GXY{do_not_&#39;</span>
<span class="n">f2</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x6F</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">f2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="n">s</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</code></pre></div><p>运行脚本，得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GXY{do_not_hate_me}
</code></pre></div><h2 id="0x5-findit">0x5 findit<a hidden class="anchor" aria-hidden="true" href="#0x5-findit">#</a></h2>
<p>看下题目哈</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">不知不觉，小明长大了，变成了一个程序员，虽然很苦逼，但是偶尔编写个小东西坑害公司新人还是蛮好玩的。新人小萌一天问小明wifi账号密码，一分钟后，小萌收到了一个文件。小萌想了好久都没得到密码，怎么办，女朋友要买东西，流量告罄，没wifi上不了网，不买就分手，是时候该展现月老的实力了兄弟们！代表月亮惩罚小明！得出答案。 注意：得到的 flag 请包上 flag{} 提交
</code></pre></div><p>感觉像是一道APK的题目，下载附件发现果然是一个APK的题目，使用APK逆向工具jadx进行逆向</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.findit</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.ActionBarActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.MenuItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="o">{</span>
    <span class="cm">/* access modifiers changed from: protected */</span>
    <span class="nd">@Override</span> <span class="c1">// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">EditText</span> <span class="n">edit</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">widget2</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">TextView</span> <span class="n">text</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">widget1</span><span class="o">);</span>
        <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">{</span><span class="sc">&#39;T&#39;</span><span class="o">,</span> <span class="sc">&#39;h&#39;</span><span class="o">,</span> <span class="sc">&#39;i&#39;</span><span class="o">,</span> <span class="sc">&#39;s&#39;</span><span class="o">,</span> <span class="sc">&#39;I&#39;</span><span class="o">,</span> <span class="sc">&#39;s&#39;</span><span class="o">,</span> <span class="sc">&#39;T&#39;</span><span class="o">,</span> <span class="sc">&#39;h&#39;</span><span class="o">,</span> <span class="sc">&#39;e&#39;</span><span class="o">,</span> <span class="sc">&#39;F&#39;</span><span class="o">,</span> <span class="sc">&#39;l&#39;</span><span class="o">,</span> <span class="sc">&#39;a&#39;</span><span class="o">,</span> <span class="sc">&#39;g&#39;</span><span class="o">,</span> <span class="sc">&#39;H&#39;</span><span class="o">,</span> <span class="sc">&#39;o&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;e&#39;</span><span class="o">};</span>
        <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="o">{</span><span class="sc">&#39;p&#39;</span><span class="o">,</span> <span class="sc">&#39;v&#39;</span><span class="o">,</span> <span class="sc">&#39;k&#39;</span><span class="o">,</span> <span class="sc">&#39;q&#39;</span><span class="o">,</span> <span class="sc">&#39;{&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;1&#39;</span><span class="o">,</span> <span class="sc">&#39;6&#39;</span><span class="o">,</span> <span class="sc">&#39;4&#39;</span><span class="o">,</span> <span class="sc">&#39;6&#39;</span><span class="o">,</span> <span class="sc">&#39;7&#39;</span><span class="o">,</span> <span class="sc">&#39;5&#39;</span><span class="o">,</span> <span class="sc">&#39;2&#39;</span><span class="o">,</span> <span class="sc">&#39;6&#39;</span><span class="o">,</span> <span class="sc">&#39;2&#39;</span><span class="o">,</span> <span class="sc">&#39;0&#39;</span><span class="o">,</span> <span class="sc">&#39;3&#39;</span><span class="o">,</span> <span class="sc">&#39;3&#39;</span><span class="o">,</span> <span class="sc">&#39;l&#39;</span><span class="o">,</span> <span class="sc">&#39;4&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;4&#39;</span><span class="o">,</span> <span class="sc">&#39;9&#39;</span><span class="o">,</span> <span class="sc">&#39;l&#39;</span><span class="o">,</span> <span class="sc">&#39;n&#39;</span><span class="o">,</span> <span class="sc">&#39;p&#39;</span><span class="o">,</span> <span class="sc">&#39;7&#39;</span><span class="o">,</span> <span class="sc">&#39;p&#39;</span><span class="o">,</span> <span class="sc">&#39;9&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;n&#39;</span><span class="o">,</span> <span class="sc">&#39;k&#39;</span><span class="o">,</span> <span class="sc">&#39;2&#39;</span><span class="o">,</span> <span class="sc">&#39;8&#39;</span><span class="o">,</span> <span class="sc">&#39;k&#39;</span><span class="o">,</span> <span class="sc">&#39;7&#39;</span><span class="o">,</span> <span class="sc">&#39;5&#39;</span><span class="o">,</span> <span class="sc">&#39;}&#39;</span><span class="o">};</span>
        <span class="o">((</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">widget3</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/* class com.example.findit.MainActivity.AnonymousClass1 */</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">char</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">17</span><span class="o">];</span>
                <span class="kt">char</span><span class="o">[]</span> <span class="n">y</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">38</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">17</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">((</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;I&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;=</span> <span class="sc">&#39;A&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;i&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;=</span> <span class="sc">&#39;a&#39;</span><span class="o">))</span> <span class="o">{</span>
                        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">18</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">((</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;A&#39;</span> <span class="o">||</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span> <span class="o">||</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;z&#39;</span><span class="o">))</span> <span class="o">{</span>
                        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="sc">&#39;\b&#39;</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">x</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">edit</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">()))</span> <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">38</span><span class="o">;</span> <span class="n">i2</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">((</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;A&#39;</span> <span class="o">||</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span> <span class="o">||</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;z&#39;</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">];</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">+</span> <span class="n">16</span><span class="o">);</span>
                            <span class="k">if</span> <span class="o">((</span><span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;=</span> <span class="sc">&#39;z&#39;</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">-</span> <span class="n">26</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">y</span><span class="o">));</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&#34;答案错了肿么办。。。不给你又不好意思。。。哎呀好纠结啊~~~&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">action_settings</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>看样子好像是一个简单的加密程序，可以进行简单的分析</p>
<p>发现主要的flag代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">38</span><span class="o">;</span> <span class="n">i2</span><span class="o">++)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;A&#39;</span> <span class="o">||</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span> <span class="o">||</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;z&#39;</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">];</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">+</span> <span class="n">16</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">((</span><span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;=</span> <span class="sc">&#39;z&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">-</span> <span class="n">26</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">y</span><span class="o">));</span>
<span class="k">return</span><span class="o">;</span>
</code></pre></div><p>这行代码稍加修改一下运行就可以直接俄得到flag了，写个Java的flag生成器，来生成flag吧！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">re</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Findit</span> <span class="o">{</span>
	<span class="kd">final</span> <span class="kd">static</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="o">{</span><span class="sc">&#39;p&#39;</span><span class="o">,</span> <span class="sc">&#39;v&#39;</span><span class="o">,</span> <span class="sc">&#39;k&#39;</span><span class="o">,</span> <span class="sc">&#39;q&#39;</span><span class="o">,</span> <span class="sc">&#39;{&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;1&#39;</span><span class="o">,</span> <span class="sc">&#39;6&#39;</span><span class="o">,</span> <span class="sc">&#39;4&#39;</span><span class="o">,</span> <span class="sc">&#39;6&#39;</span><span class="o">,</span> <span class="sc">&#39;7&#39;</span><span class="o">,</span> <span class="sc">&#39;5&#39;</span><span class="o">,</span> <span class="sc">&#39;2&#39;</span><span class="o">,</span> <span class="sc">&#39;6&#39;</span><span class="o">,</span> <span class="sc">&#39;2&#39;</span><span class="o">,</span> <span class="sc">&#39;0&#39;</span><span class="o">,</span> <span class="sc">&#39;3&#39;</span><span class="o">,</span> <span class="sc">&#39;3&#39;</span><span class="o">,</span> <span class="sc">&#39;l&#39;</span><span class="o">,</span> <span class="sc">&#39;4&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;4&#39;</span><span class="o">,</span> <span class="sc">&#39;9&#39;</span><span class="o">,</span> <span class="sc">&#39;l&#39;</span><span class="o">,</span> <span class="sc">&#39;n&#39;</span><span class="o">,</span> <span class="sc">&#39;p&#39;</span><span class="o">,</span> <span class="sc">&#39;7&#39;</span><span class="o">,</span> <span class="sc">&#39;p&#39;</span><span class="o">,</span> <span class="sc">&#39;9&#39;</span><span class="o">,</span> <span class="sc">&#39;m&#39;</span><span class="o">,</span> <span class="sc">&#39;n&#39;</span><span class="o">,</span> <span class="sc">&#39;k&#39;</span><span class="o">,</span> <span class="sc">&#39;2&#39;</span><span class="o">,</span> <span class="sc">&#39;8&#39;</span><span class="o">,</span> <span class="sc">&#39;k&#39;</span><span class="o">,</span> <span class="sc">&#39;7&#39;</span><span class="o">,</span> <span class="sc">&#39;5&#39;</span><span class="o">,</span> <span class="sc">&#39;}&#39;</span><span class="o">};</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="kt">char</span><span class="o">[]</span> <span class="n">y</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">38</span><span class="o">];</span>
		
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">38</span><span class="o">;</span> <span class="n">i2</span><span class="o">++)</span> <span class="o">{</span>
	        <span class="k">if</span> <span class="o">((</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;A&#39;</span> <span class="o">||</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span> <span class="o">||</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;z&#39;</span><span class="o">))</span> <span class="o">{</span>
	            <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">];</span>
	        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	            <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">+</span> <span class="n">16</span><span class="o">);</span>
	            <span class="k">if</span> <span class="o">((</span><span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;</span> <span class="sc">&#39;Z&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&lt;</span> <span class="sc">&#39;a&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">&gt;=</span> <span class="sc">&#39;z&#39;</span><span class="o">)</span> <span class="o">{</span>
	                <span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span><span class="o">[</span><span class="n">i2</span><span class="o">]</span> <span class="o">-</span> <span class="n">26</span><span class="o">);</span>
	            <span class="o">}</span>
	        <span class="o">}</span>
	    <span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">y</span><span class="o">));</span>
	<span class="o">}</span>	
<span class="o">}</span>
</code></pre></div><p>运行一下这个java程序就能生成flag啦！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{c164675262033b4c49bdf7f9cda28a75}
</code></pre></div><h2 id="0x6-简单的注册器">0x6 简单的注册器<a hidden class="anchor" aria-hidden="true" href="#0x6-简单的注册器">#</a></h2>
<p>看下题目</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">生活中难免会有需要使用一些付费的程序，但是没有绿色版怎么办？只能自己逆向看看注册程序的代码是什么逻辑了。 注意：得到的 flag 请包上 flag{} 提交
</code></pre></div><p>下载附件，发现是一个apk文件，使用apk逆向工具jadx查看apk的伪代码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.flag</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.app.Fragment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.ActionBarActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.LayoutInflater</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.Menu</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.MenuItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.ViewGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="o">{</span>
    <span class="cm">/* access modifiers changed from: protected */</span>
    <span class="nd">@Override</span> <span class="c1">// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">savedInstanceState</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">getSupportFragmentManager</span><span class="o">().</span><span class="na">beginTransaction</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">container</span><span class="o">,</span> <span class="k">new</span> <span class="n">PlaceholderFragment</span><span class="o">()).</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">final</span> <span class="n">TextView</span> <span class="n">textview</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView1</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">EditText</span> <span class="n">editview</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText1</span><span class="o">);</span>
        <span class="o">((</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button1</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/* class com.example.flag.MainActivity.AnonymousClass1 */</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
                <span class="n">String</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">editview</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(!(</span><span class="n">xx</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="n">32</span> <span class="o">&amp;&amp;</span> <span class="n">xx</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">31</span><span class="o">)</span> <span class="o">==</span> <span class="sc">&#39;a&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">xx</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">1</span><span class="o">)</span> <span class="o">==</span> <span class="sc">&#39;b&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">xx</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">0</span><span class="o">)</span> <span class="o">+</span> <span class="n">xx</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">2</span><span class="o">))</span> <span class="o">-</span> <span class="n">48</span> <span class="o">==</span> <span class="n">56</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">flag</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">char</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;dd2940c04462b4dd7c450528835cca15&#34;</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
                    <span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">3</span><span class="o">])</span> <span class="o">-</span> <span class="n">50</span><span class="o">);</span>
                    <span class="n">x</span><span class="o">[</span><span class="n">4</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">5</span><span class="o">])</span> <span class="o">-</span> <span class="n">48</span><span class="o">);</span>
                    <span class="n">x</span><span class="o">[</span><span class="n">30</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">31</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">9</span><span class="o">])</span> <span class="o">-</span> <span class="n">48</span><span class="o">);</span>
                    <span class="n">x</span><span class="o">[</span><span class="n">14</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">27</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">28</span><span class="o">])</span> <span class="o">-</span> <span class="n">97</span><span class="o">);</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">16</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">31</span> <span class="o">-</span> <span class="n">i</span><span class="o">];</span>
                        <span class="n">x</span><span class="o">[</span><span class="n">31</span> <span class="o">-</span> <span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="n">textview</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&#34;flag{&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;}&#34;</span><span class="o">);</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">textview</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&#34;输入注册码错误&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">getMenuInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">main</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">action_settings</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PlaceholderFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
        <span class="nd">@Override</span> <span class="c1">// android.support.v4.app.Fragment
</span><span class="c1"></span>        <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_main</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>进行简单的代码审计，可以确定核心代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">flag</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">char</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;dd2940c04462b4dd7c450528835cca15&#34;</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">3</span><span class="o">])</span> <span class="o">-</span> <span class="n">50</span><span class="o">);</span>
    <span class="n">x</span><span class="o">[</span><span class="n">4</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">5</span><span class="o">])</span> <span class="o">-</span> <span class="n">48</span><span class="o">);</span>
    <span class="n">x</span><span class="o">[</span><span class="n">30</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">31</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">9</span><span class="o">])</span> <span class="o">-</span> <span class="n">48</span><span class="o">);</span>
    <span class="n">x</span><span class="o">[</span><span class="n">14</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">27</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">28</span><span class="o">])</span> <span class="o">-</span> <span class="n">97</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">16</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">31</span> <span class="o">-</span> <span class="n">i</span><span class="o">];</span>
        <span class="n">x</span><span class="o">[</span><span class="n">31</span> <span class="o">-</span> <span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">textview</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&#34;flag{&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;}&#34;</span><span class="o">);</span>
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p>写一个Java注册器，把flag注册出来</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">re</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Register</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="kt">char</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;dd2940c04462b4dd7c450528835cca15&#34;</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
	    <span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">3</span><span class="o">])</span> <span class="o">-</span> <span class="n">50</span><span class="o">);</span>
	    <span class="n">x</span><span class="o">[</span><span class="n">4</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">5</span><span class="o">])</span> <span class="o">-</span> <span class="n">48</span><span class="o">);</span>
	    <span class="n">x</span><span class="o">[</span><span class="n">30</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">31</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">9</span><span class="o">])</span> <span class="o">-</span> <span class="n">48</span><span class="o">);</span>
	    <span class="n">x</span><span class="o">[</span><span class="n">14</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">x</span><span class="o">[</span><span class="n">27</span><span class="o">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="n">28</span><span class="o">])</span> <span class="o">-</span> <span class="n">97</span><span class="o">);</span>
	    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">16</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	        <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">31</span> <span class="o">-</span> <span class="n">i</span><span class="o">];</span>
	        <span class="n">x</span><span class="o">[</span><span class="n">31</span> <span class="o">-</span> <span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
	        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
	    <span class="o">}</span>
	    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;flag{&#34;</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;}&#34;</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><p>运行注册器来注册一个flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">flag{59acc538825054c7de4b26440c0999dd}
</code></pre></div><h2 id="0x7-bjdctf2020justre">0x7 [BJDCTF2020]JustRE<a hidden class="anchor" aria-hidden="true" href="#0x7-bjdctf2020justre">#</a></h2>
<p>下载下来是一个挺有意思的exe程序</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210902121321802.png" alt="image-20210902121321802"  />
</p>
<p>走下流程，首先是查询文件</p>
<p><img loading="lazy" src="/images/BUUCTF-REVERSE-[9-16]_writeup/image-20210902121542969.png" alt="image-20210902121542969"  />
</p>
<p>32位的PE程序，使用IDA pro反汇编通过检索BJD的字符串来定位到核心代码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">INT_PTR</span> <span class="kr">__stdcall</span> <span class="nf">DialogFunc</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">a2</span><span class="p">,</span> <span class="n">WPARAM</span> <span class="n">a3</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">a4</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">CHAR</span> <span class="n">String</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span> <span class="c1">// [esp+0h] [ebp-64h] BYREF
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">!=</span> <span class="mi">272</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">a2</span> <span class="o">!=</span> <span class="mi">273</span> <span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">_WORD</span><span class="p">)</span><span class="n">a3</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">_WORD</span><span class="p">)</span><span class="n">a3</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">sprintf</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">Format</span><span class="p">,</span> <span class="o">++</span><span class="n">dword_4099F0</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">dword_4099F0</span> <span class="o">==</span> <span class="mi">19999</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34; BJD{%d%d2069a45792d233ac}&#34;</span><span class="p">,</span> <span class="mi">19999</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">SetWindowTextA</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">String</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">SetWindowTextA</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">String</span><span class="p">);</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">EndDialog</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int16</span><span class="p">)</span><span class="n">a3</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>发现核心代码中隐藏着flag的信息，得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">BJD{1999902069a45792d233ac}
</code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.codetea.top/tags/ctf/">ctf</a></li>
      <li><a href="https://www.codetea.top/tags/writeup/">writeup</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.codetea.top/posts/buuctf-reverse-17-24_writeup/">
    <span class="title">« Prev</span>
    <br>
    <span>BUUCTF REVERSE [17~24]_Writeup</span>
  </a>
  <a class="next" href="https://www.codetea.top/posts/xctf-reverse-novice_writeup/">
    <span class="title">Next »</span>
    <br>
    <span>XCTF REVERSE novice_writeup</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share BUUCTF REVERSE [9~16]_Writeup on twitter"
        href="https://twitter.com/intent/tweet/?text=BUUCTF%20REVERSE%20%5b9~16%5d_Writeup&amp;url=https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f&amp;hashtags=ctf%2cwriteup">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share BUUCTF REVERSE [9~16]_Writeup on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f&amp;title=BUUCTF%20REVERSE%20%5b9~16%5d_Writeup&amp;summary=BUUCTF%20REVERSE%20%5b9~16%5d_Writeup&amp;source=https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share BUUCTF REVERSE [9~16]_Writeup on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f&title=BUUCTF%20REVERSE%20%5b9~16%5d_Writeup">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share BUUCTF REVERSE [9~16]_Writeup on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share BUUCTF REVERSE [9~16]_Writeup on whatsapp"
        href="https://api.whatsapp.com/send?text=BUUCTF%20REVERSE%20%5b9~16%5d_Writeup%20-%20https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share BUUCTF REVERSE [9~16]_Writeup on telegram"
        href="https://telegram.me/share/url?text=BUUCTF%20REVERSE%20%5b9~16%5d_Writeup&amp;url=https%3a%2f%2fwww.codetea.top%2fposts%2fbuuctf-reverse-9-16_writeup%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.codetea.top/">OPdbgBytes</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
