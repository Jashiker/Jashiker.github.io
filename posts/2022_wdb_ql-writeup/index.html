<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2022 网鼎杯 青龙组 Writeup | Jasmine❀Hiker</title><meta name=keywords content="writeup,ctf"><meta name=description content="2022 网鼎杯 青龙组 Writeup 今年网鼎杯的逆向题目是相对来说比较简单的，在比赛的时候做出了两道逆向题目。
第二道逆向apk的题目找到文章了，但是去看Crypto的题目了，也就没有认真去钻逆向的那道题目。
Crypto题目由于自身的数学敏感度不够没能解出，还需要继续提高
解出 fakeshell 题目给到了一个exe文件，使用die查看该文件：
发现是一个upx压缩壳加密的程序，尝试使用upx脱壳：
发现壳可能被修改过，需要手动脱壳。先尝试运行下程序，寻找下可能存在的锚点字符串信息：
找到两个锚点字符串，一个是<<Input your flag:，另一个是Wrong.
使用x64dbg进行手动脱壳，进行入口点的测试找到一个关键跳转地址0x1400276CB
这是一个长跳转指令，运行到这个指令的时候程序已经完成解密。可以对程序的内存引用进行查看：
发现程序的内存引用中已经出现了锚点字符串，说明此时的程序已经完成了解密。然后跟进到锚点字符串所在的函数位置：
这个位置应该是主函数空间，在这个主函数空间中对函数开头位置下断点，然后让程序运行到断点位置
然后使用x64dbg的Scylla插件进行dump内存：
从当前位置进行dump即可，得到一个dump的程序。
现在完成手动脱壳，进入到下一步，进行ida pro的静态分析：
使用F5插件来查看程序反编译的代码进行分析
输入的数据存储到v4变量中，对v4变量处理的函数有两个，对这两个函数依次进行审计。
首先分析第一个函数，这个函数要一直跟进跟进到和参数有关的位置
第一个函数中，存在一个判断和一个异或运算。
判断是对输入的数据进行了处理，猜测应该是进行长度判断，判断长度是否是20位。
异或操作是单纯对于输入数据的运行对于程序运行流程没有太多影响
分析第二个函数，和第一个函数的跟进方法类似
第二个函数同样也有一个异或操作和一个特殊的函数，跟进这个函数查看：
发现判断的位置有密文，跟进密文查看：
使用shift+ E将数据提取出来，可以得到：
unsigned char ida_chars[] = { 0x4B, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x45, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x5C, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x6D, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x5D, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; 显然是以4字节，小端序存储的"><meta name=author content="Me"><link rel=canonical href=https://oolongcode.github.io/posts/2022_wdb_ql-writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://oolongcode.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://oolongcode.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://oolongcode.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://oolongcode.github.io/apple-touch-icon.png><link rel=mask-icon href=https://oolongcode.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="2022 网鼎杯 青龙组 Writeup"><meta property="og:description" content="2022 网鼎杯 青龙组 Writeup 今年网鼎杯的逆向题目是相对来说比较简单的，在比赛的时候做出了两道逆向题目。
第二道逆向apk的题目找到文章了，但是去看Crypto的题目了，也就没有认真去钻逆向的那道题目。
Crypto题目由于自身的数学敏感度不够没能解出，还需要继续提高
解出 fakeshell 题目给到了一个exe文件，使用die查看该文件：
发现是一个upx压缩壳加密的程序，尝试使用upx脱壳：
发现壳可能被修改过，需要手动脱壳。先尝试运行下程序，寻找下可能存在的锚点字符串信息：
找到两个锚点字符串，一个是<<Input your flag:，另一个是Wrong.
使用x64dbg进行手动脱壳，进行入口点的测试找到一个关键跳转地址0x1400276CB
这是一个长跳转指令，运行到这个指令的时候程序已经完成解密。可以对程序的内存引用进行查看：
发现程序的内存引用中已经出现了锚点字符串，说明此时的程序已经完成了解密。然后跟进到锚点字符串所在的函数位置：
这个位置应该是主函数空间，在这个主函数空间中对函数开头位置下断点，然后让程序运行到断点位置
然后使用x64dbg的Scylla插件进行dump内存：
从当前位置进行dump即可，得到一个dump的程序。
现在完成手动脱壳，进入到下一步，进行ida pro的静态分析：
使用F5插件来查看程序反编译的代码进行分析
输入的数据存储到v4变量中，对v4变量处理的函数有两个，对这两个函数依次进行审计。
首先分析第一个函数，这个函数要一直跟进跟进到和参数有关的位置
第一个函数中，存在一个判断和一个异或运算。
判断是对输入的数据进行了处理，猜测应该是进行长度判断，判断长度是否是20位。
异或操作是单纯对于输入数据的运行对于程序运行流程没有太多影响
分析第二个函数，和第一个函数的跟进方法类似
第二个函数同样也有一个异或操作和一个特殊的函数，跟进这个函数查看：
发现判断的位置有密文，跟进密文查看：
使用shift+ E将数据提取出来，可以得到：
unsigned char ida_chars[] = { 0x4B, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x45, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x5C, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x6D, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x5D, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; 显然是以4字节，小端序存储的"><meta property="og:type" content="article"><meta property="og:url" content="https://oolongcode.github.io/posts/2022_wdb_ql-writeup/"><meta property="og:image" content="https://oolongcode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-31T17:28:44+08:00"><meta property="article:modified_time" content="2022-08-31T17:28:44+08:00"><meta property="og:site_name" content="Jasmine❀Hiker"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://oolongcode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="2022 网鼎杯 青龙组 Writeup"><meta name=twitter:description content="2022 网鼎杯 青龙组 Writeup 今年网鼎杯的逆向题目是相对来说比较简单的，在比赛的时候做出了两道逆向题目。
第二道逆向apk的题目找到文章了，但是去看Crypto的题目了，也就没有认真去钻逆向的那道题目。
Crypto题目由于自身的数学敏感度不够没能解出，还需要继续提高
解出 fakeshell 题目给到了一个exe文件，使用die查看该文件：
发现是一个upx压缩壳加密的程序，尝试使用upx脱壳：
发现壳可能被修改过，需要手动脱壳。先尝试运行下程序，寻找下可能存在的锚点字符串信息：
找到两个锚点字符串，一个是<<Input your flag:，另一个是Wrong.
使用x64dbg进行手动脱壳，进行入口点的测试找到一个关键跳转地址0x1400276CB
这是一个长跳转指令，运行到这个指令的时候程序已经完成解密。可以对程序的内存引用进行查看：
发现程序的内存引用中已经出现了锚点字符串，说明此时的程序已经完成了解密。然后跟进到锚点字符串所在的函数位置：
这个位置应该是主函数空间，在这个主函数空间中对函数开头位置下断点，然后让程序运行到断点位置
然后使用x64dbg的Scylla插件进行dump内存：
从当前位置进行dump即可，得到一个dump的程序。
现在完成手动脱壳，进入到下一步，进行ida pro的静态分析：
使用F5插件来查看程序反编译的代码进行分析
输入的数据存储到v4变量中，对v4变量处理的函数有两个，对这两个函数依次进行审计。
首先分析第一个函数，这个函数要一直跟进跟进到和参数有关的位置
第一个函数中，存在一个判断和一个异或运算。
判断是对输入的数据进行了处理，猜测应该是进行长度判断，判断长度是否是20位。
异或操作是单纯对于输入数据的运行对于程序运行流程没有太多影响
分析第二个函数，和第一个函数的跟进方法类似
第二个函数同样也有一个异或操作和一个特殊的函数，跟进这个函数查看：
发现判断的位置有密文，跟进密文查看：
使用shift+ E将数据提取出来，可以得到：
unsigned char ida_chars[] = { 0x4B, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x45, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x5C, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x6D, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x5D, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; 显然是以4字节，小端序存储的"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://oolongcode.github.io/posts/"},{"@type":"ListItem","position":3,"name":"2022 网鼎杯 青龙组 Writeup","item":"https://oolongcode.github.io/posts/2022_wdb_ql-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2022 网鼎杯 青龙组 Writeup","name":"2022 网鼎杯 青龙组 Writeup","description":"2022 网鼎杯 青龙组 Writeup 今年网鼎杯的逆向题目是相对来说比较简单的，在比赛的时候做出了两道逆向题目。\n第二道逆向apk的题目找到文章了，但是去看Crypto的题目了，也就没有认真去钻逆向的那道题目。\nCrypto题目由于自身的数学敏感度不够没能解出，还需要继续提高\n解出 fakeshell 题目给到了一个exe文件，使用die查看该文件：\n发现是一个upx压缩壳加密的程序，尝试使用upx脱壳：\n发现壳可能被修改过，需要手动脱壳。先尝试运行下程序，寻找下可能存在的锚点字符串信息：\n找到两个锚点字符串，一个是\u0026lt;\u0026lt;Input your flag:，另一个是Wrong.\n使用x64dbg进行手动脱壳，进行入口点的测试找到一个关键跳转地址0x1400276CB\n这是一个长跳转指令，运行到这个指令的时候程序已经完成解密。可以对程序的内存引用进行查看：\n发现程序的内存引用中已经出现了锚点字符串，说明此时的程序已经完成了解密。然后跟进到锚点字符串所在的函数位置：\n这个位置应该是主函数空间，在这个主函数空间中对函数开头位置下断点，然后让程序运行到断点位置\n然后使用x64dbg的Scylla插件进行dump内存：\n从当前位置进行dump即可，得到一个dump的程序。\n现在完成手动脱壳，进入到下一步，进行ida pro的静态分析：\n使用F5插件来查看程序反编译的代码进行分析\n输入的数据存储到v4变量中，对v4变量处理的函数有两个，对这两个函数依次进行审计。\n首先分析第一个函数，这个函数要一直跟进跟进到和参数有关的位置\n第一个函数中，存在一个判断和一个异或运算。\n判断是对输入的数据进行了处理，猜测应该是进行长度判断，判断长度是否是20位。\n异或操作是单纯对于输入数据的运行对于程序运行流程没有太多影响\n分析第二个函数，和第一个函数的跟进方法类似\n第二个函数同样也有一个异或操作和一个特殊的函数，跟进这个函数查看：\n发现判断的位置有密文，跟进密文查看：\n使用shift+ E将数据提取出来，可以得到：\nunsigned char ida_chars[] = { 0x4B, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x45, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x5C, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x79, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x6D, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x5D, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; 显然是以4字节，小端序存储的","keywords":["writeup","ctf"],"articleBody":"2022 网鼎杯 青龙组 Writeup 今年网鼎杯的逆向题目是相对来说比较简单的，在比赛的时候做出了两道逆向题目。\n第二道逆向apk的题目找到文章了，但是去看Crypto的题目了，也就没有认真去钻逆向的那道题目。\nCrypto题目由于自身的数学敏感度不够没能解出，还需要继续提高\n解出 fakeshell 题目给到了一个exe文件，使用die查看该文件：\n发现是一个upx压缩壳加密的程序，尝试使用upx脱壳：\n发现壳可能被修改过，需要手动脱壳。先尝试运行下程序，寻找下可能存在的锚点字符串信息：\n找到两个锚点字符串，一个是\u003c","wordCount":"1902","inLanguage":"en","datePublished":"2022-08-31T17:28:44+08:00","dateModified":"2022-08-31T17:28:44+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://oolongcode.github.io/posts/2022_wdb_ql-writeup/"},"publisher":{"@type":"Organization","name":"Jasmine❀Hiker","logo":{"@type":"ImageObject","url":"https://oolongcode.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://oolongcode.github.io accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://oolongcode.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://oolongcode.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://oolongcode.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://oolongcode.github.io/about/ title=About><span>About</span></a></li><li><a href=https://oolongcode.github.io/link/ title=Link><span>Link</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://oolongcode.github.io>Home</a>&nbsp;»&nbsp;<a href=https://oolongcode.github.io/posts/>Posts</a></div><h1 class=post-title>2022 网鼎杯 青龙组 Writeup</h1><div class=post-meta><span title='2022-08-31 17:28:44 +0800 CST'>August 31, 2022</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1902 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#2022-%e7%bd%91%e9%bc%8e%e6%9d%af-%e9%9d%92%e9%be%99%e7%bb%84-writeup aria-label="2022 网鼎杯 青龙组 Writeup">2022 网鼎杯 青龙组 Writeup</a><ul><li><a href=#%e8%a7%a3%e5%87%ba aria-label=解出>解出</a><ul><li><a href=#fakeshell aria-label=fakeshell>fakeshell</a></li><li><a href=#handmake aria-label=Handmake>Handmake</a></li></ul></li><li><a href=#%e5%a4%8d%e7%8e%b0 aria-label=复现>复现</a><ul><li><a href=#crypto091 aria-label=Crypto091>Crypto091</a></li><li><a href=#grasshopper aria-label=grasshopper>grasshopper</a></li><li><a href=#david_homework aria-label=david_homework>david_homework</a></li><li><a href=#whereiscode aria-label=whereiscode>whereiscode</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=2022-网鼎杯-青龙组-writeup>2022 网鼎杯 青龙组 Writeup<a hidden class=anchor aria-hidden=true href=#2022-网鼎杯-青龙组-writeup>#</a></h1><p>今年网鼎杯的逆向题目是相对来说比较简单的，在比赛的时候做出了两道逆向题目。</p><p>第二道逆向apk的题目找到文章了，但是去看Crypto的题目了，也就没有认真去钻逆向的那道题目。</p><p>Crypto题目由于自身的数学敏感度不够没能解出，还需要继续提高</p><h2 id=解出>解出<a hidden class=anchor aria-hidden=true href=#解出>#</a></h2><h3 id=fakeshell>fakeshell<a hidden class=anchor aria-hidden=true href=#fakeshell>#</a></h3><p>题目给到了一个exe文件，使用die查看该文件：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828123956402.png alt=image-20220828123956402></p><p>发现是一个upx压缩壳加密的程序，尝试使用upx脱壳：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828133038392.png alt=image-20220828133038392></p><p>发现壳可能被修改过，需要手动脱壳。先尝试运行下程序，寻找下可能存在的锚点字符串信息：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828140533175.png alt=image-20220828140533175></p><p>找到两个锚点字符串，一个是<code>&lt;&lt;Input your flag:</code>，另一个是<code>Wrong.</code></p><p>使用x64dbg进行手动脱壳，进行入口点的测试找到一个关键跳转地址0x1400276CB</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828140317972.png alt=image-20220828140317972></p><p>这是一个长跳转指令，运行到这个指令的时候程序已经完成解密。可以对程序的内存引用进行查看：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828140739058.png alt=image-20220828140739058></p><p>发现程序的内存引用中已经出现了锚点字符串，说明此时的程序已经完成了解密。然后跟进到锚点字符串所在的函数位置：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828140905779.png alt=image-20220828140905779></p><p>这个位置应该是主函数空间，在这个主函数空间中对函数开头位置下断点，然后让程序运行到断点位置</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828141834266.png alt=image-20220828141834266></p><p>然后使用x64dbg的Scylla插件进行dump内存：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828142149592.png alt=image-20220828142149592></p><p>从当前位置进行dump即可，得到一个dump的程序。</p><p>现在完成手动脱壳，进入到下一步，进行ida pro的静态分析：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828142350437.png alt=image-20220828142350437></p><p>使用F5插件来查看程序反编译的代码进行分析</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828142457029.png alt=image-20220828142457029></p><p>输入的数据存储到v4变量中，对v4变量处理的函数有两个，对这两个函数依次进行审计。</p><p>首先分析第一个函数，这个函数要一直跟进跟进到和参数有关的位置</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828142835318.png alt=image-20220828142835318></p><p>第一个函数中，存在一个判断和一个异或运算。</p><p>判断是对输入的数据进行了处理，猜测应该是进行长度判断，判断长度是否是20位。</p><p>异或操作是单纯对于输入数据的运行对于程序运行流程没有太多影响</p><p>分析第二个函数，和第一个函数的跟进方法类似</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828144648807.png alt=image-20220828144648807></p><p>第二个函数同样也有一个异或操作和一个特殊的函数，跟进这个函数查看：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828145157336.png alt=image-20220828145157336></p><p>发现判断的位置有密文，跟进密文查看：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828145310441.png alt=image-20220828145310441></p><p>使用<code>shift</code>+ <code>E</code>将数据提取出来，可以得到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>ida_chars</span><span class=p>[]</span> <span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>显然是以4字节，小端序存储的</p><p>现在获取的密文和两次运算，编写脚本：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>c</span><span class=p>[::</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=mh>0x14</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x14</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(((</span><span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=mh>0x50</span><span class=p>)</span><span class=o>-</span><span class=mi>10</span><span class=p>)</span><span class=o>^</span><span class=mh>0x66</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>flag</span><span class=p>))</span>
</span></span></code></pre></div><p>运行得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>why_m0dify_pUx_SheLL
</span></span></code></pre></div><h3 id=handmake>Handmake<a hidden class=anchor aria-hidden=true href=#handmake>#</a></h3><p>这道题目是手工，应该是需要手工寻找一些内容</p><p>题目给到了一个go程序的源码：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828150430370.png alt=image-20220828150430370></p><p>总共有大约15w行的代码，尝试编译运行：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828150855335.png alt=image-20220828150855335></p><p>应该是英文的阅读理解找函数的题目，理解这两句话的意思就可以求解。</p><p><code>Input the first function, which has 6 parameters and the third named gLIhR:</code></p><p>这句话就是找到一个有六个参数的函数而且第三个参数是<code>gLIhR</code></p><p><code>Input the second function, which has 3 callers and invokes the function named cHZv5op8rOmlAkb6:</code></p><p>这句话就是找到一个函数，这个函数被调用了3次并且调用了一个名为<code>cHZv5op8rOmlAkb6</code>函数。</p><p>根据要求去寻找函数名：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828151548954.png alt=image-20220828151548954></p><p>然后进行程序的测试就可以得到flag：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828151706620.png alt=image-20220828151706620></p><h2 id=复现>复现<a hidden class=anchor aria-hidden=true href=#复现>#</a></h2><h3 id=crypto091>Crypto091<a hidden class=anchor aria-hidden=true href=#crypto091>#</a></h3><p>这道题目被队友解答，我就没有进行看了，赛后进行复现下</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828152017556.png alt=image-20220828152017556></p><p>这道题目要寻找到关键信息，本道题目的关键信息有：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>170号段首批放号的联通号码
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Hash：
</span></span><span class=line><span class=cl>c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag格式：flag{13位电话号码（纯数字，含国家代码）}
</span></span></code></pre></div><p>使用搜索引擎进行查找：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828153105747.png alt=image-20220828153105747></p><p>1709是首批号码段，下面是对hash的类型进行猜测，首先看看哈希的长度：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828153953231.png alt=image-20220828153953231></p><p>hash数据的长度是64位可能是sha256加密，可以使用hacker工具Hashcat进行爆破求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hashcat -m <span class=m>1400</span> -a <span class=m>3</span> c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc 861709?d?d?d?d?d?d?d
</span></span></code></pre></div><p>运行得到：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220828155215870.png alt=image-20220828155215870></p><p>由此可以得到tel是8617091733716，故flag是<code>flag{8617091733716}</code></p><h3 id=grasshopper>grasshopper<a hidden class=anchor aria-hidden=true href=#grasshopper>#</a></h3><blockquote><p>这道题目当时代码没有审计清楚，采用Z3-solver进行求解，未能求解成功</p></blockquote><p>题目给到一个python源码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randrange</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>grassfield</span> <span class=kn>import</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>k</span> <span class=o>=</span> <span class=p>[</span><span class=n>randrange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>flag</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>grasshopper</span> <span class=o>=</span> <span class=n>flag</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>grasshopper</span> <span class=o>=</span> <span class=n>grasshopper</span> <span class=o>*</span> <span class=n>k</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Grasshopper#&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;:&#39;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>grasshopper</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span></code></pre></div><p>进行审计可以发现：</p><p>$$
k_{10} = g_0 = C_0 \cdot k_{00}\ \text{mod}\ p \\
k_{11} = g_0 = C_0 \cdot k_{00} \cdot k_{01}\ \text{mod}\ p \\
k_{12} = g_0 = C_0 \cdot k_{00} \cdot k_{01}\cdot k_{02}\ \text{mod}\ p \\
k_{13} = g_0 = C_0 \cdot k_{00} \cdot k_{01}\cdot k_{02}\cdot k_{03}\ \text{mod}\ p \\
k_{14} = g_0 = C_0 \cdot k_{00} \cdot k_{01}\cdot k_{02}\cdot k_{03} \cdot k_{04}\ \text{mod}\ p \\
$$</p><p>$$
k_{20} = g_0 = C_1 \cdot k_{10}\ \text{mod}\ p \\
k_{21} = g_0 = C_1 \cdot k_{10} \cdot k_{11}\ \text{mod}\ p \\
k_{22} = g_0 = C_1 \cdot k_{10} \cdot k_{11}\cdot k_{12}\ \text{mod}\ p \\
k_{23} = g_0 = C_1 \cdot k_{10} \cdot k_{11}\cdot k_{12}\cdot k_{13}\ \text{mod}\ p \\
k_{24} = g_0 = C_1 \cdot k_{10} \cdot k_{11}\cdot k_{12}\cdot k_{13} \cdot k_{14}\ \text{mod}\ p \\
$$
可以发现有规律存在，已知$k_{14}\ k_{24}\ k_{34}\ k_{44}\ k_{54}$ 可以推出$k_{23}\ k_{33}\ k_{43}\ k_{53}$</p><p>同理可以推出$k_{32}\ k_{42}\ k_{52}$，依此可以推出$k_{41}\ k_{51}$ 和$k_{50}$</p><p>推导公式：
$$
k_{ij} = k_{i(j+1)} \cdot k_{(i-1)j}^{-1}\ \text{mod}\ p
$$
根据推导公式可以进行求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=n>invert</span><span class=p>,</span><span class=n>gcd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>isprime</span>
</span></span><span class=line><span class=cl><span class=n>know</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;flag{&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./output.txt&#39;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>readlines</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=o>-</span><span class=mi>4</span><span class=p>:],</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>maxg</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>maxg</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>isprime</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>g04</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g14</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g13</span> <span class=o>=</span> <span class=n>g14</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g04</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g24</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g23</span> <span class=o>=</span> <span class=n>g24</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g14</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g22</span> <span class=o>=</span> <span class=n>g23</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g13</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g34</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g33</span> <span class=o>=</span> <span class=n>g34</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g24</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g32</span> <span class=o>=</span> <span class=n>g33</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g23</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g31</span> <span class=o>=</span> <span class=n>g32</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g22</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g44</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>g43</span> <span class=o>=</span> <span class=n>g44</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g34</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g42</span> <span class=o>=</span> <span class=n>g43</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g33</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g41</span> <span class=o>=</span> <span class=n>g42</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g32</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>g40</span> <span class=o>=</span> <span class=n>g41</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>g31</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=p>[</span><span class=n>g40</span><span class=p>,</span> <span class=n>g41</span><span class=p>,</span> <span class=n>g42</span><span class=p>,</span> <span class=n>g43</span><span class=p>,</span> <span class=n>g44</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=mi>42</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>_k</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=n>k</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>alp</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>invert</span><span class=p>(</span><span class=n>_k</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>alp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>k</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>alp</span> <span class=o>=</span> <span class=n>alp</span> <span class=o>*</span> <span class=n>k</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>flag</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;}&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;p = </span><span class=si>{</span><span class=n>p</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;flag{&#39;</span><span class=o>+</span><span class=n>flag</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span></code></pre></div><p>运行代码得到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>p = 59441
</span></span><span class=line><span class=cl>b&#39;flag{749d39d4-78db-4c55-b4ff-bca873d0f18e}&#39;
</span></span></code></pre></div><p>这种思路是由局部推断整体的想法，可能将题目的过程复杂化，而显得不是非常优雅。</p><hr><p>此题的求解脚本还可以使用sagemath进行相应的脚本求解，思路也是大致一样的思路。</p><p>构造一个p的整数环，来进行运算求解，这种求解方法反而会更加简单，sagemath求解的脚本：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./output.txt&#39;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>readlines</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=o>-</span><span class=mi>4</span><span class=p>:],</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>maxg</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>maxg</span><span class=p>,</span> <span class=mi>2</span><span class=o>^</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>=</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>        <span class=n>F</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>F</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>])</span><span class=o>/</span><span class=n>F</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=n>j</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;flag{&#39;</span><span class=o>+</span><span class=nb>bytes</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span></code></pre></div><p>运行脚本就可以得到flag，<code>b'flag{749d39d4-78db-4c55-b4ff-bca873d0f18e}'</code></p><p>这种脚本的思路就是直接进行整体运算来求解。</p><h3 id=david_homework>david_homework<a hidden class=anchor aria-hidden=true href=#david_homework>#</a></h3><blockquote><p>这道题目是当时考虑是将递归转循环来进行求解，但是时间复杂度还是很高，不能正常进行求解。想到线性代数的提示，时间已经所剩无几，故未能完成求解</p></blockquote><p>题目说到是一个线性代数的作业，应该是一个线性代码相关的问题求解。</p><p>赛题给到的代码是一个含有递归的函数：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829095725043.png alt=image-20220829095725043></p><p>通过搜索引擎搜索关键信息</p><ol><li>搜索 <code>递归函数转线代</code> : <a href=https://blog.csdn.net/wdq347/article/details/8919645>(191条消息) 线性代数求解递推形式数列的通项公式_wdq347的博客-CSDN博客</a></li><li>搜索 <code>递推 线代</code> : <a href=https://www.bilibili.com/video/BV18p411o7vc/>线性代数-递推法解“数字型”行列式_哔哩哔哩_bilibili</a></li><li>搜索 <code>线性代数-递推法解“数字型”行列式</code> : <a href=https://zhuanlan.zhihu.com/p/37683681>递推公式法在行列式计算中的证明与应用 - 知乎 (zhihu.com)</a></li><li>搜索 <code>递推公式法 行列式</code></li></ol><p>找到文章：<a href=https://www.zhihu.com/question/426892843>怎么用递归法计算行列式? - 知乎 (zhihu.com)</a></p><p>根据文章：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829101251970.png alt=image-20220829101251970></p><p>显然这道题目是要求求解出逆过程，首先需要抽象出递推函数的递归公式：</p><p>$$
f(x,cof) = \left\{
\begin{array}{l}
x+1 & & {x &lt; 3} \\
cof_2\cdot f(x-3) + cof_1\cdot f(x-2) + cof_0\cdot f(x-1) & & {x \geq 3}
\end{array}
\right.
$$</p><p>根据查找到的一系列文章中的<a href=https://blog.csdn.net/u011815404/article/details/99621516>(191条消息) 线性代数 —— 线性递推关系_Alex_McAvoy的博客-CSDN博客_线性递推关系</a>，可以看到：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829102307637.png alt=image-20220829102307637></p><p>根据关系可以得到</p><p>$$
f(n) = A * f(n-1)
$$</p><p>$$
A = \left[\begin{array}{ccc}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1 \\
cof_2 & cof_1 & cof_0
\end{array} \right]
$$</p><p>$$
f(n-1) = \left[
\begin{array}{l}
f(n-3) \\
f(n-2) \\
f(n-1) \\
\end{array}
\right]
$$</p><p>紧接着根据这个：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829104119031.png alt=image-20220829104119031></p><p>可以得到：
$$
F(n) = A^{n-2}\cdot f(2)
$$</p><p>$$
f(2) = \left[
\begin{array}{l}
f(0)\\
f(1) \\
f(2) \\
\end{array}
\right]
= \left[
\begin{array}{l}
1\\
2 \\
3 \\
\end{array}
\right]
$$</p><p>尝试使用sagemath求解，出现报错</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829113116331.png alt=image-20220829113116331></p><p>进行次方运算必须是一个方块矩阵，也就是矩阵的维度必须是2x2, 3x3 … n x n 的矩阵，进行运算推导下：
$$
f(n) = A * f(n-1) = \left[
\begin{array}{c}
f(n-3) \\
f(n-2) \\
f(n-1) \\
cof_2\cdot f(n-3) + cof_1\cdot f(n-2) + cof_0\cdot f(n-1)
\end{array}
\right]
$$</p><p>继续进行推导：
$$
f(n-1) = A * f(n-2) = \left[
\begin{array}{c}
f(n-4) \\
f(n-3) \\
f(n-2) \\
cof_2\cdot f(n-4) + cof_1\cdot f(n-3) + cof_0\cdot f(n-2)
\end{array}
\right]
$$</p><p>$$
A * f(n-1) \\
= \left[\begin{array}{l}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1 \\
cof_2 & cof_1 & cof_0
\end{array} \right] \cdot \left[
\begin{array}{c}
f(n-4) \\
f(n-3) \\
f(n-2) \\
cof_2\cdot f(n-4) + cof_1\cdot f(n-3) + cof_0\cdot f(n-2)
\end{array}
\right]
$$</p><p>此时无法进行运算，进行推导发现将A修改成如下形式运算结果不变：</p><p>$$
A = \left[
\begin{array}{ccc}
0 & 1 & 0 \\
0 & 0 & 1 \\
cof_2 & cof_1 & cof_0
\end{array}
\right]
$$</p><p>再次尝试编写sage代码进行运算：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># sagemath</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span><span class=p>,</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>binascii</span> <span class=kn>import</span> <span class=n>unhexlify</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cof_t</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>353</span><span class=p>,</span> <span class=o>-</span><span class=mi>1162</span><span class=p>,</span> <span class=mi>32767</span><span class=p>],</span> <span class=p>[</span><span class=mi>206</span><span class=p>,</span> <span class=o>-</span><span class=mi>8021</span><span class=p>,</span> <span class=mi>42110</span><span class=p>],</span> <span class=p>[</span><span class=mi>262</span><span class=p>,</span> <span class=o>-</span><span class=mi>7088</span><span class=p>,</span> <span class=mi>31882</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>388</span><span class=p>,</span> <span class=o>-</span><span class=mi>6394</span><span class=p>,</span> <span class=mi>21225</span><span class=p>],</span> <span class=p>[</span><span class=mi>295</span><span class=p>,</span> <span class=o>-</span><span class=mi>9469</span><span class=p>,</span> <span class=mi>44468</span><span class=p>],</span> <span class=p>[</span><span class=mi>749</span><span class=p>,</span> <span class=o>-</span><span class=mi>3501</span><span class=p>,</span> <span class=mi>40559</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>528</span><span class=p>,</span> <span class=o>-</span><span class=mi>2690</span><span class=p>,</span> <span class=mi>10210</span><span class=p>],</span> <span class=p>[</span><span class=mi>354</span><span class=p>,</span> <span class=o>-</span><span class=mi>5383</span><span class=p>,</span> <span class=mi>18437</span><span class=p>],</span> <span class=p>[</span><span class=mi>491</span><span class=p>,</span> <span class=o>-</span><span class=mi>8467</span><span class=p>,</span> <span class=mi>26892</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>932</span><span class=p>,</span> <span class=o>-</span><span class=mi>6984</span><span class=p>,</span> <span class=mi>20447</span><span class=p>],</span> <span class=p>[</span><span class=mi>731</span><span class=p>,</span> <span class=o>-</span><span class=mi>6281</span><span class=p>,</span> <span class=mi>11340</span><span class=p>],</span> <span class=p>[</span><span class=mi>420</span><span class=p>,</span> <span class=o>-</span><span class=mi>5392</span><span class=p>,</span> <span class=mi>44071</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>685</span><span class=p>,</span> <span class=o>-</span><span class=mi>6555</span><span class=p>,</span> <span class=mi>40938</span><span class=p>],</span> <span class=p>[</span><span class=mi>408</span><span class=p>,</span> <span class=o>-</span><span class=mi>8070</span><span class=p>,</span> <span class=mi>47959</span><span class=p>],</span> <span class=p>[</span><span class=mi>182</span><span class=p>,</span> <span class=o>-</span><span class=mi>9857</span><span class=p>,</span> <span class=mi>49477</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>593</span><span class=p>,</span> <span class=o>-</span><span class=mi>3584</span><span class=p>,</span> <span class=mi>49243</span><span class=p>],</span> <span class=p>[</span><span class=mi>929</span><span class=p>,</span> <span class=o>-</span><span class=mi>7410</span><span class=p>,</span> <span class=mi>31929</span><span class=p>],</span> <span class=p>[</span><span class=mi>970</span><span class=p>,</span> <span class=o>-</span><span class=mi>4549</span><span class=p>,</span> <span class=mi>17160</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>141</span><span class=p>,</span> <span class=o>-</span><span class=mi>2435</span><span class=p>,</span> <span class=mi>36408</span><span class=p>],</span> <span class=p>[</span><span class=mi>344</span><span class=p>,</span> <span class=o>-</span><span class=mi>3814</span><span class=p>,</span> <span class=mi>18949</span><span class=p>],</span> <span class=p>[</span><span class=mi>291</span><span class=p>,</span> <span class=o>-</span><span class=mi>7457</span><span class=p>,</span> <span class=mi>40587</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>765</span><span class=p>,</span> <span class=o>-</span><span class=mi>7011</span><span class=p>,</span> <span class=mi>32097</span><span class=p>],</span> <span class=p>[</span><span class=mi>700</span><span class=p>,</span> <span class=o>-</span><span class=mi>8534</span><span class=p>,</span> <span class=mi>18013</span><span class=p>],</span> <span class=p>[</span><span class=mi>267</span><span class=p>,</span> <span class=o>-</span><span class=mi>2541</span><span class=p>,</span> <span class=mi>33488</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>249</span><span class=p>,</span> <span class=o>-</span><span class=mi>8934</span><span class=p>,</span> <span class=mi>12321</span><span class=p>],</span> <span class=p>[</span><span class=mi>589</span><span class=p>,</span> <span class=o>-</span><span class=mi>9617</span><span class=p>,</span> <span class=mi>41998</span><span class=p>],</span> <span class=p>[</span><span class=mi>840</span><span class=p>,</span> <span class=o>-</span><span class=mi>1166</span><span class=p>,</span> <span class=mi>22814</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>947</span><span class=p>,</span> <span class=o>-</span><span class=mi>5660</span><span class=p>,</span> <span class=mi>41003</span><span class=p>],</span> <span class=p>[</span><span class=mi>206</span><span class=p>,</span> <span class=o>-</span><span class=mi>7195</span><span class=p>,</span> <span class=mi>46261</span><span class=p>],</span> <span class=p>[</span><span class=mi>784</span><span class=p>,</span> <span class=o>-</span><span class=mi>9270</span><span class=p>,</span> <span class=mi>28410</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>338</span><span class=p>,</span> <span class=o>-</span><span class=mi>3690</span><span class=p>,</span> <span class=mi>19608</span><span class=p>],</span> <span class=p>[</span><span class=mi>559</span><span class=p>,</span> <span class=o>-</span><span class=mi>2078</span><span class=p>,</span> <span class=mi>44397</span><span class=p>],</span> <span class=p>[</span><span class=mi>534</span><span class=p>,</span> <span class=o>-</span><span class=mi>3438</span><span class=p>,</span> <span class=mi>47830</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>515</span><span class=p>,</span> <span class=o>-</span><span class=mi>2139</span><span class=p>,</span> <span class=mi>39546</span><span class=p>],</span> <span class=p>[</span><span class=mi>603</span><span class=p>,</span> <span class=o>-</span><span class=mi>6460</span><span class=p>,</span> <span class=mi>49953</span><span class=p>],</span> <span class=p>[</span><span class=mi>234</span><span class=p>,</span> <span class=o>-</span><span class=mi>6824</span><span class=p>,</span> <span class=mi>12579</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>805</span><span class=p>,</span> <span class=o>-</span><span class=mi>8793</span><span class=p>,</span> <span class=mi>36465</span><span class=p>],</span> <span class=p>[</span><span class=mi>245</span><span class=p>,</span> <span class=o>-</span><span class=mi>5886</span><span class=p>,</span> <span class=mi>21077</span><span class=p>],</span> <span class=p>[</span><span class=mi>190</span><span class=p>,</span> <span class=o>-</span><span class=mi>7658</span><span class=p>,</span> <span class=mi>20396</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>392</span><span class=p>,</span> <span class=o>-</span><span class=mi>7053</span><span class=p>,</span> <span class=mi>19739</span><span class=p>],</span> <span class=p>[</span><span class=mi>609</span><span class=p>,</span> <span class=o>-</span><span class=mi>5399</span><span class=p>,</span> <span class=mi>39959</span><span class=p>],</span> <span class=p>[</span><span class=mi>479</span><span class=p>,</span> <span class=o>-</span><span class=mi>8172</span><span class=p>,</span> <span class=mi>45734</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>321</span><span class=p>,</span> <span class=o>-</span><span class=mi>7102</span><span class=p>,</span> <span class=mi>41224</span><span class=p>],</span> <span class=p>[</span><span class=mi>720</span><span class=p>,</span> <span class=o>-</span><span class=mi>4487</span><span class=p>,</span> <span class=mi>11055</span><span class=p>],</span> <span class=p>[</span><span class=mi>208</span><span class=p>,</span> <span class=o>-</span><span class=mi>1897</span><span class=p>,</span> <span class=mi>15237</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>890</span><span class=p>,</span> <span class=o>-</span><span class=mi>4427</span><span class=p>,</span> <span class=mi>35168</span><span class=p>],</span> <span class=p>[</span><span class=mi>513</span><span class=p>,</span> <span class=o>-</span><span class=mi>5106</span><span class=p>,</span> <span class=mi>45849</span><span class=p>],</span> <span class=p>[</span><span class=mi>666</span><span class=p>,</span> <span class=o>-</span><span class=mi>1137</span><span class=p>,</span> <span class=mi>23725</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>755</span><span class=p>,</span> <span class=o>-</span><span class=mi>6732</span><span class=p>,</span> <span class=mi>39995</span><span class=p>],</span> <span class=p>[</span><span class=mi>589</span><span class=p>,</span> <span class=o>-</span><span class=mi>6421</span><span class=p>,</span> <span class=mi>43716</span><span class=p>],</span> <span class=p>[</span><span class=mi>866</span><span class=p>,</span> <span class=o>-</span><span class=mi>3265</span><span class=p>,</span> <span class=mi>30017</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>416</span><span class=p>,</span> <span class=o>-</span><span class=mi>6540</span><span class=p>,</span> <span class=mi>34979</span><span class=p>],</span> <span class=p>[</span><span class=mi>840</span><span class=p>,</span> <span class=o>-</span><span class=mi>1305</span><span class=p>,</span> <span class=mi>18242</span><span class=p>],</span> <span class=p>[</span><span class=mi>731</span><span class=p>,</span> <span class=o>-</span><span class=mi>6844</span><span class=p>,</span> <span class=mi>13781</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>561</span><span class=p>,</span> <span class=o>-</span><span class=mi>2728</span><span class=p>,</span> <span class=mi>10298</span><span class=p>],</span> <span class=p>[</span><span class=mi>863</span><span class=p>,</span> <span class=o>-</span><span class=mi>5953</span><span class=p>,</span> <span class=mi>23132</span><span class=p>],</span> <span class=p>[</span><span class=mi>204</span><span class=p>,</span> <span class=o>-</span><span class=mi>4208</span><span class=p>,</span> <span class=mi>27492</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>158</span><span class=p>,</span> <span class=o>-</span><span class=mi>8701</span><span class=p>,</span> <span class=mi>12720</span><span class=p>],</span> <span class=p>[</span><span class=mi>802</span><span class=p>,</span> <span class=o>-</span><span class=mi>4740</span><span class=p>,</span> <span class=mi>16628</span><span class=p>],</span> <span class=p>[</span><span class=mi>491</span><span class=p>,</span> <span class=o>-</span><span class=mi>6874</span><span class=p>,</span> <span class=mi>29057</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>531</span><span class=p>,</span> <span class=o>-</span><span class=mi>4829</span><span class=p>,</span> <span class=mi>29205</span><span class=p>],</span> <span class=p>[</span><span class=mi>363</span><span class=p>,</span> <span class=o>-</span><span class=mi>4775</span><span class=p>,</span> <span class=mi>41711</span><span class=p>],</span> <span class=p>[</span><span class=mi>319</span><span class=p>,</span> <span class=o>-</span><span class=mi>9206</span><span class=p>,</span> <span class=mi>46164</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>317</span><span class=p>,</span> <span class=o>-</span><span class=mi>9270</span><span class=p>,</span> <span class=mi>18290</span><span class=p>],</span> <span class=p>[</span><span class=mi>680</span><span class=p>,</span> <span class=o>-</span><span class=mi>5136</span><span class=p>,</span> <span class=mi>12009</span><span class=p>],</span> <span class=p>[</span><span class=mi>880</span><span class=p>,</span> <span class=o>-</span><span class=mi>2940</span><span class=p>,</span> <span class=mi>34900</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>162</span><span class=p>,</span> <span class=o>-</span><span class=mi>2587</span><span class=p>,</span> <span class=mi>49881</span><span class=p>],</span> <span class=p>[</span><span class=mi>997</span><span class=p>,</span> <span class=o>-</span><span class=mi>5265</span><span class=p>,</span> <span class=mi>20890</span><span class=p>],</span> <span class=p>[</span><span class=mi>485</span><span class=p>,</span> <span class=o>-</span><span class=mi>9395</span><span class=p>,</span> <span class=mi>23048</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>867</span><span class=p>,</span> <span class=o>-</span><span class=mi>1652</span><span class=p>,</span> <span class=mi>18926</span><span class=p>],</span> <span class=p>[</span><span class=mi>691</span><span class=p>,</span> <span class=o>-</span><span class=mi>7844</span><span class=p>,</span> <span class=mi>11180</span><span class=p>],</span> <span class=p>[</span><span class=mi>355</span><span class=p>,</span> <span class=o>-</span><span class=mi>5990</span><span class=p>,</span> <span class=mi>13172</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>923</span><span class=p>,</span> <span class=o>-</span><span class=mi>2018</span><span class=p>,</span> <span class=mi>23110</span><span class=p>],</span> <span class=p>[</span><span class=mi>214</span><span class=p>,</span> <span class=o>-</span><span class=mi>4719</span><span class=p>,</span> <span class=mi>23005</span><span class=p>],</span> <span class=p>[</span><span class=mi>921</span><span class=p>,</span> <span class=o>-</span><span class=mi>9528</span><span class=p>,</span> <span class=mi>29351</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>349</span><span class=p>,</span> <span class=o>-</span><span class=mi>7957</span><span class=p>,</span> <span class=mi>20161</span><span class=p>],</span> <span class=p>[</span><span class=mi>470</span><span class=p>,</span> <span class=o>-</span><span class=mi>1889</span><span class=p>,</span> <span class=mi>46170</span><span class=p>],</span> <span class=p>[</span><span class=mi>244</span><span class=p>,</span> <span class=o>-</span><span class=mi>6106</span><span class=p>,</span> <span class=mi>23879</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>419</span><span class=p>,</span> <span class=o>-</span><span class=mi>5440</span><span class=p>,</span> <span class=mi>43576</span><span class=p>],</span> <span class=p>[</span><span class=mi>930</span><span class=p>,</span> <span class=o>-</span><span class=mi>1123</span><span class=p>,</span> <span class=mi>29859</span><span class=p>],</span> <span class=p>[</span><span class=mi>151</span><span class=p>,</span> <span class=o>-</span><span class=mi>5759</span><span class=p>,</span> <span class=mi>23405</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>843</span><span class=p>,</span> <span class=o>-</span><span class=mi>6770</span><span class=p>,</span> <span class=mi>36558</span><span class=p>],</span> <span class=p>[</span><span class=mi>574</span><span class=p>,</span> <span class=o>-</span><span class=mi>6171</span><span class=p>,</span> <span class=mi>33778</span><span class=p>],</span> <span class=p>[</span><span class=mi>772</span><span class=p>,</span> <span class=o>-</span><span class=mi>1073</span><span class=p>,</span> <span class=mi>44718</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>932</span><span class=p>,</span> <span class=o>-</span><span class=mi>4037</span><span class=p>,</span> <span class=mi>40088</span><span class=p>],</span> <span class=p>[</span><span class=mi>848</span><span class=p>,</span> <span class=o>-</span><span class=mi>5813</span><span class=p>,</span> <span class=mi>27304</span><span class=p>],</span> <span class=p>[</span><span class=mi>194</span><span class=p>,</span> <span class=o>-</span><span class=mi>6016</span><span class=p>,</span> <span class=mi>39770</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>966</span><span class=p>,</span> <span class=o>-</span><span class=mi>6789</span><span class=p>,</span> <span class=mi>14217</span><span class=p>],</span> <span class=p>[</span><span class=mi>219</span><span class=p>,</span> <span class=o>-</span><span class=mi>6849</span><span class=p>,</span> <span class=mi>40922</span><span class=p>],</span> <span class=p>[</span><span class=mi>352</span><span class=p>,</span> <span class=o>-</span><span class=mi>6046</span><span class=p>,</span> <span class=mi>18558</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>794</span><span class=p>,</span> <span class=o>-</span><span class=mi>8254</span><span class=p>,</span> <span class=mi>29748</span><span class=p>],</span> <span class=p>[</span><span class=mi>618</span><span class=p>,</span> <span class=o>-</span><span class=mi>5887</span><span class=p>,</span> <span class=mi>15535</span><span class=p>],</span> <span class=p>[</span><span class=mi>202</span><span class=p>,</span> <span class=o>-</span><span class=mi>9288</span><span class=p>,</span> <span class=mi>26590</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>611</span><span class=p>,</span> <span class=o>-</span><span class=mi>4341</span><span class=p>,</span> <span class=mi>46682</span><span class=p>],</span> <span class=p>[</span><span class=mi>155</span><span class=p>,</span> <span class=o>-</span><span class=mi>7909</span><span class=p>,</span> <span class=mi>16654</span><span class=p>],</span> <span class=p>[</span><span class=mi>935</span><span class=p>,</span> <span class=o>-</span><span class=mi>5739</span><span class=p>,</span> <span class=mi>39342</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>998</span><span class=p>,</span> <span class=o>-</span><span class=mi>6538</span><span class=p>,</span> <span class=mi>24363</span><span class=p>],</span> <span class=p>[</span><span class=mi>125</span><span class=p>,</span> <span class=o>-</span><span class=mi>5679</span><span class=p>,</span> <span class=mi>36725</span><span class=p>],</span> <span class=p>[</span><span class=mi>507</span><span class=p>,</span> <span class=o>-</span><span class=mi>7074</span><span class=p>,</span> <span class=mi>15475</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>699</span><span class=p>,</span> <span class=o>-</span><span class=mi>5836</span><span class=p>,</span> <span class=mi>47549</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>B</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>B</span> <span class=o>=</span> <span class=n>matrix</span><span class=p>(</span><span class=n>B</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>],</span> <span class=n>cof_t</span><span class=p>[</span><span class=n>i</span><span class=p>][::</span><span class=o>-</span><span class=mi>1</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>matrix</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>A</span> <span class=o>^</span> <span class=p>(</span><span class=mi>200000</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>B</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>+=</span> <span class=n>C</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>s</span><span class=p>)[</span><span class=o>-</span><span class=mi>2000</span><span class=p>:</span><span class=o>-</span><span class=mi>1000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>unhexlify</span><span class=p>(</span><span class=n>md5</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>check</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>verify</span> <span class=o>=</span> <span class=s1>&#39;2cf44ec396e3bb9ed0f2f3bdbe4fab6325ae9d9ec3107881308156069452a6d5&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;s= </span><span class=si>{</span><span class=n>s</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;key = </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;hash(key) = </span><span class=si>{</span><span class=n>check</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;check = </span><span class=si>{</span><span class=n>check</span><span class=o>==</span><span class=n>verify</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>运行sagemath脚本得到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>s= 8365222366127410597598169954399481033882921410074214649102398062373189165630613993923060190128768377015697889610969869189338768501949778819512483009804114510646333513147157016729806311717181191848898389803672575716843797638777123435881498143998689577186959772296072473194533856870919617472555638920296793205581043222881816090693269730028856738454951305575065708823347157677411074157254186955326531403441609073128679935513392779152628590893913048822608749327034655805831509883357484164977115164240733564895591006693108254829407400850621646091808483228634435805213269066211974452289769022399418497986464430356041737753404266468993201044272042844144895601296459104534111416147795404108912440106970848660340526207025880755825643455720871621993251258247195860214917957713359490024807893442884343732717743882154397539800059579470352302688717025991780505564794824908605015195865226780305658376169579983423732703921876787723921599023795922881747318116849413935343800909756656082327558085457335537828343666748
</span></span><span class=line><span class=cl>key = b&#39;S29O\x9a\xf3Z\x87\xe5\xbc{?D`xB&#39;
</span></span><span class=line><span class=cl>hash(key) = 2cf44ec396e3bb9ed0f2f3bdbe4fab6325ae9d9ec3107881308156069452a6d5
</span></span><span class=line><span class=cl>check = True
</span></span></code></pre></div><p>现在已经获取到了密钥key，使用python进行aes解密即可。</p><blockquote><p><strong>注意：！！！</strong></p><p>如果使用的是Python3.10版本，可能会出现报错：</p><p><code>SystemError: PY_SSIZE_T_CLEAN macro must be defined for '#' formats</code></p><p>这种情况是由于pycrypto库导致的问题，进行求解可以尝试安装miniconda创建python虚拟环境，切换到python3.8安装pycrypto库进行求解就可以正常求解</p></blockquote><p>求解python脚本：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span><span class=p>,</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>binascii</span> <span class=kn>import</span> <span class=n>unhexlify</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=s1>&#39;836522236612741059759816995439948103388292141007421464910239806237318916563061399392306019012876837701569788</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>96109698691893387685019497788195124830098041145106463335131471570167298063117171811918488983898036725757168437976</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>38777123435881498143998689577186959772296072473194533856870919617472555638920296793205581043222881816090693269730</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>02885673845495130557506570882334715767741107415725418695532653140344160907312867993551339277915262859089391304882</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>26087493270346558058315098833574841649771151642407335648955910066931082548294074008506216460918084832286344358052</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>13269066211974452289769022399418497986464430356041737753404266468993201044272042844144895601296459104534111416147</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>79540410891244010697084866034052620702588075582564345572087162199325125824719586021491795771335949002480789344288</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>43437327177438821543975398000595794703523026887170259917805055647948249086050151958652267803056583761695799834237</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>32703921876787723921599023795922881747318116849413935343800909756656082327558085457335537828343666748&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>unhexlify</span><span class=p>(</span><span class=n>md5</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>aes</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=s1>&#39;4f12b3a3eadc4146386f4732266f02bd03114a404ba4cb2dabae213ecec451c9d52c70dc3d25154b5af8a304afafed87&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>aes</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>c</span><span class=p>))</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span></code></pre></div><p>运行脚本即可得到相应的flag: <code>b'flag{519427b3-d104-4c34-a29d-5a7c128031ff}'</code></p><h3 id=whereiscode>whereiscode<a hidden class=anchor aria-hidden=true href=#whereiscode>#</a></h3><blockquote><p>这道题目当时是找到文章了但是当时去看密码学题目了，没有细看这道题目</p></blockquote><p>题目给到了一个apk程序文件，但是主程序里面没有程序的源代码：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829185549101.png alt=image-20220829185549101></p><p>感觉没有什么思路去处理，对程序的具体结构仔细分析：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829185730520.png alt=image-20220829185730520></p><p>发现有一个类似于壳的代码程序，尝试进行搜索找到了壳的相关博客和程序源码。</p><p>dpt壳程序文章：<a href=https://www.cnblogs.com/luoyesiqiu/p/dpt.html>Android函数抽取壳的实现 - luoyesiqiu - 博客园 (cnblogs.com)</a></p><p>dpt壳源码：<a href=https://github.com/luoyesiqiu/dpt-shell>luoyesiqiu/dpt-shell: Android函数抽取壳实现 (github.com)</a></p><p>下载壳工具的release版本，进行反编译查看dpt.jar java包文件，可以使用jadx进行反编译查看内容，找到dpt函数进行代码逻辑的审计</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829190248720.png alt=image-20220829190248720></p><p>根据文章，这个壳是一个函数抽取壳会进行函数的抽取壳：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829190759843.png alt=image-20220829190759843></p><p>文章也把壳运行的整个流程逻辑写出来了：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829190732698.png alt=image-20220829190732698></p><p>根据文章的信息，这道题目首先的一个子任务就是脱壳，而脱壳目前来说的目标就是对整个壳程序的逻辑进行分析。对整个流程大致分析下，发现主要是对于Dex进行操作，首先可以在dpt函数中搜索Dex关键字来定位到函数位置：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829191309699.png alt=image-20220829191309699></p><p>找到一个关键的函数，跟进这个函数，可以找到些许信息</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829191405666.png alt=image-20220829191405666></p><p>这个函数打开了一个<code>OoooooOooo</code>的文件，这是一个关键的文件信息，可能依据文章中的逻辑找到原来字节码的存储位置。这个函数不长，简单来说就是对原有的Dex进行提取，然后将提取的Dex写入到这个文件中，主要是写入操作的具体实现</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829192021242.png alt=image-20220829192021242></p><p>跟进<code>writeMultiDexCode</code>查看内部实现情况：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220829192849282.png alt=image-20220829192849282></p><p>感觉是比较类似于pe结构的实现方式，也就是找到相应的位置进行求解</p><p>应该就是类似的一种结构，知道相应的函数偏移位置和相应的数据大小来对dex文件的函数进行抽取，根据这个原理可以进行PE文件结构类似的操作方式进行处理。编写一个小的程序将抽取出来的数据重新填充到相应的位置中。</p><p>可以编写一个python脚本进行脱壳处理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>struct</span> <span class=kn>import</span> <span class=n>unpack</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./classes2.dex&#39;</span><span class=p>,</span><span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./OoooooOooo&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>raw</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;version = </span><span class=si>{</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;H&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>2</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;dexcount = </span><span class=si>{</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;H&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;dexCodesIndex1 = </span><span class=si>{</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;I&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;dexCodesIndex2 = </span><span class=si>{</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;I&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pos</span> <span class=o>=</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=kc>True</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>method_index</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;I&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=n>pos</span><span class=p>:</span><span class=n>pos</span><span class=o>+</span><span class=mi>4</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pos</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=n>offset_dex</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;I&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=n>pos</span><span class=p>:</span><span class=n>pos</span><span class=o>+</span><span class=mi>4</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pos</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=n>instruction_data_size</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&lt;I&#39;</span><span class=p>,</span><span class=n>raw</span><span class=p>[</span><span class=n>pos</span><span class=p>:</span><span class=n>pos</span><span class=o>+</span><span class=mi>4</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pos</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=n>instruction_data</span> <span class=o>=</span> <span class=n>raw</span><span class=p>[</span><span class=n>pos</span><span class=p>:</span><span class=n>pos</span><span class=o>+</span><span class=n>instruction_data_size</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pos</span> <span class=o>+=</span> <span class=n>instruction_data_size</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>[:</span><span class=n>offset_dex</span><span class=p>]</span><span class=o>+</span><span class=n>instruction_data</span> <span class=o>+</span> <span class=n>data</span><span class=p>[</span><span class=n>offset_dex</span><span class=o>+</span><span class=n>instruction_data_size</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>pos</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>raw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./classes2_dump.dex&#39;</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span></code></pre></div><p>脱壳后的程序，可以使用dex2jar程序进行解包，可以得到一个jar包程序：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830160534943.png alt=image-20220830160534943></p><p>可以直接解压得到一个文件夹，文件夹里面含有程序的class文件：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830160400390.png alt=image-20220830160400390></p><p>这个文件结构是Android程序包的文件结构，我们关注的点应该就是com文件夹，进入到com\example\nothingcode文件夹中：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830161024487.png alt=image-20220830161024487></p><p>这两个核心文件应该就是程序的主要文件，使用jd-gui工具进行java字节码文件的反编译来获取到java源码文件来看到程序的真实代码：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830161253724.png alt=image-20220830161253724></p><p>直接将程序保存成一个java源代码文件</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830161338787.png alt=image-20220830161338787></p><p>点击Save来保存反编译的源码</p><p>使用java ide进行源码的审计，打开生成的源代码文件，一看多少会有些惊讶：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830161646007.png alt=image-20220830161646007></p><p>有很多混淆和switch，应该是控制流平坦化的方式进行代码混淆的。这种混淆方式主要是由于一个发生器来形成switch结构，来混淆整个程序的主要流程结构。这种混淆的解决方式主要是脚本去混淆和静态代码审计来获取到主要的程序流程。</p><p>尝试寻找些未进行混淆的字符串，来确定大致的逻辑特征：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830162651236.png alt=image-20220830162651236></p><p>可以看出flag的数据应该是位于password的输入位置，往下继续寻找发现：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830224828585.png alt=image-20220830224828585></p><p>发现，check函数对str2和str3进行了处理，而str2和str3就对应的是两个输入框的内容，根据一般输入行的原理，应该是第一个输入行是用户名，而第二个输入行是密码。进入到check函数中一探究竟：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830225238183.png alt=image-20220830225238183></p><p>字符串str2有一个等于判断，判断str2是不是等于<code>“helloctf”</code> 这显然像是一个用户名，而不是密码。由于密码是flag这个设定，所以这个str2的形式显然不像是flag的形式。下面寻找字符串str3的操作：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830230118538.png alt=image-20220830230118538></p><p>找到str3的相关操作，并且找到一组数据，暂时不清楚这组数据有什么用。这个操作显然是把str3转成一个Int数组的操作，跟进函数查看具体操作情况：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830230758071.png alt=image-20220830230758071></p><p>函数内部有两个操作，一个是判断长度的操作，另一个是除法操作。应该是进行Int数组的初始化处理，继续探究后续操作：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830231328844.png alt=image-20220830231328844></p><p>进行大端序处理的操作，以及后面有迭代的操作，根据目前分析的情况。可以判断这个函数就是将字符串以大端序的方式转成Int数组。</p><p>这个函数分析完毕继续探究以下的内容：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220830231925973.png alt=image-20220830231925973></p><p>发现非常有趣的特征，一个特征是<code>&lt;32</code>说明可能有32轮次，后面两个运算方程。这些特征和TEA加密算法的特征类似。尝试进行TEA算法的比对，TEA加密算法有32轮次加密并且每轮加密的算法也是相应的一致。由此可以判断这个加密算法应该就是TEA加密算法。</p><p>现在找到了加密算法，一个加密算法应该有相应的密钥和相应的密文以及明文。由于我们输入的内容就是要加密的明文，因此找到密文和密钥就可能求解出此题。进行寻找相关信息：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220831113843486.png alt=image-20220831113843486></p><p>可以大致看出这个数据像是密文的，之前找到的四个成员的数组数据比较符号TEA加密算法的密钥形式，据此推断那个数据应该就是密钥。而且数据只对Int数组进行了加密前面两个成员。没有加密其他成员。</p><p>可以大致总结下，加密的大致逻辑：</p><p><img loading=lazy src=/images/2022_WDB_QL-writeup/image-20220831115650012.png alt=image-20220831115650012></p><p>根据整合的逻辑可以编写脚本进行求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>ctypes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>c_int32</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>c_int32</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>delta</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1640531527</span>
</span></span><span class=line><span class=cl>    <span class=n>total</span> <span class=o>=</span> <span class=n>c_uint32</span><span class=p>(</span><span class=n>delta</span> <span class=o>*</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>.</span><span class=n>value</span> <span class=o>-=</span> <span class=p>((</span><span class=n>x</span><span class=o>.</span><span class=n>value</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>^</span> <span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=n>total</span><span class=o>.</span><span class=n>value</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>x</span><span class=o>.</span><span class=n>value</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>.</span><span class=n>value</span> <span class=o>-=</span> <span class=p>((</span><span class=n>y</span><span class=o>.</span><span class=n>value</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>^</span> <span class=p>(</span><span class=n>y</span><span class=o>.</span><span class=n>value</span> <span class=o>+</span> <span class=n>total</span><span class=o>.</span><span class=n>value</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>y</span><span class=o>.</span><span class=n>value</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>total</span><span class=o>.</span><span class=n>value</span> <span class=o>-=</span> <span class=n>delta</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>y</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c_bytes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=o>-</span><span class=mi>63</span><span class=p>,</span> <span class=o>-</span><span class=mi>69</span><span class=p>,</span> <span class=o>-</span><span class=mi>86</span><span class=p>,</span> <span class=mi>43</span><span class=p>,</span> <span class=mi>126</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=o>-</span><span class=mi>75</span><span class=p>,</span> <span class=mi>102</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=mi>65</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>121</span><span class=p>,</span> <span class=mi>107</span><span class=p>,</span> <span class=mi>111</span><span class=p>,</span> <span class=mi>99</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>c_bytes</span><span class=p>),</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>num</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>num</span> <span class=o>+=</span> <span class=nb>hex</span><span class=p>((</span><span class=n>c_bytes</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=n>v</span><span class=p>]</span> <span class=o>+</span> <span class=mi>256</span><span class=p>)</span><span class=o>%</span><span class=mi>256</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>num</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>num</span><span class=p>,</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>num</span> <span class=o>&lt;</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>31</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>num</span><span class=o>-</span><span class=nb>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=p>[</span><span class=mi>2023708229</span><span class=p>,</span> <span class=o>-</span><span class=mi>158607964</span><span class=p>,</span> <span class=o>-</span><span class=mi>2120859654</span><span class=p>,</span> <span class=mi>1167043672</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>decrypt</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>key</span><span class=p>))</span> <span class=o>+</span> <span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>m</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>i</span><span class=p>)[</span><span class=mi>2</span><span class=p>:][</span><span class=n>v</span><span class=p>:</span><span class=n>v</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span> <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;flag</span><span class=se>{{</span><span class=si>{</span><span class=n>flag</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=se>}}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>运行得到flag：<code>flag{Givey0urf1Agykoc}</code></p><p>这道题目的脱壳方法也很多种，可以使用frida进行hook，然后让程序运行到解密的位置进行内存dump来进行脱壳。当然还有另一个方法也可以进行脱壳，在网上搜索到的一篇博客中有详细说明：<a href=https://blog.csdn.net/m0_64604636/article/details/121885541>(191条消息) Android脱壳之整体脱壳原理与实践，今天带你详细了解各组件原理_m0_64604636的博客-CSDN博客_android 脱壳</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://oolongcode.github.io/tags/writeup/>writeup</a></li><li><a href=https://oolongcode.github.io/tags/ctf/>ctf</a></li></ul><nav class=paginav><a class=prev href=https://oolongcode.github.io/posts/xctf-reverse_daliy_002/><span class=title>« Prev</span><br><span>攻防世界 RE 日常练习 002</span></a>
<a class=next href=https://oolongcode.github.io/posts/xctf-reverse-advanced_daliy_001/><span class=title>Next »</span><br><span>攻防世界进阶区日常训练001</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://oolongcode.github.io>Jasmine❀Hiker</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script><script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>