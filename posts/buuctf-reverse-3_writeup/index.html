<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>BUUCTF REVERSE [17~24]_Writeup | Jasmine❀Hiker</title><meta name=keywords content="ctf,writeup,reverse"><meta name=description content="BUUCTF-REVERSE-3 writeup 8道练手的逆向题目，可以尝试做一做
0x0 [GWCTF 2019] pyre 应该是python逆向的题目
果然是一个pyc文件，使用pyc的逆向工具进行处理得到python的代码
# uncompyle6 version 3.7.4 # Python bytecode 2.7 (62211) # Decompiled from: Python 3.8.8 (default, Apr 13 2021, 15:08:03) [MSC v.1916 64 bit (AMD64)] # Embedded file name: encode.py # Compiled at: 2019-08-19 21:01:57 print 'Welcome to Re World!' print 'Your input1 is your flag~' l = len(input1) for i in range(l): num = ((input1[i] + i) % 128 + 128) % 128 code += num for i in range(l - 1): code[i] = code[i] ^ code[(i + 1)] print code code = ['\x1f', '\x12', '\x1d', '(', '0', '4', '\x01', '\x06', '\x14', '4', ',', '\x1b', 'U', '?"><meta name=author content="Me"><link rel=canonical href=https://oolongcode.github.io/posts/buuctf-reverse-3_writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://oolongcode.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://oolongcode.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://oolongcode.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://oolongcode.github.io/apple-touch-icon.png><link rel=mask-icon href=https://oolongcode.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="BUUCTF REVERSE [17~24]_Writeup"><meta property="og:description" content="BUUCTF-REVERSE-3 writeup 8道练手的逆向题目，可以尝试做一做
0x0 [GWCTF 2019] pyre 应该是python逆向的题目
果然是一个pyc文件，使用pyc的逆向工具进行处理得到python的代码
# uncompyle6 version 3.7.4 # Python bytecode 2.7 (62211) # Decompiled from: Python 3.8.8 (default, Apr 13 2021, 15:08:03) [MSC v.1916 64 bit (AMD64)] # Embedded file name: encode.py # Compiled at: 2019-08-19 21:01:57 print 'Welcome to Re World!' print 'Your input1 is your flag~' l = len(input1) for i in range(l): num = ((input1[i] + i) % 128 + 128) % 128 code += num for i in range(l - 1): code[i] = code[i] ^ code[(i + 1)] print code code = ['\x1f', '\x12', '\x1d', '(', '0', '4', '\x01', '\x06', '\x14', '4', ',', '\x1b', 'U', '?"><meta property="og:type" content="article"><meta property="og:url" content="https://oolongcode.github.io/posts/buuctf-reverse-3_writeup/"><meta property="og:image" content="https://oolongcode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-28T19:24:35+08:00"><meta property="article:modified_time" content="2022-01-28T19:24:35+08:00"><meta property="og:site_name" content="Jasmine❀Hiker"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://oolongcode.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="BUUCTF REVERSE [17~24]_Writeup"><meta name=twitter:description content="BUUCTF-REVERSE-3 writeup 8道练手的逆向题目，可以尝试做一做
0x0 [GWCTF 2019] pyre 应该是python逆向的题目
果然是一个pyc文件，使用pyc的逆向工具进行处理得到python的代码
# uncompyle6 version 3.7.4 # Python bytecode 2.7 (62211) # Decompiled from: Python 3.8.8 (default, Apr 13 2021, 15:08:03) [MSC v.1916 64 bit (AMD64)] # Embedded file name: encode.py # Compiled at: 2019-08-19 21:01:57 print 'Welcome to Re World!' print 'Your input1 is your flag~' l = len(input1) for i in range(l): num = ((input1[i] + i) % 128 + 128) % 128 code += num for i in range(l - 1): code[i] = code[i] ^ code[(i + 1)] print code code = ['\x1f', '\x12', '\x1d', '(', '0', '4', '\x01', '\x06', '\x14', '4', ',', '\x1b', 'U', '?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://oolongcode.github.io/posts/"},{"@type":"ListItem","position":3,"name":"BUUCTF REVERSE [17~24]_Writeup","item":"https://oolongcode.github.io/posts/buuctf-reverse-3_writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"BUUCTF REVERSE [17~24]_Writeup","name":"BUUCTF REVERSE [17~24]_Writeup","description":"BUUCTF-REVERSE-3 writeup 8道练手的逆向题目，可以尝试做一做\n0x0 [GWCTF 2019] pyre 应该是python逆向的题目\n果然是一个pyc文件，使用pyc的逆向工具进行处理得到python的代码\n# uncompyle6 version 3.7.4 # Python bytecode 2.7 (62211) # Decompiled from: Python 3.8.8 (default, Apr 13 2021, 15:08:03) [MSC v.1916 64 bit (AMD64)] # Embedded file name: encode.py # Compiled at: 2019-08-19 21:01:57 print \u0026#39;Welcome to Re World!\u0026#39; print \u0026#39;Your input1 is your flag~\u0026#39; l = len(input1) for i in range(l): num = ((input1[i] + i) % 128 + 128) % 128 code += num for i in range(l - 1): code[i] = code[i] ^ code[(i + 1)] print code code = [\u0026#39;\\x1f\u0026#39;, \u0026#39;\\x12\u0026#39;, \u0026#39;\\x1d\u0026#39;, \u0026#39;(\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;4\u0026#39;, \u0026#39;\\x01\u0026#39;, \u0026#39;\\x06\u0026#39;, \u0026#39;\\x14\u0026#39;, \u0026#39;4\u0026#39;, \u0026#39;,\u0026#39;, \u0026#39;\\x1b\u0026#39;, \u0026#39;U\u0026#39;, \u0026#39;?","keywords":["ctf","writeup","reverse"],"articleBody":"BUUCTF-REVERSE-3 writeup 8道练手的逆向题目，可以尝试做一做\n0x0 [GWCTF 2019] pyre 应该是python逆向的题目\n果然是一个pyc文件，使用pyc的逆向工具进行处理得到python的代码\n# uncompyle6 version 3.7.4 # Python bytecode 2.7 (62211) # Decompiled from: Python 3.8.8 (default, Apr 13 2021, 15:08:03) [MSC v.1916 64 bit (AMD64)] # Embedded file name: encode.py # Compiled at: 2019-08-19 21:01:57 print 'Welcome to Re World!' print 'Your input1 is your flag~' l = len(input1) for i in range(l): num = ((input1[i] + i) % 128 + 128) % 128 code += num for i in range(l - 1): code[i] = code[i] ^ code[(i + 1)] print code code = ['\\x1f', '\\x12', '\\x1d', '(', '0', '4', '\\x01', '\\x06', '\\x14', '4', ',', '\\x1b', 'U', '?', 'o', '6', '*', ':', '\\x01', 'D', ';', '%', '\\x13'] # okay decompiling .\\attachment.pyc 对代码进行审计，发现input1的数值没有给到，感觉应该是在input1里面。根据代码进行逆推\ncode = ['\\x1f', '\\x12', '\\x1d', '(', '0', '4', '\\x01', '\\x06', '\\x14', '4', ',', '\\x1b', 'U', '?', 'o', '6', '*', ':', '\\x01', 'D', ';', '%', '\\x13'] l = len(code) for i in range(l-2,-1,-1): code[i] = chr(ord(code[i])^ord(code[i+1])) flag = \"\" for i in range(l): flag += chr((ord(code[i]) - i)%128) print(flag) 运行脚本，得到flag\nGWHT{Just_Re_1s_Ha66y!} 0x1 rsa rsa还能出逆向题目：D！Crypto手狂喜\n两个文件，一个enc文件和一个key文件，标准的RSA文件\n可以使用python脚本来获取n的数值和e的数据\nfrom Crypto.PublicKey import RSA with open(\"pub.key\",'r') as f: public_key = RSA.import_key(f.read()) e = public_key.e n = public_key.n print(n) 得到n的数值\n86934482296048119190666062003494800588905656017203025617216654058378322103517 然后使用yafu工具进行大数分解，得到p和q\nP = 304008741604601924494328155975272418463 Q = 285960468890451637935629440372639283459 然后根据后续得到是数据写脚本求解\nfrom Crypto.PublicKey import RSA from Crypto.Util.number import long_to_bytes,bytes_to_long from libnum import invmod with open(\"pub.key\",'r') as f: public_key = RSA.import_key(f.read()) e = public_key.e n = public_key.n # print(n) with open(\"flag.enc\",\"rb\") as f: c = bytes_to_long(f.read()) p = 304008741604601924494328155975272418463 q = 285960468890451637935629440372639283459 phi = (p-1)*(q-1) d = invmod(e,phi) m = pow(c,d,n) flag = long_to_bytes(m) print(flag) 运行脚本得到flag\nb'\\x02\\x9d {zR\\x1e\\x08\\xe4\\xe6\\x18\\x06\\x00flag{decrypt_256}\\n' flag即为\nflag{decrypt_256} 0x2 [ACTF新生赛] easyre 走下流程，查下壳\n发现有壳，需要进行脱壳\n使用UPX进行脱壳处理\n然后再次查看信息\n32位程序，已经成功脱壳，可以丢进ida pro里面玩耍了\nint __cdecl main(int argc, const char **argv, const char **envp) { _BYTE v4[12]; // [esp+12h] [ebp-2Eh] BYREF _DWORD v5[3]; // [esp+1Eh] [ebp-22h] _BYTE v6[5]; // [esp+2Ah] [ebp-16h] BYREF int v7; // [esp+2Fh] [ebp-11h] int v8; // [esp+33h] [ebp-Dh] int v9; // [esp+37h] [ebp-9h] char v10; // [esp+3Bh] [ebp-5h] int i; // [esp+3Ch] [ebp-4h] __main(); qmemcpy(v4, \"*F'\\\"N,\\\"(I?+@\", sizeof(v4)); printf(\"Please input:\"); scanf(\"%s\", v6); if ( v6[0] != 65 || v6[1] != 67 || v6[2] != 84 || v6[3] != 70 || v6[4] != 123 || v10 != 125 ) return 0; v5[0] = v7; v5[1] = v8; v5[2] = v9; for ( i = 0; i \u003c= 11; ++i ) { if ( v4[i] != _data_start__[*((char *)v5 + i) - 1] ) return 0; } printf(\"You are correct!\"); return 0; } 就是非常简单的算法了，进行简单的逆向算法就可以求解，写一个python脚本进行求解\ndata_list = [42,70,39,34,78,44,34,40,73,63,43,64] data = r\"}|{zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?\u003e=\u003c;:9876543210/.-,+*)(\" + chr(0x27) + r'\u0026%$# !\"' flag_list = [] for i in data_list: flag_list.append(data.find(chr(i))+1) s = [chr(x + 1) for x in pos] flag = ''.join(s) print ('flag{'+flag+'}') 运行脚本就可以得到flag：\nflag{U9X_1S_W6@T?} 0x3 CrackRTF 先查一下壳\n32位无壳的pe文件，使用ida pro打开文件\nint __cdecl main_0(int argc, const char **argv, const char **envp) { DWORD v3; // eax DWORD v4; // eax char Str[260]; // [esp+4Ch] [ebp-310h] BYREF int v7; // [esp+150h] [ebp-20Ch] char String1[260]; // [esp+154h] [ebp-208h] BYREF char Destination[260]; // [esp+258h] [ebp-104h] BYREF memset(Destination, 0, sizeof(Destination)); memset(String1, 0, sizeof(String1)); v7 = 0; printf(\"pls input the first passwd(1): \"); scanf(\"%s\", Destination); if ( strlen(Destination) != 6 ) { printf(\"Must be 6 characters!\\n\"); ExitProcess(0); } v7 = atoi(Destination); if ( v7 \u003c 100000 ) ExitProcess(0); strcat(Destination, \"@DBApp\"); v3 = strlen(Destination); sub_40100A((BYTE *)Destination, v3, String1); if ( !_strcmpi(String1, \"6E32D0943418C2C33385BC35A1470250DD8923A9\") ) { printf(\"continue...\\n\\n\"); printf(\"pls input the first passwd(2): \"); memset(Str, 0, sizeof(Str)); scanf(\"%s\", Str); if ( strlen(Str) != 6 ) { printf(\"Must be 6 characters!\\n\"); ExitProcess(0); } strcat(Str, Destination); memset(String1, 0, sizeof(String1)); v4 = strlen(Str); sub_401019((BYTE *)Str, v4, String1); if ( !_strcmpi(\"27019e688a4e62a649fd99cadaafdb4e\", String1) ) { if ( !(unsigned __int8)sub_40100F(Str) ) { printf(\"Error!!\\n\"); ExitProcess(0); } printf(\"bye ~~\\n\"); } } return 0; } 对代码进行审计分析，发现我们需要输入两次密码\n首先看下第一次密码输入需要满足什么样的要求：\n第一次输入需要进行链接然后使用md5加密然后获取的数值与某些数值相等，也就是:\nMD5(xxxxxx@DBAPP) == 6E32D0943418C2C33385BC35A1470250DD8923A9 sub_40100A函数代码：\nint __cdecl sub_401230(BYTE *pbData, DWORD dwDataLen, LPSTR lpString1) { int result; // eax DWORD i; // [esp+4Ch] [ebp-28h] CHAR String2[4]; // [esp+50h] [ebp-24h] BYREF BYTE v6[20]; // [esp+54h] [ebp-20h] BYREF DWORD pdwDataLen; // [esp+68h] [ebp-Ch] BYREF HCRYPTHASH phHash; // [esp+6Ch] [ebp-8h] BYREF HCRYPTPROV phProv; // [esp+70h] [ebp-4h] BYREF if ( !CryptAcquireContextA(\u0026phProv, 0, 0, 1u, 0xF0000000) ) return 0; if ( CryptCreateHash(phProv, 0x8004u, 0, 0, \u0026phHash) ) { if ( CryptHashData(phHash, pbData, dwDataLen, 0) ) { CryptGetHashParam(phHash, 2u, v6, \u0026pdwDataLen, 0); *lpString1 = 0; for ( i = 0; i \u003c pdwDataLen; ++i ) { wsprintfA(String2, \"%02X\", v6[i]); lstrcatA(lpString1, String2); } CryptDestroyHash(phHash); CryptReleaseContext(phProv, 0); result = 1; } else { CryptDestroyHash(phHash); CryptReleaseContext(phProv, 0); result = 0; } } else { CryptReleaseContext(phProv, 0); result = 0; } return result; } 程序直接调用WIN32的API函数进行调用来进行MD5的加密\n使用在线的MD5工具进行解密获得：\n123321@DBApp 下面解决一下第二次加密的问题，第二次加密显然也是一个MD5的比较问题，即：\nMD5(xxxxxx123321@DBApp@DBAPP) == 27019e688a4e62a649fd99cadaafdb4e 同样使用上面那个MD5的工具进行求解就可以得到数据：\n~!3a@0123321@DBApp 现在得到了所有的密码，是不是可以运行一下程序来得到结果：\n运行程序得到了一个rtf文件，打开rtf文件就能得到flag啦：\nFlag{N0_M0re_Free_Bugs} 0x4 [2019红帽杯] easyRE 得到一个ELF文件，可以确定是Linux系统的文件，虽然Linux系统的大多数文件是不带壳的，但是为了以防万一还是查下程序信息：\n64位程序，果然是没有壳的程序。使用x64 IDA pro打开一下程序，看看程序内部\n// positive sp value has been detected, the output may be wrong! void __fastcall __noreturn start(__int64 a1, __int64 a2, int a3) { __int64 v3; // rax int v4; // esi __int64 v5; // [rsp-8h] [rbp-8h] BYREF void *retaddr; // [rsp+0h] [rbp+0h] BYREF v4 = v5; v5 = v3; sub_401BC0( (unsigned int)sub_4009C6, v4, (unsigned int)\u0026retaddr, (unsigned int)sub_402080, (unsigned int)sub_402110, a3, (__int64)\u0026v5); } 好像是找不到什么具体的内容，使用字符串检索定位到关键函数的位置\n__int64 sub_4009C6() { __int64 result; // rax int i; // [rsp+Ch] [rbp-114h] __int64 v2; // [rsp+10h] [rbp-110h] __int64 v3; // [rsp+18h] [rbp-108h] __int64 v4; // [rsp+20h] [rbp-100h] __int64 v5; // [rsp+28h] [rbp-F8h] __int64 v6; // [rsp+30h] [rbp-F0h] __int64 v7; // [rsp+38h] [rbp-E8h] __int64 v8; // [rsp+40h] [rbp-E0h] __int64 v9; // [rsp+48h] [rbp-D8h] __int64 v10; // [rsp+50h] [rbp-D0h] __int64 v11; // [rsp+58h] [rbp-C8h] char v12[13]; // [rsp+60h] [rbp-C0h] BYREF char v13[4]; // [rsp+6Dh] [rbp-B3h] BYREF char v14[19]; // [rsp+71h] [rbp-AFh] BYREF char v15[32]; // [rsp+90h] [rbp-90h] BYREF int v16; // [rsp+B0h] [rbp-70h] char v17; // [rsp+B4h] [rbp-6Ch] char v18[72]; // [rsp+C0h] [rbp-60h] BYREF unsigned __int64 v19; // [rsp+108h] [rbp-18h] v19 = __readfsqword(0x28u); qmemcpy(v12, \"Iodl\u003eQnb(ocy\", 12); v12[12] = 127; qmemcpy(v13, \"y.i\", 3); v13[3] = 127; qmemcpy(v14, \"d`3w}wek9{iy=~yL@EC\", sizeof(v14)); memset(v15, 0, sizeof(v15)); v16 = 0; v17 = 0; sub_4406E0(0LL, v15, 37LL); v17 = 0; if ( sub_424BA0(v15) == 36 ) { for ( i = 0; i \u003c (unsigned __int64)sub_424BA0(v15); ++i ) { if ( (unsigned __int8)(v15[i] ^ i) != v12[i] ) { result = 4294967294LL; goto LABEL_13; } } sub_410CC0(\"continue!\"); memset(v18, 0, 0x40uLL); v18[64] = 0; sub_4406E0(0LL, v18, 64LL); v18[39] = 0; if ( sub_424BA0(v18) == 39 ) { v2 = sub_400E44(v18); v3 = sub_400E44(v2); v4 = sub_400E44(v3); v5 = sub_400E44(v4); v6 = sub_400E44(v5); v7 = sub_400E44(v6); v8 = sub_400E44(v7); v9 = sub_400E44(v8); v10 = sub_400E44(v9); v11 = sub_400E44(v10); if ( !(unsigned int)sub_400360(v11, off_6CC090) ) { sub_410CC0(\"You found me!!!\"); sub_410CC0(\"bye bye~\"); } result = 0LL; } else { result = 4294967293LL; } } else { result = 0xFFFFFFFFLL; } LABEL_13: if ( __readfsqword(0x28u) != v19 ) sub_444020(); return result; } 找到关键函数，下面就是对关键函数进行分析来寻找线索\n简单对代码进行审计，可以发现有很多混淆来防止我们进行正确的逆向分析操作\n来，让我们跳进第一个坑：\nv19 = __readfsqword(0x28u); qmemcpy(v12, \"Iodl\u003eQnb(ocy\", 12); v12[12] = 127; qmemcpy(v13, \"y.i\", 3); v13[3] = 127; qmemcpy(v14, \"d`3w}wek9{iy=~yL@EC\", sizeof(v14)); memset(v15, 0, sizeof(v15)); v16 = 0; v17 = 0; sub_4406E0(0LL, v15, 37LL); v17 = 0; if ( sub_424BA0(v15) == 36 ) { for ( i = 0; i \u003c (unsigned __int64)sub_424BA0(v15); ++i ) { if ( (unsigned __int8)(v15[i] ^ i) != v12[i] ) { result = 4294967294LL; goto LABEL_13; } } sub_410CC0(\"continue!\"); 写一个python脚本迭代出假flag：\ndata = [] v12 = \"Iodl\u003eQnb(ocy\" insert_v = 127; v13 = \"y.i\" v14 = \"d`3w}wek9{iy=~yL@EC\" flag = \"\" for i in v12: data.append(ord(i)) data.append(insert_v) for i in v13: data.append(ord(i)) data.append(insert_v) for i in v14: data.append(ord(i)) for i in range(36): flag +=chr(data[i]^i) print(flag) 运行脚本得到fake flag：\nInfo:The first four chars are `flag` 然后走进下面一个坑：\n（”吾愿称之为base64之坑“ XD ）\n提取数据：\nVm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ== 进行十次base64解密得到一个博客地址：https://bbs.pediy.com/thread-254172.htm\n点开博客看一下，可以看到这段话：\n所谓“让对手不要走正确的破解之路” 讲人话 就是“把对手往沟里带” 但对手并不傻 很多时候攻击方比防守方更聪明 要想带对手进沟 防守方必须首先透彻了解攻击方 特别是其人性弱点（知道为什么是马克思主义学院了吧） Good, 现在知道自己掉坑里面了， 两个坑都掉了一遍所以flag在哪呢？\n我们去找下主函数\n发现周围存在一个奇奇怪怪的函数，会不会就是这个函数呢\n点开看看：\nunsigned __int64 sub_400D35() { unsigned __int64 result; // rax unsigned int v1; // [rsp+Ch] [rbp-24h] int i; // [rsp+10h] [rbp-20h] int j; // [rsp+14h] [rbp-1Ch] unsigned int v4; // [rsp+24h] [rbp-Ch] unsigned __int64 v5; // [rsp+28h] [rbp-8h] v5 = __readfsqword(0x28u); v1 = sub_43FD20(0LL) - qword_6CEE38; for ( i = 0; i \u003c= 1233; ++i ) { sub_40F790(v1); sub_40FE60(); sub_40FE60(); v1 = sub_40FE60() ^ 0x98765432; } v4 = v1; if ( ((unsigned __int8)v1 ^ byte_6CC0A0[0]) == 102 \u0026\u0026 (HIBYTE(v4) ^ (unsigned __int8)byte_6CC0A3) == 103 ) { for ( j = 0; j \u003c= 24; ++j ) sub_410E90((unsigned __int8)(byte_6CC0A0[j] ^ *((_BYTE *)\u0026v4 + j % 4))); } result = __readfsqword(0x28u) ^ v5; if ( result ) sub_444020(); return result; } 应该就是简单的异或操作了，需要提取数据来进行异或来得到flag\n提取数据并写一个异或脚本就就可以得到flag\ndata = [ 0x40, 0x35, 0x20, 0x56, 0x5D, 0x18, 0x22, 0x45, 0x17, 0x2F, 0x24, 0x6E, 0x62, 0x3C, 0x27, 0x54, 0x48, 0x6C, 0x24, 0x6E, 0x72, 0x3C, 0x32, 0x45, 0x5B ] s = \"flag\" key = '' flag = '' for i in range(4): key += chr(ord(s[i])^data[i]) for i in range(len(data)): flag += chr(data[i]^ord(key[i%4])) print(flag) 运行脚本就能得到flag，终于是over了\nflag{Act1ve_Defen5e_Test} 0x5 [ACTF新生赛2020] rome 首先，查一下文件的信息\n32位程序，没有壳，丢进IDA prio里面看看：\nint func() { int result; // eax int v1[4]; // [esp+14h] [ebp-44h] unsigned __int8 v2; // [esp+24h] [ebp-34h] BYREF unsigned __int8 v3; // [esp+25h] [ebp-33h] unsigned __int8 v4; // [esp+26h] [ebp-32h] unsigned __int8 v5; // [esp+27h] [ebp-31h] unsigned __int8 v6; // [esp+28h] [ebp-30h] int v7; // [esp+29h] [ebp-2Fh] int v8; // [esp+2Dh] [ebp-2Bh] int v9; // [esp+31h] [ebp-27h] int v10; // [esp+35h] [ebp-23h] unsigned __int8 v11; // [esp+39h] [ebp-1Fh] char v12[29]; // [esp+3Bh] [ebp-1Dh] BYREF strcpy(v12, \"Qsw3sj_lz4_Ujw@l\"); printf(\"Please input:\"); scanf(\"%s\", \u0026v2); result = v2; if ( v2 == 65 ) { result = v3; if ( v3 == 67 ) { result = v4; if ( v4 == 84 ) { result = v5; if ( v5 == 70 ) { result = v6; if ( v6 == 123 ) { result = v11; if ( v11 == 125 ) { v1[0] = v7; v1[1] = v8; v1[2] = v9; v1[3] = v10; *(_DWORD *)\u0026v12[17] = 0; while ( *(int *)\u0026v12[17] \u003c= 15 ) { if ( *((char *)v1 + *(_DWORD *)\u0026v12[17]) \u003e 64 \u0026\u0026 *((char *)v1 + *(_DWORD *)\u0026v12[17]) \u003c= 90 ) *((_BYTE *)v1 + *(_DWORD *)\u0026v12[17]) = (*((char *)v1 + *(_DWORD *)\u0026v12[17]) - 51) % 26 + 65; if ( *((char *)v1 + *(_DWORD *)\u0026v12[17]) \u003e 96 \u0026\u0026 *((char *)v1 + *(_DWORD *)\u0026v12[17]) \u003c= 122 ) *((_BYTE *)v1 + *(_DWORD *)\u0026v12[17]) = (*((char *)v1 + *(_DWORD *)\u0026v12[17]) - 79) % 26 + 97; ++*(_DWORD *)\u0026v12[17]; } *(_DWORD *)\u0026v12[17] = 0; while ( *(int *)\u0026v12[17] \u003c= 15 ) { result = (unsigned __int8)v12[*(_DWORD *)\u0026v12[17]]; if ( *((_BYTE *)v1 + *(_DWORD *)\u0026v12[17]) != (_BYTE)result ) return result; ++*(_DWORD *)\u0026v12[17]; } result = printf(\"You are correct!\"); } } } } } } return result; } 对代码进行简单的审计，可以发现，程序的加密算法是类似与凯撒加密的位移方式，可以根据程序的这一特点写个Python脚本进行求解来得到flag的数据：\nimport string data = [81,115,119,51,115,106,95,108,122,52,95,85,106,119,64,108] Lower = string.ascii_lowercase Upper = string.ascii_uppercase flag = \"\" for i in data: if i \u003e 64 and i \u003c= 90: flag += Upper[i-14-65] elif i \u003e 96 and i \u003c= 122: flag += Lower[i-18-97] else: flag += chr(i) print ('flag{'+flag+'}') 运行脚本，得到flag：\nflag{Cae3ar_th4_Gre@t} 0x6 [FlareOn4] login 发现文件是一个html文件，应该是需要进行源码阅读的题目，然后逆向算法\n\u003c!DOCTYPE Html /\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eFLARE On 2017\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cinput type=\"text\" name=\"flag\" id=\"flag\" value=\"Enter the flag\" /\u003e \u003cinput type=\"button\" id=\"prompt\" value=\"Click to check the flag\" /\u003e \u003cscript type=\"text/javascript\"\u003e document.getElementById(\"prompt\").onclick = function () { var flag = document.getElementById(\"flag\").value; var rotFlag = flag.replace(/[a-zA-Z]/g, function (c) { return String.fromCharCode((c \u003c= \"Z\" ? 90 : 122) \u003e= (c = c.charCodeAt(0) + 13) ? c : c - 26); }); if (\"PyvragFvqrYbtvafNerRnfl@syner-ba.pbz\" == rotFlag) { alert(\"Correct flag!\"); } else { alert(\"Incorrect flag, rot again\"); } } \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e 源码的核心逻辑是在JavaScript的代码中，看来题目要求我们可以能够对算法进行逆向分析，来得到flag数据\n代码进行的操作无非就是±13的操作。\n代码会区分大小写分别进行相应的操作来得到flag，如果字母+13小于字母表最后一位字母，字母最终就+13，否则字母最终就-13。逻辑非常简单，写个简单的逆向算法就能进行求解：\ncipher = \"PyvragFvqrYbtvafNerRnfl@syner-ba.pbz\" m = \"\" for i in cipher: if ord(i) \u003e= 65 and ord(i) \u003c= 90: if ord(i)-13 \u003c 65: m += chr(ord(i)+13) else: m += chr(ord(i)-13) elif ord(i) \u003e= 97 and ord(i) \u003c= 122: if ord(i)-13 \u003c 97: m += chr(ord(i)+13) else: m += chr(ord(i)-13) else: m += i print(m) 运行脚本，就能得到flag：\nClientSideLoginsAreEasy@flare-on.com 唔~题目好像还有个hint可以看一下：\nHint:本题解出相应字符串后请用flag{}包裹，形如：flag{123456@flare-on.com} 所以，这道题目的flag应该就是：\nflag{ClientSideLoginsAreEasy@flare-on.com} 0x7 [GUET-CTF2019] re 拿到程序，先看看程序的信息：\n发现程序有壳，而且是一个64位的ELF程序\n需要进行脱壳处理，程序使用的是最基本的UPX的壳，可以使用UPX进行简单脱壳：\nupx -d re 脱壳后，然后使用Exeinfo再次进行查看\n壳已经被脱掉，然后使用x64 IDA pro进行查看程序\n// positive sp value has been detected, the output may be wrong! void __fastcall __noreturn start(__int64 a1, __int64 a2, int a3) { __int64 v3; // rax int v4; // esi __int64 v5; // [rsp-8h] [rbp-8h] BYREF void *retaddr; // [rsp+0h] [rbp+0h] BYREF v4 = v5; v5 = v3; sub_4016C0( (unsigned int)sub_400E28, v4, (unsigned int)\u0026retaddr, (unsigned int)sub_401B80, (unsigned int)sub_401C10, a3, (__int64)\u0026v5); } 发现程序入口并找不到什么东西，应该是将入口函数进行混淆和隐藏了\n使用字符串检索来获取相应的信息，来定位到主函数：\n__int64 __fastcall sub_400E28(__int64 a1, int a2, int a3, int a4, int a5, int a6) { int v6; // edx int v7; // ecx int v8; // er8 int v9; // er9 __int64 result; // rax __int64 v11; // [rsp+0h] [rbp-30h] BYREF unsigned __int64 v12; // [rsp+28h] [rbp-8h] v12 = __readfsqword(0x28u); sub_40F950((unsigned int)\"input your flag:\", a2, a3, a4, a5, a6, 0LL, 0LL, 0LL, 0LL); sub_40FA80((unsigned int)\"%s\", (unsigned int)\u0026v11, v6, v7, v8, v9, v11); if ( (unsigned int)sub_4009AE(\u0026v11) ) sub_410350(\"Correct!\"); else sub_410350(\"Wrong!\"); result = 0LL; if ( __readfsqword(0x28u) != v12 ) sub_443550(); return result; } 主函数中的一些关键性的函数都被进行了混淆操作，代码进行审计分析\nv11是关键输入函数，然后sub_40FA80是关键性的函数，对sub_40FA80分析：\n_BOOL8 __fastcall sub_4009AE(char *a1) { if ( 1629056 * *a1 != 166163712 ) return 0LL; if ( 6771600 * a1[1] != 731332800 ) return 0LL; if ( 3682944 * a1[2] != 357245568 ) return 0LL; if ( 10431000 * a1[3] != 1074393000 ) return 0LL; if ( 3977328 * a1[4] != 489211344 ) return 0LL; if ( 5138336 * a1[5] != 518971936 ) return 0LL; if ( 7532250 * a1[7] != 406741500 ) return 0LL; if ( 5551632 * a1[8] != 294236496 ) return 0LL; if ( 3409728 * a1[9] != 177305856 ) return 0LL; if ( 13013670 * a1[10] != 650683500 ) return 0LL; if ( 6088797 * a1[11] != 298351053 ) return 0LL; if ( 7884663 * a1[12] != 386348487 ) return 0LL; if ( 8944053 * a1[13] != 438258597 ) return 0LL; if ( 5198490 * a1[14] != 249527520 ) return 0LL; if ( 4544518 * a1[15] != 445362764 ) return 0LL; if ( 3645600 * a1[17] != 174988800 ) return 0LL; if ( 10115280 * a1[16] != 981182160 ) return 0LL; if ( 9667504 * a1[18] != 493042704 ) return 0LL; if ( 5364450 * a1[19] != 257493600 ) return 0LL; if ( 13464540 * a1[20] != 767478780 ) return 0LL; if ( 5488432 * a1[21] != 312840624 ) return 0LL; if ( 14479500 * a1[22] != 1404511500 ) return 0LL; if ( 6451830 * a1[23] != 316139670 ) return 0LL; if ( 6252576 * a1[24] != 619005024 ) return 0LL; if ( 7763364 * a1[25] != 372641472 ) return 0LL; if ( 7327320 * a1[26] != 373693320 ) return 0LL; if ( 8741520 * a1[27] != 498266640 ) return 0LL; if ( 8871876 * a1[28] != 452465676 ) return 0LL; if ( 4086720 * a1[29] != 208422720 ) return 0LL; if ( 9374400 * a1[30] == 515592000 ) return 5759124 * a1[31] == 719890500; return 0LL; } 写个C语言的flag生成器来生成flag\n#include int main() { char a1[30] = {0}; *a1 = 166163712 / 1629056; a1[1] = 731332800 / 6771600; a1[2] = 357245568 / 3682944; a1[3] = 1074393000 / 10431000; a1[4] = 489211344 / 3977328; a1[5] = 518971936 / 5138336; a1[7] = 406741500 / 7532250; a1[8] = 294236496 / 5551632; a1[9] = 177305856 / 3409728; a1[10] = 650683500 / 13013670; a1[11] = 298351053 / 6088797; a1[12] = 386348487 / 7884663; a1[13] = 438258597 / 8944053; a1[14] = 249527520 / 5198490; a1[15] = 445362764 / 4544518; a1[17] = 174988800 / 3645600; a1[16] = 981182160 / 10115280; a1[18] = 493042704 / 9667504; a1[19] = 257493600 / 5364450; a1[20] = 767478780 / 13464540; a1[21] = 312840624 / 5488432; a1[22] = 1404511500 / 14479500; a1[23] = 316139670 / 6451830; a1[24] = 619005024 / 6252576; a1[25] = 372641472 / 7763364; a1[26] = 373693320 / 7327320; a1[27] = 498266640 / 8741520; a1[28] = 452465676 / 8871876; a1[29] = 208422720 / 4086720; a1[30] = 515592000 / 9374400; a1[31] = 719890500 / 5759124; for(int i=0;i\u003c32;++i) { if(a1[i] == 0) printf(\"*\"); else printf(\"%c\",a1[i]); } printf(\"\\n\"); } 编译并运行来得到flag：\nflag{e*65421110ba03099a1c039337} 由于有一位的字符未知，需要进行爆破来得到flag:\nflag{e165421110ba03099a1c039337} ","wordCount":"2555","inLanguage":"en","datePublished":"2022-01-28T19:24:35+08:00","dateModified":"2022-01-28T19:24:35+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://oolongcode.github.io/posts/buuctf-reverse-3_writeup/"},"publisher":{"@type":"Organization","name":"Jasmine❀Hiker","logo":{"@type":"ImageObject","url":"https://oolongcode.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://oolongcode.github.io accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://oolongcode.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://oolongcode.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://oolongcode.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://oolongcode.github.io/about/ title=About><span>About</span></a></li><li><a href=https://oolongcode.github.io/link/ title=Link><span>Link</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://oolongcode.github.io>Home</a>&nbsp;»&nbsp;<a href=https://oolongcode.github.io/posts/>Posts</a></div><h1 class=post-title>BUUCTF REVERSE [17~24]_Writeup</h1><div class=post-meta><span title='2022-01-28 19:24:35 +0800 CST'>January 28, 2022</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2555 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#buuctf-reverse-3-writeup aria-label="BUUCTF-REVERSE-3 writeup">BUUCTF-REVERSE-3 writeup</a><ul><li><a href=#0x0-gwctf-2019-pyre aria-label="0x0 [GWCTF 2019] pyre">0x0 [GWCTF 2019] pyre</a></li><li><a href=#0x1-rsa aria-label="0x1 rsa">0x1 rsa</a></li><li><a href=#0x2-actf%e6%96%b0%e7%94%9f%e8%b5%9b-easyre aria-label="0x2 [ACTF新生赛] easyre">0x2 [ACTF新生赛] easyre</a></li><li><a href=#0x3-crackrtf aria-label="0x3 CrackRTF">0x3 CrackRTF</a></li><li><a href=#0x4-2019%e7%ba%a2%e5%b8%bd%e6%9d%af-easyre aria-label="0x4 [2019红帽杯] easyRE">0x4 [2019红帽杯] easyRE</a></li><li><a href=#0x5-actf%e6%96%b0%e7%94%9f%e8%b5%9b2020-rome aria-label="0x5 [ACTF新生赛2020] rome">0x5 [ACTF新生赛2020] rome</a></li><li><a href=#0x6-flareon4-login aria-label="0x6 [FlareOn4] login">0x6 [FlareOn4] login</a></li><li><a href=#0x7-guet-ctf2019-re aria-label="0x7 [GUET-CTF2019] re">0x7 [GUET-CTF2019] re</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=buuctf-reverse-3-writeup>BUUCTF-REVERSE-3 writeup<a hidden class=anchor aria-hidden=true href=#buuctf-reverse-3-writeup>#</a></h1><p>8道练手的逆向题目，可以尝试做一做</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210914212658475.png alt=image-20210914212658475></p><h2 id=0x0-gwctf-2019-pyre>0x0 [GWCTF 2019] pyre<a hidden class=anchor aria-hidden=true href=#0x0-gwctf-2019-pyre>#</a></h2><p>应该是python逆向的题目</p><p>果然是一个pyc文件，使用pyc的逆向工具进行处理得到python的代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># uncompyle6 version 3.7.4</span>
</span></span><span class=line><span class=cl><span class=c1># Python bytecode 2.7 (62211)</span>
</span></span><span class=line><span class=cl><span class=c1># Decompiled from: Python 3.8.8 (default, Apr 13 2021, 15:08:03) [MSC v.1916 64 bit (AMD64)]</span>
</span></span><span class=line><span class=cl><span class=c1># Embedded file name: encode.py</span>
</span></span><span class=line><span class=cl><span class=c1># Compiled at: 2019-08-19 21:01:57</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s1>&#39;Welcome to Re World!&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s1>&#39;Your input1 is your flag~&#39;</span>
</span></span><span class=line><span class=cl><span class=n>l</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>input1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>l</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>num</span> <span class=o>=</span> <span class=p>((</span><span class=n>input1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>%</span> <span class=mi>128</span> <span class=o>+</span> <span class=mi>128</span><span class=p>)</span> <span class=o>%</span> <span class=mi>128</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>l</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>code</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>code</span><span class=p>[(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=n>code</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;</span><span class=se>\x1f</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x12</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x1d</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;(&#39;</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x06</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x14</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>,</span> <span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x1b</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;U&#39;</span><span class=p>,</span> <span class=s1>&#39;?&#39;</span><span class=p>,</span> <span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=s1>&#39;6&#39;</span><span class=p>,</span> <span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;D&#39;</span><span class=p>,</span> <span class=s1>&#39;;&#39;</span><span class=p>,</span> <span class=s1>&#39;%&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x13</span><span class=s1>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># okay decompiling .\attachment.pyc</span>
</span></span></code></pre></div><p>对代码进行审计，发现<code>input1</code>的数值没有给到，感觉应该是在<code>input1</code>里面。根据代码进行逆推</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>code</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;</span><span class=se>\x1f</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x12</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x1d</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;(&#39;</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x06</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x14</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>,</span> <span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x1b</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;U&#39;</span><span class=p>,</span> <span class=s1>&#39;?&#39;</span><span class=p>,</span> <span class=s1>&#39;o&#39;</span><span class=p>,</span> <span class=s1>&#39;6&#39;</span><span class=p>,</span> <span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;D&#39;</span><span class=p>,</span> <span class=s1>&#39;;&#39;</span><span class=p>,</span> <span class=s1>&#39;%&#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\x13</span><span class=s1>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>l</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>l</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>code</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>^</span><span class=nb>ord</span><span class=p>(</span><span class=n>code</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>l</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>((</span><span class=nb>ord</span><span class=p>(</span><span class=n>code</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>-</span> <span class=n>i</span><span class=p>)</span><span class=o>%</span><span class=mi>128</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本，得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>GWHT{Just_Re_1s_Ha66y!}
</span></span></code></pre></div><h2 id=0x1-rsa>0x1 rsa<a hidden class=anchor aria-hidden=true href=#0x1-rsa>#</a></h2><p>rsa还能出逆向题目：D！Crypto手狂喜</p><p>两个文件，一个enc文件和一个key文件，标准的RSA文件</p><p>可以使用python脚本来获取n的数值和e的数据</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;pub.key&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>     <span class=n>public_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>import_key</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>     <span class=n>e</span> <span class=o>=</span> <span class=n>public_key</span><span class=o>.</span><span class=n>e</span>
</span></span><span class=line><span class=cl>     <span class=n>n</span> <span class=o>=</span> <span class=n>public_key</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span></code></pre></div><p>得到n的数值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>86934482296048119190666062003494800588905656017203025617216654058378322103517
</span></span></code></pre></div><p>然后使用yafu工具进行大数分解，得到p和q</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>P = 304008741604601924494328155975272418463
</span></span><span class=line><span class=cl>Q = 285960468890451637935629440372639283459
</span></span></code></pre></div><p>然后根据后续得到是数据写脚本求解</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span><span class=p>,</span><span class=n>bytes_to_long</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>libnum</span> <span class=kn>import</span> <span class=n>invmod</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;pub.key&#34;</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>     <span class=n>public_key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>import_key</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>     <span class=n>e</span> <span class=o>=</span> <span class=n>public_key</span><span class=o>.</span><span class=n>e</span>
</span></span><span class=line><span class=cl>     <span class=n>n</span> <span class=o>=</span> <span class=n>public_key</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(n)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;flag.enc&#34;</span><span class=p>,</span><span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>     <span class=n>c</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>304008741604601924494328155975272418463</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=mi>285960468890451637935629440372639283459</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>invmod</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>b&#39;\x02\x9d {zR\x1e\x08\xe4\xe6\x18\x06\x00flag{decrypt_256}\n&#39;
</span></span></code></pre></div><p>flag即为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{decrypt_256}
</span></span></code></pre></div><h2 id=0x2-actf新生赛-easyre>0x2 [ACTF新生赛] easyre<a hidden class=anchor aria-hidden=true href=#0x2-actf新生赛-easyre>#</a></h2><p>走下流程，查下壳</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210915090016298.png alt=image-20210915090016298></p><p>发现有壳，需要进行脱壳</p><p>使用UPX进行脱壳处理</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210915090432391.png alt=image-20210915090432391></p><p>然后再次查看信息</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210915090516027.png alt=image-20210915090516027></p><p>32位程序，已经成功脱壳，可以丢进ida pro里面玩耍了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>_BYTE</span> <span class=n>v4</span><span class=p>[</span><span class=mi>12</span><span class=p>];</span> <span class=c1>// [esp+12h] [ebp-2Eh] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_DWORD</span> <span class=n>v5</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span> <span class=c1>// [esp+1Eh] [ebp-22h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=n>v6</span><span class=p>[</span><span class=mi>5</span><span class=p>];</span> <span class=c1>// [esp+2Ah] [ebp-16h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [esp+2Fh] [ebp-11h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [esp+33h] [ebp-Dh]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// [esp+37h] [ebp-9h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// [esp+3Bh] [ebp-5h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+3Ch] [ebp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>__main</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v4</span><span class=p>,</span> <span class=s>&#34;*F&#39;</span><span class=se>\&#34;</span><span class=s>N,</span><span class=se>\&#34;</span><span class=s>(I?+@&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>v6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v6</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>65</span> <span class=o>||</span> <span class=n>v6</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>67</span> <span class=o>||</span> <span class=n>v6</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>84</span> <span class=o>||</span> <span class=n>v6</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>70</span> <span class=o>||</span> <span class=n>v6</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>123</span> <span class=o>||</span> <span class=n>v10</span> <span class=o>!=</span> <span class=mi>125</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>v7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>v8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>v9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>11</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v4</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>_data_start__</span><span class=p>[</span><span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v5</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You are correct!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>就是非常简单的算法了，进行简单的逆向算法就可以求解，写一个python脚本进行求解</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>42</span><span class=p>,</span><span class=mi>70</span><span class=p>,</span><span class=mi>39</span><span class=p>,</span><span class=mi>34</span><span class=p>,</span><span class=mi>78</span><span class=p>,</span><span class=mi>44</span><span class=p>,</span><span class=mi>34</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>73</span><span class=p>,</span><span class=mi>63</span><span class=p>,</span><span class=mi>43</span><span class=p>,</span><span class=mi>64</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&#34;}|{zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(&#34;</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=mh>0x27</span><span class=p>)</span> <span class=o>+</span> <span class=sa>r</span><span class=s1>&#39;&amp;%$# !&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>data_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>flag_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>))</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=p>[</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>pos</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s1>&#39;flag{&#39;</span><span class=o>+</span><span class=n>flag</span><span class=o>+</span><span class=s1>&#39;}&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本就可以得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{U9X_1S_W6@T?}
</span></span></code></pre></div><h2 id=0x3-crackrtf>0x3 CrackRTF<a hidden class=anchor aria-hidden=true href=#0x3-crackrtf>#</a></h2><p>先查一下壳</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210915115948303.png alt=image-20210915115948303></p><p>32位无壳的pe文件，使用ida pro打开文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main_0</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>DWORD</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>DWORD</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>Str</span><span class=p>[</span><span class=mi>260</span><span class=p>];</span> <span class=c1>// [esp+4Ch] [ebp-310h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [esp+150h] [ebp-20Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>String1</span><span class=p>[</span><span class=mi>260</span><span class=p>];</span> <span class=c1>// [esp+154h] [ebp-208h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>Destination</span><span class=p>[</span><span class=mi>260</span><span class=p>];</span> <span class=c1>// [esp+258h] [ebp-104h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>Destination</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Destination</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>String1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>String1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;pls input the first passwd(1): &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>Destination</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Destination</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Must be 6 characters!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>ExitProcess</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>Destination</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v7</span> <span class=o>&lt;</span> <span class=mi>100000</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>ExitProcess</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>strcat</span><span class=p>(</span><span class=n>Destination</span><span class=p>,</span> <span class=s>&#34;@DBApp&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Destination</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_40100A</span><span class=p>((</span><span class=n>BYTE</span> <span class=o>*</span><span class=p>)</span><span class=n>Destination</span><span class=p>,</span> <span class=n>v3</span><span class=p>,</span> <span class=n>String1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>_strcmpi</span><span class=p>(</span><span class=n>String1</span><span class=p>,</span> <span class=s>&#34;6E32D0943418C2C33385BC35A1470250DD8923A9&#34;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;continue...</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;pls input the first passwd(2): &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>Str</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Str</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>Str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Must be 6 characters!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>ExitProcess</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>strcat</span><span class=p>(</span><span class=n>Str</span><span class=p>,</span> <span class=n>Destination</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>String1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>String1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>v4</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_401019</span><span class=p>((</span><span class=n>BYTE</span> <span class=o>*</span><span class=p>)</span><span class=n>Str</span><span class=p>,</span> <span class=n>v4</span><span class=p>,</span> <span class=n>String1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>_strcmpi</span><span class=p>(</span><span class=s>&#34;27019e688a4e62a649fd99cadaafdb4e&#34;</span><span class=p>,</span> <span class=n>String1</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=nf>sub_40100F</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error!!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>ExitProcess</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;bye ~~</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>对代码进行审计分析，发现我们需要输入两次密码</p><p>首先看下第一次密码输入需要满足什么样的要求：</p><p>第一次输入需要进行链接然后使用md5加密然后获取的数值与某些数值相等，也就是:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>MD5(xxxxxx@DBAPP) == 6E32D0943418C2C33385BC35A1470250DD8923A9
</span></span></code></pre></div><p>sub_40100A函数代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_401230</span><span class=p>(</span><span class=n>BYTE</span> <span class=o>*</span><span class=n>pbData</span><span class=p>,</span> <span class=n>DWORD</span> <span class=n>dwDataLen</span><span class=p>,</span> <span class=n>LPSTR</span> <span class=n>lpString1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>DWORD</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [esp+4Ch] [ebp-28h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>CHAR</span> <span class=n>String2</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span> <span class=c1>// [esp+50h] [ebp-24h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>BYTE</span> <span class=n>v6</span><span class=p>[</span><span class=mi>20</span><span class=p>];</span> <span class=c1>// [esp+54h] [ebp-20h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>DWORD</span> <span class=n>pdwDataLen</span><span class=p>;</span> <span class=c1>// [esp+68h] [ebp-Ch] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>HCRYPTHASH</span> <span class=n>phHash</span><span class=p>;</span> <span class=c1>// [esp+6Ch] [ebp-8h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>HCRYPTPROV</span> <span class=n>phProv</span><span class=p>;</span> <span class=c1>// [esp+70h] [ebp-4h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>CryptAcquireContextA</span><span class=p>(</span><span class=o>&amp;</span><span class=n>phProv</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1u</span><span class=p>,</span> <span class=mh>0xF0000000</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>CryptCreateHash</span><span class=p>(</span><span class=n>phProv</span><span class=p>,</span> <span class=mh>0x8004u</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>phHash</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=nf>CryptHashData</span><span class=p>(</span><span class=n>phHash</span><span class=p>,</span> <span class=n>pbData</span><span class=p>,</span> <span class=n>dwDataLen</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>CryptGetHashParam</span><span class=p>(</span><span class=n>phHash</span><span class=p>,</span> <span class=mi>2u</span><span class=p>,</span> <span class=n>v6</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>pdwDataLen</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=o>*</span><span class=n>lpString1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pdwDataLen</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>wsprintfA</span><span class=p>(</span><span class=n>String2</span><span class=p>,</span> <span class=s>&#34;%02X&#34;</span><span class=p>,</span> <span class=n>v6</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nf>lstrcatA</span><span class=p>(</span><span class=n>lpString1</span><span class=p>,</span> <span class=n>String2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nf>CryptDestroyHash</span><span class=p>(</span><span class=n>phHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>CryptReleaseContext</span><span class=p>(</span><span class=n>phProv</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>CryptDestroyHash</span><span class=p>(</span><span class=n>phHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>CryptReleaseContext</span><span class=p>(</span><span class=n>phProv</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CryptReleaseContext</span><span class=p>(</span><span class=n>phProv</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>程序直接调用WIN32的API函数进行调用来进行MD5的加密</p><p>使用在线的<a href=https://www.somd5.com/>MD5工具</a>进行解密获得：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>123321@DBApp
</span></span></code></pre></div><p>下面解决一下第二次加密的问题，第二次加密显然也是一个MD5的比较问题，即：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>MD5(xxxxxx123321@DBApp@DBAPP) == 27019e688a4e62a649fd99cadaafdb4e
</span></span></code></pre></div><p>同样使用上面那个MD5的工具进行求解就可以得到数据：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>~!3a@0123321@DBApp
</span></span></code></pre></div><p>现在得到了所有的密码，是不是可以运行一下程序来得到结果：</p><p>运行程序得到了一个rtf文件，打开rtf文件就能得到flag啦：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Flag{N0_M0re_Free_Bugs}
</span></span></code></pre></div><h2 id=0x4-2019红帽杯-easyre>0x4 [2019红帽杯] easyRE<a hidden class=anchor aria-hidden=true href=#0x4-2019红帽杯-easyre>#</a></h2><p>得到一个ELF文件，可以确定是Linux系统的文件，虽然Linux系统的大多数文件是不带壳的，但是为了以防万一还是查下程序信息：</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210918150158372.png alt=image-20210918150158372></p><p>64位程序，果然是没有壳的程序。使用x64 IDA pro打开一下程序，看看程序内部</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// positive sp value has been detected, the output may be wrong!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=kr>__fastcall</span> <span class=n>__noreturn</span> <span class=nf>start</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>,</span> <span class=kr>__int64</span> <span class=n>a2</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp-8h] [rbp-8h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>void</span> <span class=o>*</span><span class=n>retaddr</span><span class=p>;</span> <span class=c1>// [rsp+0h] [rbp+0h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401BC0</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>sub_4009C6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>v4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>retaddr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>sub_402080</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>sub_402110</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>a3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>好像是找不到什么具体的内容，使用字符串检索定位到关键函数的位置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>sub_4009C6</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+Ch] [rbp-114h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [rsp+10h] [rbp-110h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-108h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+20h] [rbp-100h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp+28h] [rbp-F8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [rsp+30h] [rbp-F0h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [rsp+38h] [rbp-E8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [rsp+40h] [rbp-E0h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// [rsp+48h] [rbp-D8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// [rsp+50h] [rbp-D0h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [rsp+58h] [rbp-C8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v12</span><span class=p>[</span><span class=mi>13</span><span class=p>];</span> <span class=c1>// [rsp+60h] [rbp-C0h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v13</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span> <span class=c1>// [rsp+6Dh] [rbp-B3h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v14</span><span class=p>[</span><span class=mi>19</span><span class=p>];</span> <span class=c1>// [rsp+71h] [rbp-AFh] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v15</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span> <span class=c1>// [rsp+90h] [rbp-90h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v16</span><span class=p>;</span> <span class=c1>// [rsp+B0h] [rbp-70h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v17</span><span class=p>;</span> <span class=c1>// [rsp+B4h] [rbp-6Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v18</span><span class=p>[</span><span class=mi>72</span><span class=p>];</span> <span class=c1>// [rsp+C0h] [rbp-60h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v19</span><span class=p>;</span> <span class=c1>// [rsp+108h] [rbp-18h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v19</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v12</span><span class=p>,</span> <span class=s>&#34;Iodl&gt;Qnb(ocy&#34;</span><span class=p>,</span> <span class=mi>12</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v12</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=mi>127</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v13</span><span class=p>,</span> <span class=s>&#34;y.i&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v13</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=mi>127</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v14</span><span class=p>,</span> <span class=s>&#34;d`3w}wek9{iy=~yL@EC&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v14</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>v15</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v15</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>v16</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v17</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_4406E0</span><span class=p>(</span><span class=mi>0LL</span><span class=p>,</span> <span class=n>v15</span><span class=p>,</span> <span class=mi>37LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v17</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>sub_424BA0</span><span class=p>(</span><span class=n>v15</span><span class=p>)</span> <span class=o>==</span> <span class=mi>36</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int64</span><span class=p>)</span><span class=nf>sub_424BA0</span><span class=p>(</span><span class=n>v15</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)(</span><span class=n>v15</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>i</span><span class=p>)</span> <span class=o>!=</span> <span class=n>v12</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>4294967294LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_410CC0</span><span class=p>(</span><span class=s>&#34;continue!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>v18</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x40uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v18</span><span class=p>[</span><span class=mi>64</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_4406E0</span><span class=p>(</span><span class=mi>0LL</span><span class=p>,</span> <span class=n>v18</span><span class=p>,</span> <span class=mi>64LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v18</span><span class=p>[</span><span class=mi>39</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=nf>sub_424BA0</span><span class=p>(</span><span class=n>v18</span><span class=p>)</span> <span class=o>==</span> <span class=mi>39</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v2</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v3</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v4</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v5</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v6</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v7</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v7</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v9</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v10</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v11</span> <span class=o>=</span> <span class=nf>sub_400E44</span><span class=p>(</span><span class=n>v10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>sub_400360</span><span class=p>(</span><span class=n>v11</span><span class=p>,</span> <span class=n>off_6CC090</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub_410CC0</span><span class=p>(</span><span class=s>&#34;You found me!!!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub_410CC0</span><span class=p>(</span><span class=s>&#34;bye bye~&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=mi>4294967293LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mh>0xFFFFFFFFLL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nl>LABEL_13</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>)</span> <span class=o>!=</span> <span class=n>v19</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_444020</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>找到关键函数，下面就是对关键函数进行分析来寻找线索</p><p>简单对代码进行审计，可以发现有很多混淆来防止我们进行正确的逆向分析操作</p><p>来，让我们跳进第一个坑：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl> <span class=n>v19</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v12</span><span class=p>,</span> <span class=s>&#34;Iodl&gt;Qnb(ocy&#34;</span><span class=p>,</span> <span class=mi>12</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v12</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=mi>127</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v13</span><span class=p>,</span> <span class=s>&#34;y.i&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v13</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=mi>127</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v14</span><span class=p>,</span> <span class=s>&#34;d`3w}wek9{iy=~yL@EC&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v14</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>v15</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v15</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>v16</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v17</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_4406E0</span><span class=p>(</span><span class=mi>0LL</span><span class=p>,</span> <span class=n>v15</span><span class=p>,</span> <span class=mi>37LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v17</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>sub_424BA0</span><span class=p>(</span><span class=n>v15</span><span class=p>)</span> <span class=o>==</span> <span class=mi>36</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int64</span><span class=p>)</span><span class=nf>sub_424BA0</span><span class=p>(</span><span class=n>v15</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)(</span><span class=n>v15</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>i</span><span class=p>)</span> <span class=o>!=</span> <span class=n>v12</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>4294967294LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>LABEL_13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_410CC0</span><span class=p>(</span><span class=s>&#34;continue!&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>写一个python脚本迭代出假flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>v12</span> <span class=o>=</span> <span class=s2>&#34;Iodl&gt;Qnb(ocy&#34;</span>
</span></span><span class=line><span class=cl><span class=n>insert_v</span> <span class=o>=</span> <span class=mi>127</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>v13</span> <span class=o>=</span> <span class=s2>&#34;y.i&#34;</span>
</span></span><span class=line><span class=cl><span class=n>v14</span> <span class=o>=</span> <span class=s2>&#34;d`3w}wek9{iy=~yL@EC&#34;</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>v12</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>insert_v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>v13</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>insert_v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>v14</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>36</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span><span class=nb>chr</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本得到fake flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Info:The first four chars are `flag`
</span></span></code></pre></div><p>然后走进下面一个坑：</p><p>（”吾愿称之为base64之坑“ XD ）</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210918163713879.png alt=image-20210918163713879></p><p>提取数据：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ==
</span></span></code></pre></div><p>进行十次base64解密得到一个博客地址：https://bbs.pediy.com/thread-254172.htm</p><p>点开博客看一下，可以看到这段话：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>
</span></span><span class=line><span class=cl>所谓“让对手不要走正确的破解之路” 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>讲人话 就是“把对手往沟里带” 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>但对手并不傻 很多时候攻击方比防守方更聪明 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>要想带对手进沟 防守方必须首先透彻了解攻击方 特别是其人性弱点（知道为什么是马克思主义学院了吧） 
</span></span></code></pre></div><p>Good, 现在知道自己掉坑里面了， 两个坑都掉了一遍所以flag在哪呢？</p><p>我们去找下主函数</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210918173639284.png alt=image-20210918173639284></p><p>发现周围存在一个奇奇怪怪的函数，会不会就是这个函数呢</p><p>点开看看：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=nf>sub_400D35</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// [rsp+Ch] [rbp-24h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+10h] [rbp-20h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>j</span><span class=p>;</span> <span class=c1>// [rsp+14h] [rbp-1Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+24h] [rbp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp+28h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v1</span> <span class=o>=</span> <span class=nf>sub_43FD20</span><span class=p>(</span><span class=mi>0LL</span><span class=p>)</span> <span class=o>-</span> <span class=n>qword_6CEE38</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>1233</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_40F790</span><span class=p>(</span><span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_40FE60</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_40FE60</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>sub_40FE60</span><span class=p>()</span> <span class=o>^</span> <span class=mh>0x98765432</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>((</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>v1</span> <span class=o>^</span> <span class=n>byte_6CC0A0</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>==</span> <span class=mi>102</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nf>HIBYTE</span><span class=p>(</span><span class=n>v4</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>byte_6CC0A3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>103</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=mi>24</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_410E90</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)(</span><span class=n>byte_6CC0A0</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>^</span> <span class=o>*</span><span class=p>((</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v4</span> <span class=o>+</span> <span class=n>j</span> <span class=o>%</span> <span class=mi>4</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>)</span> <span class=o>^</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_444020</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>应该就是简单的异或操作了，需要提取数据来进行异或来得到flag</p><p>提取数据并写一个异或脚本就就可以得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x5B</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>^</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=n>i</span><span class=o>%</span><span class=mi>4</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本就能得到flag，终于是over了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{Act1ve_Defen5e_Test}
</span></span></code></pre></div><h2 id=0x5-actf新生赛2020-rome>0x5 [ACTF新生赛2020] rome<a hidden class=anchor aria-hidden=true href=#0x5-actf新生赛2020-rome>#</a></h2><p>首先，查一下文件的信息</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210919081555684.png alt=image-20210919081555684></p><p>32位程序，没有壳，丢进IDA prio里面看看：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v1</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span> <span class=c1>// [esp+14h] [ebp-44h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+24h] [ebp-34h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [esp+25h] [ebp-33h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [esp+26h] [ebp-32h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [esp+27h] [ebp-31h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [esp+28h] [ebp-30h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [esp+29h] [ebp-2Fh]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [esp+2Dh] [ebp-2Bh]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// [esp+31h] [ebp-27h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// [esp+35h] [ebp-23h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [esp+39h] [ebp-1Fh]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v12</span><span class=p>[</span><span class=mi>29</span><span class=p>];</span> <span class=c1>// [esp+3Bh] [ebp-1Dh] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>strcpy</span><span class=p>(</span><span class=n>v12</span><span class=p>,</span> <span class=s>&#34;Qsw3sj_lz4_Ujw@l&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v2</span> <span class=o>==</span> <span class=mi>65</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v3</span> <span class=o>==</span> <span class=mi>67</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>result</span> <span class=o>=</span> <span class=n>v4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>==</span> <span class=mi>84</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v5</span> <span class=o>==</span> <span class=mi>70</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>result</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span> <span class=n>v6</span> <span class=o>==</span> <span class=mi>123</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>v11</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=n>v11</span> <span class=o>==</span> <span class=mi>125</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=n>v1</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>v7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=n>v1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>v8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=n>v1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>v9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=n>v1</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>v10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=k>while</span> <span class=p>(</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>15</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>64</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=mi>90</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=o>*</span><span class=p>((</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>-</span> <span class=mi>51</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=mi>65</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>96</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=mi>122</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=o>*</span><span class=p>((</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>=</span> <span class=p>(</span><span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>-</span> <span class=mi>79</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>++*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>];</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=k>while</span> <span class=p>(</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>15</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>v12</span><span class=p>[</span><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=p>((</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=n>v1</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>])</span> <span class=o>!=</span> <span class=p>(</span><span class=n>_BYTE</span><span class=p>)</span><span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>++*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v12</span><span class=p>[</span><span class=mi>17</span><span class=p>];</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=n>result</span> <span class=o>=</span> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You are correct!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>对代码进行简单的审计，可以发现，程序的加密算法是类似与凯撒加密的位移方式，可以根据程序的这一特点写个Python脚本进行求解来得到flag的数据：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=mi>81</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>119</span><span class=p>,</span><span class=mi>51</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>106</span><span class=p>,</span><span class=mi>95</span><span class=p>,</span><span class=mi>108</span><span class=p>,</span><span class=mi>122</span><span class=p>,</span><span class=mi>52</span><span class=p>,</span><span class=mi>95</span><span class=p>,</span><span class=mi>85</span><span class=p>,</span><span class=mi>106</span><span class=p>,</span><span class=mi>119</span><span class=p>,</span><span class=mi>64</span><span class=p>,</span><span class=mi>108</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Lower</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span>
</span></span><span class=line><span class=cl><span class=n>Upper</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_uppercase</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=mi>64</span> <span class=ow>and</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>+=</span> <span class=n>Upper</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>14</span><span class=o>-</span><span class=mi>65</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=mi>96</span> <span class=ow>and</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>122</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>+=</span> <span class=n>Lower</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>18</span><span class=o>-</span><span class=mi>97</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=p>(</span><span class=s1>&#39;flag{&#39;</span><span class=o>+</span><span class=n>flag</span><span class=o>+</span><span class=s1>&#39;}&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本，得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{Cae3ar_th4_Gre@t}
</span></span></code></pre></div><h2 id=0x6-flareon4-login>0x6 [FlareOn4] login<a hidden class=anchor aria-hidden=true href=#0x6-flareon4-login>#</a></h2><p>发现文件是一个html文件，应该是需要进行源码阅读的题目，然后逆向算法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE Html /&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>FLARE On 2017<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;flag&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;flag&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Enter the flag&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;prompt&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Click to check the flag&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text/javascript&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;prompt&#34;</span><span class=p>).</span><span class=nx>onclick</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>flag</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;flag&#34;</span><span class=p>).</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>rotFlag</span> <span class=o>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[a-zA-Z]/g</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>c</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nb>String</span><span class=p>.</span><span class=nx>fromCharCode</span><span class=p>((</span><span class=nx>c</span> <span class=o>&lt;=</span> <span class=s2>&#34;Z&#34;</span> <span class=o>?</span> <span class=mi>90</span> <span class=o>:</span> <span class=mi>122</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=p>(</span><span class=nx>c</span> <span class=o>=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>13</span><span class=p>)</span> <span class=o>?</span> <span class=nx>c</span> <span class=o>:</span> <span class=nx>c</span> <span class=o>-</span> <span class=mi>26</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=s2>&#34;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&#34;</span> <span class=o>==</span> <span class=nx>rotFlag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Correct flag!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Incorrect flag, rot again&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>源码的核心逻辑是在JavaScript的代码中，看来题目要求我们可以能够对算法进行逆向分析，来得到flag数据</p><p>代码进行的操作无非就是±13的操作。</p><p>代码会区分大小写分别进行相应的操作来得到flag，如果字母+13小于字母表最后一位字母，字母最终就+13，否则字母最终就-13。逻辑非常简单，写个简单的逆向算法就能进行求解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=s2>&#34;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&#34;</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>cipher</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>65</span> <span class=ow>and</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>-</span><span class=mi>13</span> <span class=o>&lt;</span> <span class=mi>65</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>-</span><span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>97</span> <span class=ow>and</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>122</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>-</span><span class=mi>13</span> <span class=o>&lt;</span> <span class=mi>97</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>m</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>-</span><span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>+=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本，就能得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ClientSideLoginsAreEasy@flare-on.com
</span></span></code></pre></div><p>唔~题目好像还有个hint可以看一下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Hint:本题解出相应字符串后请用flag{}包裹，形如：flag{123456@flare-on.com}
</span></span></code></pre></div><p>所以，这道题目的flag应该就是：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{ClientSideLoginsAreEasy@flare-on.com}
</span></span></code></pre></div><h2 id=0x7-guet-ctf2019-re>0x7 [GUET-CTF2019] re<a hidden class=anchor aria-hidden=true href=#0x7-guet-ctf2019-re>#</a></h2><p>拿到程序，先看看程序的信息：</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210919092405673.png alt=image-20210919092405673></p><p>发现程序有壳，而且是一个64位的ELF程序</p><p>需要进行脱壳处理，程序使用的是最基本的UPX的壳，可以使用UPX进行简单脱壳：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>upx</span> <span class=n>-d</span> <span class=n>re</span>
</span></span></code></pre></div><p>脱壳后，然后使用Exeinfo再次进行查看</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-3_writeup/image-20210919092939620.png alt=image-20210919092939620></p><p>壳已经被脱掉，然后使用x64 IDA pro进行查看程序</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// positive sp value has been detected, the output may be wrong!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=kr>__fastcall</span> <span class=n>__noreturn</span> <span class=nf>start</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>,</span> <span class=kr>__int64</span> <span class=n>a2</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp-8h] [rbp-8h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>void</span> <span class=o>*</span><span class=n>retaddr</span><span class=p>;</span> <span class=c1>// [rsp+0h] [rbp+0h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_4016C0</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>sub_400E28</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>v4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>retaddr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>sub_401B80</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>sub_401C10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>a3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>发现程序入口并找不到什么东西，应该是将入口函数进行混淆和隐藏了</p><p>使用字符串检索来获取相应的信息，来定位到主函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>sub_400E28</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a3</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a4</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a5</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// ecx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// er8
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// er9
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [rsp+0h] [rbp-30h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v12</span><span class=p>;</span> <span class=c1>// [rsp+28h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v12</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_40F950</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=s>&#34;input your flag:&#34;</span><span class=p>,</span> <span class=n>a2</span><span class=p>,</span> <span class=n>a3</span><span class=p>,</span> <span class=n>a4</span><span class=p>,</span> <span class=n>a5</span><span class=p>,</span> <span class=n>a6</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_40FA80</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v11</span><span class=p>,</span> <span class=n>v6</span><span class=p>,</span> <span class=n>v7</span><span class=p>,</span> <span class=n>v8</span><span class=p>,</span> <span class=n>v9</span><span class=p>,</span> <span class=n>v11</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>sub_4009AE</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v11</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_410350</span><span class=p>(</span><span class=s>&#34;Correct!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_410350</span><span class=p>(</span><span class=s>&#34;Wrong!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>)</span> <span class=o>!=</span> <span class=n>v12</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_443550</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>主函数中的一些关键性的函数都被进行了混淆操作，代码进行审计分析</p><p>v11是关键输入函数，然后<code>sub_40FA80</code>是关键性的函数，对<code>sub_40FA80</code>分析：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>_BOOL8</span> <span class=kr>__fastcall</span> <span class=nf>sub_4009AE</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>1629056</span> <span class=o>*</span> <span class=o>*</span><span class=n>a1</span> <span class=o>!=</span> <span class=mi>166163712</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>6771600</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>731332800</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>3682944</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>357245568</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>10431000</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>1074393000</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>3977328</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>489211344</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>5138336</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>518971936</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>7532250</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>406741500</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>5551632</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>294236496</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>3409728</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>177305856</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>13013670</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>650683500</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>6088797</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>298351053</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>7884663</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>386348487</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>8944053</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>438258597</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>5198490</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>249527520</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>4544518</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>445362764</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>3645600</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>174988800</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>10115280</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>981182160</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>9667504</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>493042704</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>5364450</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>257493600</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>13464540</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>767478780</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>5488432</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>312840624</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>14479500</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>1404511500</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>6451830</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>316139670</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>6252576</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>619005024</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>7763364</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>372641472</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>7327320</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>26</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>373693320</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>8741520</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>27</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>498266640</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>8871876</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>452465676</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>4086720</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>29</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>208422720</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=mi>9374400</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>==</span> <span class=mi>515592000</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>5759124</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>31</span><span class=p>]</span> <span class=o>==</span> <span class=mi>719890500</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>写个C语言的flag生成器来生成flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>a1</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>a1</span> <span class=o>=</span> <span class=mi>166163712</span> <span class=o>/</span> <span class=mi>1629056</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>731332800</span> <span class=o>/</span> <span class=mi>6771600</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>357245568</span> <span class=o>/</span> <span class=mi>3682944</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1074393000</span> <span class=o>/</span> <span class=mi>10431000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=mi>489211344</span> <span class=o>/</span> <span class=mi>3977328</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=mi>518971936</span> <span class=o>/</span> <span class=mi>5138336</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=mi>406741500</span> <span class=o>/</span> <span class=mi>7532250</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>=</span> <span class=mi>294236496</span> <span class=o>/</span> <span class=mi>5551632</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>=</span> <span class=mi>177305856</span> <span class=o>/</span> <span class=mi>3409728</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=mi>650683500</span> <span class=o>/</span> <span class=mi>13013670</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>=</span> <span class=mi>298351053</span> <span class=o>/</span> <span class=mi>6088797</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=mi>386348487</span> <span class=o>/</span> <span class=mi>7884663</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>=</span> <span class=mi>438258597</span> <span class=o>/</span> <span class=mi>8944053</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>=</span> <span class=mi>249527520</span> <span class=o>/</span> <span class=mi>5198490</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=mi>445362764</span> <span class=o>/</span> <span class=mi>4544518</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>=</span> <span class=mi>174988800</span> <span class=o>/</span> <span class=mi>3645600</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=mi>981182160</span> <span class=o>/</span> <span class=mi>10115280</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=o>=</span> <span class=mi>493042704</span> <span class=o>/</span> <span class=mi>9667504</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=o>=</span> <span class=mi>257493600</span> <span class=o>/</span> <span class=mi>5364450</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=o>=</span> <span class=mi>767478780</span> <span class=o>/</span> <span class=mi>13464540</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>=</span> <span class=mi>312840624</span> <span class=o>/</span> <span class=mi>5488432</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1404511500</span> <span class=o>/</span> <span class=mi>14479500</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=o>=</span> <span class=mi>316139670</span> <span class=o>/</span> <span class=mi>6451830</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=o>=</span> <span class=mi>619005024</span> <span class=o>/</span> <span class=mi>6252576</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=o>=</span> <span class=mi>372641472</span> <span class=o>/</span> <span class=mi>7763364</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>26</span><span class=p>]</span> <span class=o>=</span> <span class=mi>373693320</span> <span class=o>/</span> <span class=mi>7327320</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>27</span><span class=p>]</span> <span class=o>=</span> <span class=mi>498266640</span> <span class=o>/</span> <span class=mi>8741520</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=o>=</span> <span class=mi>452465676</span> <span class=o>/</span> <span class=mi>8871876</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>29</span><span class=p>]</span> <span class=o>=</span> <span class=mi>208422720</span> <span class=o>/</span> <span class=mi>4086720</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>=</span> <span class=mi>515592000</span> <span class=o>/</span> <span class=mi>9374400</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>a1</span><span class=p>[</span><span class=mi>31</span><span class=p>]</span> <span class=o>=</span> <span class=mi>719890500</span> <span class=o>/</span> <span class=mi>5759124</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>32</span><span class=p>;</span><span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;*&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span><span class=n>a1</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译并运行来得到flag：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{e*65421110ba03099a1c039337}
</span></span></code></pre></div><p>由于有一位的字符未知，需要进行爆破来得到flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{e165421110ba03099a1c039337}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://oolongcode.github.io/tags/ctf/>ctf</a></li><li><a href=https://oolongcode.github.io/tags/writeup/>writeup</a></li><li><a href=https://oolongcode.github.io/tags/reverse/>Reverse</a></li></ul><nav class=paginav><a class=prev href=https://oolongcode.github.io/posts/xctf-reverse-expert-1_writeup/><span class=title>« Prev</span><br><span>XCTF REVERSE Expert (1) Writeup</span></a>
<a class=next href=https://oolongcode.github.io/posts/buuctf-reverse-2_writeup/><span class=title>Next »</span><br><span>BUUCTF REVERSE [9~16]_Writeup</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://oolongcode.github.io>Jasmine❀Hiker</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script><script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>