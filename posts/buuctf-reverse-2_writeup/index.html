<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>BUUCTF REVERSE [9~16]_Writeup | Jasmine❀Hiker</title><meta name=keywords content="ctf,writeup,reverse"><meta name=description content="BUUCTF-REVERSE-2 writeup 8道逆向工程的小题目，re真是越来越有意思了
0x0 不一样的flag 简单看看题目描述
是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。
首先还是先查询一下程序信息
没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧
#include <stdint.h> int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = &amp;a; ebx = &#34;*11110100001010000101111#&#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx !"><meta name=author content="Me"><link rel=canonical href=/posts/buuctf-reverse-2_writeup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=apple-touch-icon href=apple-touch-icon.png><link rel=mask-icon href=safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="BUUCTF REVERSE [9~16]_Writeup"><meta property="og:description" content="BUUCTF-REVERSE-2 writeup 8道逆向工程的小题目，re真是越来越有意思了
0x0 不一样的flag 简单看看题目描述
是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。
首先还是先查询一下程序信息
没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧
#include <stdint.h> int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = &amp;a; ebx = &#34;*11110100001010000101111#&#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx !"><meta property="og:type" content="article"><meta property="og:url" content="/posts/buuctf-reverse-2_writeup/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-28T19:18:38+08:00"><meta property="article:modified_time" content="2022-01-28T19:18:38+08:00"><meta property="og:site_name" content="Jasmine❀Hiker"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="BUUCTF REVERSE [9~16]_Writeup"><meta name=twitter:description content="BUUCTF-REVERSE-2 writeup 8道逆向工程的小题目，re真是越来越有意思了
0x0 不一样的flag 简单看看题目描述
是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。
首先还是先查询一下程序信息
没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧
#include <stdint.h> int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = &amp;a; ebx = &#34;*11110100001010000101111#&#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx !"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"BUUCTF REVERSE [9~16]_Writeup","item":"/posts/buuctf-reverse-2_writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"BUUCTF REVERSE [9~16]_Writeup","name":"BUUCTF REVERSE [9~16]_Writeup","description":"BUUCTF-REVERSE-2 writeup 8道逆向工程的小题目，re真是越来越有意思了\n0x0 不一样的flag 简单看看题目描述\n是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。\n首先还是先查询一下程序信息\n没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧\n#include \u0026lt;stdint.h\u0026gt; int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = \u0026amp;a; ebx = \u0026#34;*11110100001010000101111#\u0026#34;; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx !","keywords":["ctf","writeup","reverse"],"articleBody":"BUUCTF-REVERSE-2 writeup 8道逆向工程的小题目，re真是越来越有意思了\n0x0 不一样的flag 简单看看题目描述\n是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交 应该会是一道非常有趣的题目，非常有意思的题目。\n首先还是先查询一下程序信息\n没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧\n#include int32_t dbg_main (void) { int32_t var_4h; char[5][5] a; int[2] location; int32_t var_34h; int32_t choice; int32_t i; int32_t var_40h; /* int main(); */ _main (ebx, esi, edi); location = 0; var_34h = 0; edx = \u0026a; ebx = \"*11110100001010000101111#\"; eax = 0x19; edi = edx; esi = ebx; ecx = eax; do { *(es:edi) = *(esi); ecx--; esi++; es:edi++; } while (ecx != 0); goto label_1; label_0: label_1: _puts (\"you can choose one action to execute\"); _puts (\"1 up\"); _puts (\"2 down\"); _puts (\"3 left\"); _printf (\"4 right\\n:\"); eax = \u0026choice; _scanf (0x403066, eax); eax = choice; if (eax != 2) { if (eax \u003c= 2) { if (eax != 1) { } else { if (eax != 3) { if (eax == 4) { goto label_2; } eax = location; eax--; location = eax; } else { } else { eax = location; eax++; location = eax; goto label_3; } } eax = var_34h; eax--; var_34h = eax; goto label_3; label_2: eax = var_34h; eax++; var_34h = eax; goto label_3; } _exit (1); } label_3: i = 0; while (i \u003c= 1) { eax = i; eax = *((esp + eax*4 + 0x30)); if (eax \u003e= 0) { eax = i; eax = *((esp + eax*4 + 0x30)); if (eax \u003c= 4) { goto label_4; } } _exit (1); label_4: i++; } edx = location; ecx = var_34h; eax = edx; eax \u003c\u003c= 2; eax += edx; edx = \u0026var_40h; eax += edx; eax += ecx; eax -= 0x29; al = *(eax); if (al == 0x31) { _exit (1); } edx = location; ecx = var_34h; eax = edx; eax \u003c\u003c= 2; eax += edx; esi = \u0026var_40h; eax += esi; eax += ecx; eax -= 0x29; al = *(eax); if (al != 0x23) { goto label_0; } _puts (\"\\nok, the order you enter is the flag!\"); _exit (0); } 根据反编译的代码，可以发现这道题目是一个走迷宫的题目，总体而言，还是挺有意思的，找到迷宫数据然后走出迷宫。\n根据迷宫的特性，需要寻找一下一些关键性的信息，来完成迷宫的\n首先是迷宫的信息，可以从反编译的关键代码找到迷宫信息\nebx = \"*11110100001010000101111#\"; 将数据整合一下便得到如下内容：\n*1111 01000 01010 00010 1111# 对于这个数据可以非常清晰看出迷宫的形式，*是起点，#是终点，1不能通行，0可以通行。\n然后是寻找操作指令，自然也可以从反编译代码中找到\n_puts (\"you can choose one action to execute\"); _puts (\"1 up\"); _puts (\"2 down\"); _puts (\"3 left\"); _printf (\"4 right\\n:\"); 根据迷宫和操作数，就可以得到flag\nflag{222441144222} 0x1 SimpleRev 首先查一下程序信息，看看程序具体是个什么\n是一个Linux程序，使用x64 IDA pro进行打开\n找到main函数位置，查看反编译代码\nint __cdecl __noreturn main(int argc, const char **argv, const char **envp) { int v3; // eax char v4; // [rsp+Fh] [rbp-1h] while ( 1 ) { while ( 1 ) { printf(\"Welcome to CTF game!\\nPlease input d/D to start or input q/Q to quit this program: \"); v4 = getchar(); if ( v4 != 100 \u0026\u0026 v4 != 68 ) break; Decry(\"Welcome to CTF game!\\nPlease input d/D to start or input q/Q to quit this program: \", argv); } if ( v4 == 113 || v4 == 81 ) Exit(\"Welcome to CTF game!\\nPlease input d/D to start or input q/Q to quit this program: \", argv); puts(\"Input fault format!\"); v3 = getchar(); putchar(v3); } } 对反编译的代码进行简单的审计，发现Decry函数是关键函数，可以看看这个函数的具体实现细节\nunsigned __int64 Decry() { char v1; // [rsp+Fh] [rbp-51h] int v2; // [rsp+10h] [rbp-50h] int v3; // [rsp+14h] [rbp-4Ch] int i; // [rsp+18h] [rbp-48h] int v5; // [rsp+1Ch] [rbp-44h] char src[8]; // [rsp+20h] [rbp-40h] BYREF __int64 v7; // [rsp+28h] [rbp-38h] int v8; // [rsp+30h] [rbp-30h] __int64 v9[2]; // [rsp+40h] [rbp-20h] BYREF int v10; // [rsp+50h] [rbp-10h] unsigned __int64 v11; // [rsp+58h] [rbp-8h] v11 = __readfsqword(0x28u); *(_QWORD *)src = 0x534C43444ELL; v7 = 0LL; v8 = 0; v9[0] = 0x776F646168LL; v9[1] = 0LL; v10 = 0; text = (char *)join(key3, v9); strcpy(key, key1); strcat(key, src); v2 = 0; v3 = 0; getchar(); v5 = strlen(key); for ( i = 0; i \u003c v5; ++i ) { if ( key[v3 % v5] \u003e 64 \u0026\u0026 key[v3 % v5] \u003c= 90 ) key[i] = key[v3 % v5] + 32; ++v3; } printf(\"Please input your flag:\"); while ( 1 ) { v1 = getchar(); if ( v1 == 10 ) break; if ( v1 == 32 ) { ++v2; } else { if ( v1 \u003c= 96 || v1 \u003e 122 ) { if ( v1 \u003e 64 \u0026\u0026 v1 \u003c= 90 ) { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } } else { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } if ( !(v3 % v5) ) putchar(32); ++v2; } } if ( !strcmp(text, str2) ) puts(\"Congratulation!\\n\"); else puts(\"Try again!\\n\"); return __readfsqword(0x28u) ^ v11; } 根据函数的核心代码可以知道，最开始的数据是\nIntel CPU/AMD CPU 计算机内部的数据存储的方式是以小端序存储的方式，因此部分数据是以颠倒方式进行存储的\ntext = 'killshadow' key = 'ADSFKNDCLS' 现在有原始数据就可以进一步对算法进行分析\nwhile ( 1 ) { v1 = getchar(); if ( v1 == 10 ) break; if ( v1 == 32 ) { ++v2; } else { if ( v1 \u003c= 96 || v1 \u003e 122 ) { if ( v1 \u003e 64 \u0026\u0026 v1 \u003c= 90 ) { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } } else { str2[v2] = (v1 - 39 - key[v3 % v5] + 97) % 26 + 97; ++v3; } if ( !(v3 % v5) ) putchar(32); ++v2; } } if ( !strcmp(text, str2) ) puts(\"Congratulation!\\n\"); else puts(\"Try again!\\n\"); 对代码观察可以发现，最终的逻辑判断是text的数据和str2的数据相等\n根据对于程序的逻辑判断，编写逆向算法\n#include #include using namespace std; int main() { int i, j, n = 0, v2 = 0, v3 = 0;; char v1; string text = \"killshadow\"; string key = \"ADSFKNDCLS\"; char flag[11] = { 0 }; char str2[104] = { 0 };\tint v5 = key.length(); for(int i=0; i\u003cv5; ++i) { if ( key[v3 % v5] \u003e 64 \u0026\u0026 key[v3 % v5] \u003c= 90 ) key[i] = key[v3 % v5] + 32; ++v3; } for (j = 0; j \u003c 10; ++j) { for (v2 = 0; v2 \u003c 10; ++v2) { v1 = text[v2] - 97 + 26 * j - 97 + key[v3++ % v5] + 39; if ((v1 \u003e= 65 \u0026\u0026 v1 \u003c= 90) || (v1 \u003e= 97 \u0026\u0026 v1 \u003c= 122)) { flag[v2] = v1; if (++n == 10) { cout \u003c\u003c flag \u003c\u003c endl; system(\"PAUSE\"); return 0; } } } } system(\"PAUSE\"); return 0; } 运行得到flag\nKLDQCUDFZO 0x2 Java逆向解密 Java逆向的题目，本质上和安卓逆向有着异曲同工之处，可以使用安卓逆向工具进行打开，这里使用Jadx打开\npackage defpackage; import java.util.ArrayList; import java.util.Scanner; /* renamed from: Reverse reason: default package */ public class Reverse { public static void main(String[] args) { Scanner s = new Scanner(System.in); System.out.println(\"Please input the flag ：\"); String str = s.next(); System.out.println(\"Your input is ：\"); System.out.println(str); Encrypt(str.toCharArray()); } public static void Encrypt(char[] arr) { int[] KEY; ArrayList\u003cInteger\u003e Resultlist = new ArrayList\u003c\u003e(); for (char c : arr) { Resultlist.add(Integer.valueOf((c + '@') ^ 32)); } ArrayList\u003cInteger\u003e KEYList = new ArrayList\u003c\u003e(); for (int i : new int[]{180, 136, 137, 147, 191, 137, 147, 191, 148, 136, 133, 191, 134, 140, 129, 135, 191, 65}) { KEYList.add(Integer.valueOf(i)); } System.out.println(\"Result:\"); if (Resultlist.equals(KEYList)) { System.out.println(\"Congratulations！\"); } else { System.err.println(\"Error！\"); } } } 应该就是最基本的代码审计\n关键代码其实就在Encrypt函数里面\npublic static void Encrypt(char[] arr) { int[] KEY; ArrayList\u003cInteger\u003e Resultlist = new ArrayList\u003c\u003e(); for (char c : arr) { Resultlist.add(Integer.valueOf((c + '@') ^ 32)); } ArrayList\u003cInteger\u003e KEYList = new ArrayList\u003c\u003e(); for (int i : new int[]{180, 136, 137, 147, 191, 137, 147, 191, 148, 136, 133, 191, 134, 140, 129, 135, 191, 65}) { KEYList.add(Integer.valueOf(i)); } System.out.println(\"Result:\"); if (Resultlist.equals(KEYList)) { System.out.println(\"Congratulations！\"); } else { System.err.println(\"Error！\"); } } 应该是一个注册码校验程序，写一个java程序逆过去应该就可以得到flag\npackage re; import java.util.ArrayList; public class JavaRe { public static void main(String[] args) { ArrayList\u003cInteger\u003e KEYList = new ArrayList\u003c\u003e(); for (int i : new int[]{180, 136, 137, 147, 191, 137, 147, 191, 148, 136, 133, 191, 134, 140, 129, 135, 191, 65}) { KEYList.add(Integer.valueOf(i)); } ArrayList\u003cCharacter\u003e Resultlist = new ArrayList\u003c\u003e(); for (int c : KEYList) { Resultlist.add(((char)((c^ 32)-'@'))); } String flag = new String(); for(char c:Resultlist) { flag += c; } System.out.println(flag); } } 运行Java程序就可以得到flag\nThis_is_the_flag_! 0x3 刮开有奖 看下题目：\n这是一个赌博程序，快去赚钱吧！！！！！！！！！！！！！！！！！！！！！！！！！！！(在编辑框中的输入值，即为flag，提交即可) 注意：得到的 flag 请包上 flag{} 提交 先查一下壳：\n没壳，32位的程序，使用IDA pro打开\nint __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd) { DialogBoxParamA(hInstance, (LPCSTR)0x67, 0, DialogFunc, 0); return 0; } 看样子是调用了一个WIN32的API函数，关键的代码应该是在DialogFunc函数代码中\nINT_PTR __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4) { const char *v4; // esi const char *v5; // edi int v7[2]; // [esp+8h] [ebp-20030h] BYREF int v8; // [esp+10h] [ebp-20028h] int v9; // [esp+14h] [ebp-20024h] int v10; // [esp+18h] [ebp-20020h] int v11; // [esp+1Ch] [ebp-2001Ch] int v12; // [esp+20h] [ebp-20018h] int v13; // [esp+24h] [ebp-20014h] int v14; // [esp+28h] [ebp-20010h] int v15; // [esp+2Ch] [ebp-2000Ch] int v16; // [esp+30h] [ebp-20008h] CHAR String[65536]; // [esp+34h] [ebp-20004h] BYREF char v18[65536]; // [esp+10034h] [ebp-10004h] BYREF if ( a2 == 272 ) return 1; if ( a2 != 273 ) return 0; if ( (_WORD)a3 == 1001 ) { memset(String, 0, 0xFFFFu); GetDlgItemTextA(hDlg, 1000, String, 0xFFFF); if ( strlen(String) == 8 ) { v7[0] = 90; v7[1] = 74; v8 = 83; v9 = 69; v10 = 67; v11 = 97; v12 = 78; v13 = 72; v14 = 51; v15 = 110; v16 = 103; sub_4010F0(v7, 0, 10); memset(v18, 0, 0xFFFFu); v18[0] = String[5]; v18[2] = String[7]; v18[1] = String[6]; v4 = (const char *)sub_401000(v18, strlen(v18)); memset(v18, 0, 0xFFFFu); v18[1] = String[3]; v18[0] = String[2]; v18[2] = String[4]; v5 = (const char *)sub_401000(v18, strlen(v18)); if ( String[0] == v7[0] + 34 \u0026\u0026 String[1] == v10 \u0026\u0026 4 * String[2] - 141 == 3 * v8 \u0026\u0026 String[3] / 4 == 2 * (v13 / 9) \u0026\u0026 !strcmp(v4, \"ak1w\") \u0026\u0026 !strcmp(v5, \"V1Ax\") ) { MessageBoxA(hDlg, \"U g3t 1T!\", \"@_@\", 0); } } return 0; } if ( (_WORD)a3 != 1 \u0026\u0026 (_WORD)a3 != 2 ) return 0; EndDialog(hDlg, (unsigned __int16)a3); return 1; } 也是调用了几个WIN32的API，对代码进行分析\n可以知道：\nGetDlgItemTextA 函数是获取输入的字符串\n这段代码对字符串进行了处理，主要是有两个处理函数sub_4010F0 和 sub_401000\n这个函数应该是处理这个程序字符串的关键函数\n先来看看sub_4010F0函数：\nint __cdecl sub_4010F0(int a1, int a2, int a3) { int result; // eax int i; // esi int v5; // ecx int v6; // edx result = a3; for ( i = a2; i \u003c= a3; a2 = i ) { v5 = 4 * i; v6 = *(_DWORD *)(4 * i + a1); if ( a2 \u003c result \u0026\u0026 i \u003c result ) { do { if ( v6 \u003e *(_DWORD *)(a1 + 4 * result) ) { if ( i \u003e= result ) break; ++i; *(_DWORD *)(v5 + a1) = *(_DWORD *)(a1 + 4 * result); if ( i \u003e= result ) break; while ( *(_DWORD *)(a1 + 4 * i) \u003c= v6 ) { if ( ++i \u003e= result ) goto LABEL_13; } if ( i \u003e= result ) break; v5 = 4 * i; *(_DWORD *)(a1 + 4 * result) = *(_DWORD *)(4 * i + a1); } --result; } while ( i \u003c result ); } LABEL_13: *(_DWORD *)(a1 + 4 * result) = v6; sub_4010F0(a1, a2, i - 1); result = a3; ++i; } return result; } 代码的功能暂时不太清楚，毕竟对C语言的审计功底还是不是很到位，根据代码进行转换为相应的Cpp代码运行一下：\n#include #include #include using namespace std; int __cdecl sub_4010F0(char *a1, int a2, int a3) { int result; // eax int i; // esi int v5; // ecx int v6; // edx result = a3; for (i = a2; i \u003c= a3; a2 = i) { v5 = i; v6 = a1[i]; if (a2 \u003c result \u0026\u0026 i \u003c result) { do { if (v6 \u003ea1[result]) { if (i \u003e= result) break; ++i; a1[v5] = a1[result]; if (i \u003e= result) break; while (a1[i] \u003c= v6) { if (++i \u003e= result) goto LABEL_13; } if (i \u003e= result) break; v5 = i; a1[result] = a1[i]; } --result; } while (i \u003c result); } LABEL_13: a1[result] = v6; sub_4010F0(a1, a2, i - 1); result = a3; ++i; } return result; } int main() { char v7[11]; v7[0] = 90; v7[1] = 74; v7[2] = 83; v7[3] = 69; v7[4] = 67; v7[5] = 97; v7[6] = 78; v7[7] = 72; v7[8] = 51; v7[9] = 110; v7[10] = 103; cout \u003c\u003c v7 \u003c\u003c endl; sub_4010F0(v7, 0, 10); for(int i = 0;i\u003c 11;++i){ cout \u003c\u003c (int)v7[i] \u003c\u003c \"\\t\"; } cout \u003c\u003c endl; system(\"PAUSE\"); return 0; } 运行代码，得到\nZJSECaNH3ng 51 67 69 72 74 78 83 90 97 103 110 看来应该是一个排序算法，按升序进行排序的\n下面分析另一个函数具体是个什么东西：\n_BYTE *__cdecl sub_401000(int a1, int a2) { int v2; // eax int v3; // esi size_t v4; // ebx _BYTE *v5; // eax _BYTE *v6; // edi int v7; // eax _BYTE *v8; // ebx int v9; // edi int v10; // edx int v11; // edi int v12; // eax int i; // esi _BYTE *result; // eax _BYTE *v15; // [esp+Ch] [ebp-10h] _BYTE *v16; // [esp+10h] [ebp-Ch] int v17; // [esp+14h] [ebp-8h] int v18; // [esp+18h] [ebp-4h] v2 = a2 / 3; v3 = 0; if ( a2 % 3 \u003e 0 ) ++v2; v4 = 4 * v2 + 1; v5 = malloc(v4); v6 = v5; v15 = v5; if ( !v5 ) exit(0); memset(v5, 0, v4); v7 = a2; v8 = v6; v16 = v6; if ( a2 \u003e 0 ) { while ( 1 ) { v9 = 0; v10 = 0; v18 = 0; do { if ( v3 \u003e= v7 ) break; ++v10; v9 = *(unsigned __int8 *)(v3 + a1) | (v9 \u003c\u003c 8); ++v3; } while ( v10 \u003c 3 ); v11 = v9 \u003c\u003c (8 * (3 - v10)); v12 = 0; v17 = v3; for ( i = 18; i \u003e -6; i -= 6 ) { if ( v10 \u003e= v12 ) { *((_BYTE *)\u0026v18 + v12) = (v11 \u003e\u003e i) \u0026 0x3F; v8 = v16; } else { *((_BYTE *)\u0026v18 + v12) = 64; } *v8++ = byte_407830[*((char *)\u0026v18 + v12++)]; v16 = v8; } v3 = v17; if ( v17 \u003e= a2 ) break; v7 = a2; } v6 = v15; } result = v6; *v8 = 0; return result; } 看代码，发现有3和8移位的特征初步推测是base64编码，看到有一个byte_407830的数组，跟进点开查看数据内容\n看到这数据应该就可以断定是base64编码了。\n现在知道了两个函数的功能作用，可以直接进行求解，直接定位到判断条件的位置：\nif ( String[0] == v7[0] + 34 \u0026\u0026 String[1] == v10 \u0026\u0026 4 * String[2] - 141 == 3 * v8 \u0026\u0026 String[3] / 4 == 2 * (v13 / 9) \u0026\u0026 !strcmp(v4, \"ak1w\") \u0026\u0026 !strcmp(v5, \"V1Ax\") ) { MessageBoxA(hDlg, \"U g3t 1T!\", \"@_@\", 0); } 进行简单的推断可以得出\nString[0] == 85; // 51+34 = 85 String[1] == 74; String[2] == 87; //(3 x 69 +141)/4 = 87 String[3] == 80;// 2 x (90 / 9) x4 == 80 下面进行base64解码来得到后面四个字符的数据\nb'jMp' b'WP1' 根据推断出来的信息可以求解得到flag\nUJWP1jMp 也可以使用Python脚本快速求解\nimport base64 data = [51, 67, 69, 72, 74, 78, 83, 90, 97, 103, 110] String = \"\" String += chr(data[0]+34) String += chr(data[4]) String += base64.b64decode(\"V1Ax\").decode() String += base64.b64decode(\"ak1w\").decode() flag = \"flag{\"+String+\"}\" print(flag) 运行脚本就可以得到flag\nflag{UJWP1jMp} 0x4 [GXYCTF2019]luck_guy 文件没有拓展名，感觉是一个ELF格式的文件\n先走一下逆向的流程，首先查下壳\n果然是一个ELF文件，64位的文件，用x64 IDA pro打开文件，查看主程序\nint __cdecl main(int argc, const char **argv, const char **envp) { unsigned int v4; // [rsp+14h] [rbp-Ch] BYREF unsigned __int64 v5; // [rsp+18h] [rbp-8h] v5 = __readfsqword(0x28u); welcome(argc, argv, envp); puts(\"_________________\"); puts(\"try to patch me and find flag\"); v4 = 0; puts(\"please input a lucky number\"); __isoc99_scanf(\"%d\", \u0026v4); patch_me(v4); puts(\"OK,see you again\"); return 0; } 程序挺简单的，需要寻找一下核心代码\n看样子核心代码应该是在patch_me(v4)函数里面，进入函数内部\nint __fastcall patch_me(int a1) { int result; // eax if ( a1 % 2 == 1 ) result = puts(\"just finished\"); else result = get_flag(); return result; } 继续跟进到get_flag()函数里面\nunsigned __int64 get_flag() { unsigned int v0; // eax int i; // [rsp+4h] [rbp-3Ch] int j; // [rsp+8h] [rbp-38h] __int64 s; // [rsp+10h] [rbp-30h] BYREF char v5; // [rsp+18h] [rbp-28h] unsigned __int64 v6; // [rsp+38h] [rbp-8h] v6 = __readfsqword(0x28u); v0 = time(0LL); srand(v0); for ( i = 0; i \u003c= 4; ++i ) { switch ( rand() % 200 ) { case 1: puts(\"OK, it's flag:\"); memset(\u0026s, 0, 0x28uLL); strcat((char *)\u0026s, f1); strcat((char *)\u0026s, \u0026f2); printf(\"%s\", (const char *)\u0026s); break; case 2: printf(\"Solar not like you\"); break; case 3: printf(\"Solar want a girlfriend\"); break; case 4: s = 0x7F666F6067756369LL; v5 = 0; strcat(\u0026f2, (const char *)\u0026s); break; case 5: for ( j = 0; j \u003c= 7; ++j ) { if ( j % 2 == 1 ) *(\u0026f2 + j) -= 2; else --*(\u0026f2 + j); } break; default: puts(\"emmm,you can't find flag 23333\"); break; } } return __readfsqword(0x28u) ^ v6; } 看来flag应该就在这个函数里面，本来觉得可以使用gdb调试出来，无奈自己太菜了，不知道到gdb怎么修改汇编代码进行跳转，只能进行静态分析调试\n进行分析发现，switch 条件的顺序应该是 4 –\u003e 5 —\u003e1的顺序依次输出flag\n写一个脚本将flag数据输出\nflag = 'GXY{do_not_' f2 = [0x7F, 0x66, 0x6F, 0x60, 0x67, 0x75, 0x63, 0x69][::-1] s = '' for i in range(8): if i % 2 == 1: s = chr(f2[i] - 2) else: s = chr(f2[i] - 1) flag += s print(flag) 运行脚本，得到flag\nGXY{do_not_hate_me} 0x5 findit 看下题目哈\n不知不觉，小明长大了，变成了一个程序员，虽然很苦逼，但是偶尔编写个小东西坑害公司新人还是蛮好玩的。新人小萌一天问小明wifi账号密码，一分钟后，小萌收到了一个文件。小萌想了好久都没得到密码，怎么办，女朋友要买东西，流量告罄，没wifi上不了网，不买就分手，是时候该展现月老的实力了兄弟们！代表月亮惩罚小明！得出答案。 注意：得到的 flag 请包上 flag{} 提交 感觉像是一道APK的题目，下载附件发现果然是一个APK的题目，使用APK逆向工具jadx进行逆向\npackage com.example.findit; import android.os.Bundle; import android.support.v7.app.ActionBarActivity; import android.view.MenuItem; import android.view.View; import android.widget.Button; import android.widget.EditText; import android.widget.TextView; public class MainActivity extends ActionBarActivity { /* access modifiers changed from: protected */ @Override // android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); final EditText edit = (EditText) findViewById(R.id.widget2); final TextView text = (TextView) findViewById(R.id.widget1); final char[] a = {'T', 'h', 'i', 's', 'I', 's', 'T', 'h', 'e', 'F', 'l', 'a', 'g', 'H', 'o', 'm', 'e'}; final char[] b = {'p', 'v', 'k', 'q', '{', 'm', '1', '6', '4', '6', '7', '5', '2', '6', '2', '0', '3', '3', 'l', '4', 'm', '4', '9', 'l', 'n', 'p', '7', 'p', '9', 'm', 'n', 'k', '2', '8', 'k', '7', '5', '}'}; ((Button) findViewById(R.id.widget3)).setOnClickListener(new View.OnClickListener() { /* class com.example.findit.MainActivity.AnonymousClass1 */ public void onClick(View v) { char[] x = new char[17]; char[] y = new char[38]; for (int i = 0; i \u003c 17; i++) { if ((a[i] \u003c 'I' \u0026\u0026 a[i] \u003e= 'A') || (a[i] \u003c 'i' \u0026\u0026 a[i] \u003e= 'a')) { x[i] = (char) (a[i] + 18); } else if ((a[i] \u003c 'A' || a[i] \u003e 'Z') \u0026\u0026 (a[i] \u003c 'a' || a[i] \u003e 'z')) { x[i] = a[i]; } else { x[i] = (char) (a[i] - '\\b'); } } if (String.valueOf(x).equals(edit.getText().toString())) { for (int i2 = 0; i2 \u003c 38; i2++) { if ((b[i2] \u003c 'A' || b[i2] \u003e 'Z') \u0026\u0026 (b[i2] \u003c 'a' || b[i2] \u003e 'z')) { y[i2] = b[i2]; } else { y[i2] = (char) (b[i2] + 16); if ((y[i2] \u003e 'Z' \u0026\u0026 y[i2] \u003c 'a') || y[i2] \u003e= 'z') { y[i2] = (char) (y[i2] - 26); } } } text.setText(String.valueOf(y)); return; } text.setText(\"答案错了肿么办。。。不给你又不好意思。。。哎呀好纠结啊~~~\"); } }); } public boolean onOptionsItemSelected(MenuItem item) { if (item.getItemId() == R.id.action_settings) { return true; } return super.onOptionsItemSelected(item); } } 看样子好像是一个简单的加密程序，可以进行简单的分析\n发现主要的flag代码：\nfor (int i2 = 0; i2 \u003c 38; i2++) { if ((b[i2] \u003c 'A' || b[i2] \u003e 'Z') \u0026\u0026 (b[i2] \u003c 'a' || b[i2] \u003e 'z')) { y[i2] = b[i2]; } else { y[i2] = (char) (b[i2] + 16); if ((y[i2] \u003e 'Z' \u0026\u0026 y[i2] \u003c 'a') || y[i2] \u003e= 'z') { y[i2] = (char) (y[i2] - 26); } } } text.setText(String.valueOf(y)); return; 这行代码稍加修改一下运行就可以直接俄得到flag了，写个Java的flag生成器，来生成flag吧！\npackage re; public class Findit { final static char[] b = {'p', 'v', 'k', 'q', '{', 'm', '1', '6', '4', '6', '7', '5', '2', '6', '2', '0', '3', '3', 'l', '4', 'm', '4', '9', 'l', 'n', 'p', '7', 'p', '9', 'm', 'n', 'k', '2', '8', 'k', '7', '5', '}'}; public static void main(String[] args) { char[] y = new char[38]; for (int i2 = 0; i2 \u003c 38; i2++) { if ((b[i2] \u003c 'A' || b[i2] \u003e 'Z') \u0026\u0026 (b[i2] \u003c 'a' || b[i2] \u003e 'z')) { y[i2] = b[i2]; } else { y[i2] = (char) (b[i2] + 16); if ((y[i2] \u003e 'Z' \u0026\u0026 y[i2] \u003c 'a') || y[i2] \u003e= 'z') { y[i2] = (char) (y[i2] - 26); } } } System.out.println(String.valueOf(y)); }\t} 运行一下这个java程序就能生成flag啦！\nflag{c164675262033b4c49bdf7f9cda28a75} 0x6 简单的注册器 看下题目\n生活中难免会有需要使用一些付费的程序，但是没有绿色版怎么办？只能自己逆向看看注册程序的代码是什么逻辑了。 注意：得到的 flag 请包上 flag{} 提交 下载附件，发现是一个apk文件，使用apk逆向工具jadx查看apk的伪代码\npackage com.example.flag; import android.os.Bundle; import android.support.v4.app.Fragment; import android.support.v7.app.ActionBarActivity; import android.view.LayoutInflater; import android.view.Menu; import android.view.MenuItem; import android.view.View; import android.view.ViewGroup; import android.widget.Button; import android.widget.EditText; import android.widget.TextView; public class MainActivity extends ActionBarActivity { /* access modifiers changed from: protected */ @Override // android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity public void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); if (savedInstanceState == null) { getSupportFragmentManager().beginTransaction().add(R.id.container, new PlaceholderFragment()).commit(); } final TextView textview = (TextView) findViewById(R.id.textView1); final EditText editview = (EditText) findViewById(R.id.editText1); ((Button) findViewById(R.id.button1)).setOnClickListener(new View.OnClickListener() { /* class com.example.flag.MainActivity.AnonymousClass1 */ public void onClick(View v) { int flag = 1; String xx = editview.getText().toString(); if (!(xx.length() == 32 \u0026\u0026 xx.charAt(31) == 'a' \u0026\u0026 xx.charAt(1) == 'b' \u0026\u0026 (xx.charAt(0) + xx.charAt(2)) - 48 == 56)) { flag = 0; } if (flag == 1) { char[] x = \"dd2940c04462b4dd7c450528835cca15\".toCharArray(); x[2] = (char) ((x[2] + x[3]) - 50); x[4] = (char) ((x[2] + x[5]) - 48); x[30] = (char) ((x[31] + x[9]) - 48); x[14] = (char) ((x[27] + x[28]) - 97); for (int i = 0; i \u003c 16; i++) { char a = x[31 - i]; x[31 - i] = x[i]; x[i] = a; } textview.setText(\"flag{\" + String.valueOf(x) + \"}\"); return; } textview.setText(\"输入注册码错误\"); } }); } public boolean onCreateOptionsMenu(Menu menu) { getMenuInflater().inflate(R.menu.main, menu); return true; } public boolean onOptionsItemSelected(MenuItem item) { if (item.getItemId() == R.id.action_settings) { return true; } return super.onOptionsItemSelected(item); } public static class PlaceholderFragment extends Fragment { @Override // android.support.v4.app.Fragment public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) { return inflater.inflate(R.layout.fragment_main, container, false); } } } 进行简单的代码审计，可以确定核心代码：\nif (flag == 1) { char[] x = \"dd2940c04462b4dd7c450528835cca15\".toCharArray(); x[2] = (char) ((x[2] + x[3]) - 50); x[4] = (char) ((x[2] + x[5]) - 48); x[30] = (char) ((x[31] + x[9]) - 48); x[14] = (char) ((x[27] + x[28]) - 97); for (int i = 0; i \u003c 16; i++) { char a = x[31 - i]; x[31 - i] = x[i]; x[i] = a; } textview.setText(\"flag{\" + String.valueOf(x) + \"}\"); return; } 写一个Java注册器，把flag注册出来\npackage re; public class Register { public static void main(String[] args) { char[] x = \"dd2940c04462b4dd7c450528835cca15\".toCharArray(); x[2] = (char) ((x[2] + x[3]) - 50); x[4] = (char) ((x[2] + x[5]) - 48); x[30] = (char) ((x[31] + x[9]) - 48); x[14] = (char) ((x[27] + x[28]) - 97); for (int i = 0; i \u003c 16; i++) { char a = x[31 - i]; x[31 - i] = x[i]; x[i] = a; } System.out.println(\"flag{\" + String.valueOf(x) + \"}\"); } } 运行注册器来注册一个flag\nflag{59acc538825054c7de4b26440c0999dd} 0x7 [BJDCTF2020]JustRE 下载下来是一个挺有意思的exe程序\n走下流程，首先是查询文件\n32位的PE程序，使用IDA pro反汇编通过检索BJD的字符串来定位到核心代码\nINT_PTR __stdcall DialogFunc(HWND hWnd, UINT a2, WPARAM a3, LPARAM a4) { CHAR String[100]; // [esp+0h] [ebp-64h] BYREF if ( a2 != 272 ) { if ( a2 != 273 ) return 0; if ( (_WORD)a3 != 1 \u0026\u0026 (_WORD)a3 != 2 ) { sprintf(String, Format, ++dword_4099F0); if ( dword_4099F0 == 19999 ) { sprintf(String, \" BJD{%d%d2069a45792d233ac}\", 19999, 0); SetWindowTextA(hWnd, String); return 0; } SetWindowTextA(hWnd, String); return 0; } EndDialog(hWnd, (unsigned __int16)a3); } return 1; } 发现核心代码中隐藏着flag的信息，得到flag\nBJD{1999902069a45792d233ac} ","wordCount":"3647","inLanguage":"en","datePublished":"2022-01-28T19:18:38+08:00","dateModified":"2022-01-28T19:18:38+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/buuctf-reverse-2_writeup/"},"publisher":{"@type":"Organization","name":"Jasmine❀Hiker","logo":{"@type":"ImageObject","url":"favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/categories/ title=Categories><span>Categories</span></a></li><li><a href=/tags/ title=Tags><span>Tags</span></a></li><li><a href=/posts/ title=Posts><span>Posts</span></a></li><li><a href=/about/ title=About><span>About</span></a></li><li><a href=/link/ title=Link><span>Link</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/posts/>Posts</a></div><h1 class=post-title>BUUCTF REVERSE [9~16]_Writeup</h1><div class=post-meta><span title='2022-01-28 19:18:38 +0800 CST'>January 28, 2022</span>&nbsp;·&nbsp;18 min&nbsp;·&nbsp;3647 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#buuctf-reverse-2-writeup aria-label="BUUCTF-REVERSE-2 writeup">BUUCTF-REVERSE-2 writeup</a><ul><li><a href=#0x0-%e4%b8%8d%e4%b8%80%e6%a0%b7%e7%9a%84flag aria-label="0x0 不一样的flag">0x0 不一样的flag</a></li><li><a href=#0x1-simplerev aria-label="0x1 SimpleRev">0x1 SimpleRev</a></li><li><a href=#0x2-java%e9%80%86%e5%90%91%e8%a7%a3%e5%af%86 aria-label="0x2 Java逆向解密">0x2 Java逆向解密</a></li><li><a href=#0x3-%e5%88%ae%e5%bc%80%e6%9c%89%e5%a5%96 aria-label="0x3 刮开有奖">0x3 刮开有奖</a></li><li><a href=#0x4-gxyctf2019luck_guy aria-label="0x4 [GXYCTF2019]luck_guy">0x4 [GXYCTF2019]luck_guy</a></li><li><a href=#0x5-findit aria-label="0x5 findit">0x5 findit</a></li><li><a href=#0x6-%e7%ae%80%e5%8d%95%e7%9a%84%e6%b3%a8%e5%86%8c%e5%99%a8 aria-label="0x6 简单的注册器">0x6 简单的注册器</a></li><li><a href=#0x7-bjdctf2020justre aria-label="0x7 [BJDCTF2020]JustRE">0x7 [BJDCTF2020]JustRE</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=buuctf-reverse-2-writeup>BUUCTF-REVERSE-2 writeup<a hidden class=anchor aria-hidden=true href=#buuctf-reverse-2-writeup>#</a></h1><p>8道逆向工程的小题目，re真是越来越有意思了</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210808095050806.png alt=image-20210808095050806></p><h2 id=0x0-不一样的flag>0x0 不一样的flag<a hidden class=anchor aria-hidden=true href=#0x0-不一样的flag>#</a></h2><p>简单看看题目描述</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>是不是做习惯了常规的逆向题目？试试这道题，看你在能不能在程序中找到真正的flag！注意：flag并非是flag{XXX}形式，就是一个’字符串‘，考验眼力的时候到了！ 注意：得到的 flag 请包上 flag{} 提交
</span></span></code></pre></div><p>应该会是一道非常有趣的题目，非常有意思的题目。</p><p>首先还是先查询一下程序信息</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210808211004969.png alt=image-20210808211004969></p><p>没有壳，是一个32位的PE程序，丢进Cutter里面看个究竟吧</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span> 
</span></span><span class=line><span class=cl><span class=kt>int32_t</span> <span class=nf>dbg_main</span> <span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int32_t</span> <span class=n>var_4h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=p>[</span><span class=mi>5</span><span class=p>][</span><span class=mi>5</span><span class=p>]</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=n>location</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int32_t</span> <span class=n>var_34h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int32_t</span> <span class=n>choice</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int32_t</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int32_t</span> <span class=n>var_40h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* int main(); */</span>
</span></span><span class=line><span class=cl>    <span class=nf>_main</span> <span class=p>(</span><span class=n>ebx</span><span class=p>,</span> <span class=n>esi</span><span class=p>,</span> <span class=n>edi</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>var_34h</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ebx</span> <span class=o>=</span> <span class=s>&#34;*11110100001010000101111#&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>=</span> <span class=mh>0x19</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>edi</span> <span class=o>=</span> <span class=n>edx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>esi</span> <span class=o>=</span> <span class=n>ebx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>eax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=p>(</span><span class=nl>es</span><span class=p>:</span><span class=n>edi</span><span class=p>)</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>esi</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ecx</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>esi</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nl>es</span><span class=p>:</span><span class=n>edi</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=n>ecx</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>label_1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>label_0</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=nl>label_1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;you can choose one action to execute&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;1 up&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;2 down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;3 left&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_printf</span> <span class=p>(</span><span class=s>&#34;4 right</span><span class=se>\n</span><span class=s>:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>choice</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>_scanf</span> <span class=p>(</span><span class=mh>0x403066</span><span class=p>,</span> <span class=n>eax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>=</span> <span class=n>choice</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>&lt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>==</span> <span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>goto</span> <span class=n>label_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>eax</span> <span class=o>=</span> <span class=n>location</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>eax</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>location</span> <span class=o>=</span> <span class=n>eax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>eax</span> <span class=o>=</span> <span class=n>location</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>eax</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>location</span> <span class=o>=</span> <span class=n>eax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>goto</span> <span class=n>label_3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>eax</span> <span class=o>=</span> <span class=n>var_34h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>eax</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>var_34h</span> <span class=o>=</span> <span class=n>eax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>goto</span> <span class=n>label_3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>label_2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>eax</span> <span class=o>=</span> <span class=n>var_34h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>eax</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>var_34h</span> <span class=o>=</span> <span class=n>eax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>goto</span> <span class=n>label_3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>_exit</span> <span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nl>label_3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>eax</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>eax</span> <span class=o>=</span> <span class=o>*</span><span class=p>((</span><span class=n>esp</span> <span class=o>+</span> <span class=n>eax</span><span class=o>*</span><span class=mi>4</span> <span class=o>+</span> <span class=mh>0x30</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>eax</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>eax</span> <span class=o>=</span> <span class=o>*</span><span class=p>((</span><span class=n>esp</span> <span class=o>+</span> <span class=n>eax</span><span class=o>*</span><span class=mi>4</span> <span class=o>+</span> <span class=mh>0x30</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>eax</span> <span class=o>&lt;=</span> <span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>goto</span> <span class=n>label_4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>_exit</span> <span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nl>label_4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=n>location</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>var_34h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>=</span> <span class=n>edx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>&lt;&lt;=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>+=</span> <span class=n>edx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>var_40h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>+=</span> <span class=n>edx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>+=</span> <span class=n>ecx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>-=</span> <span class=mh>0x29</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>al</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>eax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>al</span> <span class=o>==</span> <span class=mh>0x31</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>_exit</span> <span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=n>location</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>var_34h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>=</span> <span class=n>edx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>&lt;&lt;=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>+=</span> <span class=n>edx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>esi</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>var_40h</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>+=</span> <span class=n>esi</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>+=</span> <span class=n>ecx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>eax</span> <span class=o>-=</span> <span class=mh>0x29</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>al</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>eax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>al</span> <span class=o>!=</span> <span class=mh>0x23</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>goto</span> <span class=n>label_0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>ok, the order you enter is the flag!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_exit</span> <span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>根据反编译的代码，可以发现这道题目是一个走迷宫的题目，总体而言，还是挺有意思的，找到迷宫数据然后走出迷宫。</p><p>根据迷宫的特性，需要寻找一下一些关键性的信息，来完成迷宫的</p><p>首先是迷宫的信息，可以从反编译的关键代码找到迷宫信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl> <span class=n>ebx</span> <span class=o>=</span> <span class=s>&#34;*11110100001010000101111#&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p>将数据整合一下便得到如下内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>*1111
</span></span><span class=line><span class=cl>01000
</span></span><span class=line><span class=cl>01010
</span></span><span class=line><span class=cl>00010
</span></span><span class=line><span class=cl>1111#
</span></span></code></pre></div><p>对于这个数据可以非常清晰看出迷宫的形式，*是起点，#是终点，1不能通行，0可以通行。</p><p>然后是寻找操作指令，自然也可以从反编译代码中找到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;you can choose one action to execute&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;1 up&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;2 down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_puts</span> <span class=p>(</span><span class=s>&#34;3 left&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_printf</span> <span class=p>(</span><span class=s>&#34;4 right</span><span class=se>\n</span><span class=s>:&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>根据迷宫和操作数，就可以得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{222441144222}
</span></span></code></pre></div><h2 id=0x1-simplerev>0x1 SimpleRev<a hidden class=anchor aria-hidden=true href=#0x1-simplerev>#</a></h2><p>首先查一下程序信息，看看程序具体是个什么</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210809170725758.png alt=image-20210809170725758></p><p>是一个Linux程序，使用x64 IDA pro进行打开</p><p>找到main函数位置，查看反编译代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=n>__noreturn</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+Fh] [rbp-1h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Welcome to CTF game!</span><span class=se>\n</span><span class=s>Please input d/D to start or input q/Q to quit this program: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v4</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>!=</span> <span class=mi>100</span> <span class=o>&amp;&amp;</span> <span class=n>v4</span> <span class=o>!=</span> <span class=mi>68</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nf>Decry</span><span class=p>(</span><span class=s>&#34;Welcome to CTF game!</span><span class=se>\n</span><span class=s>Please input d/D to start or input q/Q to quit this program: &#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>==</span> <span class=mi>113</span> <span class=o>||</span> <span class=n>v4</span> <span class=o>==</span> <span class=mi>81</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nf>Exit</span><span class=p>(</span><span class=s>&#34;Welcome to CTF game!</span><span class=se>\n</span><span class=s>Please input d/D to start or input q/Q to quit this program: &#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Input fault format!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>putchar</span><span class=p>(</span><span class=n>v3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>对反编译的代码进行简单的审计，发现Decry函数是关键函数，可以看看这个函数的具体实现细节</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=nf>Decry</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// [rsp+Fh] [rbp-51h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [rsp+10h] [rbp-50h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [rsp+14h] [rbp-4Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-48h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp+1Ch] [rbp-44h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>src</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span> <span class=c1>// [rsp+20h] [rbp-40h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [rsp+28h] [rbp-38h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [rsp+30h] [rbp-30h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v9</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span> <span class=c1>// [rsp+40h] [rbp-20h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// [rsp+50h] [rbp-10h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [rsp+58h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v11</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>src</span> <span class=o>=</span> <span class=mh>0x534C43444ELL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v9</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x776F646168LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v9</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v10</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>text</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>join</span><span class=p>(</span><span class=n>key3</span><span class=p>,</span> <span class=n>v9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>strcpy</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>key1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>strcat</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>src</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>v5</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>64</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>90</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>key</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input your flag:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>10</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>32</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=o>++</span><span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>&lt;=</span> <span class=mi>96</span> <span class=o>||</span> <span class=n>v1</span> <span class=o>&gt;</span> <span class=mi>122</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>&gt;</span> <span class=mi>64</span> <span class=o>&amp;&amp;</span> <span class=n>v1</span> <span class=o>&lt;=</span> <span class=mi>90</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>str2</span><span class=p>[</span><span class=n>v2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>v1</span> <span class=o>-</span> <span class=mi>39</span> <span class=o>-</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>97</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>str2</span><span class=p>[</span><span class=n>v2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>v1</span> <span class=o>-</span> <span class=mi>39</span> <span class=o>-</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>97</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=p>(</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>putchar</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=o>++</span><span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>str2</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Congratulation!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Try again!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>)</span> <span class=o>^</span> <span class=n>v11</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>根据函数的核心代码可以知道，最开始的数据是</p><blockquote><p>Intel CPU/AMD CPU 计算机内部的数据存储的方式是以小端序存储的方式，因此部分数据是以颠倒方式进行存储的</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>text = &#39;killshadow&#39;
</span></span><span class=line><span class=cl>key =  &#39;ADSFKNDCLS&#39;
</span></span></code></pre></div><p>现在有原始数据就可以进一步对算法进行分析</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>10</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>32</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>&lt;=</span> <span class=mi>96</span> <span class=o>||</span> <span class=n>v1</span> <span class=o>&gt;</span> <span class=mi>122</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>&gt;</span> <span class=mi>64</span> <span class=o>&amp;&amp;</span> <span class=n>v1</span> <span class=o>&lt;=</span> <span class=mi>90</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>str2</span><span class=p>[</span><span class=n>v2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>v1</span> <span class=o>-</span> <span class=mi>39</span> <span class=o>-</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>97</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>str2</span><span class=p>[</span><span class=n>v2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>v1</span> <span class=o>-</span> <span class=mi>39</span> <span class=o>-</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>97</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=p>(</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>putchar</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>str2</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Congratulation!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Try again!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>对代码观察可以发现，最终的逻辑判断是<code>text</code>的数据和<code>str2</code>的数据相等</p><p>根据对于程序的逻辑判断，编写逆向算法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>v2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>v3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>	<span class=kt>char</span> <span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>string</span> <span class=n>text</span> <span class=o>=</span> <span class=s>&#34;killshadow&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>string</span> <span class=n>key</span> <span class=o>=</span> <span class=s>&#34;ADSFKNDCLS&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>char</span> <span class=n>flag</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=kt>char</span> <span class=n>str2</span><span class=p>[</span><span class=mi>104</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span>	
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>v5</span> <span class=o>=</span> <span class=n>key</span><span class=p>.</span><span class=n>length</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>v5</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>64</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>90</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      		<span class=n>key</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    	<span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>v2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>v2</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=o>++</span><span class=n>v2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>v1</span> <span class=o>=</span> <span class=n>text</span><span class=p>[</span><span class=n>v2</span><span class=p>]</span> <span class=o>-</span> <span class=mi>97</span> <span class=o>+</span> <span class=mi>26</span> <span class=o>*</span> <span class=n>j</span> <span class=o>-</span> <span class=mi>97</span> <span class=o>+</span> <span class=n>key</span><span class=p>[</span><span class=n>v3</span><span class=o>++</span> <span class=o>%</span> <span class=n>v5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>39</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=n>v1</span> <span class=o>&gt;=</span> <span class=mi>65</span> <span class=o>&amp;&amp;</span> <span class=n>v1</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=n>v1</span> <span class=o>&gt;=</span> <span class=mi>97</span> <span class=o>&amp;&amp;</span> <span class=n>v1</span> <span class=o>&lt;=</span> <span class=mi>122</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span><span class=p>[</span><span class=n>v2</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=o>++</span><span class=n>n</span> <span class=o>==</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>flag</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>system</span><span class=p>(</span><span class=s>&#34;PAUSE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>system</span><span class=p>(</span><span class=s>&#34;PAUSE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>运行得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>KLDQCUDFZO
</span></span></code></pre></div><h2 id=0x2-java逆向解密>0x2 Java逆向解密<a hidden class=anchor aria-hidden=true href=#0x2-java逆向解密>#</a></h2><p>Java逆向的题目，本质上和安卓逆向有着异曲同工之处，可以使用安卓逆向工具进行打开，这里使用Jadx打开</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>defpackage</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Scanner</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* renamed from: Reverse  reason: default package */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Reverse</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Scanner</span> <span class=n>s</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Scanner</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Please input the flag ：&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Your input is ：&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>str</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Encrypt</span><span class=o>(</span><span class=n>str</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>Encrypt</span><span class=o>(</span><span class=kt>char</span><span class=o>[]</span> <span class=n>arr</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>KEY</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>Resultlist</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>char</span> <span class=n>c</span> <span class=o>:</span> <span class=n>arr</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Resultlist</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>((</span><span class=n>c</span> <span class=o>+</span> <span class=sc>&#39;@&#39;</span><span class=o>)</span> <span class=o>^</span> <span class=mi>32</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>KEYList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>:</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[]{</span><span class=mi>180</span><span class=o>,</span> <span class=mi>136</span><span class=o>,</span> <span class=mi>137</span><span class=o>,</span> <span class=mi>147</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>137</span><span class=o>,</span> <span class=mi>147</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>148</span><span class=o>,</span> <span class=mi>136</span><span class=o>,</span> <span class=mi>133</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>134</span><span class=o>,</span> <span class=mi>140</span><span class=o>,</span> <span class=mi>129</span><span class=o>,</span> <span class=mi>135</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>65</span><span class=o>})</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>KEYList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Result:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>Resultlist</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>KEYList</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Congratulations！&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Error！&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>应该就是最基本的代码审计</p><p>关键代码其实就在<code>Encrypt</code>函数里面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>Encrypt</span><span class=o>(</span><span class=kt>char</span><span class=o>[]</span> <span class=n>arr</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>KEY</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>Resultlist</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>char</span> <span class=n>c</span> <span class=o>:</span> <span class=n>arr</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Resultlist</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>((</span><span class=n>c</span> <span class=o>+</span> <span class=sc>&#39;@&#39;</span><span class=o>)</span> <span class=o>^</span> <span class=mi>32</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>KEYList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>:</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[]{</span><span class=mi>180</span><span class=o>,</span> <span class=mi>136</span><span class=o>,</span> <span class=mi>137</span><span class=o>,</span> <span class=mi>147</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>137</span><span class=o>,</span> <span class=mi>147</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>148</span><span class=o>,</span> <span class=mi>136</span><span class=o>,</span> <span class=mi>133</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>134</span><span class=o>,</span> <span class=mi>140</span><span class=o>,</span> <span class=mi>129</span><span class=o>,</span> <span class=mi>135</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>65</span><span class=o>})</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>KEYList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Result:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>Resultlist</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>KEYList</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Congratulations！&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Error！&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><p>应该是一个注册码校验程序，写一个java程序逆过去应该就可以得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>re</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>JavaRe</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>KEYList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>:</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[]{</span><span class=mi>180</span><span class=o>,</span> <span class=mi>136</span><span class=o>,</span> <span class=mi>137</span><span class=o>,</span> <span class=mi>147</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>137</span><span class=o>,</span> <span class=mi>147</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>148</span><span class=o>,</span> <span class=mi>136</span><span class=o>,</span> <span class=mi>133</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>134</span><span class=o>,</span> <span class=mi>140</span><span class=o>,</span> <span class=mi>129</span><span class=o>,</span> <span class=mi>135</span><span class=o>,</span> <span class=mi>191</span><span class=o>,</span> <span class=mi>65</span><span class=o>})</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>KEYList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>Resultlist</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>c</span> <span class=o>:</span> <span class=n>KEYList</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Resultlist</span><span class=o>.</span><span class=na>add</span><span class=o>(((</span><span class=kt>char</span><span class=o>)((</span><span class=n>c</span><span class=o>^</span> <span class=mi>32</span><span class=o>)-</span><span class=sc>&#39;@&#39;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>flag</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=kt>char</span> <span class=n>c</span><span class=o>:</span><span class=n>Resultlist</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        	<span class=n>flag</span> <span class=o>+=</span> <span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>flag</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>运行Java程序就可以得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>This_is_the_flag_!
</span></span></code></pre></div><h2 id=0x3-刮开有奖>0x3 刮开有奖<a hidden class=anchor aria-hidden=true href=#0x3-刮开有奖>#</a></h2><p>看下题目：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>这是一个赌博程序，快去赚钱吧！！！！！！！！！！！！！！！！！！！！！！！！！！！(在编辑框中的输入值，即为flag，提交即可) 注意：得到的 flag 请包上 flag{} 提交
</span></span></code></pre></div><p>先查一下壳：</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210901182834092.png alt=image-20210901182834092></p><p>没壳，32位的程序，使用IDA pro打开</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__stdcall</span> <span class=nf>WinMain</span><span class=p>(</span><span class=n>HINSTANCE</span> <span class=n>hInstance</span><span class=p>,</span> <span class=n>HINSTANCE</span> <span class=n>hPrevInstance</span><span class=p>,</span> <span class=n>LPSTR</span> <span class=n>lpCmdLine</span><span class=p>,</span> <span class=kt>int</span> <span class=n>nShowCmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>DialogBoxParamA</span><span class=p>(</span><span class=n>hInstance</span><span class=p>,</span> <span class=p>(</span><span class=n>LPCSTR</span><span class=p>)</span><span class=mh>0x67</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>DialogFunc</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>看样子是调用了一个WIN32的API函数，关键的代码应该是在DialogFunc函数代码中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>INT_PTR</span> <span class=kr>__stdcall</span> <span class=nf>DialogFunc</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hDlg</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>a2</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>a3</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>a4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>v4</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>v5</span><span class=p>;</span> <span class=c1>// edi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span> <span class=c1>// [esp+8h] [ebp-20030h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [esp+10h] [ebp-20028h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// [esp+14h] [ebp-20024h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// [esp+18h] [ebp-20020h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [esp+1Ch] [ebp-2001Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v12</span><span class=p>;</span> <span class=c1>// [esp+20h] [ebp-20018h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v13</span><span class=p>;</span> <span class=c1>// [esp+24h] [ebp-20014h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v14</span><span class=p>;</span> <span class=c1>// [esp+28h] [ebp-20010h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v15</span><span class=p>;</span> <span class=c1>// [esp+2Ch] [ebp-2000Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v16</span><span class=p>;</span> <span class=c1>// [esp+30h] [ebp-20008h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>CHAR</span> <span class=n>String</span><span class=p>[</span><span class=mi>65536</span><span class=p>];</span> <span class=c1>// [esp+34h] [ebp-20004h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v18</span><span class=p>[</span><span class=mi>65536</span><span class=p>];</span> <span class=c1>// [esp+10034h] [ebp-10004h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>==</span> <span class=mi>272</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>!=</span> <span class=mi>273</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=n>_WORD</span><span class=p>)</span><span class=n>a3</span> <span class=o>==</span> <span class=mi>1001</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0xFFFFu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>GetDlgItemTextA</span><span class=p>(</span><span class=n>hDlg</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=n>String</span><span class=p>,</span> <span class=mh>0xFFFF</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>String</span><span class=p>)</span> <span class=o>==</span> <span class=mi>8</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v7</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>90</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v7</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>74</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v8</span> <span class=o>=</span> <span class=mi>83</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v9</span> <span class=o>=</span> <span class=mi>69</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v10</span> <span class=o>=</span> <span class=mi>67</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v11</span> <span class=o>=</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v12</span> <span class=o>=</span> <span class=mi>78</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v13</span> <span class=o>=</span> <span class=mi>72</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v14</span> <span class=o>=</span> <span class=mi>51</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v15</span> <span class=o>=</span> <span class=mi>110</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v16</span> <span class=o>=</span> <span class=mi>103</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_4010F0</span><span class=p>(</span><span class=n>v7</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>memset</span><span class=p>(</span><span class=n>v18</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0xFFFFu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>String</span><span class=p>[</span><span class=mi>5</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>String</span><span class=p>[</span><span class=mi>7</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>String</span><span class=p>[</span><span class=mi>6</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>v4</span> <span class=o>=</span> <span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>sub_401000</span><span class=p>(</span><span class=n>v18</span><span class=p>,</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>v18</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nf>memset</span><span class=p>(</span><span class=n>v18</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0xFFFFu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>String</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>String</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>String</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>v5</span> <span class=o>=</span> <span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>sub_401000</span><span class=p>(</span><span class=n>v18</span><span class=p>,</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>v18</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>String</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>v7</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>34</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=n>String</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>v10</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>String</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=mi>141</span> <span class=o>==</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>v8</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=n>String</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>/</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>2</span> <span class=o>*</span> <span class=p>(</span><span class=n>v13</span> <span class=o>/</span> <span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>v4</span><span class=p>,</span> <span class=s>&#34;ak1w&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=s>&#34;V1Ax&#34;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>MessageBoxA</span><span class=p>(</span><span class=n>hDlg</span><span class=p>,</span> <span class=s>&#34;U g3t 1T!&#34;</span><span class=p>,</span> <span class=s>&#34;@_@&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=n>_WORD</span><span class=p>)</span><span class=n>a3</span> <span class=o>!=</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>_WORD</span><span class=p>)</span><span class=n>a3</span> <span class=o>!=</span> <span class=mi>2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>EndDialog</span><span class=p>(</span><span class=n>hDlg</span><span class=p>,</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int16</span><span class=p>)</span><span class=n>a3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>也是调用了几个WIN32的API，对代码进行分析</p><p>可以知道：</p><p><code>GetDlgItemTextA</code> 函数是获取输入的字符串</p><p>这段代码对字符串进行了处理，主要是有两个处理函数<code>sub_4010F0</code> 和 <code>sub_401000</code></p><p>这个函数应该是处理这个程序字符串的关键函数</p><p>先来看看sub_4010F0函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_4010F0</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// ecx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=n>a3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=n>a2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>a3</span><span class=p>;</span> <span class=n>a2</span> <span class=o>=</span> <span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v5</span> <span class=o>=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v6</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>4</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>&lt;</span> <span class=n>result</span> <span class=o>&amp;&amp;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>do</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v6</span> <span class=o>&gt;</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>result</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=o>++</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>v5</span> <span class=o>+</span> <span class=n>a1</span><span class=p>)</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>while</span> <span class=p>(</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>i</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>v6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=o>++</span><span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=k>goto</span> <span class=n>LABEL_13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v5</span> <span class=o>=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>result</span><span class=p>)</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=mi>4</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>--</span><span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>while</span> <span class=p>(</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>result</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nl>LABEL_13</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>result</span><span class=p>)</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_4010F0</span><span class=p>(</span><span class=n>a1</span><span class=p>,</span> <span class=n>a2</span><span class=p>,</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>a3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>代码的功能暂时不太清楚，毕竟对C语言的审计功底还是不是很到位，根据代码进行转换为相应的Cpp代码运行一下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_4010F0</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// ecx
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>a3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>a2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>a3</span><span class=p>;</span> <span class=n>a2</span> <span class=o>=</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v5</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>v6</span> <span class=o>=</span> <span class=n>a1</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>a2</span> <span class=o>&lt;</span> <span class=n>result</span> <span class=o>&amp;&amp;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>do</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>v6</span> <span class=o>&gt;</span><span class=n>a1</span><span class=p>[</span><span class=n>result</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=o>++</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>a1</span><span class=p>[</span><span class=n>v5</span><span class=p>]</span> <span class=o>=</span> <span class=n>a1</span><span class=p>[</span><span class=n>result</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>v6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=o>++</span><span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=k>goto</span> <span class=n>LABEL_13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;=</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>v5</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>a1</span><span class=p>[</span><span class=n>result</span><span class=p>]</span> <span class=o>=</span> <span class=n>a1</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=o>--</span><span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nl>LABEL_13</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>a1</span><span class=p>[</span><span class=n>result</span><span class=p>]</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>sub_4010F0</span><span class=p>(</span><span class=n>a1</span><span class=p>,</span> <span class=n>a2</span><span class=p>,</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>a3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>char</span> <span class=n>v7</span><span class=p>[</span><span class=mi>11</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>v7</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>90</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>74</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>83</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=mi>69</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=mi>67</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=mi>97</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>=</span> <span class=mi>78</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=mi>72</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>=</span> <span class=mi>51</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>=</span> <span class=mi>110</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v7</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=mi>103</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>v7</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_4010F0</span><span class=p>(</span><span class=n>v7</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span> <span class=mi>11</span><span class=p>;</span><span class=o>++</span><span class=n>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    	<span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v7</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>system</span><span class=p>(</span><span class=s>&#34;PAUSE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>运行代码，得到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ZJSECaNH3ng
</span></span><span class=line><span class=cl><span class=m>51</span>      <span class=m>67</span>      <span class=m>69</span>      <span class=m>72</span>      <span class=m>74</span>      <span class=m>78</span>      <span class=m>83</span>      <span class=m>90</span>      <span class=m>97</span>      <span class=m>103</span>     <span class=m>110</span>
</span></span></code></pre></div><p>看来应该是一个排序算法，按升序进行排序的</p><p>下面分析另一个函数具体是个什么东西：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>_BYTE</span> <span class=o>*</span><span class=kr>__cdecl</span> <span class=nf>sub_401000</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>size_t</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// ebx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=o>*</span><span class=n>v5</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=o>*</span><span class=n>v6</span><span class=p>;</span> <span class=c1>// edi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=o>*</span><span class=n>v8</span><span class=p>;</span> <span class=c1>// ebx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// edi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// edx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// edi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v12</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// esi
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=o>*</span><span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=o>*</span><span class=n>v15</span><span class=p>;</span> <span class=c1>// [esp+Ch] [ebp-10h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=o>*</span><span class=n>v16</span><span class=p>;</span> <span class=c1>// [esp+10h] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v17</span><span class=p>;</span> <span class=c1>// [esp+14h] [ebp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v18</span><span class=p>;</span> <span class=c1>// [esp+18h] [ebp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=n>a2</span> <span class=o>/</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>v2</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v15</span> <span class=o>=</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>v5</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=n>a2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v16</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v9</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v10</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v18</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>do</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v3</span> <span class=o>&gt;=</span> <span class=n>v7</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>v10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>v9</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=p>)(</span><span class=n>v3</span> <span class=o>+</span> <span class=n>a1</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>v9</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>while</span> <span class=p>(</span> <span class=n>v10</span> <span class=o>&lt;</span> <span class=mi>3</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v11</span> <span class=o>=</span> <span class=n>v9</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=mi>8</span> <span class=o>*</span> <span class=p>(</span><span class=mi>3</span> <span class=o>-</span> <span class=n>v10</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=n>v12</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v17</span> <span class=o>=</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>18</span><span class=p>;</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>6</span><span class=p>;</span> <span class=n>i</span> <span class=o>-=</span> <span class=mi>6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v10</span> <span class=o>&gt;=</span> <span class=n>v12</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=p>((</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v18</span> <span class=o>+</span> <span class=n>v12</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=n>v11</span> <span class=o>&gt;&gt;</span> <span class=n>i</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x3F</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>v8</span> <span class=o>=</span> <span class=n>v16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=p>((</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v18</span> <span class=o>+</span> <span class=n>v12</span><span class=p>)</span> <span class=o>=</span> <span class=mi>64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>v8</span><span class=o>++</span> <span class=o>=</span> <span class=n>byte_407830</span><span class=p>[</span><span class=o>*</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v18</span> <span class=o>+</span> <span class=n>v12</span><span class=o>++</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>        <span class=n>v16</span> <span class=o>=</span> <span class=n>v8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=n>v3</span> <span class=o>=</span> <span class=n>v17</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>v17</span> <span class=o>&gt;=</span> <span class=n>a2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>v7</span> <span class=o>=</span> <span class=n>a2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>v6</span> <span class=o>=</span> <span class=n>v15</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>v8</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>看代码，发现有3和8移位的特征初步推测是base64编码，看到有一个<code>byte_407830</code>的数组，跟进点开查看数据内容</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210901203207491.png alt=image-20210901203207491></p><p>看到这数据应该就可以断定是base64编码了。</p><p>现在知道了两个函数的功能作用，可以直接进行求解，直接定位到判断条件的位置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=n>String</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>v7</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>34</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=n>String</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>v10</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>String</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=mi>141</span> <span class=o>==</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>v8</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=n>String</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>/</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>2</span> <span class=o>*</span> <span class=p>(</span><span class=n>v13</span> <span class=o>/</span> <span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>v4</span><span class=p>,</span> <span class=s>&#34;ak1w&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=s>&#34;V1Ax&#34;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>MessageBoxA</span><span class=p>(</span><span class=n>hDlg</span><span class=p>,</span> <span class=s>&#34;U g3t 1T!&#34;</span><span class=p>,</span> <span class=s>&#34;@_@&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span></code></pre></div><p>进行简单的推断可以得出</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>String</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>85</span><span class=p>;</span> <span class=c1>// 51+34 = 85
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>String</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>74</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>String</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>87</span><span class=p>;</span> <span class=c1>//(3 x 69 +141)/4 = 87
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>String</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>80</span><span class=p>;</span><span class=c1>// 2 x (90 / 9) x4 == 80
</span></span></span></code></pre></div><p>下面进行base64解码来得到后面四个字符的数据</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>b<span class=s1>&#39;jMp&#39;</span>
</span></span><span class=line><span class=cl>b<span class=s1>&#39;WP1&#39;</span>
</span></span></code></pre></div><p>根据推断出来的信息可以求解得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>UJWP1jMp
</span></span></code></pre></div><hr><p>也可以使用Python脚本快速求解</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=mi>51</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>69</span><span class=p>,</span> <span class=mi>72</span><span class=p>,</span> <span class=mi>74</span><span class=p>,</span> <span class=mi>78</span><span class=p>,</span> <span class=mi>83</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>97</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>110</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=mi>34</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=o>+=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=s2>&#34;V1Ax&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=o>+=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=s2>&#34;ak1w&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;flag{&#34;</span><span class=o>+</span><span class=n>String</span><span class=o>+</span><span class=s2>&#34;}&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本就可以得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{UJWP1jMp}
</span></span></code></pre></div><h2 id=0x4-gxyctf2019luck_guy>0x4 [GXYCTF2019]luck_guy<a hidden class=anchor aria-hidden=true href=#0x4-gxyctf2019luck_guy>#</a></h2><p>文件没有拓展名，感觉是一个ELF格式的文件</p><p>先走一下逆向的流程，首先查下壳</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210902074301328.png alt=image-20210902074301328></p><p>果然是一个ELF文件，64位的文件，用x64 IDA pro打开文件，查看主程序</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [rsp+14h] [rbp-Ch] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>welcome</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>envp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;_________________&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;try to patch me and find flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;please input a lucky number&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>patch_me</span><span class=p>(</span><span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;OK,see you again&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>程序挺简单的，需要寻找一下核心代码</p><p>看样子核心代码应该是在<code>patch_me(v4)</code>函数里面，进入函数内部</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=nf>patch_me</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a1</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;just finished&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>get_flag</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>继续跟进到<code>get_flag()</code>函数里面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=nf>get_flag</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v0</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+4h] [rbp-3Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>j</span><span class=p>;</span> <span class=c1>// [rsp+8h] [rbp-38h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>s</span><span class=p>;</span> <span class=c1>// [rsp+10h] [rbp-30h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-28h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [rsp+38h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v0</span> <span class=o>=</span> <span class=nf>time</span><span class=p>(</span><span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>srand</span><span class=p>(</span><span class=n>v0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>4</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span> <span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>200</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;OK, it&#39;s flag:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x28uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcat</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=n>f1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcat</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>f2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Solar not like you&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Solar want a girlfriend&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>4</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=mh>0x7F666F6067756369LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>v5</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcat</span><span class=p>(</span><span class=o>&amp;</span><span class=n>f2</span><span class=p>,</span> <span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>5</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=mi>7</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span> <span class=n>j</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=o>*</span><span class=p>(</span><span class=o>&amp;</span><span class=n>f2</span> <span class=o>+</span> <span class=n>j</span><span class=p>)</span> <span class=o>-=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=o>--*</span><span class=p>(</span><span class=o>&amp;</span><span class=n>f2</span> <span class=o>+</span> <span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;emmm,you can&#39;t find flag 23333&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>)</span> <span class=o>^</span> <span class=n>v6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>看来flag应该就在这个函数里面，本来觉得可以使用gdb调试出来，无奈自己太菜了，不知道到gdb怎么修改汇编代码进行跳转，只能进行静态分析调试</p><p>进行分析发现，<code>switch</code> 条件的顺序应该是 4 –> 5 —>1的顺序依次输出flag</p><p>写一个脚本将flag数据输出</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;GXY{do_not_&#39;</span>
</span></span><span class=line><span class=cl><span class=n>f2</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>][::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>f2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>f2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=n>s</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>运行脚本，得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>GXY{do_not_hate_me}
</span></span></code></pre></div><h2 id=0x5-findit>0x5 findit<a hidden class=anchor aria-hidden=true href=#0x5-findit>#</a></h2><p>看下题目哈</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>不知不觉，小明长大了，变成了一个程序员，虽然很苦逼，但是偶尔编写个小东西坑害公司新人还是蛮好玩的。新人小萌一天问小明wifi账号密码，一分钟后，小萌收到了一个文件。小萌想了好久都没得到密码，怎么办，女朋友要买东西，流量告罄，没wifi上不了网，不买就分手，是时候该展现月老的实力了兄弟们！代表月亮惩罚小明！得出答案。 注意：得到的 flag 请包上 flag{} 提交
</span></span></code></pre></div><p>感觉像是一道APK的题目，下载附件发现果然是一个APK的题目，使用APK逆向工具jadx进行逆向</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.example.findit</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.os.Bundle</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.support.v7.app.ActionBarActivity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.MenuItem</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.View</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.widget.Button</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.widget.EditText</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.widget.TextView</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainActivity</span> <span class=kd>extends</span> <span class=n>ActionBarActivity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* access modifiers changed from: protected */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span> <span class=c1>// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onCreate</span><span class=o>(</span><span class=n>Bundle</span> <span class=n>savedInstanceState</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>.</span><span class=na>onCreate</span><span class=o>(</span><span class=n>savedInstanceState</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>setContentView</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>layout</span><span class=o>.</span><span class=na>activity_main</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>EditText</span> <span class=n>edit</span> <span class=o>=</span> <span class=o>(</span><span class=n>EditText</span><span class=o>)</span> <span class=n>findViewById</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>widget2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>TextView</span> <span class=n>text</span> <span class=o>=</span> <span class=o>(</span><span class=n>TextView</span><span class=o>)</span> <span class=n>findViewById</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>widget1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>a</span> <span class=o>=</span> <span class=o>{</span><span class=sc>&#39;T&#39;</span><span class=o>,</span> <span class=sc>&#39;h&#39;</span><span class=o>,</span> <span class=sc>&#39;i&#39;</span><span class=o>,</span> <span class=sc>&#39;s&#39;</span><span class=o>,</span> <span class=sc>&#39;I&#39;</span><span class=o>,</span> <span class=sc>&#39;s&#39;</span><span class=o>,</span> <span class=sc>&#39;T&#39;</span><span class=o>,</span> <span class=sc>&#39;h&#39;</span><span class=o>,</span> <span class=sc>&#39;e&#39;</span><span class=o>,</span> <span class=sc>&#39;F&#39;</span><span class=o>,</span> <span class=sc>&#39;l&#39;</span><span class=o>,</span> <span class=sc>&#39;a&#39;</span><span class=o>,</span> <span class=sc>&#39;g&#39;</span><span class=o>,</span> <span class=sc>&#39;H&#39;</span><span class=o>,</span> <span class=sc>&#39;o&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;e&#39;</span><span class=o>};</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>b</span> <span class=o>=</span> <span class=o>{</span><span class=sc>&#39;p&#39;</span><span class=o>,</span> <span class=sc>&#39;v&#39;</span><span class=o>,</span> <span class=sc>&#39;k&#39;</span><span class=o>,</span> <span class=sc>&#39;q&#39;</span><span class=o>,</span> <span class=sc>&#39;{&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;1&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;5&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;0&#39;</span><span class=o>,</span> <span class=sc>&#39;3&#39;</span><span class=o>,</span> <span class=sc>&#39;3&#39;</span><span class=o>,</span> <span class=sc>&#39;l&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span> <span class=sc>&#39;9&#39;</span><span class=o>,</span> <span class=sc>&#39;l&#39;</span><span class=o>,</span> <span class=sc>&#39;n&#39;</span><span class=o>,</span> <span class=sc>&#39;p&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;p&#39;</span><span class=o>,</span> <span class=sc>&#39;9&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;n&#39;</span><span class=o>,</span> <span class=sc>&#39;k&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;8&#39;</span><span class=o>,</span> <span class=sc>&#39;k&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;5&#39;</span><span class=o>,</span> <span class=sc>&#39;}&#39;</span><span class=o>};</span>
</span></span><span class=line><span class=cl>        <span class=o>((</span><span class=n>Button</span><span class=o>)</span> <span class=n>findViewById</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>widget3</span><span class=o>)).</span><span class=na>setOnClickListener</span><span class=o>(</span><span class=k>new</span> <span class=n>View</span><span class=o>.</span><span class=na>OnClickListener</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=cm>/* class com.example.findit.MainActivity.AnonymousClass1 */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onClick</span><span class=o>(</span><span class=n>View</span> <span class=n>v</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>char</span><span class=o>[]</span> <span class=n>x</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=o>[</span><span class=mi>17</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                <span class=kt>char</span><span class=o>[]</span> <span class=n>y</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=o>[</span><span class=mi>38</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>17</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=o>((</span><span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;I&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;A&#39;</span><span class=o>)</span> <span class=o>||</span> <span class=o>(</span><span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;i&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;a&#39;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>+</span> <span class=mi>18</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>((</span><span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;A&#39;</span> <span class=o>||</span> <span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span> <span class=o>||</span> <span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;z&#39;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>a</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>-</span> <span class=sc>&#39;\b&#39;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>x</span><span class=o>).</span><span class=na>equals</span><span class=o>(</span><span class=n>edit</span><span class=o>.</span><span class=na>getText</span><span class=o>().</span><span class=na>toString</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i2</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i2</span> <span class=o>&lt;</span> <span class=mi>38</span><span class=o>;</span> <span class=n>i2</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=o>((</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;A&#39;</span> <span class=o>||</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span> <span class=o>||</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;z&#39;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>+</span> <span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=k>if</span> <span class=o>((</span><span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span><span class=o>)</span> <span class=o>||</span> <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;z&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>-</span> <span class=mi>26</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                            <span class=o>}</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>text</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>y</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=n>text</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=s>&#34;答案错了肿么办。。。不给你又不好意思。。。哎呀好纠结啊~~~&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onOptionsItemSelected</span><span class=o>(</span><span class=n>MenuItem</span> <span class=n>item</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>item</span><span class=o>.</span><span class=na>getItemId</span><span class=o>()</span> <span class=o>==</span> <span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>action_settings</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>onOptionsItemSelected</span><span class=o>(</span><span class=n>item</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>看样子好像是一个简单的加密程序，可以进行简单的分析</p><p>发现主要的flag代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i2</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i2</span> <span class=o>&lt;</span> <span class=mi>38</span><span class=o>;</span> <span class=n>i2</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;A&#39;</span> <span class=o>||</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span> <span class=o>||</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;z&#39;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>+</span> <span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>((</span><span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span><span class=o>)</span> <span class=o>||</span> <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;z&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>-</span> <span class=mi>26</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>text</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>y</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=k>return</span><span class=o>;</span>
</span></span></code></pre></div><p>这行代码稍加修改一下运行就可以直接俄得到flag了，写个Java的flag生成器，来生成flag吧！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>re</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Findit</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>final</span> <span class=kd>static</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>b</span> <span class=o>=</span> <span class=o>{</span><span class=sc>&#39;p&#39;</span><span class=o>,</span> <span class=sc>&#39;v&#39;</span><span class=o>,</span> <span class=sc>&#39;k&#39;</span><span class=o>,</span> <span class=sc>&#39;q&#39;</span><span class=o>,</span> <span class=sc>&#39;{&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;1&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;5&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;0&#39;</span><span class=o>,</span> <span class=sc>&#39;3&#39;</span><span class=o>,</span> <span class=sc>&#39;3&#39;</span><span class=o>,</span> <span class=sc>&#39;l&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span> <span class=sc>&#39;9&#39;</span><span class=o>,</span> <span class=sc>&#39;l&#39;</span><span class=o>,</span> <span class=sc>&#39;n&#39;</span><span class=o>,</span> <span class=sc>&#39;p&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;p&#39;</span><span class=o>,</span> <span class=sc>&#39;9&#39;</span><span class=o>,</span> <span class=sc>&#39;m&#39;</span><span class=o>,</span> <span class=sc>&#39;n&#39;</span><span class=o>,</span> <span class=sc>&#39;k&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;8&#39;</span><span class=o>,</span> <span class=sc>&#39;k&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;5&#39;</span><span class=o>,</span> <span class=sc>&#39;}&#39;</span><span class=o>};</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>char</span><span class=o>[]</span> <span class=n>y</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=o>[</span><span class=mi>38</span><span class=o>];</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i2</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i2</span> <span class=o>&lt;</span> <span class=mi>38</span><span class=o>;</span> <span class=n>i2</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	        <span class=k>if</span> <span class=o>((</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;A&#39;</span> <span class=o>||</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span> <span class=o>||</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;z&#39;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	            <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>];</span>
</span></span><span class=line><span class=cl>	        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	            <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>b</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>+</span> <span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	            <span class=k>if</span> <span class=o>((</span><span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;</span> <span class=sc>&#39;Z&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&lt;</span> <span class=sc>&#39;a&#39;</span><span class=o>)</span> <span class=o>||</span> <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>&gt;=</span> <span class=sc>&#39;z&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	                <span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>(</span><span class=n>y</span><span class=o>[</span><span class=n>i2</span><span class=o>]</span> <span class=o>-</span> <span class=mi>26</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	            <span class=o>}</span>
</span></span><span class=line><span class=cl>	        <span class=o>}</span>
</span></span><span class=line><span class=cl>	    <span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>y</span><span class=o>));</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>	
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>运行一下这个java程序就能生成flag啦！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{c164675262033b4c49bdf7f9cda28a75}
</span></span></code></pre></div><h2 id=0x6-简单的注册器>0x6 简单的注册器<a hidden class=anchor aria-hidden=true href=#0x6-简单的注册器>#</a></h2><p>看下题目</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>生活中难免会有需要使用一些付费的程序，但是没有绿色版怎么办？只能自己逆向看看注册程序的代码是什么逻辑了。 注意：得到的 flag 请包上 flag{} 提交
</span></span></code></pre></div><p>下载附件，发现是一个apk文件，使用apk逆向工具jadx查看apk的伪代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.example.flag</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.os.Bundle</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.support.v4.app.Fragment</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.support.v7.app.ActionBarActivity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.LayoutInflater</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.Menu</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.MenuItem</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.View</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.view.ViewGroup</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.widget.Button</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.widget.EditText</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>android.widget.TextView</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainActivity</span> <span class=kd>extends</span> <span class=n>ActionBarActivity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* access modifiers changed from: protected */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span> <span class=c1>// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onCreate</span><span class=o>(</span><span class=n>Bundle</span> <span class=n>savedInstanceState</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>.</span><span class=na>onCreate</span><span class=o>(</span><span class=n>savedInstanceState</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>setContentView</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>layout</span><span class=o>.</span><span class=na>activity_main</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>savedInstanceState</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>getSupportFragmentManager</span><span class=o>().</span><span class=na>beginTransaction</span><span class=o>().</span><span class=na>add</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>container</span><span class=o>,</span> <span class=k>new</span> <span class=n>PlaceholderFragment</span><span class=o>()).</span><span class=na>commit</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>TextView</span> <span class=n>textview</span> <span class=o>=</span> <span class=o>(</span><span class=n>TextView</span><span class=o>)</span> <span class=n>findViewById</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>textView1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>EditText</span> <span class=n>editview</span> <span class=o>=</span> <span class=o>(</span><span class=n>EditText</span><span class=o>)</span> <span class=n>findViewById</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>editText1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>((</span><span class=n>Button</span><span class=o>)</span> <span class=n>findViewById</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>button1</span><span class=o>)).</span><span class=na>setOnClickListener</span><span class=o>(</span><span class=k>new</span> <span class=n>View</span><span class=o>.</span><span class=na>OnClickListener</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=cm>/* class com.example.flag.MainActivity.AnonymousClass1 */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onClick</span><span class=o>(</span><span class=n>View</span> <span class=n>v</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>int</span> <span class=n>flag</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=n>String</span> <span class=n>xx</span> <span class=o>=</span> <span class=n>editview</span><span class=o>.</span><span class=na>getText</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(!(</span><span class=n>xx</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>32</span> <span class=o>&amp;&amp;</span> <span class=n>xx</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>31</span><span class=o>)</span> <span class=o>==</span> <span class=sc>&#39;a&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>xx</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>1</span><span class=o>)</span> <span class=o>==</span> <span class=sc>&#39;b&#39;</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>xx</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>0</span><span class=o>)</span> <span class=o>+</span> <span class=n>xx</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>2</span><span class=o>))</span> <span class=o>-</span> <span class=mi>48</span> <span class=o>==</span> <span class=mi>56</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>flag</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>flag</span> <span class=o>==</span> <span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=kt>char</span><span class=o>[]</span> <span class=n>x</span> <span class=o>=</span> <span class=s>&#34;dd2940c04462b4dd7c450528835cca15&#34;</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                    <span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>3</span><span class=o>])</span> <span class=o>-</span> <span class=mi>50</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>x</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>5</span><span class=o>])</span> <span class=o>-</span> <span class=mi>48</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>x</span><span class=o>[</span><span class=mi>30</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>31</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>9</span><span class=o>])</span> <span class=o>-</span> <span class=mi>48</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>x</span><span class=o>[</span><span class=mi>14</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>27</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>28</span><span class=o>])</span> <span class=o>-</span> <span class=mi>97</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>char</span> <span class=n>a</span> <span class=o>=</span> <span class=n>x</span><span class=o>[</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>[</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>a</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>textview</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=s>&#34;flag{&#34;</span> <span class=o>+</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>x</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;}&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=n>textview</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=s>&#34;输入注册码错误&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onCreateOptionsMenu</span><span class=o>(</span><span class=n>Menu</span> <span class=n>menu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>getMenuInflater</span><span class=o>().</span><span class=na>inflate</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>menu</span><span class=o>.</span><span class=na>main</span><span class=o>,</span> <span class=n>menu</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onOptionsItemSelected</span><span class=o>(</span><span class=n>MenuItem</span> <span class=n>item</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>item</span><span class=o>.</span><span class=na>getItemId</span><span class=o>()</span> <span class=o>==</span> <span class=n>R</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>action_settings</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>onOptionsItemSelected</span><span class=o>(</span><span class=n>item</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>PlaceholderFragment</span> <span class=kd>extends</span> <span class=n>Fragment</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span> <span class=c1>// android.support.v4.app.Fragment
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>public</span> <span class=n>View</span> <span class=nf>onCreateView</span><span class=o>(</span><span class=n>LayoutInflater</span> <span class=n>inflater</span><span class=o>,</span> <span class=n>ViewGroup</span> <span class=n>container</span><span class=o>,</span> <span class=n>Bundle</span> <span class=n>savedInstanceState</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>inflater</span><span class=o>.</span><span class=na>inflate</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>layout</span><span class=o>.</span><span class=na>fragment_main</span><span class=o>,</span> <span class=n>container</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>进行简单的代码审计，可以确定核心代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=n>flag</span> <span class=o>==</span> <span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>[]</span> <span class=n>x</span> <span class=o>=</span> <span class=s>&#34;dd2940c04462b4dd7c450528835cca15&#34;</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>3</span><span class=o>])</span> <span class=o>-</span> <span class=mi>50</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>5</span><span class=o>])</span> <span class=o>-</span> <span class=mi>48</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=o>[</span><span class=mi>30</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>31</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>9</span><span class=o>])</span> <span class=o>-</span> <span class=mi>48</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=o>[</span><span class=mi>14</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>27</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>28</span><span class=o>])</span> <span class=o>-</span> <span class=mi>97</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>a</span> <span class=o>=</span> <span class=n>x</span><span class=o>[</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>[</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>a</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>textview</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=s>&#34;flag{&#34;</span> <span class=o>+</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>x</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;}&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>写一个Java注册器，把flag注册出来</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>re</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Register</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>char</span><span class=o>[]</span> <span class=n>x</span> <span class=o>=</span> <span class=s>&#34;dd2940c04462b4dd7c450528835cca15&#34;</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	    <span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>3</span><span class=o>])</span> <span class=o>-</span> <span class=mi>50</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	    <span class=n>x</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>5</span><span class=o>])</span> <span class=o>-</span> <span class=mi>48</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	    <span class=n>x</span><span class=o>[</span><span class=mi>30</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>31</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>9</span><span class=o>])</span> <span class=o>-</span> <span class=mi>48</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	    <span class=n>x</span><span class=o>[</span><span class=mi>14</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span> <span class=o>((</span><span class=n>x</span><span class=o>[</span><span class=mi>27</span><span class=o>]</span> <span class=o>+</span> <span class=n>x</span><span class=o>[</span><span class=mi>28</span><span class=o>])</span> <span class=o>-</span> <span class=mi>97</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	    <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	        <span class=kt>char</span> <span class=n>a</span> <span class=o>=</span> <span class=n>x</span><span class=o>[</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>	        <span class=n>x</span><span class=o>[</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>	        <span class=n>x</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>a</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	    <span class=o>}</span>
</span></span><span class=line><span class=cl>	    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;flag{&#34;</span> <span class=o>+</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>x</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;}&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>运行注册器来注册一个flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{59acc538825054c7de4b26440c0999dd}
</span></span></code></pre></div><h2 id=0x7-bjdctf2020justre>0x7 [BJDCTF2020]JustRE<a hidden class=anchor aria-hidden=true href=#0x7-bjdctf2020justre>#</a></h2><p>下载下来是一个挺有意思的exe程序</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210902121321802.png alt=image-20210902121321802></p><p>走下流程，首先是查询文件</p><p><img loading=lazy src=/images/BUUCTF-REVERSE-2_writeup/image-20210902121542969.png alt=image-20210902121542969></p><p>32位的PE程序，使用IDA pro反汇编通过检索BJD的字符串来定位到核心代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>INT_PTR</span> <span class=kr>__stdcall</span> <span class=nf>DialogFunc</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>a2</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>a3</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>a4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>CHAR</span> <span class=n>String</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span> <span class=c1>// [esp+0h] [ebp-64h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>!=</span> <span class=mi>272</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>!=</span> <span class=mi>273</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=n>_WORD</span><span class=p>)</span><span class=n>a3</span> <span class=o>!=</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>_WORD</span><span class=p>)</span><span class=n>a3</span> <span class=o>!=</span> <span class=mi>2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>sprintf</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>Format</span><span class=p>,</span> <span class=o>++</span><span class=n>dword_4099F0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>dword_4099F0</span> <span class=o>==</span> <span class=mi>19999</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>sprintf</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=s>&#34; BJD{%d%d2069a45792d233ac}&#34;</span><span class=p>,</span> <span class=mi>19999</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>SetWindowTextA</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>String</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nf>SetWindowTextA</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>String</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>EndDialog</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int16</span><span class=p>)</span><span class=n>a3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>发现核心代码中隐藏着flag的信息，得到flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>BJD{1999902069a45792d233ac}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/ctf/>ctf</a></li><li><a href=/tags/writeup/>writeup</a></li><li><a href=/tags/reverse/>Reverse</a></li></ul><nav class=paginav><a class=prev href=/posts/buuctf-reverse-3_writeup/><span class=title>« Prev</span><br><span>BUUCTF REVERSE [17~24]_Writeup</span></a>
<a class=next href=/posts/xctf-reverse-novice_writeup/><span class=title>Next »</span><br><span>XCTF REVERSE novice_writeup</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href>Jasmine❀Hiker</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script><script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>